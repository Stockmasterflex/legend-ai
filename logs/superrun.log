[ERROR] warp-run-docs not found. Install it or provide the command to run.
2025-09-16 23:45:44 === LegendAI Doc Superrun starting (PROJECT_DIR=/Users/kyleholthaus/Projects/LegendAI/scripts/..) ===
2025-09-16 23:45:44 === Iteration 1 ===
2025-09-16 23:45:44 venv exists
2025-09-16 23:45:44 Installing Python requirements
2025-09-16 23:45:45 shots: node_modules present
2025-09-16 23:45:45 frontend: node_modules present
2025-09-16 23:45:45 Running unit tests (pytest)
2025-09-16 23:45:45 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-16 23:45:45 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-16 23:45:45 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Tue Sep 16 23:24:30 2025)
fe: 1 windows (created Tue Sep 16 23:24:30 2025)
legend-docs: 1 windows (created Tue Sep 16 23:45:43 2025)
shots: 1 windows (created Tue Sep 16 23:24:30 2025)

Ports:
python3.1 13856 kyleholthaus    3u  IPv4 0x4abf832ca3f99a36      0t0  TCP 127.0.0.1:8000 (LISTEN)
node      13863 kyleholthaus   14u  IPv6 0x5cc7c8cf63bff8a9      0t0  TCP *:3010 (LISTEN)
node      13929 kyleholthaus   16u  IPv6  0x83471d01bbeda1e      0t0  TCP *:3001 (LISTEN)
python3.1 17179 kyleholthaus    3u  IPv4 0x4abf832ca3f99a36      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-16 23:39:07,650", "levelname": "INFO", "message": "request", "request_id": "ddc6c52d-dd1c-45c4-bb76-ab0ffc3c2d2a", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 94}
INFO:     127.0.0.1:58144 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-16 23:39:07,658", "levelname": "INFO", "message": "request", "request_id": "0ac19e07-b6b7-449f-9d16-8d2c2d3016a9", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 5}
INFO:     127.0.0.1:58147 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-16 23:45:45,267", "levelname": "INFO", "message": "request", "request_id": "450d0eb9-ef41-40ed-b411-a76b28e631ff", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:58326 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-16 23:45:45,401", "levelname": "INFO", "message": "request", "request_id": "b3abc967-a220-4dc0-b4f8-0532e5b05dce", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:58329 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-16 23:45:45,666", "levelname": "INFO", "message": "request", "request_id": "89f6fb10-293f-4e73-aac9-18036e82617c", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 252}
INFO:     127.0.0.1:58330 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
legend-shots listening on :3010
---- logs/fe.log ----

> kyle-thomas-portfolio@0.1.0 dev
> next dev -p 3001

  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1238ms
2025-09-16 23:45:45 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

67.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=NVDA+Chart",
  "meta": {
    "source": "dummy",
    "overlay_applied": false,
    "fallback": true,
    "error": "shots status 500"
  }
}

2025-09-16 23:45:46 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
67.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=NVDA+Chart",
  "dry_run": true
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=NVDA+Chart",
  "meta": {
    "source": "dummy",
    "overlay_applied": false,
    "fallback": true,
    "error": "shots status 500"
  }
}
2025-09-16 23:45:46 Running sample backtest
2025-09-16 23:45:46 Phase 4 optional: AI trading demo
2025-09-16 23:45:46 Deploy skipped (DO_DEPLOY!=1)
2025-09-16 23:45:46 Sleeping 5m before next iteration
2025-09-16 23:47:10 === LegendAI Doc Superrun starting (PROJECT_DIR=/Users/kyleholthaus/Projects/LegendAI/scripts/..) ===
2025-09-16 23:47:10 === Iteration 1 ===
2025-09-16 23:47:10 venv exists
2025-09-16 23:47:10 Installing Python requirements
2025-09-16 23:47:11 shots: node_modules present
2025-09-16 23:47:11 frontend: node_modules present
2025-09-16 23:47:11 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
...................                                                      [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

test_production.py::test_health_endpoint
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_health_endpoint returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_vcp_scan
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_vcp_scan returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_api_endpoints
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_api_endpoints returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_database_operations
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_database_operations returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_performance
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_performance returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
19 passed, 6 warnings in 11.36s
2025-09-16 23:47:24 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-16 23:47:24 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-16 23:47:24 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Tue Sep 16 23:24:30 2025)
fe: 1 windows (created Tue Sep 16 23:24:30 2025)
legend-docs: 1 windows (created Tue Sep 16 23:47:09 2025)
shots: 1 windows (created Tue Sep 16 23:24:30 2025)

Ports:
python3.1 13856 kyleholthaus    3u  IPv4 0x4abf832ca3f99a36      0t0  TCP 127.0.0.1:8000 (LISTEN)
node      13863 kyleholthaus   14u  IPv6 0x5cc7c8cf63bff8a9      0t0  TCP *:3010 (LISTEN)
node      13929 kyleholthaus   16u  IPv6  0x83471d01bbeda1e      0t0  TCP *:3001 (LISTEN)
python3.1 17179 kyleholthaus    3u  IPv4 0x4abf832ca3f99a36      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-16 23:47:18,879", "levelname": "INFO", "message": "request", "request_id": "4b7b4be8-b757-46c9-9121-6c2476612a99", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 40}
INFO:     127.0.0.1:58395 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-16 23:47:18,885", "levelname": "INFO", "message": "request", "request_id": "af0d24fe-41d7-4377-8ff9-9fe6e417d636", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:58398 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-16 23:47:24,238", "levelname": "INFO", "message": "request", "request_id": "2c2a01e8-2c36-46f4-a45c-8275efd32fff", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:58423 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-16 23:47:24,361", "levelname": "INFO", "message": "request", "request_id": "4d6b354d-6c1d-4394-b1cb-193b79ba25eb", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 0}
INFO:     127.0.0.1:58426 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-16 23:47:24,394", "levelname": "INFO", "message": "request", "request_id": "36a0c904-50be-40f5-9d4f-9682ebdce28d", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 22}
INFO:     127.0.0.1:58427 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
legend-shots listening on :3010
---- logs/fe.log ----

> kyle-thomas-portfolio@0.1.0 dev
> next dev -p 3001

  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1238ms
2025-09-16 23:47:24 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

67.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=NVDA+Chart",
  "meta": {
    "source": "dummy",
    "overlay_applied": false,
    "fallback": true,
    "error": "shots status 500"
  }
}

2025-09-16 23:47:24 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
67.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=NVDA+Chart",
  "dry_run": true
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=NVDA+Chart",
  "meta": {
    "source": "dummy",
    "overlay_applied": false,
    "fallback": true,
    "error": "shots status 500"
  }
}
2025-09-16 23:47:24 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-16 23:47:28 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
üì¶ installed ta
üì¶ installed transformers
üì¶ installed torch
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-16 23:48:19 Deploy skipped (DO_DEPLOY!=1)
2025-09-16 23:48:19 Sleeping 5m before next iteration
2025-09-16 23:53:19 === Iteration 2 ===
2025-09-16 23:53:19 venv exists
2025-09-16 23:53:19 Installing Python requirements
2025-09-16 23:53:21 shots: node_modules present
2025-09-16 23:53:21 frontend: node_modules present
2025-09-16 23:53:21 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
...................                                                      [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

test_production.py::test_health_endpoint
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_health_endpoint returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_vcp_scan
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_vcp_scan returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_api_endpoints
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_api_endpoints returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_database_operations
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_database_operations returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_performance
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_performance returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
19 passed, 6 warnings in 7.97s
2025-09-16 23:53:31 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-16 23:53:31 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-16 23:53:31 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Tue Sep 16 23:24:30 2025)
fe: 1 windows (created Tue Sep 16 23:24:30 2025)
legend-docs: 1 windows (created Tue Sep 16 23:47:09 2025)
shots: 1 windows (created Tue Sep 16 23:24:30 2025)

Ports:
python3.1 13856 kyleholthaus    3u  IPv4 0x4abf832ca3f99a36      0t0  TCP 127.0.0.1:8000 (LISTEN)
node      13863 kyleholthaus   14u  IPv6 0x5cc7c8cf63bff8a9      0t0  TCP *:3010 (LISTEN)
node      13929 kyleholthaus   16u  IPv6  0x83471d01bbeda1e      0t0  TCP *:3001 (LISTEN)
python3.1 17179 kyleholthaus    3u  IPv4 0x4abf832ca3f99a36      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-16 23:53:26,385", "levelname": "INFO", "message": "request", "request_id": "155173bf-2c32-4eb0-b4d4-f0e377661808", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 9}
INFO:     127.0.0.1:58686 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-16 23:53:26,389", "levelname": "INFO", "message": "request", "request_id": "f1e08d6d-e661-44ce-86b8-a3face60a536", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:58689 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-16 23:53:31,182", "levelname": "INFO", "message": "request", "request_id": "5977e767-d3be-49a3-a25e-69b865f8b52e", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:58713 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-16 23:53:31,271", "levelname": "INFO", "message": "request", "request_id": "24670296-c84a-49af-a165-ebd4c20d36de", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 0}
INFO:     127.0.0.1:58716 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-16 23:53:31,294", "levelname": "INFO", "message": "request", "request_id": "57bd117a-c49a-43e4-acb5-fa232d7486d8", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 14}
INFO:     127.0.0.1:58717 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
legend-shots listening on :3010
---- logs/fe.log ----

> kyle-thomas-portfolio@0.1.0 dev
> next dev -p 3001

  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1238ms
2025-09-16 23:53:31 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

67.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=NVDA+Chart",
  "meta": {
    "source": "dummy",
    "overlay_applied": false,
    "fallback": true,
    "error": "shots status 500"
  }
}

2025-09-16 23:53:31 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
67.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=NVDA+Chart",
  "dry_run": true
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=NVDA+Chart",
  "meta": {
    "source": "dummy",
    "overlay_applied": false,
    "fallback": true,
    "error": "shots status 500"
  }
}
2025-09-16 23:53:31 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-17 06:53:35.095813', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-16 23:53:35 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-16 23:53:41 Deploy skipped (DO_DEPLOY!=1)
2025-09-16 23:53:41 Sleeping 5m before next iteration
2025-09-16 23:58:41 === Iteration 3 ===
2025-09-16 23:58:41 venv exists
2025-09-16 23:58:41 Installing Python requirements
2025-09-16 23:58:42 shots: node_modules present
2025-09-16 23:58:42 frontend: node_modules present
2025-09-16 23:58:42 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
...................                                                      [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

test_production.py::test_health_endpoint
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_health_endpoint returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_vcp_scan
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_vcp_scan returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_api_endpoints
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_api_endpoints returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_database_operations
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_database_operations returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_performance
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_performance returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
19 passed, 6 warnings in 8.02s
2025-09-16 23:58:51 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-16 23:58:51 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-16 23:58:52 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Tue Sep 16 23:24:30 2025)
fe: 1 windows (created Tue Sep 16 23:24:30 2025)
legend-docs: 1 windows (created Tue Sep 16 23:47:09 2025)
shots: 1 windows (created Tue Sep 16 23:24:30 2025)

Ports:
python3.1 13856 kyleholthaus    3u  IPv4 0x4abf832ca3f99a36      0t0  TCP 127.0.0.1:8000 (LISTEN)
node      13863 kyleholthaus   14u  IPv6 0x5cc7c8cf63bff8a9      0t0  TCP *:3010 (LISTEN)
node      13929 kyleholthaus   16u  IPv6  0x83471d01bbeda1e      0t0  TCP *:3001 (LISTEN)
python3.1 17179 kyleholthaus    3u  IPv4 0x4abf832ca3f99a36      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-16 23:58:47,051", "levelname": "INFO", "message": "request", "request_id": "34e915fc-3683-460a-9bfa-a7b101fd4447", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 9}
INFO:     127.0.0.1:58904 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-16 23:58:47,056", "levelname": "INFO", "message": "request", "request_id": "a7eafac0-a25f-4ade-b84f-8278850a5e82", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:58907 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-16 23:58:52,031", "levelname": "INFO", "message": "request", "request_id": "124fb2f1-1914-49b7-bd20-1985a70fb958", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 0}
INFO:     127.0.0.1:58938 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-16 23:58:52,172", "levelname": "INFO", "message": "request", "request_id": "28c08f7d-be59-440d-8b59-391fbcf911c3", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:58941 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-16 23:58:52,199", "levelname": "INFO", "message": "request", "request_id": "0b3777f2-a53b-4bc9-8cc3-e134d0c21a1e", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 15}
INFO:     127.0.0.1:58942 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
legend-shots listening on :3010
---- logs/fe.log ----

> kyle-thomas-portfolio@0.1.0 dev
> next dev -p 3001

  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1238ms
2025-09-16 23:58:52 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

67.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=NVDA+Chart",
  "meta": {
    "source": "dummy",
    "overlay_applied": false,
    "fallback": true,
    "error": "shots status 500"
  }
}

2025-09-16 23:58:52 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
67.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=NVDA+Chart",
  "dry_run": true
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=NVDA+Chart",
  "meta": {
    "source": "dummy",
    "overlay_applied": false,
    "fallback": true,
    "error": "shots status 500"
  }
}
2025-09-16 23:58:52 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-17 06:58:56.070244', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-16 23:58:56 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-16 23:59:02 Deploy skipped (DO_DEPLOY!=1)
2025-09-16 23:59:02 Sleeping 5m before next iteration
2025-09-17 13:42:26 === LegendAI Doc Superrun starting (PROJECT_DIR=/Users/kyleholthaus/Projects/LegendAI/scripts/..) ===
2025-09-17 13:42:26 === Iteration 1 ===
2025-09-17 13:42:26 venv exists
2025-09-17 13:42:26 Installing Python requirements
2025-09-17 13:42:27 shots: node_modules present
2025-09-17 13:42:27 frontend: node_modules present
2025-09-17 13:42:27 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
...................                                                      [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

test_production.py::test_health_endpoint
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_health_endpoint returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_vcp_scan
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_vcp_scan returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_api_endpoints
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_api_endpoints returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_database_operations
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_database_operations returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_performance
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_performance returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
19 passed, 6 warnings in 11.74s
2025-09-17 13:42:41 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 13:42:41 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 13:42:41 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 13:42:23 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 13:42:33,222", "levelname": "INFO", "message": "request", "request_id": "1da04e1b-8c8f-4612-9850-a975208ad9d1", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 22}
INFO:     127.0.0.1:61556 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 13:42:33,227", "levelname": "INFO", "message": "request", "request_id": "72420fb6-85c6-4691-bde4-6c95219eec2b", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:61559 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 13:42:41,287", "levelname": "INFO", "message": "request", "request_id": "9f3a3c3a-5dea-448d-bde4-39df59de3ce7", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:61582 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 13:42:53,632", "levelname": "INFO", "message": "request", "request_id": "5f4aea18-129f-4d97-b40a-a838011ce723", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 4}
INFO:     127.0.0.1:61616 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 13:42:53,938", "levelname": "INFO", "message": "request", "request_id": "6c4cc860-79e6-4520-858f-54af4049066d", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 285}
INFO:     127.0.0.1:61617 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 12052,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758141773329.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 7223,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758141781071.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 13:43:01 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758141788751.png",
  "meta": {
    "source": "http://127.0.0.1:3010",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 7066.97
  }
}

2025-09-17 13:43:08 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758141796056.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 7164
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758141805181.png",
  "meta": {
    "source": "http://127.0.0.1:3010",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8610.3
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 145,
  "sample": {
    "symbol": "DG",
    "score": 89.73,
    "entry": 69.6163,
    "stop": 67.7259,
    "targets": [
      71.8387,
      73.3203
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 66.8,
          "x2": "2025-09-15",
          "y2": 69.27,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 63.096,
          "x2": "2025-09-15",
          "y2": 68.41,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 68.84
        }
      ],
      "priceLevels": {
        "entry": 69.6163,
        "stop": 67.7259,
        "targets": [
          71.8387,
          73.3203
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.23",
        "slope gap 0.0095"
      ],
      "direction": "falling",
      "atr14": 4.025,
      "sector": "Consumer Defensive"
    },
    "avg_price": 58.824666595458986,
    "avg_volume": 10344398.1,
    "key_levels": {
      "entry": 69.6163,
      "stop": 67.7259,
      "targets": [
        71.8387,
        73.3203
      ]
    },
    "atr14": 4.025,
    "sector": "Consumer Defensive",
    "chart_url": "http://127.0.0.1:3010/reports/DG-1758141850165.png"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/AAPL-1758141858596.png",
  "meta": {
    "source": "http://127.0.0.1:3010",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8200.72
  }
}
2025-09-17 13:44:18 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 13:44:22 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 13:44:39 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 13:44:39 Sleeping 5m before next iteration
2025-09-17 13:47:32 === LegendAI Doc Superrun starting (PROJECT_DIR=/Users/kyleholthaus/Projects/LegendAI/scripts/..) ===
2025-09-17 13:47:32 === Iteration 1 ===
2025-09-17 13:47:32 venv exists
2025-09-17 13:47:32 Installing Python requirements
2025-09-17 13:47:34 shots: node_modules present
2025-09-17 13:47:34 frontend: node_modules present
2025-09-17 13:47:34 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
...................                                                      [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

test_production.py::test_health_endpoint
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_health_endpoint returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_vcp_scan
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_vcp_scan returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_api_endpoints
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_api_endpoints returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_database_operations
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_database_operations returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_performance
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_performance returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
19 passed, 6 warnings in 9.04s
2025-09-17 13:47:44 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 13:47:44 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 13:47:44 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 13:47:31 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 13:47:39,356", "levelname": "INFO", "message": "request", "request_id": "480d355a-fbcc-41e3-8625-937242764502", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 18}
INFO:     127.0.0.1:62879 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 13:47:39,363", "levelname": "INFO", "message": "request", "request_id": "76c0f7ed-7195-4a81-b7aa-4061484146b4", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:62882 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 13:47:44,968", "levelname": "INFO", "message": "request", "request_id": "181a9b5d-e249-482c-b61f-d4eebe6ae0cb", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:62907 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 13:47:52,165", "levelname": "INFO", "message": "request", "request_id": "6a8fc347-7114-42bc-9565-d7f3ab3da13c", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:62945 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 13:47:52,230", "levelname": "INFO", "message": "request", "request_id": "3bf184e2-776c-4af0-a335-cdd3aa4f968f", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 46}
INFO:     127.0.0.1:62946 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 7031,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758142071921.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5208,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758142077359.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 13:47:57 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758142082711.png",
  "meta": {
    "source": "http://127.0.0.1:3010",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 4919.73
  }
}

2025-09-17 13:48:02 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758142088448.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5548
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758142094125.png",
  "meta": {
    "source": "http://127.0.0.1:3010",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 5616.3
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 164,
  "sample": {
    "symbol": "ARE",
    "score": 88.11,
    "entry": 85.0699,
    "stop": 80.3286,
    "targets": [
      92.4979,
      97.4499
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 91.66,
          "x2": "2025-09-15",
          "y2": 84.6467,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 79.28,
          "x2": "2025-09-15",
          "y2": 81.14,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 82.8933
        }
      ],
      "priceLevels": {
        "entry": 85.0699,
        "stop": 80.3286,
        "targets": [
          92.4979,
          97.4499
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.28",
        "slope gap 0.0170"
      ],
      "direction": "falling",
      "atr14": 4.5891,
      "sector": "Real Estate"
    },
    "avg_price": 67.01066678365072,
    "avg_volume": 13664847.3,
    "key_levels": {
      "entry": 85.0699,
      "stop": 80.3286,
      "targets": [
        92.4979,
        97.4499
      ]
    },
    "atr14": 4.5891,
    "sector": "Real Estate",
    "chart_url": "http://127.0.0.1:3010/reports/ARE-1758142128442.png"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/AAPL-1758142133805.png",
  "meta": {
    "source": "http://127.0.0.1:3010",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 5226.74
  }
}
2025-09-17 13:48:53 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-17 20:48:57.458963', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 13:48:57 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 13:49:04 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 13:49:04 Sleeping 5m before next iteration
2025-09-17 13:54:04 === Iteration 2 ===
2025-09-17 13:54:04 venv exists
2025-09-17 13:54:04 Installing Python requirements
2025-09-17 13:54:05 shots: node_modules present
2025-09-17 13:54:05 frontend: node_modules present
2025-09-17 13:54:05 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
...................                                                      [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

test_production.py::test_health_endpoint
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_health_endpoint returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_vcp_scan
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_vcp_scan returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_api_endpoints
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_api_endpoints returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_database_operations
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_database_operations returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_performance
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_performance returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
19 passed, 6 warnings in 8.50s
2025-09-17 13:54:15 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 13:54:15 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 13:54:15 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 13:47:31 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 13:54:10,512", "levelname": "INFO", "message": "request", "request_id": "8f703556-36ca-4a37-a3dd-f5575957682e", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 16}
INFO:     127.0.0.1:64122 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 13:54:10,517", "levelname": "INFO", "message": "request", "request_id": "899583e5-1f67-4dfc-bbef-40cc1bc65256", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:64125 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 13:54:15,794", "levelname": "INFO", "message": "request", "request_id": "7a1c3b2d-553f-4593-b51f-b8be7655cb89", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64148 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 13:54:23,075", "levelname": "INFO", "message": "request", "request_id": "b9d101e8-d82a-48c6-83ef-dcd0e1820762", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:64180 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 13:54:23,143", "levelname": "INFO", "message": "request", "request_id": "138f2ca4-761a-4d02-b7f7-7a5c6a90d2df", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 48}
INFO:     127.0.0.1:64181 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 7125,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758142462856.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5197,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758142468254.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 13:54:28 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758142473073.png",
  "meta": {
    "source": "http://127.0.0.1:3010",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 4648.77
  }
}

2025-09-17 13:54:33 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758142477807.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 4626
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758142483595.png",
  "meta": {
    "source": "http://127.0.0.1:3010",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 5702.3
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 131,
  "sample": {
    "symbol": "MCD",
    "score": 85.33,
    "entry": 58.2197,
    "stop": 54.9945,
    "targets": [
      62.9115,
      66.0394
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 107.672,
          "x2": "2025-09-15",
          "y2": 57.93,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 99.8522,
          "x2": "2025-09-15",
          "y2": 55.55,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 56.74
        }
      ],
      "priceLevels": {
        "entry": 58.2197,
        "stop": 54.9945,
        "targets": [
          62.9115,
          66.0394
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.30",
        "slope gap 0.0213"
      ],
      "direction": "falling",
      "atr14": 4.0684,
      "sector": "Consumer Cyclical"
    },
    "avg_price": 53.675659306844075,
    "avg_volume": 10704263.433333334,
    "key_levels": {
      "entry": 58.2197,
      "stop": 54.9945,
      "targets": [
        62.9115,
        66.0394
      ]
    },
    "atr14": 4.0684,
    "sector": "Consumer Cyclical",
    "chart_url": "http://127.0.0.1:3010/reports/MCD-1758142515849.png"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/AAPL-1758142521568.png",
  "meta": {
    "source": "http://127.0.0.1:3010",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 5624.78
  }
}
2025-09-17 13:55:21 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-17 20:55:25.456927', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 13:55:25 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 13:55:31 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 13:55:31 Sleeping 5m before next iteration
2025-09-17 14:00:31 === Iteration 3 ===
2025-09-17 14:00:31 venv exists
2025-09-17 14:00:31 Installing Python requirements
2025-09-17 14:00:33 shots: node_modules present
2025-09-17 14:00:33 frontend: node_modules present
2025-09-17 14:00:33 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
...................                                                      [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

test_production.py::test_health_endpoint
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_health_endpoint returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_vcp_scan
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_vcp_scan returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_api_endpoints
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_api_endpoints returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_database_operations
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_database_operations returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_performance
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_performance returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
19 passed, 6 warnings in 9.39s
2025-09-17 14:00:44 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 14:00:44 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 14:00:45 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 13:47:31 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 14:00:39,342", "levelname": "INFO", "message": "request", "request_id": "75cf876e-86b2-499c-95dd-1bae063bcecb", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 23}
INFO:     127.0.0.1:65313 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 14:00:39,350", "levelname": "INFO", "message": "request", "request_id": "ad86bb84-0ee1-41bf-96aa-d34454d5016e", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 5}
INFO:     127.0.0.1:65316 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:00:44,960", "levelname": "INFO", "message": "request", "request_id": "b69f2606-0343-4f61-b522-dbe0a718f467", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 4}
INFO:     127.0.0.1:65340 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:00:53,183", "levelname": "INFO", "message": "request", "request_id": "45dd785f-20ce-47f0-b70d-b22f8e809962", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 6}
INFO:     127.0.0.1:65385 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:00:53,326", "levelname": "INFO", "message": "request", "request_id": "9ce29578-2dd2-49f7-abbf-077b5e9e9fec", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 108}
INFO:     127.0.0.1:65386 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 7802,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758142852914.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 6981,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758142860246.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 14:01:00 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758142867928.png",
  "meta": {
    "source": "http://127.0.0.1:3010",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 7115.81
  }
}

2025-09-17 14:01:08 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758142874846.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6682
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758142881442.png",
  "meta": {
    "source": "http://127.0.0.1:3010",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 7012.6
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 134,
  "sample": {
    "symbol": "NDAQ",
    "score": 88.91,
    "entry": 187.121,
    "stop": 178.0713,
    "targets": [
      201.4358,
      210.9791
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 284.755,
          "x2": "2025-09-15",
          "y2": 186.19,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 260.8969,
          "x2": "2025-09-15",
          "y2": 179.87,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 183.03
        }
      ],
      "priceLevels": {
        "entry": 187.121,
        "stop": 178.0713,
        "targets": [
          201.4358,
          210.9791
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.26",
        "slope gap 0.0683"
      ],
      "direction": "falling",
      "atr14": 9.5991,
      "sector": "Financial Services"
    },
    "avg_price": 208.48872934977214,
    "avg_volume": 2926685.566666667,
    "key_levels": {
      "entry": 187.121,
      "stop": 178.0713,
      "targets": [
        201.4358,
        210.9791
      ]
    },
    "atr14": 9.5991,
    "sector": "Financial Services",
    "chart_url": "http://127.0.0.1:3010/reports/NDAQ-1758142918630.png"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/AAPL-1758142927537.png",
  "meta": {
    "source": "http://127.0.0.1:3010",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8506.11
  }
}
2025-09-17 14:02:07 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-17 21:02:11.549986', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 14:02:11 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 14:02:20 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 14:02:20 Sleeping 5m before next iteration
2025-09-17 14:03:04 === LegendAI Doc Superrun starting (PROJECT_DIR=/Users/kyleholthaus/Projects/LegendAI/scripts/..) ===
2025-09-17 14:03:04 === Iteration 1 ===
2025-09-17 14:03:04 venv exists
2025-09-17 14:03:04 Installing Python requirements
2025-09-17 14:03:06 shots: node_modules present
2025-09-17 14:03:06 frontend: node_modules present
2025-09-17 14:03:06 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
...................                                                      [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

test_production.py::test_health_endpoint
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_health_endpoint returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_vcp_scan
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_vcp_scan returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_api_endpoints
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_api_endpoints returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_database_operations
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_database_operations returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_performance
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_performance returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
19 passed, 6 warnings in 9.92s
2025-09-17 14:03:17 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 14:03:17 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 14:03:18 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:03:02 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 14:03:11,656", "levelname": "INFO", "message": "request", "request_id": "10785ff1-60b8-4f55-a792-ba083cda2d25", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 14}
INFO:     127.0.0.1:49956 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 14:03:11,661", "levelname": "INFO", "message": "request", "request_id": "b3c27caf-7e7a-4f62-9792-2a7849e4e251", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:49959 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:03:18,005", "levelname": "INFO", "message": "request", "request_id": "dad68973-caf3-44ad-9128-e2803df48286", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:49984 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:03:25,713", "levelname": "INFO", "message": "request", "request_id": "31073e7d-e05c-4ddc-b344-c5fb6ab7e1c1", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:50018 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:03:25,773", "levelname": "INFO", "message": "request", "request_id": "016dde93-74e0-4acc-967d-c272e8f1968e", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 48}
INFO:     127.0.0.1:50019 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 7531,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758143005511.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5089,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758143010795.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 14:03:30 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758143016528.png",
  "meta": {
    "source": "http://127.0.0.1:3010",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 5415.47
  }
}

2025-09-17 14:03:36 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758143021442.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 4800
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758143026214.png",
  "meta": {
    "source": "http://127.0.0.1:3010",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 4757.91
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 205,
  "sample": {
    "symbol": "NDAQ",
    "score": 88.91,
    "entry": 187.121,
    "stop": 178.0713,
    "targets": [
      201.4358,
      210.9791
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 284.755,
          "x2": "2025-09-15",
          "y2": 186.19,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 260.8969,
          "x2": "2025-09-15",
          "y2": 179.87,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 183.03
        }
      ],
      "priceLevels": {
        "entry": 187.121,
        "stop": 178.0713,
        "targets": [
          201.4358,
          210.9791
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.26",
        "slope gap 0.0683"
      ],
      "direction": "falling",
      "atr14": 9.5991,
      "sector": "Financial Services"
    },
    "avg_price": 208.48872934977214,
    "avg_volume": 2926685.566666667,
    "key_levels": {
      "entry": 187.121,
      "stop": 178.0713,
      "targets": [
        201.4358,
        210.9791
      ]
    },
    "atr14": 9.5991,
    "sector": "Financial Services",
    "chart_url": "http://127.0.0.1:3010/reports/NDAQ-1758143046791.png"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/AAPL-1758143054057.png",
  "meta": {
    "source": "http://127.0.0.1:3010",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 6803.87
  }
}
2025-09-17 14:04:14 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-17 21:04:18.044145', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 14:04:18 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 14:04:25 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 14:04:25 Sleeping 5m before next iteration
2025-09-17 14:09:25 === Iteration 2 ===
2025-09-17 14:09:25 venv exists
2025-09-17 14:09:25 Installing Python requirements
2025-09-17 14:09:27 shots: node_modules present
2025-09-17 14:09:27 frontend: node_modules present
2025-09-17 14:09:27 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
...................                                                      [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

test_production.py::test_health_endpoint
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_health_endpoint returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_vcp_scan
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_vcp_scan returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_api_endpoints
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_api_endpoints returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_database_operations
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_database_operations returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_performance
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_performance returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
19 passed, 6 warnings in 8.96s
2025-09-17 14:09:38 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 14:09:38 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 14:09:38 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:03:02 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 14:09:33,025", "levelname": "INFO", "message": "request", "request_id": "4c78baa9-9a9f-4a84-8868-f16dd38b5be4", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 26}
INFO:     127.0.0.1:50853 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 14:09:33,034", "levelname": "INFO", "message": "request", "request_id": "e9f8b9b9-b907-48da-a9d9-5295212bd2f0", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 5}
INFO:     127.0.0.1:50856 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:09:38,262", "levelname": "INFO", "message": "request", "request_id": "feb5f13a-0e72-4256-8b50-9931ab7549c3", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:50878 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:09:46,820", "levelname": "INFO", "message": "request", "request_id": "1c320c93-0bc6-4ed5-b6fc-1f510da7b820", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:50910 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:09:46,934", "levelname": "INFO", "message": "request", "request_id": "0c4f9129-1f7b-4fab-92c9-312c7798c794", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 76}
INFO:     127.0.0.1:50911 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 8303,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758143386503.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 8311,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758143395124.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 14:09:55 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758143405903.png",
  "meta": {
    "source": "http://127.0.0.1:3010",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9790.41
  }
}

2025-09-17 14:10:06 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758143416201.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 9409
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758143425684.png",
  "meta": {
    "source": "http://127.0.0.1:3010",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9223.73
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 142,
  "sample": {
    "symbol": "DIS",
    "score": 83.42,
    "entry": 99.1935,
    "stop": 93.951,
    "targets": [
      105.0975,
      109.0335
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 145.09,
          "x2": "2025-09-15",
          "y2": 98.7,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 135.25,
          "x2": "2025-09-15",
          "y2": 94.9,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 96.8
        }
      ],
      "priceLevels": {
        "entry": 99.1935,
        "stop": 93.951,
        "targets": [
          105.0975,
          109.0335
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.39",
        "slope gap 0.0125"
      ],
      "direction": "falling",
      "atr14": 5.8471,
      "sector": "Communication Services"
    },
    "avg_price": 92.20166702270508,
    "avg_volume": 21742586.633333333,
    "key_levels": {
      "entry": 99.1935,
      "stop": 93.951,
      "targets": [
        105.0975,
        109.0335
      ]
    },
    "atr14": 5.8471,
    "sector": "Communication Services",
    "chart_url": "http://127.0.0.1:3010/reports/DIS-1758143457964.png"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/AAPL-1758143465827.png",
  "meta": {
    "source": "http://127.0.0.1:3010",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 7732.83
  }
}
2025-09-17 14:11:06 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-17 21:11:11.064823', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 14:11:11 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 14:11:22 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 14:11:22 Sleeping 5m before next iteration
2025-09-17 14:16:22 === Iteration 3 ===
2025-09-17 14:16:22 venv exists
2025-09-17 14:16:22 Installing Python requirements
2025-09-17 14:16:24 shots: node_modules present
2025-09-17 14:16:24 frontend: node_modules present
2025-09-17 14:16:24 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

test_production.py::test_health_endpoint
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_health_endpoint returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_vcp_scan
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_vcp_scan returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_api_endpoints
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_api_endpoints returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_database_operations
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_database_operations returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_performance
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_performance returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 6 warnings in 12.57s
2025-09-17 14:16:39 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 14:16:39 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 14:16:39 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:03:02 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 14:16:33,448", "levelname": "INFO", "message": "request", "request_id": "460ec011-7a5b-4bdc-afdf-d88a52d1c67e", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 412}
INFO:     127.0.0.1:52138 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 14:16:33,533", "levelname": "INFO", "message": "request", "request_id": "04ec4090-0e6c-4089-848f-a8825622c20b", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 74}
INFO:     127.0.0.1:52142 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:16:39,580", "levelname": "INFO", "message": "request", "request_id": "b48c6a8d-7d3a-4d01-b88d-faeeb1a6e0c2", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:52165 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:16:48,505", "levelname": "INFO", "message": "request", "request_id": "dec78478-b2cd-43e2-8f0e-065734c3218c", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:52197 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:16:49,024", "levelname": "INFO", "message": "request", "request_id": "d5aca9d3-62d8-40e5-bfd2-214d0b2c6a53", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 499}
INFO:     127.0.0.1:52198 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 8577,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758143808205.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 7594,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758143816587.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 14:16:56 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=NVDA+Chart",
  "meta": {
    "source": "dummy",
    "overlay_applied": false,
    "fallback": true,
    "error": "shots status 502",
    "dry_run": false,
    "duration_ms": 3416.01
  }
}

2025-09-17 14:17:00 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758143827086.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6374
}
API ‚Üí chart (NVDA) ‚Ä¶
2025-09-17 14:17:25 === LegendAI Doc Superrun starting (PROJECT_DIR=/Users/kyleholthaus/Projects/LegendAI/scripts/..) ===
2025-09-17 14:17:25 === Iteration 1 ===
2025-09-17 14:17:25 venv exists
2025-09-17 14:17:25 Installing Python requirements
2025-09-17 14:17:28 shots: node_modules present
2025-09-17 14:17:28 frontend: node_modules present
2025-09-17 14:17:28 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 1 warning in 10.42s
2025-09-17 14:17:41 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 14:17:41 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 14:17:41 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:17:23 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 14:17:43,648", "levelname": "INFO", "message": "request", "request_id": "59fd7d04-d0a2-4f34-a566-2b3670e07099", "path": "/api/v1/vcp/metrics", "method": "GET", "status_code": 200, "duration_ms": 305}
INFO:     127.0.0.1:52368 - "GET /api/v1/vcp/metrics?start=2024-01-01&end=2024-12-31 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:17:43,688", "levelname": "INFO", "message": "request", "request_id": "bc8df01e-1bc1-42e4-b8bb-cf2190b3d8d1", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 20}
INFO:     127.0.0.1:52369 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 14:17:43,722", "levelname": "INFO", "message": "request", "request_id": "afd0dfc8-abd7-4977-99dc-4af1c7b9a363", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 18}
INFO:     127.0.0.1:52372 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:17:50,987", "levelname": "INFO", "message": "request", "request_id": "33e815ff-1272-48f4-b7c1-bb0d35b0f228", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 15}
INFO:     127.0.0.1:52423 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:17:51,088", "levelname": "INFO", "message": "request", "request_id": "3f9c5038-da38-489f-8523-994f381f2631", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 61}
INFO:     127.0.0.1:52424 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 9067,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758143870553.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 9560,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758143880647.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 14:18:00 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758143892337.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10463.74
  }
}

2025-09-17 14:18:12 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758143899746.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 7636
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758143910236.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10026.67
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 130,
  "sample": {
    "symbol": "DHI",
    "score": 83.42,
    "entry": 99.1935,
    "stop": 93.951,
    "targets": [
      105.0975,
      109.0335
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 145.09,
          "x2": "2025-09-15",
          "y2": 98.7,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 135.25,
          "x2": "2025-09-15",
          "y2": 94.9,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 96.8
        }
      ],
      "priceLevels": {
        "entry": 99.1935,
        "stop": 93.951,
        "targets": [
          105.0975,
          109.0335
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.39",
        "slope gap 0.0125"
      ],
      "direction": "falling",
      "atr14": 5.8471,
      "sector": "Consumer Cyclical"
    },
    "avg_price": 92.20166702270508,
    "avg_volume": 21742586.633333333,
    "key_levels": {
      "entry": 99.1935,
      "stop": 93.951,
      "targets": [
        105.0975,
        109.0335
      ]
    },
    "atr14": 5.8471,
    "sector": "Consumer Cyclical",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=DHI+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758144010236.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 11375.19
  }
}
2025-09-17 14:20:10 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-17 21:20:14.066746', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 14:20:14 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 14:20:22 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 14:20:22 Sleeping 5m before next iteration
2025-09-17 14:25:22 === Iteration 2 ===
2025-09-17 14:25:22 venv exists
2025-09-17 14:25:22 Installing Python requirements
2025-09-17 14:25:24 shots: node_modules present
2025-09-17 14:25:24 frontend: node_modules present
2025-09-17 14:25:24 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 1 warning in 8.97s
2025-09-17 14:25:35 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 14:25:35 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 14:25:35 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:17:23 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 14:25:29,650", "levelname": "INFO", "message": "request", "request_id": "1fdd9f1f-2707-4d86-b8ac-5a7eb1ba03b5", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 32}
INFO:     127.0.0.1:53537 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 14:25:29,661", "levelname": "INFO", "message": "request", "request_id": "5a745614-16d0-475b-bf03-b47d435694c2", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 6}
INFO:     127.0.0.1:53540 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:25:35,258", "levelname": "INFO", "message": "request", "request_id": "59c313cc-8b7e-404f-a933-9a4cf6038cb3", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:53563 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:25:43,041", "levelname": "INFO", "message": "request", "request_id": "4650a3b1-f725-40fa-a4d4-1d4004f6621f", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:53595 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:25:43,113", "levelname": "INFO", "message": "request", "request_id": "87063167-b888-42d1-992a-4a302ba9d193", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 53}
INFO:     127.0.0.1:53596 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 7555,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758144342821.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 6175,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758144349216.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 14:25:49 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758144375233.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 25315.21
  }
}

2025-09-17 14:26:15 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758144381978.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6841
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758144391844.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9882.04
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
2025-09-17 14:26:53 === LegendAI Doc Superrun starting (PROJECT_DIR=/Users/kyleholthaus/Projects/LegendAI/scripts/..) ===
2025-09-17 14:26:53 === Iteration 1 ===
2025-09-17 14:26:53 venv exists
2025-09-17 14:26:53 Installing Python requirements
2025-09-17 14:26:55 shots: node_modules present
2025-09-17 14:26:55 frontend: node_modules present
2025-09-17 14:26:55 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 1 warning in 8.69s
2025-09-17 14:27:05 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 14:27:05 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 14:27:05 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 14:27:00,547", "levelname": "INFO", "message": "request", "request_id": "68a0fd25-efda-4fcb-afb1-63fe296f0e0f", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 18}
INFO:     127.0.0.1:54432 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 14:27:00,554", "levelname": "INFO", "message": "request", "request_id": "5f1aaa4c-c9b1-45ea-ac21-4ecdf5a0d4f9", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:54435 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:27:05,454", "levelname": "INFO", "message": "request", "request_id": "2b648ebb-328a-452e-b2e9-8afd658784f9", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:54458 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:27:12,409", "levelname": "INFO", "message": "request", "request_id": "f8a21ba3-0c56-4a0d-a626-ac46a00aee77", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 4}
INFO:     127.0.0.1:54489 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:27:12,465", "levelname": "INFO", "message": "request", "request_id": "dd801ff4-3ec4-47aa-a13d-25a91bc6ee0c", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 36}
INFO:     127.0.0.1:54490 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6804,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758144432206.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5577,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758144437990.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 14:27:18 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=NVDA+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30184.16
  }
}

2025-09-17 14:27:48 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758144474902.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6339
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758144505211.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30004.36
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 188,
  "sample": {
    "symbol": "MU",
    "score": 88.78,
    "entry": 83.1637,
    "stop": 79.7346,
    "targets": [
      87.9836,
      91.1968
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 111.318,
          "x2": "2025-09-15",
          "y2": 82.75,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 103.285,
          "x2": "2025-09-15",
          "y2": 80.54,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 81.645
        }
      ],
      "priceLevels": {
        "entry": 83.1637,
        "stop": 79.7346,
        "targets": [
          87.9836,
          91.1968
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.28",
        "slope gap 0.0030"
      ],
      "direction": "falling",
      "atr14": 4.3001
    },
    "avg_price": 81.54688618977865,
    "avg_volume": 71392666.4,
    "key_levels": {
      "entry": 83.1637,
      "stop": 79.7346,
      "targets": [
        87.9836,
        91.1968
      ]
    },
    "atr14": 4.3001,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=MU+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30371.62
  }
}
2025-09-17 14:30:13 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-17 21:30:16.799418', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 14:30:16 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 14:30:25 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 14:30:25 Sleeping 5m before next iteration
2025-09-17 14:35:25 === Iteration 2 ===
2025-09-17 14:35:25 venv exists
2025-09-17 14:35:25 Installing Python requirements
2025-09-17 14:35:26 shots: node_modules present
2025-09-17 14:35:26 frontend: node_modules present
2025-09-17 14:35:26 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 1 warning in 8.47s
2025-09-17 14:35:36 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 14:35:36 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 14:35:36 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 14:35:31,617", "levelname": "INFO", "message": "request", "request_id": "98428624-bf53-4753-86f5-02e1e549840e", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 15}
INFO:     127.0.0.1:55295 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 14:35:31,626", "levelname": "INFO", "message": "request", "request_id": "ad9ba3a2-59cb-4e25-9d87-e822fea579a8", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:55298 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:35:36,734", "levelname": "INFO", "message": "request", "request_id": "9597e86b-c36f-4361-8d30-c93dafe78a90", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:55321 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:35:44,396", "levelname": "INFO", "message": "request", "request_id": "06213efc-2bb8-448e-9a5a-28c0101be688", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:55353 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:35:44,478", "levelname": "INFO", "message": "request", "request_id": "35e5e868-9caa-4315-aa54-d0c74985a947", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 46}
INFO:     127.0.0.1:55354 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 7467,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758144944154.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 6655,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758144951075.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 14:35:51 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758144961954.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10700.02
  }
}

2025-09-17 14:36:02 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758144969206.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6988
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758144979156.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9809.08
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 126,
  "sample": {
    "symbol": "AVGO",
    "score": 88.11,
    "entry": 85.0699,
    "stop": 80.3286,
    "targets": [
      92.4979,
      97.4499
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 91.66,
          "x2": "2025-09-15",
          "y2": 84.6467,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 79.28,
          "x2": "2025-09-15",
          "y2": 81.14,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 82.8933
        }
      ],
      "priceLevels": {
        "entry": 85.0699,
        "stop": 80.3286,
        "targets": [
          92.4979,
          97.4499
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.28",
        "slope gap 0.0170"
      ],
      "direction": "falling",
      "atr14": 4.5891,
      "sector": "Technology"
    },
    "avg_price": 67.01066678365072,
    "avg_volume": 13664891.066666666,
    "key_levels": {
      "entry": 85.0699,
      "stop": 80.3286,
      "targets": [
        92.4979,
        97.4499
      ]
    },
    "atr14": 4.5891,
    "sector": "Technology",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AVGO+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758145101070.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 41212.58
  }
}
2025-09-17 14:38:21 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-17 21:38:25.395916', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 14:38:25 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 14:38:33 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 14:38:33 Sleeping 5m before next iteration
2025-09-17 14:43:33 === Iteration 3 ===
2025-09-17 14:43:33 venv exists
2025-09-17 14:43:33 Installing Python requirements
2025-09-17 14:43:34 shots: node_modules present
2025-09-17 14:43:34 frontend: node_modules present
2025-09-17 14:43:34 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 1 warning in 9.47s
2025-09-17 14:43:45 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 14:43:45 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 14:43:45 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 14:43:39,390", "levelname": "INFO", "message": "request", "request_id": "85f379f0-579a-4cbc-a1ca-99d81259ee13", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 12}
INFO:     127.0.0.1:56245 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 14:43:39,401", "levelname": "INFO", "message": "request", "request_id": "97915cc7-ed01-4a11-9b39-39feca920735", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 5}
INFO:     127.0.0.1:56248 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:43:45,587", "levelname": "INFO", "message": "request", "request_id": "184b3506-6129-471b-9693-5141f61feeed", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:56272 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:43:53,375", "levelname": "INFO", "message": "request", "request_id": "1f427914-afe5-4042-a4de-b2a3c4e8f92a", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:56307 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:43:53,440", "levelname": "INFO", "message": "request", "request_id": "04b0a376-2f54-4ef8-b390-b54d53eb0e18", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 50}
INFO:     127.0.0.1:56308 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 7610,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758145433143.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5830,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758145439206.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 14:43:59 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758145451158.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 11619.28
  }
}

2025-09-17 14:44:11 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758145456917.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5722
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758145466836.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9862.14
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 160,
  "sample": {
    "symbol": "DIS",
    "score": 89.73,
    "entry": 69.6163,
    "stop": 67.7259,
    "targets": [
      71.8387,
      73.3203
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 66.8,
          "x2": "2025-09-15",
          "y2": 69.27,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 63.096,
          "x2": "2025-09-15",
          "y2": 68.41,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 68.84
        }
      ],
      "priceLevels": {
        "entry": 69.6163,
        "stop": 67.7259,
        "targets": [
          71.8387,
          73.3203
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.23",
        "slope gap 0.0095"
      ],
      "direction": "falling",
      "atr14": 4.025,
      "sector": "Communication Services"
    },
    "avg_price": 58.824666595458986,
    "avg_volume": 10344460.766666668,
    "key_levels": {
      "entry": 69.6163,
      "stop": 67.7259,
      "targets": [
        71.8387,
        73.3203
      ]
    },
    "atr14": 4.025,
    "sector": "Communication Services",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=DIS+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758145566650.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 21530.98
  }
}
2025-09-17 14:46:06 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-17 21:46:10.367679', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 14:46:10 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 14:46:17 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 14:46:17 Sleeping 5m before next iteration
2025-09-17 14:51:17 === Iteration 4 ===
2025-09-17 14:51:17 venv exists
2025-09-17 14:51:17 Installing Python requirements
2025-09-17 14:51:18 shots: node_modules present
2025-09-17 14:51:18 frontend: node_modules present
2025-09-17 14:51:18 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 1 warning in 8.87s
2025-09-17 14:51:28 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 14:51:28 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 14:51:28 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 14:51:23,320", "levelname": "INFO", "message": "request", "request_id": "11494b84-38ff-4ba5-944d-e0ecc8afa9a1", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 12}
INFO:     127.0.0.1:57171 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 14:51:23,329", "levelname": "INFO", "message": "request", "request_id": "a1127ec0-e442-48ff-842c-4985f0ca0975", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:57174 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:51:28,957", "levelname": "INFO", "message": "request", "request_id": "641fe887-3e3a-4f48-a080-b2aac12dab7d", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:57203 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:51:36,124", "levelname": "INFO", "message": "request", "request_id": "7e0a6462-056c-4c3c-9850-669d972c2659", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:57235 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:51:36,194", "levelname": "INFO", "message": "request", "request_id": "e88bc727-6b5c-4f16-b2a0-2422b9dbfeb7", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 45}
INFO:     127.0.0.1:57236 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6948,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758145895852.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5451,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758145901585.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 14:51:41 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758145912453.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10596.2
  }
}

2025-09-17 14:51:52 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758145918617.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6066
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758145928283.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9688.08
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 155,
  "sample": {
    "symbol": "MKC",
    "score": 88.91,
    "entry": 187.121,
    "stop": 178.0713,
    "targets": [
      201.4358,
      210.9791
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 284.7549,
          "x2": "2025-09-15",
          "y2": 186.19,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 260.8968,
          "x2": "2025-09-15",
          "y2": 179.87,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 183.03
        }
      ],
      "priceLevels": {
        "entry": 187.121,
        "stop": 178.0713,
        "targets": [
          201.4358,
          210.9791
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.26",
        "slope gap 0.0683"
      ],
      "direction": "falling",
      "atr14": 9.5991
    },
    "avg_price": 208.48872934977214,
    "avg_volume": 2926685.566666667,
    "key_levels": {
      "entry": 187.121,
      "stop": 178.0713,
      "targets": [
        201.4358,
        210.9791
      ]
    },
    "atr14": 9.5991,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=MKC+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758146035348.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 28878.91
  }
}
2025-09-17 14:53:55 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-17 21:53:59.185419', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 14:53:59 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 14:54:06 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 14:54:06 Sleeping 5m before next iteration
2025-09-17 14:59:06 === Iteration 5 ===
2025-09-17 14:59:06 venv exists
2025-09-17 14:59:06 Installing Python requirements
2025-09-17 14:59:08 shots: node_modules present
2025-09-17 14:59:08 frontend: node_modules present
2025-09-17 14:59:08 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 1 warning in 8.60s
2025-09-17 14:59:18 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 14:59:18 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 14:59:18 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 14:59:13,831", "levelname": "INFO", "message": "request", "request_id": "e946b690-515c-4249-98e8-0c4bc53d482c", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 16}
INFO:     127.0.0.1:58111 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 14:59:13,842", "levelname": "INFO", "message": "request", "request_id": "132c8a5d-2ec4-4c09-b350-f02da6871e3f", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:58114 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:59:18,831", "levelname": "INFO", "message": "request", "request_id": "f97b6d91-79a9-48b7-b658-4355f0b27971", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:58136 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:59:26,382", "levelname": "INFO", "message": "request", "request_id": "386e5a9f-54e8-41b0-b94e-89f413bbfd26", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:58171 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:59:26,456", "levelname": "INFO", "message": "request", "request_id": "60c06599-19ad-4056-b91d-b384802cd8d8", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 52}
INFO:     127.0.0.1:58172 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 7382,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758146366169.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 6591,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758146373001.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 14:59:33 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758146383949.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10453.03
  }
}

2025-09-17 14:59:44 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758146390480.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6496
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758146400550.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9914.6
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 177,
  "sample": {
    "symbol": "DECK",
    "score": 89.73,
    "entry": 69.6163,
    "stop": 67.7259,
    "targets": [
      71.8387,
      73.3203
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 66.8,
          "x2": "2025-09-15",
          "y2": 69.27,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 63.096,
          "x2": "2025-09-15",
          "y2": 68.41,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 68.84
        }
      ],
      "priceLevels": {
        "entry": 69.6163,
        "stop": 67.7259,
        "targets": [
          71.8387,
          73.3203
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.23",
        "slope gap 0.0095"
      ],
      "direction": "falling",
      "atr14": 4.025
    },
    "avg_price": 58.824666595458986,
    "avg_volume": 10344460.766666668,
    "key_levels": {
      "entry": 69.6163,
      "stop": 67.7259,
      "targets": [
        71.8387,
        73.3203
      ]
    },
    "atr14": 4.025,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=DECK+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30306.17
  }
}
2025-09-17 15:01:48 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-17 22:01:52.694578', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 15:01:52 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 15:01:59 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 15:01:59 Sleeping 5m before next iteration
2025-09-17 15:06:59 === Iteration 6 ===
2025-09-17 15:06:59 venv exists
2025-09-17 15:06:59 Installing Python requirements
2025-09-17 15:07:02 shots: node_modules present
2025-09-17 15:07:02 frontend: node_modules present
2025-09-17 15:07:02 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 1 warning in 9.01s
2025-09-17 15:07:12 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 15:07:12 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 15:07:12 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 15:07:07,280", "levelname": "INFO", "message": "request", "request_id": "f3ae6a2a-993b-453f-a79d-1d10c193288d", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 30}
INFO:     127.0.0.1:59072 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 15:07:07,290", "levelname": "INFO", "message": "request", "request_id": "cc9e3b69-eac2-473e-aab7-7943d78f6c80", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 4}
INFO:     127.0.0.1:59075 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 15:07:12,681", "levelname": "INFO", "message": "request", "request_id": "45768ad7-2273-4eef-bd26-230279a03f59", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:59098 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 15:07:19,682", "levelname": "INFO", "message": "request", "request_id": "b861303f-1f3c-4f95-8afc-dd17d61c820d", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:59137 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 15:07:19,739", "levelname": "INFO", "message": "request", "request_id": "92b665e9-1746-4792-885d-fffc43a5f40c", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 46}
INFO:     127.0.0.1:59138 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6743,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758146839416.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5951,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758146845568.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 15:07:25 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758146856546.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10619.95
  }
}

2025-09-17 15:07:36 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758146862967.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6208
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758146872349.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9322.5
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 105,
  "sample": {
    "symbol": "EXC",
    "score": 83.42,
    "entry": 99.1935,
    "stop": 93.951,
    "targets": [
      105.0975,
      109.0335
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 145.09,
          "x2": "2025-09-15",
          "y2": 98.7,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 135.25,
          "x2": "2025-09-15",
          "y2": 94.9,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 96.8
        }
      ],
      "priceLevels": {
        "entry": 99.1935,
        "stop": 93.951,
        "targets": [
          105.0975,
          109.0335
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.39",
        "slope gap 0.0125"
      ],
      "direction": "falling",
      "atr14": 5.8471,
      "sector": "Utilities"
    },
    "avg_price": 92.20166702270508,
    "avg_volume": 21742586.633333333,
    "key_levels": {
      "entry": 99.1935,
      "stop": 93.951,
      "targets": [
        105.0975,
        109.0335
      ]
    },
    "atr14": 5.8471,
    "sector": "Utilities",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=EXC+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30227.63
  }
}
2025-09-17 15:09:41 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-17 22:09:45.155646', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 15:09:45 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 15:09:52 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 15:09:52 Sleeping 5m before next iteration
2025-09-17 15:14:52 === Iteration 7 ===
2025-09-17 15:14:52 venv exists
2025-09-17 15:14:52 Installing Python requirements
2025-09-17 15:14:53 shots: node_modules present
2025-09-17 15:14:53 frontend: node_modules present
2025-09-17 15:14:53 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 1 warning in 8.51s
2025-09-17 15:15:03 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 15:15:03 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 15:15:03 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 15:14:58,539", "levelname": "INFO", "message": "request", "request_id": "50dfcf4c-a843-4895-a318-77ffc7bf03e8", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 31}
INFO:     127.0.0.1:59959 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 15:14:58,546", "levelname": "INFO", "message": "request", "request_id": "5d7f79cd-b48c-4c5e-9c2c-5b5b0ef80cf3", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:59962 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 15:15:03,577", "levelname": "INFO", "message": "request", "request_id": "aa1640bf-0d0a-4b64-a7ea-826733aefcb5", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:59984 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 15:15:10,544", "levelname": "INFO", "message": "request", "request_id": "b45ad1e2-6e8d-4676-a4ff-1a3e4c3861fd", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:60016 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 15:15:10,594", "levelname": "INFO", "message": "request", "request_id": "50f2caa5-b918-4399-9059-727be25bdb5c", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 39}
INFO:     127.0.0.1:60017 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6742,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758147310317.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5517,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758147316064.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 15:15:16 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758147327249.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 11009.95
  }
}

2025-09-17 15:15:27 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758147333100.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5632
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758147342460.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9257.5
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 138,
  "sample": {
    "symbol": "APA",
    "score": 88.11,
    "entry": 85.0699,
    "stop": 80.3286,
    "targets": [
      92.4979,
      97.4499
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 91.66,
          "x2": "2025-09-15",
          "y2": 84.6467,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 79.28,
          "x2": "2025-09-15",
          "y2": 81.14,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 82.8933
        }
      ],
      "priceLevels": {
        "entry": 85.0699,
        "stop": 80.3286,
        "targets": [
          92.4979,
          97.4499
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.28",
        "slope gap 0.0170"
      ],
      "direction": "falling",
      "atr14": 4.5891
    },
    "avg_price": 67.01066678365072,
    "avg_volume": 13664891.066666666,
    "key_levels": {
      "entry": 85.0699,
      "stop": 80.3286,
      "targets": [
        92.4979,
        97.4499
      ]
    },
    "atr14": 4.5891,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=APA+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30287.3
  }
}
2025-09-17 15:17:28 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-17 22:17:32.733028', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 15:17:32 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 15:17:40 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 15:17:40 Sleeping 5m before next iteration
2025-09-17 15:22:40 === Iteration 8 ===
2025-09-17 15:22:40 venv exists
2025-09-17 15:22:40 Installing Python requirements
2025-09-17 15:22:41 shots: node_modules present
2025-09-17 15:22:41 frontend: node_modules present
2025-09-17 15:22:41 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 1 warning in 8.58s
2025-09-17 15:22:51 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 15:22:51 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 15:22:51 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 15:22:46,417", "levelname": "INFO", "message": "request", "request_id": "d5343e33-0ad3-428a-a108-83ad85854f19", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 24}
INFO:     127.0.0.1:60800 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 15:22:46,426", "levelname": "INFO", "message": "request", "request_id": "acd9e7d8-c80a-4d4d-a4c0-12a6aea34a99", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:60803 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 15:22:51,494", "levelname": "INFO", "message": "request", "request_id": "7db32695-57fa-4723-8292-790cb49a8310", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:60826 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 15:22:58,446", "levelname": "INFO", "message": "request", "request_id": "a8cba86d-c508-40ff-8239-ecfb0dc07dd4", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:60860 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 15:22:58,510", "levelname": "INFO", "message": "request", "request_id": "da5d8a5e-5084-4481-9381-4a17f272a55e", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 46}
INFO:     127.0.0.1:60861 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6788,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758147778246.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5338,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758147783796.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 15:23:03 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758147795646.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 11463.6
  }
}

2025-09-17 15:23:15 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758147801244.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5540
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758147810959.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9719.22
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 140,
  "sample": {
    "symbol": "MA",
    "score": 85.33,
    "entry": 58.2197,
    "stop": 54.9945,
    "targets": [
      62.9115,
      66.0394
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 107.672,
          "x2": "2025-09-15",
          "y2": 57.93,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 99.8522,
          "x2": "2025-09-15",
          "y2": 55.55,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 56.74
        }
      ],
      "priceLevels": {
        "entry": 58.2197,
        "stop": 54.9945,
        "targets": [
          62.9115,
          66.0394
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.30",
        "slope gap 0.0213"
      ],
      "direction": "falling",
      "atr14": 4.0684,
      "sector": "Financial Services"
    },
    "avg_price": 53.6756591796875,
    "avg_volume": 10704263.433333334,
    "key_levels": {
      "entry": 58.2197,
      "stop": 54.9945,
      "targets": [
        62.9115,
        66.0394
      ]
    },
    "atr14": 4.0684,
    "sector": "Financial Services",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=MA+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30517.86
  }
}
2025-09-17 15:25:16 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-17 22:25:20.996357', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 15:25:21 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 15:25:28 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 15:25:28 Sleeping 5m before next iteration
2025-09-17 15:30:28 === Iteration 9 ===
2025-09-17 15:30:28 venv exists
2025-09-17 15:30:28 Installing Python requirements
2025-09-17 15:30:29 shots: node_modules present
2025-09-17 15:30:29 frontend: node_modules present
2025-09-17 15:30:29 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 1 warning in 8.52s
2025-09-17 15:30:39 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 15:30:39 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 15:30:39 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 15:30:34,581", "levelname": "INFO", "message": "request", "request_id": "8577e044-8f53-4b06-88aa-058174efe5e7", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 11}
INFO:     127.0.0.1:61625 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 15:30:34,592", "levelname": "INFO", "message": "request", "request_id": "4cd1c774-1184-456a-af74-c9c5c65df45f", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:61628 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 15:30:39,770", "levelname": "INFO", "message": "request", "request_id": "40cc4385-5218-4eec-a3c9-8f5a83b70738", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:61650 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 15:30:47,275", "levelname": "INFO", "message": "request", "request_id": "2e52a90b-3040-4b3c-bab8-3b4f82df56e2", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:61680 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 15:30:47,350", "levelname": "INFO", "message": "request", "request_id": "1c5af01b-e90b-41f3-8f15-f16c0b252551", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 46}
INFO:     127.0.0.1:61681 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 7354,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758148247074.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 6069,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758148253379.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 15:30:53 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758148264056.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10356.64
  }
}

2025-09-17 15:31:04 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758148270576.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6258
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758148280124.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9460.17
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 127,
  "sample": {
    "symbol": "CHTR",
    "score": 82.7,
    "entry": 19.4367,
    "stop": 18.4635,
    "targets": [
      20.4152,
      21.0676
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 27.1964,
          "x2": "2025-09-15",
          "y2": 19.34,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 25.5656,
          "x2": "2025-09-15",
          "y2": 18.65,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 18.995
        }
      ],
      "priceLevels": {
        "entry": 19.4367,
        "stop": 18.4635,
        "targets": [
          20.4152,
          21.0676
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.42",
        "slope gap 0.0009"
      ],
      "direction": "falling",
      "atr14": 1.0326,
      "sector": "Communication Services"
    },
    "avg_price": 21.75607592264811,
    "avg_volume": 41265469.333333336,
    "key_levels": {
      "entry": 19.4367,
      "stop": 18.4635,
      "targets": [
        20.4152,
        21.0676
      ]
    },
    "atr14": 1.0326,
    "sector": "Communication Services",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=CHTR+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30229.75
  }
}
2025-09-17 15:33:07 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-17 22:33:11.359598', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 15:33:11 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 15:33:19 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 15:33:19 Sleeping 5m before next iteration
2025-09-17 15:38:19 === Iteration 10 ===
2025-09-17 15:38:19 venv exists
2025-09-17 15:38:19 Installing Python requirements
2025-09-17 15:38:20 shots: node_modules present
2025-09-17 15:38:20 frontend: node_modules present
2025-09-17 15:38:20 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 1 warning in 9.75s
2025-09-17 15:38:33 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 15:38:33 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 15:38:33 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 15:38:27,477", "levelname": "INFO", "message": "request", "request_id": "28b7ab7c-782b-4b16-80c3-eb0a893ac3ff", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 29}
INFO:     127.0.0.1:62505 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 15:38:27,493", "levelname": "INFO", "message": "request", "request_id": "5c37027a-3e62-4f68-af61-b52f853d682c", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 5}
INFO:     127.0.0.1:62508 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 15:38:33,324", "levelname": "INFO", "message": "request", "request_id": "ab407083-ba0e-4a0f-9d57-f6d16d4cad7a", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:62531 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 15:38:40,784", "levelname": "INFO", "message": "request", "request_id": "95a87898-0ff3-4092-a229-18b59b3f10d0", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:62596 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 15:38:40,855", "levelname": "INFO", "message": "request", "request_id": "3fbf67e1-391a-491a-950d-1c53eee620fa", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 59}
INFO:     127.0.0.1:62597 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 7133,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758148720495.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5716,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758148726493.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 15:38:46 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758148737738.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 11008.59
  }
}

2025-09-17 15:38:57 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758148745284.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 7299
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758148755239.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9869.78
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 119,
  "sample": {
    "symbol": "VICI",
    "score": 82.55,
    "entry": 91.2681,
    "stop": 87.5556,
    "targets": [
      94.9414,
      97.3903
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 135.8187,
          "x2": "2025-09-15",
          "y2": 90.814,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 129.6965,
          "x2": "2025-09-15",
          "y2": 88.44,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 89.627
        }
      ],
      "priceLevels": {
        "entry": 91.2681,
        "stop": 87.5556,
        "targets": [
          94.9414,
          97.3903
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.39",
        "slope gap 0.0283"
      ],
      "direction": "falling",
      "atr14": 5.9275,
      "sector": "Real Estate"
    },
    "avg_price": 98.35214207967122,
    "avg_volume": 36477690.1,
    "key_levels": {
      "entry": 91.2681,
      "stop": 87.5556,
      "targets": [
        94.9414,
        97.3903
      ]
    },
    "atr14": 5.9275,
    "sector": "Real Estate",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=VICI+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30269.12
  }
}
2025-09-17 15:41:01 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-17 22:41:05.974781', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 15:41:06 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 15:41:13 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 15:41:13 Sleeping 5m before next iteration
2025-09-17 15:46:13 === Iteration 11 ===
2025-09-17 15:46:13 venv exists
2025-09-17 15:46:13 Installing Python requirements
2025-09-17 15:46:14 shots: node_modules present
2025-09-17 15:46:14 frontend: node_modules present
2025-09-17 15:46:14 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 1 warning in 8.94s
2025-09-17 15:46:25 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 15:46:25 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 15:46:25 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 15:46:20,163", "levelname": "INFO", "message": "request", "request_id": "329ab52b-4643-4e27-aa8a-72256eb936da", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 52}
INFO:     127.0.0.1:63507 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 15:46:20,174", "levelname": "INFO", "message": "request", "request_id": "1929d6a8-11ee-4205-a770-4e02f3c3cb2b", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 4}
INFO:     127.0.0.1:63510 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 15:46:25,304", "levelname": "INFO", "message": "request", "request_id": "a723421d-d0d8-4c6f-9b24-1e40984da72b", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:63542 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 15:46:32,145", "levelname": "INFO", "message": "request", "request_id": "e3f14fef-b89b-4d83-ae69-0bb488fb85d0", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 4}
INFO:     127.0.0.1:63575 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 15:46:32,212", "levelname": "INFO", "message": "request", "request_id": "fed38a9e-a7a5-476b-a97a-7e29a10a96a9", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 52}
INFO:     127.0.0.1:63576 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6623,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758149191910.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5069,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758149197193.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 15:46:37 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758149208473.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 11018.66
  }
}

2025-09-17 15:46:48 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758149214960.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6382
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758149225503.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10565.83
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 172,
  "sample": {
    "symbol": "EMR",
    "score": 83.42,
    "entry": 99.1935,
    "stop": 93.951,
    "targets": [
      105.0975,
      109.0335
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 145.09,
          "x2": "2025-09-15",
          "y2": 98.7,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 135.25,
          "x2": "2025-09-15",
          "y2": 94.9,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 96.8
        }
      ],
      "priceLevels": {
        "entry": 99.1935,
        "stop": 93.951,
        "targets": [
          105.0975,
          109.0335
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.39",
        "slope gap 0.0125"
      ],
      "direction": "falling",
      "atr14": 5.8471
    },
    "avg_price": 92.20166702270508,
    "avg_volume": 21742586.633333333,
    "key_levels": {
      "entry": 99.1935,
      "stop": 93.951,
      "targets": [
        105.0975,
        109.0335
      ]
    },
    "atr14": 5.8471,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=EMR+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30246.34
  }
}
2025-09-17 15:48:52 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-17 22:48:58.351425', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 15:48:58 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 15:49:06 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 15:49:06 Sleeping 5m before next iteration
2025-09-17 15:54:06 === Iteration 12 ===
2025-09-17 15:54:06 venv exists
2025-09-17 15:54:06 Installing Python requirements
2025-09-17 15:54:08 shots: node_modules present
2025-09-17 15:54:08 frontend: node_modules present
2025-09-17 15:54:08 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 1 warning in 10.91s
2025-09-17 15:54:20 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 15:54:20 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 15:54:20 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 15:54:12,979", "levelname": "INFO", "message": "request", "request_id": "ab1d830b-d2ca-4ae4-8619-f333bbd08303", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 24}
INFO:     127.0.0.1:64349 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 15:54:12,988", "levelname": "INFO", "message": "request", "request_id": "6d12795d-a4ae-4eb7-90fd-39e8d9463f51", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:64352 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 15:54:20,187", "levelname": "INFO", "message": "request", "request_id": "55526210-03b2-4c19-8535-a6a9b70a674c", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 4}
INFO:     127.0.0.1:64374 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 15:54:26,680", "levelname": "INFO", "message": "request", "request_id": "21d85b21-6a24-4fa2-9d89-da3c833e2303", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64403 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 15:54:26,745", "levelname": "INFO", "message": "request", "request_id": "f3c623dd-9c7b-4818-bb8c-3210189b5dcb", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 45}
INFO:     127.0.0.1:64404 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6307,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758149666486.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 4906,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758149671571.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 15:54:31 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758149682368.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10555.6
  }
}

2025-09-17 15:54:42 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758149688688.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6169
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758149697950.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9246.97
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 123,
  "sample": {
    "symbol": "L",
    "score": 80.6,
    "entry": 192.6686,
    "stop": 182.9025,
    "targets": [
      202.3226,
      208.7586
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 232.68,
          "x2": "2025-09-15",
          "y2": 191.71,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 216.59,
          "x2": "2025-09-15",
          "y2": 184.75,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 188.23
        }
      ],
      "priceLevels": {
        "entry": 192.6686,
        "stop": 182.9025,
        "targets": [
          202.3226,
          208.7586
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.43",
        "slope gap 0.0045"
      ],
      "direction": "falling",
      "atr14": 12.9686,
      "sector": "Financial Services"
    },
    "avg_price": 168.3730005900065,
    "avg_volume": 9545966.633333333,
    "key_levels": {
      "entry": 192.6686,
      "stop": 182.9025,
      "targets": [
        202.3226,
        208.7586
      ]
    },
    "atr14": 12.9686,
    "sector": "Financial Services",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=L+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30344.81
  }
}
2025-09-17 15:56:43 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-17 22:56:46.995839', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 15:56:47 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 15:56:53 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 15:56:53 Sleeping 5m before next iteration
2025-09-17 16:01:53 === Iteration 13 ===
2025-09-17 16:01:53 venv exists
2025-09-17 16:01:53 Installing Python requirements
2025-09-17 16:01:54 shots: node_modules present
2025-09-17 16:01:54 frontend: node_modules present
2025-09-17 16:01:54 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 1 warning in 8.36s
2025-09-17 16:02:04 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 16:02:04 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 16:02:04 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 16:01:59,485", "levelname": "INFO", "message": "request", "request_id": "23a2313c-b104-4b54-b2cd-e1acf0313435", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 10}
INFO:     127.0.0.1:65206 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 16:01:59,495", "levelname": "INFO", "message": "request", "request_id": "8ab21207-f6c9-41cd-b105-f8a1d08ab0dd", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:65209 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 16:02:04,699", "levelname": "INFO", "message": "request", "request_id": "09d312da-5b91-47ac-a541-fd259373bce5", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 4}
INFO:     127.0.0.1:65232 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 16:02:11,079", "levelname": "INFO", "message": "request", "request_id": "4c08eff9-c14b-4533-9088-57f141f794c1", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:65260 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 16:02:11,134", "levelname": "INFO", "message": "request", "request_id": "b2a5f02d-a8e8-4c47-b0bd-89cd50de988e", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 42}
INFO:     127.0.0.1:65261 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6224,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758150130854.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5018,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758150136089.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 16:02:16 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758150147466.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 11157.24
  }
}

2025-09-17 16:02:27 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758150153159.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5526
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758150163054.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9777.71
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 148,
  "sample": {
    "symbol": "DHR",
    "score": 88.54,
    "entry": 106.7612,
    "stop": 102.3066,
    "targets": [
      112.9763,
      117.1197
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 136.2477,
          "x2": "2025-09-15",
          "y2": 106.23,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 125.8892,
          "x2": "2025-09-15",
          "y2": 103.34,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 104.785
        }
      ],
      "priceLevels": {
        "entry": 106.7612,
        "stop": 102.3066,
        "targets": [
          112.9763,
          117.1197
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.28",
        "slope gap 0.0487"
      ],
      "direction": "falling",
      "atr14": 5.3876,
      "sector": "Healthcare"
    },
    "avg_price": 100.27833760579428,
    "avg_volume": 17986646.166666668,
    "key_levels": {
      "entry": 106.7612,
      "stop": 102.3066,
      "targets": [
        112.9763,
        117.1197
      ]
    },
    "atr14": 5.3876,
    "sector": "Healthcare",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=DHR+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30359.2
  }
}
2025-09-17 16:04:28 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-17 23:04:32.150599', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 16:04:32 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 16:04:39 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 16:04:39 Sleeping 5m before next iteration
2025-09-17 16:09:39 === Iteration 14 ===
2025-09-17 16:09:39 venv exists
2025-09-17 16:09:39 Installing Python requirements
2025-09-17 16:09:40 shots: node_modules present
2025-09-17 16:09:40 frontend: node_modules present
2025-09-17 16:09:40 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 1 warning in 18.40s
2025-09-17 16:10:00 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 16:10:00 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 16:10:00 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 16:09:55,162", "levelname": "INFO", "message": "request", "request_id": "2ba667b7-ee9e-40ec-8203-2cf452e3d076", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 11}
INFO:     127.0.0.1:49642 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 16:09:55,171", "levelname": "INFO", "message": "request", "request_id": "5eab4eff-50b9-4c64-9ea1-4490038cc81e", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:49645 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 16:10:00,561", "levelname": "INFO", "message": "request", "request_id": "62e770e8-6308-42d8-9343-ad16d4f08522", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:49669 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 16:10:07,442", "levelname": "INFO", "message": "request", "request_id": "01285e65-f3d0-44ab-a67b-e858cec25385", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:49700 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 16:10:07,508", "levelname": "INFO", "message": "request", "request_id": "3662eba1-a8a9-4e73-8779-d09f789ce938", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 55}
INFO:     127.0.0.1:49701 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6704,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758150607189.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 6151,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758150613523.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 16:10:13 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758150625140.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 11208.4
  }
}

2025-09-17 16:10:25 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758150631711.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6213
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758150641545.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9734.92
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 166,
  "sample": {
    "symbol": "DHR",
    "score": 88.54,
    "entry": 106.7612,
    "stop": 102.3066,
    "targets": [
      112.9763,
      117.1197
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 136.2477,
          "x2": "2025-09-15",
          "y2": 106.23,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 125.8892,
          "x2": "2025-09-15",
          "y2": 103.34,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 104.785
        }
      ],
      "priceLevels": {
        "entry": 106.7612,
        "stop": 102.3066,
        "targets": [
          112.9763,
          117.1197
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.28",
        "slope gap 0.0487"
      ],
      "direction": "falling",
      "atr14": 5.3876,
      "sector": "Healthcare"
    },
    "avg_price": 100.27833760579428,
    "avg_volume": 17986646.166666668,
    "key_levels": {
      "entry": 106.7612,
      "stop": 102.3066,
      "targets": [
        112.9763,
        117.1197
      ]
    },
    "atr14": 5.3876,
    "sector": "Healthcare",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=DHR+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30313.12
  }
}
2025-09-17 16:12:30 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-17 23:12:34.236465', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 16:12:34 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 16:12:41 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 16:12:41 Sleeping 5m before next iteration
2025-09-17 16:17:41 === Iteration 15 ===
2025-09-17 16:17:41 venv exists
2025-09-17 16:17:41 Installing Python requirements
2025-09-17 16:17:42 shots: node_modules present
2025-09-17 16:17:42 frontend: node_modules present
2025-09-17 16:17:42 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 1 warning in 11.00s
2025-09-17 16:17:54 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 16:17:54 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 16:17:55 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 16:17:48,601", "levelname": "INFO", "message": "request", "request_id": "2cf6b3c8-9e62-4ebb-9a4b-9b31a784b0ea", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 24}
INFO:     127.0.0.1:50461 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 16:17:48,610", "levelname": "INFO", "message": "request", "request_id": "1cde72df-5e7d-4b07-90d3-36a0c5866abc", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:50464 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 16:17:55,014", "levelname": "INFO", "message": "request", "request_id": "62b20e81-c193-44dc-8ffa-8161b46f33a7", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:50487 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 16:18:01,601", "levelname": "INFO", "message": "request", "request_id": "7370f84d-a842-4777-8427-de08c25bce90", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:50519 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 16:18:01,637", "levelname": "INFO", "message": "request", "request_id": "4434c663-627f-446d-b072-e11745ce2451", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 24}
INFO:     127.0.0.1:50520 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6387,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758151081384.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5504,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758151087053.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 16:18:07 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758151097860.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10564.8
  }
}

2025-09-17 16:18:18 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758151103700.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5669
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758151112943.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9182.12
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 115,
  "sample": {
    "symbol": "VRSN",
    "score": 84.29,
    "entry": 75.9177,
    "stop": 71.7552,
    "targets": [
      80.894,
      84.2116
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 104.7729,
          "x2": "2025-09-15",
          "y2": 75.54,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 96.479,
          "x2": "2025-09-15",
          "y2": 72.48,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 74.01
        }
      ],
      "priceLevels": {
        "entry": 75.9177,
        "stop": 71.7552,
        "targets": [
          80.894,
          84.2116
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.37",
        "slope gap 0.0201"
      ],
      "direction": "falling",
      "atr14": 4.335
    },
    "avg_price": 68.79065272013347,
    "avg_volume": 15849026.566666666,
    "key_levels": {
      "entry": 75.9177,
      "stop": 71.7552,
      "targets": [
        80.894,
        84.2116
      ]
    },
    "atr14": 4.335,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=VRSN+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30498.61
  }
}
2025-09-17 16:20:17 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-17 23:20:20.737266', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 16:20:20 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 16:20:27 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 16:20:27 Sleeping 5m before next iteration
2025-09-17 16:25:27 === Iteration 16 ===
2025-09-17 16:25:27 venv exists
2025-09-17 16:25:27 Installing Python requirements
2025-09-17 16:25:28 shots: node_modules present
2025-09-17 16:25:28 frontend: node_modules present
2025-09-17 16:25:28 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 1 warning in 8.58s
2025-09-17 16:25:38 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 16:25:38 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 16:25:38 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 16:25:33,702", "levelname": "INFO", "message": "request", "request_id": "b576becb-66da-4946-937a-89c09c9c57fc", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 23}
INFO:     127.0.0.1:51270 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 16:25:33,710", "levelname": "INFO", "message": "request", "request_id": "e309a1d1-ea34-40fe-bfac-b695776f91b4", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 4}
INFO:     127.0.0.1:51273 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 16:25:38,705", "levelname": "INFO", "message": "request", "request_id": "8ced3d54-26b4-4b81-b65f-917986303165", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:51295 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 16:25:45,664", "levelname": "INFO", "message": "request", "request_id": "4a46a071-7299-4857-82e1-81568355a678", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:51327 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 16:25:45,752", "levelname": "INFO", "message": "request", "request_id": "0bb53517-69f6-44bc-a9bb-2b4b05752446", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 76}
INFO:     127.0.0.1:51328 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6751,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758151545428.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5263,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758151550920.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 16:25:51 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758151562160.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10933.13
  }
}

2025-09-17 16:26:02 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758151568191.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5811
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758151577458.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9129.67
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 168,
  "sample": {
    "symbol": "RVTY",
    "score": 80.6,
    "entry": 192.6686,
    "stop": 182.9025,
    "targets": [
      202.3226,
      208.7586
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 232.68,
          "x2": "2025-09-15",
          "y2": 191.71,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 216.59,
          "x2": "2025-09-15",
          "y2": 184.75,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 188.23
        }
      ],
      "priceLevels": {
        "entry": 192.6686,
        "stop": 182.9025,
        "targets": [
          202.3226,
          208.7586
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.43",
        "slope gap 0.0045"
      ],
      "direction": "falling",
      "atr14": 12.9686,
      "sector": "Healthcare"
    },
    "avg_price": 168.3730005900065,
    "avg_volume": 9545966.633333333,
    "key_levels": {
      "entry": 192.6686,
      "stop": 182.9025,
      "targets": [
        202.3226,
        208.7586
      ]
    },
    "atr14": 12.9686,
    "sector": "Healthcare",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=RVTY+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30342.05
  }
}
2025-09-17 16:28:02 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-17 23:28:06.819362', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 16:28:06 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 16:28:13 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 16:28:13 Sleeping 5m before next iteration
2025-09-17 16:33:13 === Iteration 17 ===
2025-09-17 16:33:13 venv exists
2025-09-17 16:33:13 Installing Python requirements
2025-09-17 16:33:14 shots: node_modules present
2025-09-17 16:33:14 frontend: node_modules present
2025-09-17 16:33:14 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 1 warning in 8.82s
2025-09-17 16:33:25 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 16:33:25 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 16:33:25 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 16:33:19,525", "levelname": "INFO", "message": "request", "request_id": "5ae6fa06-f760-4c2b-819d-4a79cb183751", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 13}
INFO:     127.0.0.1:52114 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 16:33:19,534", "levelname": "INFO", "message": "request", "request_id": "cb83eea3-2483-4292-ad1f-d849d210aada", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:52117 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 16:33:25,077", "levelname": "INFO", "message": "request", "request_id": "e35379fb-2ded-4622-ac6a-d04e0eef4249", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:52140 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 16:33:31,801", "levelname": "INFO", "message": "request", "request_id": "78117d33-3d44-4344-a94b-d1a37467e28e", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:52172 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 16:33:31,855", "levelname": "INFO", "message": "request", "request_id": "74865e6f-a554-43e0-bd40-436bd24fc312", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 43}
INFO:     127.0.0.1:52175 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6593,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758152011619.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5246,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758152017034.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 16:33:37 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758152028061.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10855.78
  }
}

2025-09-17 16:33:48 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758152033621.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5442
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758152043172.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9429.62
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 111,
  "sample": {
    "symbol": "PM",
    "score": 80.57,
    "entry": 144.2476,
    "stop": 138.5109,
    "targets": [
      148.5605,
      151.4357
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 164.837,
          "x2": "2025-09-15",
          "y2": 143.53,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 157.6489,
          "x2": "2025-09-15",
          "y2": 139.91,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 141.72
        }
      ],
      "priceLevels": {
        "entry": 144.2476,
        "stop": 138.5109,
        "targets": [
          148.5605,
          151.4357
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.50",
        "slope gap 0.0137"
      ],
      "direction": "falling",
      "atr14": 6.2749
    },
    "avg_price": 138.4904032389323,
    "avg_volume": 42075104.56666667,
    "key_levels": {
      "entry": 144.2476,
      "stop": 138.5109,
      "targets": [
        148.5605,
        151.4357
      ]
    },
    "atr14": 6.2749,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=PM+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758152133569.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 15801.81
  }
}
2025-09-17 16:35:33 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-17 23:35:37.442194', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 16:35:37 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 16:35:43 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 16:35:43 Sleeping 5m before next iteration
2025-09-17 16:40:43 === Iteration 18 ===
2025-09-17 16:40:43 venv exists
2025-09-17 16:40:43 Installing Python requirements
2025-09-17 16:40:45 shots: node_modules present
2025-09-17 16:40:45 frontend: node_modules present
2025-09-17 16:40:45 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 1 warning in 8.82s
2025-09-17 16:40:55 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 16:40:55 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 16:40:55 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 16:40:50,282", "levelname": "INFO", "message": "request", "request_id": "c56024be-bb26-4928-b594-eb4161dba429", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 64}
INFO:     127.0.0.1:52911 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 16:40:50,295", "levelname": "INFO", "message": "request", "request_id": "99c8cfc0-07cd-4ba2-9143-6002f58ed610", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 4}
INFO:     127.0.0.1:52914 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 16:40:55,499", "levelname": "INFO", "message": "request", "request_id": "34855542-254b-4b4b-9dbe-e955b5f9e533", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:52936 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 16:41:02,101", "levelname": "INFO", "message": "request", "request_id": "3a255da8-2881-4878-928a-51a0cbcf1f29", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:52966 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 16:41:02,192", "levelname": "INFO", "message": "request", "request_id": "36c88c5e-aff8-4b79-9e96-b5826ee4b774", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 60}
INFO:     127.0.0.1:52967 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6457,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758152461923.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5198,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758152467306.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 16:41:07 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758152477372.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9798.68
  }
}

2025-09-17 16:41:17 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758152482981.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5471
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758152492655.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9659.78
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 177,
  "sample": {
    "symbol": "APA",
    "score": 88.11,
    "entry": 85.0699,
    "stop": 80.3286,
    "targets": [
      92.4979,
      97.4499
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 91.66,
          "x2": "2025-09-15",
          "y2": 84.6467,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 79.28,
          "x2": "2025-09-15",
          "y2": 81.14,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 82.8933
        }
      ],
      "priceLevels": {
        "entry": 85.0699,
        "stop": 80.3286,
        "targets": [
          92.4979,
          97.4499
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.28",
        "slope gap 0.0170"
      ],
      "direction": "falling",
      "atr14": 4.5891
    },
    "avg_price": 67.01066678365072,
    "avg_volume": 13664891.066666666,
    "key_levels": {
      "entry": 85.0699,
      "stop": 80.3286,
      "targets": [
        92.4979,
        97.4499
      ]
    },
    "atr14": 4.5891,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=APA+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30367.87
  }
}
2025-09-17 16:43:18 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-17 23:43:23.766562', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 16:43:24 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 16:43:33 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 16:43:33 Sleeping 5m before next iteration
2025-09-17 16:48:33 === Iteration 19 ===
2025-09-17 16:48:33 venv exists
2025-09-17 16:48:33 Installing Python requirements
2025-09-17 16:48:34 shots: node_modules present
2025-09-17 16:48:34 frontend: node_modules present
2025-09-17 16:48:34 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 1 warning in 8.70s
2025-09-17 16:48:44 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 16:48:44 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 16:48:44 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 16:48:39,499", "levelname": "INFO", "message": "request", "request_id": "9b86fb92-c963-4ca1-9b11-9fd70beeb479", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 27}
INFO:     127.0.0.1:53834 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 16:48:39,512", "levelname": "INFO", "message": "request", "request_id": "cd9f5c34-bc02-4964-8cb0-230d1a2dfc9d", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 4}
INFO:     127.0.0.1:53837 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 16:48:44,431", "levelname": "INFO", "message": "request", "request_id": "287cd9c4-5976-4942-b86d-b86f8c425315", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 0}
INFO:     127.0.0.1:53860 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 16:48:51,610", "levelname": "INFO", "message": "request", "request_id": "defe9bd0-6e9c-45b2-a034-070a066cbbb1", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 7}
INFO:     127.0.0.1:53893 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 16:48:51,688", "levelname": "INFO", "message": "request", "request_id": "a74330ae-6e55-4e48-96fa-01875cc66c42", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 62}
INFO:     127.0.0.1:53894 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6964,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758152931373.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 6350,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758152937955.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 16:48:58 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758152948453.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10247.59
  }
}

2025-09-17 16:49:08 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758152955062.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6452
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758152964352.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9224.87
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 196,
  "sample": {
    "symbol": "ORCL",
    "score": 85.78,
    "entry": 73.7469,
    "stop": 70.8939,
    "targets": [
      77.198,
      79.4988
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 104.2589,
          "x2": "2025-09-15",
          "y2": 73.38,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 98.507,
          "x2": "2025-09-15",
          "y2": 71.61,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 72.495
        }
      ],
      "priceLevels": {
        "entry": 73.7469,
        "stop": 70.8939,
        "targets": [
          77.198,
          79.4988
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.31",
        "slope gap 0.0002"
      ],
      "direction": "falling",
      "atr14": 4.8596,
      "sector": "Technology"
    },
    "avg_price": 67.44640210469564,
    "avg_volume": 79877114.13333334,
    "key_levels": {
      "entry": 73.7469,
      "stop": 70.8939,
      "targets": [
        77.198,
        79.4988
      ]
    },
    "atr14": 4.8596,
    "sector": "Technology",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=ORCL+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30278.88
  }
}
2025-09-17 16:51:09 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-17 23:51:13.089313', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 16:51:13 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 16:51:19 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 16:51:19 Sleeping 5m before next iteration
2025-09-17 16:56:19 === Iteration 20 ===
2025-09-17 16:56:19 venv exists
2025-09-17 16:56:19 Installing Python requirements
2025-09-17 16:56:21 shots: node_modules present
2025-09-17 16:56:21 frontend: node_modules present
2025-09-17 16:56:21 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 1 warning in 8.67s
2025-09-17 16:56:31 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 16:56:31 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 16:56:31 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 16:56:26,180", "levelname": "INFO", "message": "request", "request_id": "8bd6ad6f-63e7-4d14-ac68-906b8d8f0409", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 24}
INFO:     127.0.0.1:54711 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 16:56:26,190", "levelname": "INFO", "message": "request", "request_id": "2ba944ea-72eb-4bdf-9f89-24b8d98acc7e", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:54714 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 16:56:31,330", "levelname": "INFO", "message": "request", "request_id": "6e8d6897-4e27-445b-879e-2217cc05a956", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:54738 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 16:56:38,128", "levelname": "INFO", "message": "request", "request_id": "a4031e83-c693-476a-b978-6ce68cc54f6c", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:54766 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 16:56:38,244", "levelname": "INFO", "message": "request", "request_id": "57e9580b-8ad2-48c1-b97d-40f697300637", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 97}
INFO:     127.0.0.1:54767 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6605,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758153397899.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5249,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758153403416.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 16:56:43 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758153415035.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 11311.12
  }
}

2025-09-17 16:56:55 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758153421647.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6446
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758153431152.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9476.48
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 176,
  "sample": {
    "symbol": "TRGP",
    "score": 84.29,
    "entry": 75.9177,
    "stop": 71.7552,
    "targets": [
      80.894,
      84.2116
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 104.7729,
          "x2": "2025-09-15",
          "y2": 75.54,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 96.479,
          "x2": "2025-09-15",
          "y2": 72.48,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 74.01
        }
      ],
      "priceLevels": {
        "entry": 75.9177,
        "stop": 71.7552,
        "targets": [
          80.894,
          84.2116
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.37",
        "slope gap 0.0201"
      ],
      "direction": "falling",
      "atr14": 4.335
    },
    "avg_price": 68.79065284729003,
    "avg_volume": 15849026.566666666,
    "key_levels": {
      "entry": 75.9177,
      "stop": 71.7552,
      "targets": [
        80.894,
        84.2116
      ]
    },
    "atr14": 4.335,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=TRGP+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30389.0
  }
}
2025-09-17 16:58:56 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-17 23:59:00.498310', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 16:59:00 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 16:59:07 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 16:59:07 Sleeping 5m before next iteration
2025-09-17 17:04:07 === Iteration 21 ===
2025-09-17 17:04:07 venv exists
2025-09-17 17:04:07 Installing Python requirements
2025-09-17 17:04:09 shots: node_modules present
2025-09-17 17:04:09 frontend: node_modules present
2025-09-17 17:04:09 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 1 warning in 9.00s
2025-09-17 17:04:19 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 17:04:19 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 17:04:20 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 17:04:14,630", "levelname": "INFO", "message": "request", "request_id": "7b152fe2-8ce4-4e7e-93a5-7461d61b1a6b", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 29}
INFO:     127.0.0.1:55567 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 17:04:14,639", "levelname": "INFO", "message": "request", "request_id": "5b850d2e-6e53-40b3-8fc5-cf5046bb002a", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:55570 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 17:04:20,009", "levelname": "INFO", "message": "request", "request_id": "04699e14-41b1-418f-ab5f-1e081bb879b7", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:55594 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 17:04:26,745", "levelname": "INFO", "message": "request", "request_id": "4c6d8eeb-d477-41fa-950c-cbf70e0fce79", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:55625 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 17:04:26,816", "levelname": "INFO", "message": "request", "request_id": "d730b8c6-f577-468e-8535-1985bb9fee0d", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 57}
INFO:     127.0.0.1:55626 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6490,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758153866511.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5452,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758153872178.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 17:04:32 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758153884465.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 11980.37
  }
}

2025-09-17 17:04:44 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758153890896.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6336
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758153900049.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9049.58
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 151,
  "sample": {
    "symbol": "NDAQ",
    "score": 88.78,
    "entry": 83.1637,
    "stop": 79.7346,
    "targets": [
      87.9836,
      91.1968
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 111.318,
          "x2": "2025-09-15",
          "y2": 82.75,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 103.285,
          "x2": "2025-09-15",
          "y2": 80.54,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 81.645
        }
      ],
      "priceLevels": {
        "entry": 83.1637,
        "stop": 79.7346,
        "targets": [
          87.9836,
          91.1968
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.28",
        "slope gap 0.0030"
      ],
      "direction": "falling",
      "atr14": 4.3001
    },
    "avg_price": 81.54688568115235,
    "avg_volume": 71392666.4,
    "key_levels": {
      "entry": 83.1637,
      "stop": 79.7346,
      "targets": [
        87.9836,
        91.1968
      ]
    },
    "atr14": 4.3001,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=NDAQ+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30402.52
  }
}
2025-09-17 17:06:44 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 00:06:48.679538', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 17:06:48 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 17:06:55 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 17:06:55 Sleeping 5m before next iteration
2025-09-17 17:11:55 === Iteration 22 ===
2025-09-17 17:11:55 venv exists
2025-09-17 17:11:55 Installing Python requirements
2025-09-17 17:12:29 shots: node_modules present
2025-09-17 17:12:29 frontend: node_modules present
2025-09-17 17:12:29 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 27.96s
2025-09-17 17:12:59 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 17:12:59 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 17:12:59 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 17:12:53,231", "levelname": "INFO", "message": "request", "request_id": "c85450dc-32f8-41e2-9614-2e34c2f6d7dc", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 27}
INFO:     127.0.0.1:56450 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 17:12:53,240", "levelname": "INFO", "message": "request", "request_id": "643b4e69-8da2-4b03-ba32-63d96dd0f633", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 4}
INFO:     127.0.0.1:56453 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 17:12:59,737", "levelname": "INFO", "message": "request", "request_id": "9eb11ce8-4207-4a5a-979c-40b70a1cb999", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:56480 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 17:13:06,591", "levelname": "INFO", "message": "request", "request_id": "bf002f71-9415-4d40-b59f-ad1d388ea6ae", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:56516 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 17:13:06,669", "levelname": "INFO", "message": "request", "request_id": "9189c6eb-4bab-47f3-9a79-e7495493011a", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 63}
INFO:     127.0.0.1:56517 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6626,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758154386383.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5580,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758154392138.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 17:13:12 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758154401880.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9430.82
  }
}

2025-09-17 17:13:22 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758154407955.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5896
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758154417344.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9318.13
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 111,
  "sample": {
    "symbol": "TTD",
    "score": 82.55,
    "entry": 91.2681,
    "stop": 87.5556,
    "targets": [
      94.9414,
      97.3903
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 135.8186,
          "x2": "2025-09-15",
          "y2": 90.814,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 129.6964,
          "x2": "2025-09-15",
          "y2": 88.44,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 89.627
        }
      ],
      "priceLevels": {
        "entry": 91.2681,
        "stop": 87.5556,
        "targets": [
          94.9414,
          97.3903
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.39",
        "slope gap 0.0283"
      ],
      "direction": "falling",
      "atr14": 5.9275
    },
    "avg_price": 98.35214207967122,
    "avg_volume": 36477690.1,
    "key_levels": {
      "entry": 91.2681,
      "stop": 87.5556,
      "targets": [
        94.9414,
        97.3903
      ]
    },
    "atr14": 5.9275,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=TTD+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30318.9
  }
}
2025-09-17 17:15:22 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 00:15:26.259163', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 17:15:26 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 17:15:33 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 17:15:33 Sleeping 5m before next iteration
2025-09-17 17:20:33 === Iteration 23 ===
2025-09-17 17:20:33 venv exists
2025-09-17 17:20:33 Installing Python requirements
2025-09-17 17:20:33 shots: node_modules present
2025-09-17 17:20:33 frontend: node_modules present
2025-09-17 17:20:33 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 10.48s
2025-09-17 17:20:45 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 17:20:45 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 17:20:45 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 17:20:38,553", "levelname": "INFO", "message": "request", "request_id": "f15ba3a1-0001-41a0-92b2-4d0df37f3558", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 32}
INFO:     127.0.0.1:57295 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 17:20:38,560", "levelname": "INFO", "message": "request", "request_id": "30307a20-f88e-4489-84db-5d577d6208ad", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:57298 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 17:20:45,643", "levelname": "INFO", "message": "request", "request_id": "af4deb40-6866-4ab5-956c-5c2ae3f88d7b", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:57321 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 17:20:52,753", "levelname": "INFO", "message": "request", "request_id": "cdf69228-7b17-458e-aee0-c00b65136c6d", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 5}
INFO:     127.0.0.1:57352 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 17:20:52,824", "levelname": "INFO", "message": "request", "request_id": "2bf0d111-582a-49bd-a9e4-20c951fbe5bb", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 56}
INFO:     127.0.0.1:57353 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6768,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758154852516.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5947,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758154858682.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 17:20:58 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758154869961.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10979.31
  }
}

2025-09-17 17:21:10 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758154876810.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6742
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758154886363.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9463.06
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 145,
  "sample": {
    "symbol": "HON",
    "score": 78.59,
    "entry": 50.4108,
    "stop": 47.9358,
    "targets": [
      52.2945,
      53.5503
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 63.2387,
          "x2": "2025-09-15",
          "y2": 50.16,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 60.0992,
          "x2": "2025-09-15",
          "y2": 48.42,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 49.29
        }
      ],
      "priceLevels": {
        "entry": 50.4108,
        "stop": 47.9358,
        "targets": [
          52.2945,
          53.5503
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.55",
        "slope gap 0.0034"
      ],
      "direction": "falling",
      "atr14": 2.1962
    },
    "avg_price": 53.468086624145506,
    "avg_volume": 27987371.1,
    "key_levels": {
      "entry": 50.4108,
      "stop": 47.9358,
      "targets": [
        52.2945,
        53.5503
      ]
    },
    "atr14": 2.1962,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=HON+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30267.61
  }
}
2025-09-17 17:23:10 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 00:23:14.940143', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 17:23:15 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 17:23:21 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 17:23:21 Sleeping 5m before next iteration
2025-09-17 17:28:21 === Iteration 24 ===
2025-09-17 17:28:21 venv exists
2025-09-17 17:28:21 Installing Python requirements
2025-09-17 17:28:22 shots: node_modules present
2025-09-17 17:28:22 frontend: node_modules present
2025-09-17 17:28:22 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 8.46s
2025-09-17 17:28:32 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 17:28:32 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 17:28:32 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 17:28:27,555", "levelname": "INFO", "message": "request", "request_id": "02324940-ea61-4e22-a84a-c006d5e621cc", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 48}
INFO:     127.0.0.1:58182 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 17:28:27,563", "levelname": "INFO", "message": "request", "request_id": "15467745-7bf9-4025-baed-fac282cd9880", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:58185 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 17:28:32,569", "levelname": "INFO", "message": "request", "request_id": "3c3e010d-e3df-4f7e-a1f8-9168841cea34", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:58210 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 17:28:39,339", "levelname": "INFO", "message": "request", "request_id": "ecac3a92-6975-4fa8-bba4-39ec64661444", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:58240 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 17:28:39,436", "levelname": "INFO", "message": "request", "request_id": "a27154f0-5b3a-478f-810d-28344a61c325", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 59}
INFO:     127.0.0.1:58241 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6552,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758155319144.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 4993,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758155324344.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 17:28:44 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758155335376.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10842.68
  }
}

2025-09-17 17:28:55 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758155341929.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6317
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758155351363.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9494.82
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 115,
  "sample": {
    "symbol": "DUK",
    "score": 83.42,
    "entry": 99.1935,
    "stop": 93.951,
    "targets": [
      105.0975,
      109.0335
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 145.09,
          "x2": "2025-09-15",
          "y2": 98.7,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 135.25,
          "x2": "2025-09-15",
          "y2": 94.9,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 96.8
        }
      ],
      "priceLevels": {
        "entry": 99.1935,
        "stop": 93.951,
        "targets": [
          105.0975,
          109.0335
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.39",
        "slope gap 0.0125"
      ],
      "direction": "falling",
      "atr14": 5.8471,
      "sector": "Utilities"
    },
    "avg_price": 92.20166702270508,
    "avg_volume": 21742586.633333333,
    "key_levels": {
      "entry": 99.1935,
      "stop": 93.951,
      "targets": [
        105.0975,
        109.0335
      ]
    },
    "atr14": 5.8471,
    "sector": "Utilities",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=DUK+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30334.35
  }
}
2025-09-17 17:30:56 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 00:31:00.563307', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 17:31:00 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 17:31:07 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 17:31:07 Sleeping 5m before next iteration
2025-09-17 17:36:07 === Iteration 25 ===
2025-09-17 17:36:07 venv exists
2025-09-17 17:36:07 Installing Python requirements
2025-09-17 17:36:08 shots: node_modules present
2025-09-17 17:36:08 frontend: node_modules present
2025-09-17 17:36:08 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 8.62s
2025-09-17 17:36:18 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 17:36:18 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 17:36:18 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 17:36:13,032", "levelname": "INFO", "message": "request", "request_id": "e48fb1fa-a264-4451-b83a-a429afc115d7", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 39}
INFO:     127.0.0.1:59044 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 17:36:13,039", "levelname": "INFO", "message": "request", "request_id": "819fb2ad-8531-49a5-8000-58100f25aea1", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:59047 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 17:36:18,188", "levelname": "INFO", "message": "request", "request_id": "73fe2f46-3e97-4cf3-9ba1-dfbea853f0ff", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:59070 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 17:36:25,088", "levelname": "INFO", "message": "request", "request_id": "8c7a18e0-7bee-4208-854b-e1c1b78459f0", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:59114 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 17:36:25,144", "levelname": "INFO", "message": "request", "request_id": "5b74b1e3-799c-4b9f-9bca-a4f9ab2198b9", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 41}
INFO:     127.0.0.1:59115 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6669,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758155784858.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 6375,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758155791464.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 17:36:31 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758155802756.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 11041.07
  }
}

2025-09-17 17:36:42 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758155808796.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5894
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758155818339.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9587.38
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 161,
  "sample": {
    "symbol": "ARE",
    "score": 88.11,
    "entry": 85.0699,
    "stop": 80.3286,
    "targets": [
      92.4979,
      97.4499
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 91.66,
          "x2": "2025-09-15",
          "y2": 84.6467,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 79.28,
          "x2": "2025-09-15",
          "y2": 81.14,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 82.8933
        }
      ],
      "priceLevels": {
        "entry": 85.0699,
        "stop": 80.3286,
        "targets": [
          92.4979,
          97.4499
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.28",
        "slope gap 0.0170"
      ],
      "direction": "falling",
      "atr14": 4.5891,
      "sector": "Real Estate"
    },
    "avg_price": 67.01066678365072,
    "avg_volume": 13664891.066666666,
    "key_levels": {
      "entry": 85.0699,
      "stop": 80.3286,
      "targets": [
        92.4979,
        97.4499
      ]
    },
    "atr14": 4.5891,
    "sector": "Real Estate",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=ARE+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30396.81
  }
}
2025-09-17 17:38:42 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 00:38:46.515954', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 17:38:46 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 17:38:53 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 17:38:53 Sleeping 5m before next iteration
2025-09-17 17:43:53 === Iteration 26 ===
2025-09-17 17:43:53 venv exists
2025-09-17 17:43:54 Installing Python requirements
2025-09-17 17:43:54 shots: node_modules present
2025-09-17 17:43:54 frontend: node_modules present
2025-09-17 17:43:54 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 8.49s
2025-09-17 17:44:04 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 17:44:04 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 17:44:04 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 17:43:59,300", "levelname": "INFO", "message": "request", "request_id": "6e857e8d-65cc-4dc6-a8a7-7aaa9cad15c9", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 28}
INFO:     127.0.0.1:59949 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 17:43:59,311", "levelname": "INFO", "message": "request", "request_id": "537ce5d0-ea37-4e6c-b134-fb1db86313a5", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 4}
INFO:     127.0.0.1:59952 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 17:44:04,357", "levelname": "INFO", "message": "request", "request_id": "cc1c6ece-2e5e-472a-a5c5-daa1e76c0d06", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:59974 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 17:44:11,153", "levelname": "INFO", "message": "request", "request_id": "4f8d1269-7943-48bc-8f94-7e14ff2ca29d", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:60003 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 17:44:11,208", "levelname": "INFO", "message": "request", "request_id": "aa35c95a-2d76-449a-b952-39c4753d5a55", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 40}
INFO:     127.0.0.1:60004 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6583,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758156250954.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 4818,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758156255951.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 17:44:16 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758156266538.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10402.53
  }
}

2025-09-17 17:44:26 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758156272502.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5716
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758156281871.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9444.32
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 148,
  "sample": {
    "symbol": "TDY",
    "score": 84.29,
    "entry": 75.9177,
    "stop": 71.7552,
    "targets": [
      80.894,
      84.2116
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 104.7729,
          "x2": "2025-09-15",
          "y2": 75.54,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 96.479,
          "x2": "2025-09-15",
          "y2": 72.48,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 74.01
        }
      ],
      "priceLevels": {
        "entry": 75.9177,
        "stop": 71.7552,
        "targets": [
          80.894,
          84.2116
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.37",
        "slope gap 0.0201"
      ],
      "direction": "falling",
      "atr14": 4.335
    },
    "avg_price": 68.79065272013347,
    "avg_volume": 15849026.566666666,
    "key_levels": {
      "entry": 75.9177,
      "stop": 71.7552,
      "targets": [
        80.894,
        84.2116
      ]
    },
    "atr14": 4.335,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=TDY+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30315.26
  }
}
2025-09-17 17:46:25 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 00:46:30.061779', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 17:46:30 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 17:46:37 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 17:46:37 Sleeping 5m before next iteration
2025-09-17 17:51:37 === Iteration 27 ===
2025-09-17 17:51:37 venv exists
2025-09-17 17:51:37 Installing Python requirements
2025-09-17 17:51:38 shots: node_modules present
2025-09-17 17:51:38 frontend: node_modules present
2025-09-17 17:51:38 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 9.12s
2025-09-17 17:51:48 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 17:51:48 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 17:51:48 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 17:51:42,992", "levelname": "INFO", "message": "request", "request_id": "d78b558a-8b4a-4c43-acd2-4482a608a6e2", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 44}
INFO:     127.0.0.1:60790 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 17:51:43,004", "levelname": "INFO", "message": "request", "request_id": "92eec1e6-2a55-4b7d-b063-d7ffea354c7d", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 7}
INFO:     127.0.0.1:60793 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 17:51:48,465", "levelname": "INFO", "message": "request", "request_id": "17d6656d-a1e9-4f86-82b1-5f7f22cfaa98", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:60817 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 17:51:56,028", "levelname": "INFO", "message": "request", "request_id": "7c6ef934-9b1d-4e7d-b4a1-350e87bbe4ed", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 11}
INFO:     127.0.0.1:60860 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 17:51:56,184", "levelname": "INFO", "message": "request", "request_id": "0a5b54e8-a5c7-49c4-8ed3-784195fa9456", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 104}
INFO:     127.0.0.1:60861 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 7307,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758156715790.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5668,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758156721759.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 17:52:01 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758156733153.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 11062.33
  }
}

2025-09-17 17:52:13 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758156740439.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6831
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758156749834.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9362.2
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 164,
  "sample": {
    "symbol": "MTD",
    "score": 88.91,
    "entry": 187.121,
    "stop": 178.0713,
    "targets": [
      201.4358,
      210.9791
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 284.7549,
          "x2": "2025-09-15",
          "y2": 186.19,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 260.8968,
          "x2": "2025-09-15",
          "y2": 179.87,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 183.03
        }
      ],
      "priceLevels": {
        "entry": 187.121,
        "stop": 178.0713,
        "targets": [
          201.4358,
          210.9791
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.26",
        "slope gap 0.0683"
      ],
      "direction": "falling",
      "atr14": 9.5991,
      "sector": "Healthcare"
    },
    "avg_price": 208.48872884114584,
    "avg_volume": 2926685.566666667,
    "key_levels": {
      "entry": 187.121,
      "stop": 178.0713,
      "targets": [
        201.4358,
        210.9791
      ]
    },
    "atr14": 9.5991,
    "sector": "Healthcare",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=MTD+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30290.8
  }
}
2025-09-17 17:54:15 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 00:54:18.953842', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 17:54:19 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 17:54:25 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 17:54:25 Sleeping 5m before next iteration
2025-09-17 17:59:25 === Iteration 28 ===
2025-09-17 17:59:25 venv exists
2025-09-17 17:59:25 Installing Python requirements
2025-09-17 17:59:26 shots: node_modules present
2025-09-17 17:59:26 frontend: node_modules present
2025-09-17 17:59:26 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 9.11s
2025-09-17 17:59:36 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 17:59:36 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 17:59:36 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 17:59:31,059", "levelname": "INFO", "message": "request", "request_id": "d3cbe4e7-c602-4c8b-a21f-aadaf583e478", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 29}
INFO:     127.0.0.1:61685 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 17:59:31,066", "levelname": "INFO", "message": "request", "request_id": "78e49b64-1def-4a5e-a8a5-d52a5ebf7b4a", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:61688 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 17:59:36,446", "levelname": "INFO", "message": "request", "request_id": "cc0a164c-3bd9-4b9a-96d6-3a053aed1a85", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:61713 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 17:59:43,433", "levelname": "INFO", "message": "request", "request_id": "34e9544a-a03b-490e-9333-1841775e37fd", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 12}
INFO:     127.0.0.1:61746 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 17:59:43,516", "levelname": "INFO", "message": "request", "request_id": "795524d1-fa1c-4780-9db5-03c1d0b35883", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 62}
INFO:     127.0.0.1:61747 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6743,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758157183216.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5606,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758157189035.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 17:59:49 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758157200272.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 11123.77
  }
}

2025-09-17 18:00:00 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758157206236.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5598
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758157215569.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9255.92
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 115,
  "sample": {
    "symbol": "NVDA",
    "score": 85.78,
    "entry": 73.7469,
    "stop": 70.8939,
    "targets": [
      77.198,
      79.4988
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 104.2589,
          "x2": "2025-09-15",
          "y2": 73.38,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 98.507,
          "x2": "2025-09-15",
          "y2": 71.61,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 72.495
        }
      ],
      "priceLevels": {
        "entry": 73.7469,
        "stop": 70.8939,
        "targets": [
          77.198,
          79.4988
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.31",
        "slope gap 0.0002"
      ],
      "direction": "falling",
      "atr14": 4.8596,
      "sector": "Technology"
    },
    "avg_price": 67.44640197753907,
    "avg_volume": 79877114.13333334,
    "key_levels": {
      "entry": 73.7469,
      "stop": 70.8939,
      "targets": [
        77.198,
        79.4988
      ]
    },
    "atr14": 4.8596,
    "sector": "Technology",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=NVDA+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30310.28
  }
}
2025-09-17 18:02:00 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 01:02:04.885187', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 18:02:04 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 18:02:11 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 18:02:12 Sleeping 5m before next iteration
2025-09-17 18:07:12 === Iteration 29 ===
2025-09-17 18:07:12 venv exists
2025-09-17 18:07:12 Installing Python requirements
2025-09-17 18:07:12 shots: node_modules present
2025-09-17 18:07:12 frontend: node_modules present
2025-09-17 18:07:12 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 9.06s
2025-09-17 18:07:22 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 18:07:22 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 18:07:22 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 18:07:17,753", "levelname": "INFO", "message": "request", "request_id": "f93aed39-439e-47cf-ae9c-c8fa4c6688c1", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 51}
INFO:     127.0.0.1:62576 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 18:07:17,762", "levelname": "INFO", "message": "request", "request_id": "317f1d63-c3c6-4c08-9886-dedb38c75f95", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 4}
INFO:     127.0.0.1:62579 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 18:07:22,952", "levelname": "INFO", "message": "request", "request_id": "b9441b6a-d27b-4bed-ba19-b449f201300f", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:62602 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 18:07:30,257", "levelname": "INFO", "message": "request", "request_id": "29f45204-30bf-412f-84af-f3ed45b67e82", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 5}
INFO:     127.0.0.1:62639 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 18:07:30,369", "levelname": "INFO", "message": "request", "request_id": "da27d03c-ecd4-44e6-8f37-b47860125ffb", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 75}
INFO:     127.0.0.1:62640 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 7062,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758157650019.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5729,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758157656033.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 18:07:36 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758157667664.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 11308.19
  }
}

2025-09-17 18:07:47 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758157674950.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6987
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758157684366.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9457.71
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 161,
  "sample": {
    "symbol": "DDOG",
    "score": 89.73,
    "entry": 69.6163,
    "stop": 67.7259,
    "targets": [
      71.8387,
      73.3203
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 66.8,
          "x2": "2025-09-15",
          "y2": 69.27,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 63.096,
          "x2": "2025-09-15",
          "y2": 68.41,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 68.84
        }
      ],
      "priceLevels": {
        "entry": 69.6163,
        "stop": 67.7259,
        "targets": [
          71.8387,
          73.3203
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.23",
        "slope gap 0.0095"
      ],
      "direction": "falling",
      "atr14": 4.025,
      "sector": "Technology"
    },
    "avg_price": 58.824666595458986,
    "avg_volume": 10344460.766666668,
    "key_levels": {
      "entry": 69.6163,
      "stop": 67.7259,
      "targets": [
        71.8387,
        73.3203
      ]
    },
    "atr14": 4.025,
    "sector": "Technology",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=DDOG+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758157800676.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 41987.73
  }
}
2025-09-17 18:10:00 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 01:10:04.539757', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 18:10:04 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 18:10:11 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 18:10:11 Sleeping 5m before next iteration
2025-09-17 18:15:11 === Iteration 30 ===
2025-09-17 18:15:11 venv exists
2025-09-17 18:15:11 Installing Python requirements
2025-09-17 18:15:11 shots: node_modules present
2025-09-17 18:15:11 frontend: node_modules present
2025-09-17 18:15:11 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 8.23s
2025-09-17 18:15:20 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 18:15:20 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 18:15:20 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 18:15:15,923", "levelname": "INFO", "message": "request", "request_id": "7e486465-f7ae-49f4-9795-010ead3a43e3", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 30}
INFO:     127.0.0.1:63471 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 18:15:15,930", "levelname": "INFO", "message": "request", "request_id": "f6e82282-64db-4ae1-b5fa-8b7a533e5b8f", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:63474 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 18:15:20,936", "levelname": "INFO", "message": "request", "request_id": "e1601ab1-6786-43d2-b13c-c6c976cb0bc4", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 0}
INFO:     127.0.0.1:63498 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 18:15:28,099", "levelname": "INFO", "message": "request", "request_id": "4687ec31-4436-49a3-a50b-ac4ae39ae020", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:63529 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 18:15:28,176", "levelname": "INFO", "message": "request", "request_id": "9114019f-779b-44d3-8592-34d7cd23bb72", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 54}
INFO:     127.0.0.1:63530 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6925,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758158127905.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5591,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758158133703.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 18:15:33 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758158143945.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9976.88
  }
}

2025-09-17 18:15:44 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758158149932.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5834
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758158159462.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9554.85
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 127,
  "sample": {
    "symbol": "DE",
    "score": 89.73,
    "entry": 69.6163,
    "stop": 67.7259,
    "targets": [
      71.8387,
      73.3203
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 66.8,
          "x2": "2025-09-15",
          "y2": 69.27,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 63.096,
          "x2": "2025-09-15",
          "y2": 68.41,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 68.84
        }
      ],
      "priceLevels": {
        "entry": 69.6163,
        "stop": 67.7259,
        "targets": [
          71.8387,
          73.3203
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.23",
        "slope gap 0.0095"
      ],
      "direction": "falling",
      "atr14": 4.025
    },
    "avg_price": 58.824666595458986,
    "avg_volume": 10344460.766666668,
    "key_levels": {
      "entry": 69.6163,
      "stop": 67.7259,
      "targets": [
        71.8387,
        73.3203
      ]
    },
    "atr14": 4.025,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=DE+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30218.02
  }
}
2025-09-17 18:17:44 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 01:17:47.800732', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 18:17:47 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 18:17:54 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 18:17:54 Sleeping 5m before next iteration
2025-09-17 18:22:54 === Iteration 31 ===
2025-09-17 18:22:54 venv exists
2025-09-17 18:22:54 Installing Python requirements
2025-09-17 18:22:55 shots: node_modules present
2025-09-17 18:22:55 frontend: node_modules present
2025-09-17 18:22:55 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 9.32s
2025-09-17 18:23:05 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 18:23:05 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 18:23:05 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 18:22:59,934", "levelname": "INFO", "message": "request", "request_id": "9efc3437-d51e-4bed-88be-09f7c68b7537", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 23}
INFO:     127.0.0.1:64348 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 18:22:59,944", "levelname": "INFO", "message": "request", "request_id": "5589a710-d164-4a4c-874c-ec1e9968fe62", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:64351 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 18:23:05,684", "levelname": "INFO", "message": "request", "request_id": "cc70eb6f-3315-4eeb-b890-0b6e4279be0b", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64374 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 18:23:12,905", "levelname": "INFO", "message": "request", "request_id": "12f331de-94ae-4ed4-91ca-a447ca9fd111", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:64407 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 18:23:12,977", "levelname": "INFO", "message": "request", "request_id": "157ae38e-43a3-4b8e-846d-6fe6ece2d82b", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 56}
INFO:     127.0.0.1:64408 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 7020,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758158592669.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5262,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758158598151.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 18:23:18 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758158607878.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9562.92
  }
}

2025-09-17 18:23:28 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758158615231.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 7115
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758158624644.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9327.11
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 142,
  "sample": {
    "symbol": "TSCO",
    "score": 84.29,
    "entry": 75.9177,
    "stop": 71.7552,
    "targets": [
      80.894,
      84.2116
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 104.7729,
          "x2": "2025-09-15",
          "y2": 75.54,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 96.479,
          "x2": "2025-09-15",
          "y2": 72.48,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 74.01
        }
      ],
      "priceLevels": {
        "entry": 75.9177,
        "stop": 71.7552,
        "targets": [
          80.894,
          84.2116
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.37",
        "slope gap 0.0201"
      ],
      "direction": "falling",
      "atr14": 4.335,
      "sector": "Consumer Cyclical"
    },
    "avg_price": 68.79065284729003,
    "avg_volume": 15849026.566666666,
    "key_levels": {
      "entry": 75.9177,
      "stop": 71.7552,
      "targets": [
        80.894,
        84.2116
      ]
    },
    "atr14": 4.335,
    "sector": "Consumer Cyclical",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=TSCO+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30266.37
  }
}
2025-09-17 18:25:29 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 01:25:33.608836', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 18:25:33 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 18:25:40 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 18:25:40 Sleeping 5m before next iteration
2025-09-17 18:30:40 === Iteration 32 ===
2025-09-17 18:30:40 venv exists
2025-09-17 18:30:40 Installing Python requirements
2025-09-17 18:30:41 shots: node_modules present
2025-09-17 18:30:41 frontend: node_modules present
2025-09-17 18:30:41 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 8.51s
2025-09-17 18:30:50 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 18:30:50 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 18:30:50 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 18:30:45,549", "levelname": "INFO", "message": "request", "request_id": "73a5c4c2-3954-41dd-9521-237b2056db2b", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 30}
INFO:     127.0.0.1:65258 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 18:30:45,557", "levelname": "INFO", "message": "request", "request_id": "6d5dd278-af69-4232-aab2-d66a8d602d3d", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:65261 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 18:30:50,622", "levelname": "INFO", "message": "request", "request_id": "0e432d5f-bba1-4532-a0e4-4f2aaddcd1a8", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:65286 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 18:30:58,014", "levelname": "INFO", "message": "request", "request_id": "c2fd6b10-d9dd-4436-bb9b-b4b5787c00ef", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:65319 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 18:30:58,086", "levelname": "INFO", "message": "request", "request_id": "724e7b57-e8d0-435d-9744-8a59c7dcf65a", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 58}
INFO:     127.0.0.1:65320 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 7174,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758159057788.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 6503,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758159064506.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 18:31:04 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758159074510.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9791.33
  }
}

2025-09-17 18:31:14 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758159081206.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6489
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758159090774.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9513.68
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 116,
  "sample": {
    "symbol": "DTE",
    "score": 89.73,
    "entry": 69.6163,
    "stop": 67.7259,
    "targets": [
      71.8387,
      73.3203
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 66.8,
          "x2": "2025-09-15",
          "y2": 69.27,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 63.096,
          "x2": "2025-09-15",
          "y2": 68.41,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 68.84
        }
      ],
      "priceLevels": {
        "entry": 69.6163,
        "stop": 67.7259,
        "targets": [
          71.8387,
          73.3203
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.23",
        "slope gap 0.0095"
      ],
      "direction": "falling",
      "atr14": 4.025,
      "sector": "Utilities"
    },
    "avg_price": 58.824666595458986,
    "avg_volume": 10466750.766666668,
    "key_levels": {
      "entry": 69.6163,
      "stop": 67.7259,
      "targets": [
        71.8387,
        73.3203
      ]
    },
    "atr14": 4.025,
    "sector": "Utilities",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=DTE+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30430.04
  }
}
2025-09-17 18:33:15 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 01:33:18.961890', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 18:33:19 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 18:33:25 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 18:33:25 Sleeping 5m before next iteration
2025-09-17 18:38:25 === Iteration 33 ===
2025-09-17 18:38:25 venv exists
2025-09-17 18:38:25 Installing Python requirements
2025-09-17 18:38:26 shots: node_modules present
2025-09-17 18:38:26 frontend: node_modules present
2025-09-17 18:38:26 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 8.63s
2025-09-17 18:38:36 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 18:38:36 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 18:38:36 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 18:38:31,072", "levelname": "INFO", "message": "request", "request_id": "98ded5ce-74c0-469f-a1b2-b092f068b733", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 74}
INFO:     127.0.0.1:49756 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 18:38:31,081", "levelname": "INFO", "message": "request", "request_id": "b6b23a93-cd81-4c61-9899-325a046193fe", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 4}
INFO:     127.0.0.1:49759 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 18:38:36,321", "levelname": "INFO", "message": "request", "request_id": "8a174204-da5a-40cc-9078-35352ec000ce", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:49783 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 18:38:43,037", "levelname": "INFO", "message": "request", "request_id": "5ef5693d-0758-4738-82bf-25668601b69b", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:49813 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 18:38:43,118", "levelname": "INFO", "message": "request", "request_id": "70079bed-3644-498c-afe5-99130e3dcb73", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 68}
INFO:     127.0.0.1:49814 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6499,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758159522838.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5134,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758159528172.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 18:38:48 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758159538356.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9971.24
  }
}

2025-09-17 18:38:58 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758159544189.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5728
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758159553839.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9835.28
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 133,
  "sample": {
    "symbol": "ARE",
    "score": 88.1,
    "entry": 85.0733,
    "stop": 80.3286,
    "targets": [
      92.5013,
      97.4533
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 91.66,
          "x2": "2025-09-15",
          "y2": 84.65,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 79.28,
          "x2": "2025-09-15",
          "y2": 81.14,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 82.895
        }
      ],
      "priceLevels": {
        "entry": 85.0733,
        "stop": 80.3286,
        "targets": [
          92.5013,
          97.4533
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.28",
        "slope gap 0.0170"
      ],
      "direction": "falling",
      "atr14": 4.5893,
      "sector": "Real Estate"
    },
    "avg_price": 67.01066678365072,
    "avg_volume": 13724511.066666666,
    "key_levels": {
      "entry": 85.0733,
      "stop": 80.3286,
      "targets": [
        92.5013,
        97.4533
      ]
    },
    "atr14": 4.5893,
    "sector": "Real Estate",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=ARE+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30296.11
  }
}
2025-09-17 18:40:58 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 01:41:01.751584', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 18:41:01 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 18:41:08 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 18:41:08 Sleeping 5m before next iteration
2025-09-17 18:46:08 === Iteration 34 ===
2025-09-17 18:46:08 venv exists
2025-09-17 18:46:08 Installing Python requirements
2025-09-17 18:46:09 shots: node_modules present
2025-09-17 18:46:09 frontend: node_modules present
2025-09-17 18:46:09 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 9.34s
2025-09-17 18:46:20 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 18:46:20 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 18:46:20 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 18:46:15,046", "levelname": "INFO", "message": "request", "request_id": "f852142d-dc5c-46f5-ab5d-fed1aba5e4a5", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 29}
INFO:     127.0.0.1:50596 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 18:46:15,054", "levelname": "INFO", "message": "request", "request_id": "fb76427a-31e6-4ba9-a8ad-ce347783fbfb", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:50599 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 18:46:20,428", "levelname": "INFO", "message": "request", "request_id": "1f34a649-ceb5-446e-9120-f0f2970cb429", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 9}
INFO:     127.0.0.1:50621 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 18:46:31,658", "levelname": "INFO", "message": "request", "request_id": "313fb3be-2dbd-4753-84f0-380edb4146b3", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 5}
INFO:     127.0.0.1:50663 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 18:46:31,773", "levelname": "INFO", "message": "request", "request_id": "790714c9-17c1-4330-9ca7-36dfeb575ee4", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 81}
INFO:     127.0.0.1:50664 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 10886,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758159991400.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5919,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758159997652.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 18:46:37 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758160008371.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10251.34
  }
}

2025-09-17 18:46:48 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758160014397.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5868
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758160024020.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9607.43
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 94,
  "sample": {
    "symbol": "LEN",
    "score": 80.79,
    "entry": 62.0085,
    "stop": 58.4298,
    "targets": [
      65.8785,
      68.4585
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 77.63,
          "x2": "2025-09-15",
          "y2": 61.7,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 71.18,
          "x2": "2025-09-15",
          "y2": 59.02,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 60.36
        }
      ],
      "priceLevels": {
        "entry": 62.0085,
        "stop": 58.4298,
        "targets": [
          65.8785,
          68.4585
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.42",
        "slope gap 0.0041"
      ],
      "direction": "falling",
      "atr14": 4.4257
    },
    "avg_price": 65.70599975585938,
    "avg_volume": 15414877.5,
    "key_levels": {
      "entry": 62.0085,
      "stop": 58.4298,
      "targets": [
        65.8785,
        68.4585
      ]
    },
    "atr14": 4.4257,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=LEN+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30224.01
  }
}
2025-09-17 18:48:48 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 01:48:52.744782', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 18:48:52 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 18:49:00 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 18:49:00 Sleeping 5m before next iteration
2025-09-17 18:54:00 === Iteration 35 ===
2025-09-17 18:54:00 venv exists
2025-09-17 18:54:00 Installing Python requirements
2025-09-17 18:54:01 shots: node_modules present
2025-09-17 18:54:01 frontend: node_modules present
2025-09-17 18:54:01 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 8.81s
2025-09-17 18:54:10 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 18:54:10 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 18:54:11 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 18:54:05,796", "levelname": "INFO", "message": "request", "request_id": "3ec668a8-8fda-46cd-8cd8-e7c2033bf56c", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 30}
INFO:     127.0.0.1:51442 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 18:54:05,804", "levelname": "INFO", "message": "request", "request_id": "0c783bb7-89e1-480c-a135-3fdb0b5a7013", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:51445 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 18:54:11,006", "levelname": "INFO", "message": "request", "request_id": "f26944c2-6efd-445c-991c-e899f5ae4657", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:51467 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 18:54:18,066", "levelname": "INFO", "message": "request", "request_id": "45b698cd-cd13-4030-a41e-2e893463feda", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 4}
INFO:     127.0.0.1:51498 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 18:54:18,129", "levelname": "INFO", "message": "request", "request_id": "ed9cddc5-8efd-4903-b95a-4e216909e592", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 46}
INFO:     127.0.0.1:51499 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6816,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758160457825.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 4842,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758160462910.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 18:54:23 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758160472932.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9740.53
  }
}

2025-09-17 18:54:33 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758160479407.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6323
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758160489052.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9642.75
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 165,
  "sample": {
    "symbol": "BMY",
    "score": 83.77,
    "entry": 28.2506,
    "stop": 26.8389,
    "targets": [
      29.9898,
      31.1494
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 55.3463,
          "x2": "2025-09-15",
          "y2": 28.11,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 52.4474,
          "x2": "2025-09-15",
          "y2": 27.11,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 27.61
        }
      ],
      "priceLevels": {
        "entry": 28.2506,
        "stop": 26.8389,
        "targets": [
          29.9898,
          31.1494
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.34",
        "slope gap 0.0026"
      ],
      "direction": "falling",
      "atr14": 1.9824
    },
    "avg_price": 30.925524711608887,
    "avg_volume": 18955150.0,
    "key_levels": {
      "entry": 28.2506,
      "stop": 26.8389,
      "targets": [
        29.9898,
        31.1494
      ]
    },
    "atr14": 1.9824,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=BMY+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30393.45
  }
}
2025-09-17 18:56:33 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 01:56:36.820765', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 18:56:36 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 18:56:43 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 18:56:43 Sleeping 5m before next iteration
2025-09-17 19:01:43 === Iteration 36 ===
2025-09-17 19:01:43 venv exists
2025-09-17 19:01:43 Installing Python requirements
2025-09-17 19:01:44 shots: node_modules present
2025-09-17 19:01:44 frontend: node_modules present
2025-09-17 19:01:44 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 8.60s
2025-09-17 19:01:54 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 19:01:54 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 19:01:54 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 19:01:49,104", "levelname": "INFO", "message": "request", "request_id": "6add1644-8ca9-4f89-bfaa-0c45f3e16554", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 11}
INFO:     127.0.0.1:52288 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 19:01:49,111", "levelname": "INFO", "message": "request", "request_id": "862d67c6-0955-466e-a90d-9bbd3457b67d", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:52291 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 19:01:54,380", "levelname": "INFO", "message": "request", "request_id": "aae4bc62-2056-4df6-88ce-e9876a881239", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:52324 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 19:02:01,004", "levelname": "INFO", "message": "request", "request_id": "9f3294e6-cf77-40bd-b956-4c627a4d7d1e", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:52355 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 19:02:01,061", "levelname": "INFO", "message": "request", "request_id": "57d0fd4e-a121-4889-8d8d-68f4fe6745ff", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 41}
INFO:     127.0.0.1:52356 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6463,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758160920772.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5020,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758160926023.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 19:02:06 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758160936868.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10684.53
  }
}

2025-09-17 19:02:17 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758160942872.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5763
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758160952747.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9813.25
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 116,
  "sample": {
    "symbol": "HPE",
    "score": 78.56,
    "entry": 278.2946,
    "stop": 267.5871,
    "targets": [
      285.6572,
      290.5656
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 251.2054,
          "x2": "2025-09-15",
          "y2": 276.91,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 238.9343,
          "x2": "2025-09-15",
          "y2": 270.29,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 273.6
        }
      ],
      "priceLevels": {
        "entry": 278.2946,
        "stop": 267.5871,
        "targets": [
          285.6572,
          290.5656
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.54",
        "slope gap 0.0526"
      ],
      "direction": "falling",
      "atr14": 12.9797,
      "sector": "Technology"
    },
    "avg_price": 234.40657450358074,
    "avg_volume": 2861699.6,
    "key_levels": {
      "entry": 278.2946,
      "stop": 267.5871,
      "targets": [
        285.6572,
        290.5656
      ]
    },
    "atr14": 12.9797,
    "sector": "Technology",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=HPE+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30365.53
  }
}
2025-09-17 19:04:19 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 02:04:22.994289', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 19:04:23 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 19:04:30 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 19:04:30 Sleeping 5m before next iteration
2025-09-17 19:09:30 === Iteration 37 ===
2025-09-17 19:09:30 venv exists
2025-09-17 19:09:30 Installing Python requirements
2025-09-17 19:09:30 shots: node_modules present
2025-09-17 19:09:30 frontend: node_modules present
2025-09-17 19:09:30 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 8.01s
2025-09-17 19:09:39 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 19:09:39 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 19:09:39 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 19:09:34,960", "levelname": "INFO", "message": "request", "request_id": "7b725b7c-dbe4-4b09-a2ec-9ccc4f592afb", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 10}
INFO:     127.0.0.1:53114 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 19:09:34,967", "levelname": "INFO", "message": "request", "request_id": "317fe6e3-c81f-4f30-860b-ff1b2bb3f1e4", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:53117 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 19:09:39,887", "levelname": "INFO", "message": "request", "request_id": "7665a9b6-1320-4c43-9636-32831bcec598", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:53139 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 19:09:46,586", "levelname": "INFO", "message": "request", "request_id": "f53c84de-ccd9-4608-9178-fd76aa217a8f", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 4}
INFO:     127.0.0.1:53168 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 19:09:46,655", "levelname": "INFO", "message": "request", "request_id": "5d634e83-9a8f-4340-9ef7-edc3d6b43700", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 43}
INFO:     127.0.0.1:53169 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6555,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758161386371.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5155,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758161391744.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 19:09:51 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758161402867.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10829.83
  }
}

2025-09-17 19:10:02 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758161408487.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5502
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758161419067.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10543.71
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 159,
  "sample": {
    "symbol": "ROL",
    "score": 80.57,
    "entry": 144.2476,
    "stop": 138.5109,
    "targets": [
      148.5605,
      151.4357
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 164.837,
          "x2": "2025-09-15",
          "y2": 143.53,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 157.6489,
          "x2": "2025-09-15",
          "y2": 139.91,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 141.72
        }
      ],
      "priceLevels": {
        "entry": 144.2476,
        "stop": 138.5109,
        "targets": [
          148.5605,
          151.4357
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.50",
        "slope gap 0.0137"
      ],
      "direction": "falling",
      "atr14": 6.2749
    },
    "avg_price": 138.49040247599285,
    "avg_volume": 42278137.9,
    "key_levels": {
      "entry": 144.2476,
      "stop": 138.5109,
      "targets": [
        148.5605,
        151.4357
      ]
    },
    "atr14": 6.2749,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=ROL+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30340.1
  }
}
2025-09-17 19:12:03 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 02:12:08.170779', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 19:12:08 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 19:12:15 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 19:12:15 Sleeping 5m before next iteration
2025-09-17 19:17:15 === Iteration 38 ===
2025-09-17 19:17:15 venv exists
2025-09-17 19:17:15 Installing Python requirements
2025-09-17 19:17:15 shots: node_modules present
2025-09-17 19:17:15 frontend: node_modules present
2025-09-17 19:17:15 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 8.49s
2025-09-17 19:17:25 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 19:17:25 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 19:17:25 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 19:17:20,227", "levelname": "INFO", "message": "request", "request_id": "98a69afd-4615-47b9-bc24-c81bba1445ab", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 17}
INFO:     127.0.0.1:53934 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 19:17:20,234", "levelname": "INFO", "message": "request", "request_id": "73d5cf2d-6d12-4958-b298-feea56f307b2", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:53937 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 19:17:25,538", "levelname": "INFO", "message": "request", "request_id": "b1ded529-2345-4838-a428-f558e1d8dca6", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:53960 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 19:17:31,798", "levelname": "INFO", "message": "request", "request_id": "814f66c4-d70c-4d97-9882-ff935dde0e04", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:53991 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 19:17:31,844", "levelname": "INFO", "message": "request", "request_id": "7516867b-4ece-48b7-a3de-e641b7f8cb0c", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 36}
INFO:     127.0.0.1:53992 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6100,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758161851570.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 4812,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758161856583.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 19:17:36 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758161867847.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 11056.78
  }
}

2025-09-17 19:17:48 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758161873802.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5699
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758161883262.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9374.31
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 170,
  "sample": {
    "symbol": "AVGO",
    "score": 88.1,
    "entry": 85.0733,
    "stop": 80.3286,
    "targets": [
      92.5013,
      97.4533
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 91.66,
          "x2": "2025-09-15",
          "y2": 84.65,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 79.28,
          "x2": "2025-09-15",
          "y2": 81.14,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 82.895
        }
      ],
      "priceLevels": {
        "entry": 85.0733,
        "stop": 80.3286,
        "targets": [
          92.5013,
          97.4533
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.28",
        "slope gap 0.0170"
      ],
      "direction": "falling",
      "atr14": 4.5893,
      "sector": "Technology"
    },
    "avg_price": 67.01066678365072,
    "avg_volume": 13724511.066666666,
    "key_levels": {
      "entry": 85.0733,
      "stop": 80.3286,
      "targets": [
        92.5013,
        97.4533
      ]
    },
    "atr14": 4.5893,
    "sector": "Technology",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AVGO+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30484.11
  }
}
2025-09-17 19:19:48 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 02:19:52.292632', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 19:19:52 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 19:19:59 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 19:19:59 Sleeping 5m before next iteration
2025-09-17 19:24:59 === Iteration 39 ===
2025-09-17 19:24:59 venv exists
2025-09-17 19:24:59 Installing Python requirements
2025-09-17 19:25:00 shots: node_modules present
2025-09-17 19:25:00 frontend: node_modules present
2025-09-17 19:25:00 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 11.09s
2025-09-17 19:25:12 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 19:25:12 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 19:25:12 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 19:25:07,081", "levelname": "INFO", "message": "request", "request_id": "17812ed5-3526-4402-aad1-26b1eae4d8d4", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 26}
INFO:     127.0.0.1:54786 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 19:25:07,115", "levelname": "INFO", "message": "request", "request_id": "03e1655e-0480-4aa4-99cd-31b4d0be96b0", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 28}
INFO:     127.0.0.1:54789 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 19:25:12,322", "levelname": "INFO", "message": "request", "request_id": "bc880b6a-8990-4110-9bd3-4b1ec7ceb435", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:54811 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 19:25:19,674", "levelname": "INFO", "message": "request", "request_id": "c5e8ec44-e9e5-4b22-92cb-1e2b9cc28f81", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:54843 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 19:25:19,771", "levelname": "INFO", "message": "request", "request_id": "610c29a1-cf00-4234-b892-f43fd7aa7c93", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 77}
INFO:     127.0.0.1:54844 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 7089,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758162319389.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 6308,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758162326036.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 19:25:26 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758162336762.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10499.26
  }
}

2025-09-17 19:25:36 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758162342451.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5536
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758162351945.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9445.68
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 159,
  "sample": {
    "symbol": "NEE",
    "score": 88.78,
    "entry": 83.1637,
    "stop": 79.7346,
    "targets": [
      87.9836,
      91.1968
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 111.318,
          "x2": "2025-09-15",
          "y2": 82.75,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 103.285,
          "x2": "2025-09-15",
          "y2": 80.54,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 81.645
        }
      ],
      "priceLevels": {
        "entry": 83.1637,
        "stop": 79.7346,
        "targets": [
          87.9836,
          91.1968
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.28",
        "slope gap 0.0030"
      ],
      "direction": "falling",
      "atr14": 4.3001
    },
    "avg_price": 81.5468859354655,
    "avg_volume": 71813879.73333333,
    "key_levels": {
      "entry": 83.1637,
      "stop": 79.7346,
      "targets": [
        87.9836,
        91.1968
      ]
    },
    "atr14": 4.3001,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=NEE+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30204.09
  }
}
2025-09-17 19:27:41 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 02:27:44.780260', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 19:27:44 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 19:27:50 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 19:27:50 Sleeping 5m before next iteration
2025-09-17 19:32:50 === Iteration 40 ===
2025-09-17 19:32:50 venv exists
2025-09-17 19:32:50 Installing Python requirements
2025-09-17 19:32:51 shots: node_modules present
2025-09-17 19:32:51 frontend: node_modules present
2025-09-17 19:32:51 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 11.14s
2025-09-17 19:33:04 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 19:33:04 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 19:33:04 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 19:32:57,293", "levelname": "INFO", "message": "request", "request_id": "8a5ab26a-5b02-4aef-a5b5-d57ddc61051f", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 76}
INFO:     127.0.0.1:55628 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 19:32:57,348", "levelname": "INFO", "message": "request", "request_id": "63a8a8e3-efe8-45c8-a36e-e79eb176b67e", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 50}
INFO:     127.0.0.1:55631 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 19:33:04,672", "levelname": "INFO", "message": "request", "request_id": "a42f84ee-a440-4bd4-a101-dd2e89175f8b", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:55654 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 19:33:12,874", "levelname": "INFO", "message": "request", "request_id": "79da3a8a-8915-49f6-992b-142d8f3769b9", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:55685 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 19:33:12,999", "levelname": "INFO", "message": "request", "request_id": "7fcd67ab-bd14-4e90-8156-d2d938e6963c", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 109}
INFO:     127.0.0.1:55686 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 7894,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758162792559.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 6801,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758162799850.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 19:33:20 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758162812143.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 11312.5
  }
}

2025-09-17 19:33:32 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758162818962.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6691
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758162828358.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9280.18
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 114,
  "sample": {
    "symbol": "NOW",
    "score": 88.78,
    "entry": 83.1637,
    "stop": 79.7346,
    "targets": [
      87.9836,
      91.1968
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 111.318,
          "x2": "2025-09-15",
          "y2": 82.75,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 103.285,
          "x2": "2025-09-15",
          "y2": 80.54,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 81.645
        }
      ],
      "priceLevels": {
        "entry": 83.1637,
        "stop": 79.7346,
        "targets": [
          87.9836,
          91.1968
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.28",
        "slope gap 0.0030"
      ],
      "direction": "falling",
      "atr14": 4.3001
    },
    "avg_price": 81.54688568115235,
    "avg_volume": 71813879.73333333,
    "key_levels": {
      "entry": 83.1637,
      "stop": 79.7346,
      "targets": [
        87.9836,
        91.1968
      ]
    },
    "atr14": 4.3001,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=NOW+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30380.66
  }
}
2025-09-17 19:35:33 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 02:35:37.019824', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 19:35:37 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 19:35:43 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 19:35:43 Sleeping 5m before next iteration
2025-09-17 19:40:43 === Iteration 41 ===
2025-09-17 19:40:43 venv exists
2025-09-17 19:40:43 Installing Python requirements
2025-09-17 19:40:43 shots: node_modules present
2025-09-17 19:40:43 frontend: node_modules present
2025-09-17 19:40:43 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 8.45s
2025-09-17 19:40:52 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 19:40:52 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 19:40:52 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 19:40:47,873", "levelname": "INFO", "message": "request", "request_id": "166af57b-981a-44d1-80f6-efdba07656c5", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 14}
INFO:     127.0.0.1:56428 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 19:40:47,880", "levelname": "INFO", "message": "request", "request_id": "f7364862-9a83-48e0-a361-b303bae769b4", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:56431 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 19:40:52,994", "levelname": "INFO", "message": "request", "request_id": "fede5198-02e8-4db9-b8eb-930f35ff23e5", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:56455 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 19:40:59,536", "levelname": "INFO", "message": "request", "request_id": "ef20f135-11af-4063-b437-7f88853301ff", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:56484 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 19:40:59,587", "levelname": "INFO", "message": "request", "request_id": "ae266d22-3407-4b68-93c8-0063115e508c", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 32}
INFO:     127.0.0.1:56485 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6401,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758163259330.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5445,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758163264942.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 19:41:05 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758163276841.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 11667.41
  }
}

2025-09-17 19:41:16 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758163282280.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5340
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758163291963.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9755.49
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 144,
  "sample": {
    "symbol": "SYF",
    "score": 84.29,
    "entry": 75.9177,
    "stop": 71.7552,
    "targets": [
      80.894,
      84.2116
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 104.7729,
          "x2": "2025-09-15",
          "y2": 75.54,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 96.479,
          "x2": "2025-09-15",
          "y2": 72.48,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 74.01
        }
      ],
      "priceLevels": {
        "entry": 75.9177,
        "stop": 71.7552,
        "targets": [
          80.894,
          84.2116
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.37",
        "slope gap 0.0201"
      ],
      "direction": "falling",
      "atr14": 4.335
    },
    "avg_price": 68.79065284729003,
    "avg_volume": 15929483.233333332,
    "key_levels": {
      "entry": 75.9177,
      "stop": 71.7552,
      "targets": [
        80.894,
        84.2116
      ]
    },
    "atr14": 4.335,
    "chart_url": "https://legend-shots.onrender.com/reports/SYF-1758163328571.png"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30286.99
  }
}
2025-09-17 19:43:16 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 02:43:19.788112', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 19:43:19 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 19:43:26 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 19:43:26 Sleeping 5m before next iteration
2025-09-17 19:48:26 === Iteration 42 ===
2025-09-17 19:48:26 venv exists
2025-09-17 19:48:26 Installing Python requirements
2025-09-17 19:48:27 shots: node_modules present
2025-09-17 19:48:27 frontend: node_modules present
2025-09-17 19:48:27 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 8.56s
2025-09-17 19:48:36 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 19:48:36 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 19:48:36 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 19:48:31,651", "levelname": "INFO", "message": "request", "request_id": "026445fe-9d8f-4bc2-b9aa-a0d8b6bc7c86", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 12}
INFO:     127.0.0.1:57246 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 19:48:31,661", "levelname": "INFO", "message": "request", "request_id": "f55f06bf-a933-489c-9c7d-326ee5cf0ce4", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:57249 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 19:48:36,955", "levelname": "INFO", "message": "request", "request_id": "1b237166-2ff1-442f-8046-0d4e125117d3", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:57271 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 19:48:43,921", "levelname": "INFO", "message": "request", "request_id": "88f7a391-3eb2-4b6e-9b8e-7e9ef21b82d4", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:57304 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 19:48:43,957", "levelname": "INFO", "message": "request", "request_id": "6d38630c-55ff-4a66-a11d-f46f91ee633f", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 22}
INFO:     127.0.0.1:57305 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6834,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758163723720.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5174,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758163729054.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 19:48:49 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758163739372.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10204.17
  }
}

2025-09-17 19:48:59 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758163745089.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5462
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758163754690.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9545.33
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 90,
  "sample": {
    "symbol": "ANET",
    "score": 88.1,
    "entry": 85.0733,
    "stop": 80.3286,
    "targets": [
      92.5013,
      97.4533
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 91.66,
          "x2": "2025-09-15",
          "y2": 84.65,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 79.28,
          "x2": "2025-09-15",
          "y2": 81.14,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 82.895
        }
      ],
      "priceLevels": {
        "entry": 85.0733,
        "stop": 80.3286,
        "targets": [
          92.5013,
          97.4533
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.28",
        "slope gap 0.0170"
      ],
      "direction": "falling",
      "atr14": 4.5893,
      "sector": "Technology"
    },
    "avg_price": 67.01066678365072,
    "avg_volume": 13724511.066666666,
    "key_levels": {
      "entry": 85.0733,
      "stop": 80.3286,
      "targets": [
        92.5013,
        97.4533
      ]
    },
    "atr14": 4.5893,
    "sector": "Technology",
    "chart_url": "https://legend-shots.onrender.com/reports/ANET-1758163791030.png"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30315.03
  }
}
2025-09-17 19:50:59 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 02:51:02.692964', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 19:51:02 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 19:51:08 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 19:51:08 Sleeping 5m before next iteration
2025-09-17 19:56:08 === Iteration 43 ===
2025-09-17 19:56:08 venv exists
2025-09-17 19:56:08 Installing Python requirements
2025-09-17 19:56:09 shots: node_modules present
2025-09-17 19:56:09 frontend: node_modules present
2025-09-17 19:56:09 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 8.25s
2025-09-17 19:56:18 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 19:56:18 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 19:56:18 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 19:56:13,414", "levelname": "INFO", "message": "request", "request_id": "66ed3712-0a9d-456c-8e64-201326bec1fc", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 11}
INFO:     127.0.0.1:58077 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 19:56:13,421", "levelname": "INFO", "message": "request", "request_id": "1b12d24a-5711-4732-88e3-76db463d18d4", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:58080 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 19:56:18,574", "levelname": "INFO", "message": "request", "request_id": "51a33141-b4fa-4893-998d-267802943d9d", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:58102 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 19:56:25,014", "levelname": "INFO", "message": "request", "request_id": "033fb981-ad3e-4a2f-ab7b-de2ad5a99faa", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:58135 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 19:56:25,062", "levelname": "INFO", "message": "request", "request_id": "1c239782-137f-4df1-b42c-029502b5a8d4", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 36}
INFO:     127.0.0.1:58136 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6305,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758164184808.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5341,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758164190343.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 19:56:30 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758164200855.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10285.77
  }
}

2025-09-17 19:56:40 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758164206295.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5273
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758164215654.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9411.51
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 141,
  "sample": {
    "symbol": "AVGO",
    "score": 88.1,
    "entry": 85.0733,
    "stop": 80.3286,
    "targets": [
      92.5013,
      97.4533
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 91.66,
          "x2": "2025-09-15",
          "y2": 84.65,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 79.28,
          "x2": "2025-09-15",
          "y2": 81.14,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 82.895
        }
      ],
      "priceLevels": {
        "entry": 85.0733,
        "stop": 80.3286,
        "targets": [
          92.5013,
          97.4533
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.28",
        "slope gap 0.0170"
      ],
      "direction": "falling",
      "atr14": 4.5893,
      "sector": "Technology"
    },
    "avg_price": 67.01066678365072,
    "avg_volume": 13724511.066666666,
    "key_levels": {
      "entry": 85.0733,
      "stop": 80.3286,
      "targets": [
        92.5013,
        97.4533
      ]
    },
    "atr14": 4.5893,
    "sector": "Technology",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AVGO+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30345.37
  }
}
2025-09-17 19:58:39 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 02:58:43.624342', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 19:58:43 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 19:58:50 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 19:58:50 Sleeping 5m before next iteration
2025-09-17 20:03:50 === Iteration 44 ===
2025-09-17 20:03:50 venv exists
2025-09-17 20:03:50 Installing Python requirements
2025-09-17 20:03:50 shots: node_modules present
2025-09-17 20:03:50 frontend: node_modules present
2025-09-17 20:03:50 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 8.91s
2025-09-17 20:04:00 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 20:04:00 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 20:04:01 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:03:55,918", "levelname": "INFO", "message": "request", "request_id": "83ad6749-9ac4-4aeb-829b-f656444f3229", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 27}
INFO:     127.0.0.1:58966 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 20:03:55,926", "levelname": "INFO", "message": "request", "request_id": "4af2e61a-1568-4329-ac3b-ee18cb4fa321", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:58969 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:04:01,021", "levelname": "INFO", "message": "request", "request_id": "1c8a39bd-279e-4875-9ece-1e86f494c4f2", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:58994 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:04:07,758", "levelname": "INFO", "message": "request", "request_id": "8fd1ef30-dcc2-4563-8278-703c8aa4ab43", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:59024 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:04:07,833", "levelname": "INFO", "message": "request", "request_id": "2ad2e791-c352-4d01-95e7-a12d0e685573", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 60}
INFO:     127.0.0.1:59025 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6527,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758164647549.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 6384,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758164654148.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 20:04:14 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758164665436.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 11009.57
  }
}

2025-09-17 20:04:25 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758164671466.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5929
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758164679050.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 7557.38
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 136,
  "sample": {
    "symbol": "ISRG",
    "score": 80.6,
    "entry": 192.6686,
    "stop": 182.9025,
    "targets": [
      202.3226,
      208.7586
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 232.68,
          "x2": "2025-09-15",
          "y2": 191.71,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 216.59,
          "x2": "2025-09-15",
          "y2": 184.75,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 188.23
        }
      ],
      "priceLevels": {
        "entry": 192.6686,
        "stop": 182.9025,
        "targets": [
          202.3226,
          208.7586
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.43",
        "slope gap 0.0045"
      ],
      "direction": "falling",
      "atr14": 12.9686
    },
    "avg_price": 168.3730005900065,
    "avg_volume": 9577806.633333333,
    "key_levels": {
      "entry": 192.6686,
      "stop": 182.9025,
      "targets": [
        202.3226,
        208.7586
      ]
    },
    "atr14": 12.9686,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=ISRG+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30306.44
  }
}
2025-09-17 20:06:23 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 03:06:27.748176', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 20:06:27 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 20:06:34 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 20:06:35 Sleeping 5m before next iteration
2025-09-17 20:11:35 === Iteration 45 ===
2025-09-17 20:11:35 venv exists
2025-09-17 20:11:35 Installing Python requirements
2025-09-17 20:11:35 shots: node_modules present
2025-09-17 20:11:35 frontend: node_modules present
2025-09-17 20:11:35 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 8.77s
2025-09-17 20:11:45 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 20:11:45 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 20:11:45 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:11:40,419", "levelname": "INFO", "message": "request", "request_id": "2d7abefc-90d4-484c-8665-1bda113323d3", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 51}
INFO:     127.0.0.1:59861 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 20:11:40,427", "levelname": "INFO", "message": "request", "request_id": "b6a53689-5627-4e9c-ba61-c68ff19f2e26", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:59864 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:11:45,605", "levelname": "INFO", "message": "request", "request_id": "15e8dc66-1fc0-4b0f-811d-2468f4f4bf5c", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:59887 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:11:52,814", "levelname": "INFO", "message": "request", "request_id": "d9f461a6-e1db-45eb-b350-bcbe3828739d", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:59927 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:11:52,881", "levelname": "INFO", "message": "request", "request_id": "5c97d2bf-5712-4f29-ad4c-1445be818880", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 54}
INFO:     127.0.0.1:59928 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 7001,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758165112597.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5202,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758165118012.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 20:11:58 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758165129651.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 11389.8
  }
}

2025-09-17 20:12:09 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758165135546.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5746
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758165145150.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9630.84
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 131,
  "sample": {
    "symbol": "SYF",
    "score": 84.29,
    "entry": 75.9177,
    "stop": 71.7552,
    "targets": [
      80.894,
      84.2116
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 104.7729,
          "x2": "2025-09-15",
          "y2": 75.54,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 96.479,
          "x2": "2025-09-15",
          "y2": 72.48,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 74.01
        }
      ],
      "priceLevels": {
        "entry": 75.9177,
        "stop": 71.7552,
        "targets": [
          80.894,
          84.2116
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.37",
        "slope gap 0.0201"
      ],
      "direction": "falling",
      "atr14": 4.335
    },
    "avg_price": 68.79065246582032,
    "avg_volume": 15929483.233333332,
    "key_levels": {
      "entry": 75.9177,
      "stop": 71.7552,
      "targets": [
        80.894,
        84.2116
      ]
    },
    "atr14": 4.335,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=SYF+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30247.5
  }
}
2025-09-17 20:14:09 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 03:14:15.628023', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 20:14:15 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 20:14:22 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 20:14:22 Sleeping 5m before next iteration
2025-09-17 20:19:22 === Iteration 46 ===
2025-09-17 20:19:22 venv exists
2025-09-17 20:19:22 Installing Python requirements
2025-09-17 20:19:22 shots: node_modules present
2025-09-17 20:19:22 frontend: node_modules present
2025-09-17 20:19:22 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 8.35s
2025-09-17 20:19:32 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 20:19:32 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 20:19:32 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:19:27,151", "levelname": "INFO", "message": "request", "request_id": "4d7eb349-f413-40b5-8290-3d6983e1d0a2", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 16}
INFO:     127.0.0.1:60715 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 20:19:27,155", "levelname": "INFO", "message": "request", "request_id": "b2f808fe-fc2f-4811-8a54-87308ea20435", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:60718 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:19:32,161", "levelname": "INFO", "message": "request", "request_id": "2aa64010-4446-4623-8861-e3905652ffcf", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:60742 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:19:39,033", "levelname": "INFO", "message": "request", "request_id": "648e060c-9bff-4eac-b8ff-6688f404852f", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 5}
INFO:     127.0.0.1:60773 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:19:39,092", "levelname": "INFO", "message": "request", "request_id": "1b98f988-9ad5-4b34-bb36-a2ac86a298e2", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 40}
INFO:     127.0.0.1:60774 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6721,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758165578816.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5273,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758165584287.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 20:19:44 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758165594849.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10318.73
  }
}

2025-09-17 20:19:54 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758165600585.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5565
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758165609965.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9386.14
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 136,
  "sample": {
    "symbol": "DE",
    "score": 89.73,
    "entry": 69.6163,
    "stop": 67.7259,
    "targets": [
      71.8387,
      73.3203
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 66.8,
          "x2": "2025-09-15",
          "y2": 69.27,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 63.096,
          "x2": "2025-09-15",
          "y2": 68.41,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 68.84
        }
      ],
      "priceLevels": {
        "entry": 69.6163,
        "stop": 67.7259,
        "targets": [
          71.8387,
          73.3203
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.23",
        "slope gap 0.0095"
      ],
      "direction": "falling",
      "atr14": 4.025
    },
    "avg_price": 58.824666595458986,
    "avg_volume": 10466750.766666668,
    "key_levels": {
      "entry": 69.6163,
      "stop": 67.7259,
      "targets": [
        71.8387,
        73.3203
      ]
    },
    "atr14": 4.025,
    "chart_url": "https://legend-shots.onrender.com/reports/DE-1758165673333.png"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758165716059.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 31909.46
  }
}
2025-09-17 20:21:56 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 03:22:01.716700', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 20:22:01 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 20:22:08 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 20:22:08 Sleeping 5m before next iteration
2025-09-17 20:27:08 === Iteration 47 ===
2025-09-17 20:27:08 venv exists
2025-09-17 20:27:08 Installing Python requirements
2025-09-17 20:27:09 shots: node_modules present
2025-09-17 20:27:09 frontend: node_modules present
2025-09-17 20:27:09 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 8.29s
2025-09-17 20:27:19 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 20:27:19 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 20:27:19 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:27:13,639", "levelname": "INFO", "message": "request", "request_id": "d31aaebf-e68e-47e1-8558-ebd7bc759752", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 13}
INFO:     127.0.0.1:61576 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 20:27:13,648", "levelname": "INFO", "message": "request", "request_id": "ba05dc64-293d-4cab-a6ec-1b05a6b326d3", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:61579 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:27:19,148", "levelname": "INFO", "message": "request", "request_id": "9aa86e72-ca91-461d-b6d9-fed34e52a0ed", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 5}
INFO:     127.0.0.1:61603 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:27:25,823", "levelname": "INFO", "message": "request", "request_id": "1424a007-e1e8-4889-ade6-39a7d9dd504e", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:61632 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:27:25,892", "levelname": "INFO", "message": "request", "request_id": "0ebadeb0-da65-4e5e-bbb0-1d147af8dc90", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 56}
INFO:     127.0.0.1:61633 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6485,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758166045612.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5085,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758166050889.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 20:27:31 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758166061331.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10214.92
  }
}

2025-09-17 20:27:41 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758166067301.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5770
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758166076563.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9198.75
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 174,
  "sample": {
    "symbol": "MRNA",
    "score": 88.91,
    "entry": 187.121,
    "stop": 178.0713,
    "targets": [
      201.4358,
      210.9791
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 284.755,
          "x2": "2025-09-15",
          "y2": 186.19,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 260.8969,
          "x2": "2025-09-15",
          "y2": 179.87,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 183.03
        }
      ],
      "priceLevels": {
        "entry": 187.121,
        "stop": 178.0713,
        "targets": [
          201.4358,
          210.9791
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.26",
        "slope gap 0.0683"
      ],
      "direction": "falling",
      "atr14": 9.5991
    },
    "avg_price": 208.48872884114584,
    "avg_volume": 2946465.566666667,
    "key_levels": {
      "entry": 187.121,
      "stop": 178.0713,
      "targets": [
        201.4358,
        210.9791
      ]
    },
    "atr14": 9.5991,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=MRNA+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30287.01
  }
}
2025-09-17 20:29:40 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 03:29:44.258790', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 20:29:44 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 20:29:51 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 20:29:51 Sleeping 5m before next iteration
2025-09-17 20:34:51 === Iteration 48 ===
2025-09-17 20:34:51 venv exists
2025-09-17 20:34:51 Installing Python requirements
2025-09-17 20:34:51 shots: node_modules present
2025-09-17 20:34:51 frontend: node_modules present
2025-09-17 20:34:51 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 8.42s
2025-09-17 20:35:01 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 20:35:01 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 20:35:01 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:34:56,170", "levelname": "INFO", "message": "request", "request_id": "65c543bd-720a-4aba-a5d9-889857853ee4", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 14}
INFO:     127.0.0.1:62462 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 20:34:56,179", "levelname": "INFO", "message": "request", "request_id": "17736519-c459-461d-af79-299a7d110aae", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:62465 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:35:01,578", "levelname": "INFO", "message": "request", "request_id": "17124d6c-6ea6-45c3-81ca-276fece6132a", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 4}
INFO:     127.0.0.1:62490 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:35:09,397", "levelname": "INFO", "message": "request", "request_id": "16fafb81-c0ee-42cb-8d6b-6b8d3037d68d", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:62523 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:35:09,478", "levelname": "INFO", "message": "request", "request_id": "aaac25da-0ab7-4d6e-961e-845ae0b34fb4", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 64}
INFO:     127.0.0.1:62524 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 7641,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758166509187.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 7630,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758166517068.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 20:35:17 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758166528143.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10941.92
  }
}

2025-09-17 20:35:28 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758166534253.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5734
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758166543944.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9595.28
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 130,
  "sample": {
    "symbol": "DIS",
    "score": 88.5,
    "entry": 106.7712,
    "stop": 102.3066,
    "targets": [
      112.9863,
      117.1297
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 136.2477,
          "x2": "2025-09-15",
          "y2": 106.24,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 125.8892,
          "x2": "2025-09-15",
          "y2": 103.34,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 104.79
        }
      ],
      "priceLevels": {
        "entry": 106.7712,
        "stop": 102.3066,
        "targets": [
          112.9863,
          117.1297
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.28",
        "slope gap 0.0487"
      ],
      "direction": "falling",
      "atr14": 5.3883,
      "sector": "Communication Services"
    },
    "avg_price": 100.27833760579428,
    "avg_volume": 18073049.5,
    "key_levels": {
      "entry": 106.7712,
      "stop": 102.3066,
      "targets": [
        112.9863,
        117.1297
      ]
    },
    "atr14": 5.3883,
    "sector": "Communication Services",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=DIS+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30342.25
  }
}
2025-09-17 20:37:28 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 03:37:32.705225', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 20:37:32 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 20:37:38 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 20:37:38 Sleeping 5m before next iteration
2025-09-17 20:42:38 === Iteration 49 ===
2025-09-17 20:42:38 venv exists
2025-09-17 20:42:38 Installing Python requirements
2025-09-17 20:42:39 shots: node_modules present
2025-09-17 20:42:39 frontend: node_modules present
2025-09-17 20:42:39 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 8.14s
2025-09-17 20:42:48 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 20:42:48 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 20:42:48 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:42:43,641", "levelname": "INFO", "message": "request", "request_id": "52ab8f59-1d90-4ab5-b6e7-196ac9c2b0b1", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 23}
INFO:     127.0.0.1:63331 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 20:42:43,651", "levelname": "INFO", "message": "request", "request_id": "1ebab3c6-05b5-4486-a9ec-091a6ad9d30f", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:63334 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:42:48,527", "levelname": "INFO", "message": "request", "request_id": "aa6a6f41-d189-46e2-b94f-aa658878943e", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:63357 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:42:55,927", "levelname": "INFO", "message": "request", "request_id": "f45492b7-92b3-4ab7-8671-636a960c6cb1", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:63395 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:42:56,000", "levelname": "INFO", "message": "request", "request_id": "65d7412e-64b9-42f1-a02a-83438732208e", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 61}
INFO:     127.0.0.1:63396 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 7159,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758166975682.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5155,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758166981098.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 20:43:01 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758166992076.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10609.86
  }
}

2025-09-17 20:43:12 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758166998067.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5790
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758167008058.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9927.54
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 130,
  "sample": {
    "symbol": "ORLY",
    "score": 85.78,
    "entry": 73.7469,
    "stop": 70.8939,
    "targets": [
      77.198,
      79.4988
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 104.2589,
          "x2": "2025-09-15",
          "y2": 73.38,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 98.507,
          "x2": "2025-09-15",
          "y2": 71.61,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 72.495
        }
      ],
      "priceLevels": {
        "entry": 73.7469,
        "stop": 70.8939,
        "targets": [
          77.198,
          79.4988
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.31",
        "slope gap 0.0002"
      ],
      "direction": "falling",
      "atr14": 4.8596,
      "sector": "Consumer Cyclical"
    },
    "avg_price": 67.44640210469564,
    "avg_volume": 80247007.46666667,
    "key_levels": {
      "entry": 73.7469,
      "stop": 70.8939,
      "targets": [
        77.198,
        79.4988
      ]
    },
    "atr14": 4.8596,
    "sector": "Consumer Cyclical",
    "chart_url": "https://legend-shots.onrender.com/reports/ORLY-1758167045534.png"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30336.19
  }
}
2025-09-17 20:44:47 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 03:44:51.494429', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 20:44:51 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 20:44:58 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 20:44:58 Sleeping 5m before next iteration
2025-09-17 20:49:58 === Iteration 50 ===
2025-09-17 20:49:58 venv exists
2025-09-17 20:49:58 Installing Python requirements
2025-09-17 20:49:58 shots: node_modules present
2025-09-17 20:49:58 frontend: node_modules present
2025-09-17 20:49:58 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 8.95s
2025-09-17 20:50:09 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 20:50:09 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 20:50:09 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:04,562", "levelname": "INFO", "message": "request", "request_id": "0820b2df-725f-405b-879b-276a8d23a12b", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 11}
INFO:     127.0.0.1:64227 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 20:50:04,569", "levelname": "INFO", "message": "request", "request_id": "724b506f-90b2-41b1-bab9-7cee7cf0ed38", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:64230 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:09,470", "levelname": "INFO", "message": "request", "request_id": "c0a75868-0e3e-4c96-b2f4-778a1547459a", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:64254 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:16,339", "levelname": "INFO", "message": "request", "request_id": "d2457979-5037-499b-b19b-943f27c5022e", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 7}
INFO:     127.0.0.1:64285 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:16,388", "levelname": "INFO", "message": "request", "request_id": "d762e21d-56a8-42f0-91e4-21c8f8b750ea", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 27}
INFO:     127.0.0.1:64286 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6681,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167416096.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 20:50:21 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758167432957.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 11072.38
  }
}

2025-09-17 20:50:33 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758167438773.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5762
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758167448756.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9843.59
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 92,
  "sample": {
    "symbol": "CCL",
    "score": 83.77,
    "entry": 28.2506,
    "stop": 26.8389,
    "targets": [
      29.9898,
      31.1494
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 55.3463,
          "x2": "2025-09-15",
          "y2": 28.11,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 52.4474,
          "x2": "2025-09-15",
          "y2": 27.11,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 27.61
        }
      ],
      "priceLevels": {
        "entry": 28.2506,
        "stop": 26.8389,
        "targets": [
          29.9898,
          31.1494
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.34",
        "slope gap 0.0026"
      ],
      "direction": "falling",
      "atr14": 1.9824
    },
    "avg_price": 30.925524266560874,
    "avg_volume": 18955150.0,
    "key_levels": {
      "entry": 28.2506,
      "stop": 26.8389,
      "targets": [
        29.9898,
        31.1494
      ]
    },
    "atr14": 1.9824,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=CCL+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30417.89
  }
}
2025-09-17 20:52:33 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 03:52:37.030899', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 20:52:37 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 20:52:43 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 20:52:44 Sleeping 5m before next iteration
2025-09-18 02:00:44 === Iteration 90 ===
2025-09-18 02:00:44 venv exists
2025-09-18 02:00:44 Installing Python requirements
2025-09-18 02:00:45 shots: node_modules present
2025-09-18 02:00:45 frontend: node_modules present
2025-09-18 02:00:45 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 9.79s
2025-09-18 02:00:55 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 02:00:55 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 02:00:56 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 02:01:09 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758186080367.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10643.63
  }
}

2025-09-18 02:01:20 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758186087066.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6188
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758186096200.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8920.82
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 94,
  "sample": {
    "symbol": "MGM",
    "score": 85.33,
    "entry": 58.2197,
    "stop": 54.9945,
    "targets": [
      62.9115,
      66.0394
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 107.672,
          "x2": "2025-09-15",
          "y2": 57.93,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 99.8522,
          "x2": "2025-09-15",
          "y2": 55.55,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 56.74
        }
      ],
      "priceLevels": {
        "entry": 58.2197,
        "stop": 54.9945,
        "targets": [
          62.9115,
          66.0394
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.30",
        "slope gap 0.0213"
      ],
      "direction": "falling",
      "atr14": 4.0684,
      "sector": "Consumer Cyclical"
    },
    "avg_price": 53.6756591796875,
    "avg_volume": 10765186.766666668,
    "key_levels": {
      "entry": 58.2197,
      "stop": 54.9945,
      "targets": [
        62.9115,
        66.0394
      ]
    },
    "atr14": 4.0684,
    "sector": "Consumer Cyclical",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=MGM+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30260.6
  }
}
2025-09-18 02:03:20 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 09:03:24.157061', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 02:03:24 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 02:03:30 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 02:03:30 Sleeping 5m before next iteration
2025-09-18 02:08:30 === Iteration 91 ===
2025-09-18 02:08:30 venv exists
2025-09-18 02:08:30 Installing Python requirements
2025-09-18 02:08:30 shots: node_modules present
2025-09-18 02:08:30 frontend: node_modules present
2025-09-18 02:08:30 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 10.14s
2025-09-18 02:08:41 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 02:08:42 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 02:08:42 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 02:08:56 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758186545715.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8850.32
  }
}

2025-09-18 02:09:05 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758186551875.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6011
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758186560770.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8847.92
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 111,
  "sample": {
    "symbol": "LNT",
    "score": 80.79,
    "entry": 62.0085,
    "stop": 58.4298,
    "targets": [
      65.8785,
      68.4585
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 77.63,
          "x2": "2025-09-15",
          "y2": 61.7,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 71.18,
          "x2": "2025-09-15",
          "y2": 59.02,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 60.36
        }
      ],
      "priceLevels": {
        "entry": 62.0085,
        "stop": 58.4298,
        "targets": [
          65.8785,
          68.4585
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.42",
        "slope gap 0.0041"
      ],
      "direction": "falling",
      "atr14": 4.4257
    },
    "avg_price": 65.70599975585938,
    "avg_volume": 15414877.5,
    "key_levels": {
      "entry": 62.0085,
      "stop": 58.4298,
      "targets": [
        65.8785,
        68.4585
      ]
    },
    "atr14": 4.4257,
    "chart_url": "https://legend-shots.onrender.com/reports/LNT-1758186597679.png"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758186654577.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 19462.42
  }
}
2025-09-18 02:10:54 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 09:10:58.473348', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 02:10:58 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 02:11:04 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 02:11:04 Sleeping 5m before next iteration
2025-09-18 02:16:04 === Iteration 92 ===
2025-09-18 02:16:04 venv exists
2025-09-18 02:16:04 Installing Python requirements
2025-09-18 02:16:05 shots: node_modules present
2025-09-18 02:16:05 frontend: node_modules present
2025-09-18 02:16:05 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 9.56s
2025-09-18 02:16:15 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 02:16:15 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 02:16:15 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 02:16:28 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758186997280.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8820.82
  }
}

2025-09-18 02:16:37 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758187002915.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5490
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758187011796.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8876.94
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 97,
  "sample": {
    "symbol": "DDOG",
    "score": 89.73,
    "entry": 69.6163,
    "stop": 67.7259,
    "targets": [
      71.8387,
      73.3203
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 66.8,
          "x2": "2025-09-15",
          "y2": 69.27,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 63.096,
          "x2": "2025-09-15",
          "y2": 68.41,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 68.84
        }
      ],
      "priceLevels": {
        "entry": 69.6163,
        "stop": 67.7259,
        "targets": [
          71.8387,
          73.3203
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.23",
        "slope gap 0.0095"
      ],
      "direction": "falling",
      "atr14": 4.025,
      "sector": "Technology"
    },
    "avg_price": 58.824666595458986,
    "avg_volume": 10466750.766666668,
    "key_levels": {
      "entry": 69.6163,
      "stop": 67.7259,
      "targets": [
        71.8387,
        73.3203
      ]
    },
    "atr14": 4.025,
    "sector": "Technology",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=DDOG+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30297.51
  }
}
2025-09-18 02:18:36 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 09:18:40.233716', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 02:18:40 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 02:18:47 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 02:18:47 Sleeping 5m before next iteration
2025-09-18 02:23:47 === Iteration 93 ===
2025-09-18 02:23:47 venv exists
2025-09-18 02:23:47 Installing Python requirements
2025-09-18 02:23:47 shots: node_modules present
2025-09-18 02:23:47 frontend: node_modules present
2025-09-18 02:23:47 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 9.19s
2025-09-18 02:23:57 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 02:23:57 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 02:23:57 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 02:24:10 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758187460677.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10315.28
  }
}

2025-09-18 02:24:20 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758187466309.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5503
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758187475110.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8774.04
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 144,
  "sample": {
    "symbol": "ARE",
    "score": 88.1,
    "entry": 85.0733,
    "stop": 80.3286,
    "targets": [
      92.5013,
      97.4533
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 91.66,
          "x2": "2025-09-15",
          "y2": 84.65,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 79.28,
          "x2": "2025-09-15",
          "y2": 81.14,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 82.895
        }
      ],
      "priceLevels": {
        "entry": 85.0733,
        "stop": 80.3286,
        "targets": [
          92.5013,
          97.4533
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.28",
        "slope gap 0.0170"
      ],
      "direction": "falling",
      "atr14": 4.5893,
      "sector": "Real Estate"
    },
    "avg_price": 67.01066678365072,
    "avg_volume": 13724511.066666666,
    "key_levels": {
      "entry": 85.0733,
      "stop": 80.3286,
      "targets": [
        92.5013,
        97.4533
      ]
    },
    "atr14": 4.5893,
    "sector": "Real Estate",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=ARE+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758189357604.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10408.4
  }
}
2025-09-18 02:55:57 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 09:56:02.881653', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 02:56:03 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 02:56:12 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 02:56:12 Sleeping 5m before next iteration
2025-09-18 03:15:05 === Iteration 94 ===
2025-09-18 03:15:05 venv exists
2025-09-18 03:15:06 Installing Python requirements
2025-09-18 03:15:07 shots: node_modules present
2025-09-18 03:15:07 frontend: node_modules present
2025-09-18 03:15:07 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 10.66s
2025-09-18 03:15:18 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 03:15:18 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 03:15:19 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 03:15:34 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758190543705.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8846.82
  }
}

2025-09-18 03:15:44 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758190550948.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6921
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758190559756.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8785.12
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 125,
  "sample": {
    "symbol": "WDAY",
    "score": 82.58,
    "entry": 10.0399,
    "stop": 9.3951,
    "targets": [
      10.7557,
      11.2328
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 11.1702,
          "x2": "2025-09-15",
          "y2": 9.99,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 9.9774,
          "x2": "2025-09-15",
          "y2": 9.49,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 9.74
        }
      ],
      "priceLevels": {
        "entry": 10.0399,
        "stop": 9.3951,
        "targets": [
          10.7557,
          11.2328
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.42",
        "slope gap 0.0011"
      ],
      "direction": "falling",
      "atr14": 0.5566,
      "sector": "Technology"
    },
    "avg_price": 8.938133509953817,
    "avg_volume": 63375603.5,
    "key_levels": {
      "entry": 10.0399,
      "stop": 9.3951,
      "targets": [
        10.7557,
        11.2328
      ]
    },
    "atr14": 0.5566,
    "sector": "Technology",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=WDAY+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30310.77
  }
}
2025-09-18 03:17:43 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 10:17:48.958098', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 03:17:49 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 03:17:57 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 03:17:57 Sleeping 5m before next iteration
2025-09-18 03:22:57 === Iteration 95 ===
2025-09-18 03:22:57 venv exists
2025-09-18 03:22:57 Installing Python requirements
2025-09-18 03:22:57 shots: node_modules present
2025-09-18 03:22:57 frontend: node_modules present
2025-09-18 03:22:57 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 9.99s
2025-09-18 03:23:08 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 03:23:08 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 03:23:08 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 03:23:22 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758191011985.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8783.19
  }
}

2025-09-18 03:23:32 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758191018430.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6230
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758191027388.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8936.29
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 118,
  "sample": {
    "symbol": "AVB",
    "score": 88.1,
    "entry": 85.0733,
    "stop": 80.3286,
    "targets": [
      92.5013,
      97.4533
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 91.66,
          "x2": "2025-09-15",
          "y2": 84.65,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 79.28,
          "x2": "2025-09-15",
          "y2": 81.14,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 82.895
        }
      ],
      "priceLevels": {
        "entry": 85.0733,
        "stop": 80.3286,
        "targets": [
          92.5013,
          97.4533
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.28",
        "slope gap 0.0170"
      ],
      "direction": "falling",
      "atr14": 4.5893,
      "sector": "Real Estate"
    },
    "avg_price": 67.01066678365072,
    "avg_volume": 13724511.066666666,
    "key_levels": {
      "entry": 85.0733,
      "stop": 80.3286,
      "targets": [
        92.5013,
        97.4533
      ]
    },
    "atr14": 4.5893,
    "sector": "Real Estate",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AVB+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30609.47
  }
}
2025-09-18 03:25:32 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 10:25:35.977805', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 03:25:36 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 03:25:42 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 03:25:42 Sleeping 5m before next iteration
2025-09-18 03:30:42 === Iteration 96 ===
2025-09-18 03:30:42 venv exists
2025-09-18 03:30:42 Installing Python requirements
2025-09-18 03:30:42 shots: node_modules present
2025-09-18 03:30:42 frontend: node_modules present
2025-09-18 03:30:42 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 10.37s
2025-09-18 03:30:54 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 03:30:54 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 03:30:54 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 03:31:07 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758191476385.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8955.05
  }
}

2025-09-18 03:31:16 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758191482691.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6062
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758191492001.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9246.3
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 188,
  "sample": {
    "symbol": "DE",
    "score": 89.73,
    "entry": 69.6163,
    "stop": 67.7259,
    "targets": [
      71.8387,
      73.3203
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 66.8,
          "x2": "2025-09-15",
          "y2": 69.27,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 63.096,
          "x2": "2025-09-15",
          "y2": 68.41,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 68.84
        }
      ],
      "priceLevels": {
        "entry": 69.6163,
        "stop": 67.7259,
        "targets": [
          71.8387,
          73.3203
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.23",
        "slope gap 0.0095"
      ],
      "direction": "falling",
      "atr14": 4.025
    },
    "avg_price": 58.824666595458986,
    "avg_volume": 10466750.766666668,
    "key_levels": {
      "entry": 69.6163,
      "stop": 67.7259,
      "targets": [
        71.8387,
        73.3203
      ]
    },
    "atr14": 4.025,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=DE+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30224.58
  }
}
2025-09-18 03:33:17 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 10:33:21.317373', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 03:33:21 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 03:33:29 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 03:33:29 Sleeping 5m before next iteration
2025-09-18 03:38:29 === Iteration 97 ===
2025-09-18 03:38:29 venv exists
2025-09-18 03:38:29 Installing Python requirements
2025-09-18 03:38:30 shots: node_modules present
2025-09-18 03:38:30 frontend: node_modules present
2025-09-18 03:38:30 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 11.65s
2025-09-18 03:38:43 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 03:38:43 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 03:38:43 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 03:38:59 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758191949615.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9712.19
  }
}

2025-09-18 03:39:09 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758191957424.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 7372
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758191966181.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8571.35
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 162,
  "sample": {
    "symbol": "ORCL",
    "score": 88.78,
    "entry": 83.1637,
    "stop": 79.7346,
    "targets": [
      87.9836,
      91.1968
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 111.318,
          "x2": "2025-09-15",
          "y2": 82.75,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 103.285,
          "x2": "2025-09-15",
          "y2": 80.54,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 81.645
        }
      ],
      "priceLevels": {
        "entry": 83.1637,
        "stop": 79.7346,
        "targets": [
          87.9836,
          91.1968
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.28",
        "slope gap 0.0030"
      ],
      "direction": "falling",
      "atr14": 4.3001,
      "sector": "Technology"
    },
    "avg_price": 81.5468859354655,
    "avg_volume": 71813879.73333333,
    "key_levels": {
      "entry": 83.1637,
      "stop": 79.7346,
      "targets": [
        87.9836,
        91.1968
      ]
    },
    "atr14": 4.3001,
    "sector": "Technology",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=ORCL+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30313.68
  }
}
2025-09-18 03:41:11 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 10:41:14.740936', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 03:41:14 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 03:41:21 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 03:41:21 Sleeping 5m before next iteration
2025-09-18 03:46:21 === Iteration 98 ===
2025-09-18 03:46:21 venv exists
2025-09-18 03:46:21 Installing Python requirements
2025-09-18 03:46:22 shots: node_modules present
2025-09-18 03:46:22 frontend: node_modules present
2025-09-18 03:46:22 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 9.18s
2025-09-18 03:46:32 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 03:46:32 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 03:46:32 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 03:46:44 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758192414996.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10319.74
  }
}

2025-09-18 03:46:55 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758192421492.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6276
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758192430380.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8816.3
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 190,
  "sample": {
    "symbol": "DIS",
    "score": 88.5,
    "entry": 106.7712,
    "stop": 102.3066,
    "targets": [
      112.9863,
      117.1297
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 136.2477,
          "x2": "2025-09-15",
          "y2": 106.24,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 125.8892,
          "x2": "2025-09-15",
          "y2": 103.34,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 104.79
        }
      ],
      "priceLevels": {
        "entry": 106.7712,
        "stop": 102.3066,
        "targets": [
          112.9863,
          117.1297
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.28",
        "slope gap 0.0487"
      ],
      "direction": "falling",
      "atr14": 5.3883,
      "sector": "Communication Services"
    },
    "avg_price": 100.27833760579428,
    "avg_volume": 18073049.5,
    "key_levels": {
      "entry": 106.7712,
      "stop": 102.3066,
      "targets": [
        112.9863,
        117.1297
      ]
    },
    "atr14": 5.3883,
    "sector": "Communication Services",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=DIS+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30315.64
  }
}
2025-09-18 03:48:54 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 10:48:57.915646', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 03:48:58 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 03:49:05 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 03:49:05 Sleeping 5m before next iteration
2025-09-18 03:54:05 === Iteration 99 ===
2025-09-18 03:54:05 venv exists
2025-09-18 03:54:05 Installing Python requirements
2025-09-18 03:54:05 shots: node_modules present
2025-09-18 03:54:05 frontend: node_modules present
2025-09-18 03:54:05 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 10.34s
2025-09-18 03:54:17 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 03:54:17 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 03:54:17 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 03:54:30 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758192880677.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10424.42
  }
}

2025-09-18 03:54:40 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758192887794.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6929
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758192896860.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8874.21
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 165,
  "sample": {
    "symbol": "ON",
    "score": 85.78,
    "entry": 73.7469,
    "stop": 70.8939,
    "targets": [
      77.198,
      79.4988
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 104.2589,
          "x2": "2025-09-15",
          "y2": 73.38,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 98.507,
          "x2": "2025-09-15",
          "y2": 71.61,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 72.495
        }
      ],
      "priceLevels": {
        "entry": 73.7469,
        "stop": 70.8939,
        "targets": [
          77.198,
          79.4988
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.31",
        "slope gap 0.0002"
      ],
      "direction": "falling",
      "atr14": 4.8596,
      "sector": "Technology"
    },
    "avg_price": 67.44640197753907,
    "avg_volume": 80247007.46666667,
    "key_levels": {
      "entry": 73.7469,
      "stop": 70.8939,
      "targets": [
        77.198,
        79.4988
      ]
    },
    "atr14": 4.8596,
    "sector": "Technology",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=ON+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30656.5
  }
}
2025-09-18 03:56:41 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 10:56:45.337727', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 03:56:45 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 03:56:52 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 03:56:52 Sleeping 5m before next iteration
2025-09-18 04:01:52 === Iteration 100 ===
2025-09-18 04:01:52 venv exists
2025-09-18 04:01:52 Installing Python requirements
2025-09-18 04:01:53 shots: node_modules present
2025-09-18 04:01:53 frontend: node_modules present
2025-09-18 04:01:53 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 10.58s
2025-09-18 04:02:05 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 04:02:05 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 04:02:05 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 04:02:17 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=NVDA+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30512.71
  }
}

2025-09-18 04:02:48 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758193375468.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 7086
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=NVDA+Chart",
  "meta": {
    "source": "dummy",
    "overlay_applied": false,
    "fallback": true,
    "error": "shots status 502",
    "dry_run": false,
    "duration_ms": 16748.5
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 133,
  "sample": {
    "symbol": "DVA",
    "score": 88.5,
    "entry": 106.7712,
    "stop": 102.3066,
    "targets": [
      112.9863,
      117.1297
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 136.2477,
          "x2": "2025-09-15",
          "y2": 106.24,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 125.8892,
          "x2": "2025-09-15",
          "y2": 103.34,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 104.79
        }
      ],
      "priceLevels": {
        "entry": 106.7712,
        "stop": 102.3066,
        "targets": [
          112.9863,
          117.1297
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.28",
        "slope gap 0.0487"
      ],
      "direction": "falling",
      "atr14": 5.3883,
      "sector": "Healthcare"
    },
    "avg_price": 100.27833760579428,
    "avg_volume": 18073049.5,
    "key_levels": {
      "entry": 106.7712,
      "stop": 102.3066,
      "targets": [
        112.9863,
        117.1297
      ]
    },
    "atr14": 5.3883,
    "sector": "Healthcare",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=DVA+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "dummy",
    "overlay_applied": true,
    "fallback": true,
    "error": "shots status 502",
    "dry_run": false,
    "duration_ms": 178.14,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    }
  }
}
2025-09-18 04:03:27 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 11:03:31.094411', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 04:03:31 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 04:03:38 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 04:03:38 Sleeping 5m before next iteration
2025-09-18 04:08:38 === Iteration 101 ===
2025-09-18 04:08:38 venv exists
2025-09-18 04:08:38 Installing Python requirements
2025-09-18 04:08:39 shots: node_modules present
2025-09-18 04:08:39 frontend: node_modules present
2025-09-18 04:08:39 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 10.33s
2025-09-18 04:08:50 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 04:08:50 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 04:08:51 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 04:09:04 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=NVDA+Chart",
  "meta": {
    "source": "dummy",
    "overlay_applied": false,
    "fallback": true,
    "error": "shots status 502",
    "dry_run": false,
    "duration_ms": 346.71
  }
}

2025-09-18 04:09:04 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758193750756.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6024
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=NVDA+Chart",
  "meta": {
    "source": "dummy",
    "overlay_applied": false,
    "fallback": true,
    "error": "shots status 502",
    "dry_run": false,
    "duration_ms": 323.61
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 141,
  "sample": {
    "symbol": "PTC",
    "score": 88.91,
    "entry": 187.121,
    "stop": 178.0713,
    "targets": [
      201.4358,
      210.9791
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 284.7549,
          "x2": "2025-09-15",
          "y2": 186.19,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 260.8968,
          "x2": "2025-09-15",
          "y2": 179.87,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 183.03
        }
      ],
      "priceLevels": {
        "entry": 187.121,
        "stop": 178.0713,
        "targets": [
          201.4358,
          210.9791
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.26",
        "slope gap 0.0683"
      ],
      "direction": "falling",
      "atr14": 9.5991,
      "sector": "Technology"
    },
    "avg_price": 208.48872934977214,
    "avg_volume": 2946465.566666667,
    "key_levels": {
      "entry": 187.121,
      "stop": 178.0713,
      "targets": [
        201.4358,
        210.9791
      ]
    },
    "atr14": 9.5991,
    "sector": "Technology",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=PTC+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30407.96
  }
}
2025-09-18 04:10:56 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 11:10:59.707959', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 04:10:59 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 04:11:06 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 04:11:06 Sleeping 5m before next iteration
2025-09-18 04:16:06 === Iteration 102 ===
2025-09-18 04:16:06 venv exists
2025-09-18 04:16:06 Installing Python requirements
2025-09-18 04:16:07 shots: node_modules present
2025-09-18 04:16:07 frontend: node_modules present
2025-09-18 04:16:07 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 9.93s
2025-09-18 04:16:18 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 04:16:18 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 04:16:18 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 04:16:31 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=NVDA+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30243.92
  }
}

2025-09-18 04:17:01 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758194229653.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 7762
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=NVDA+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30386.43
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 96,
  "sample": {
    "symbol": "ORLY",
    "score": 88.91,
    "entry": 187.121,
    "stop": 178.0713,
    "targets": [
      201.4358,
      210.9791
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 284.7549,
          "x2": "2025-09-15",
          "y2": 186.19,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 260.8968,
          "x2": "2025-09-15",
          "y2": 179.87,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 183.03
        }
      ],
      "priceLevels": {
        "entry": 187.121,
        "stop": 178.0713,
        "targets": [
          201.4358,
          210.9791
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.26",
        "slope gap 0.0683"
      ],
      "direction": "falling",
      "atr14": 9.5991,
      "sector": "Consumer Cyclical"
    },
    "avg_price": 208.48872934977214,
    "avg_volume": 2946465.566666667,
    "key_levels": {
      "entry": 187.121,
      "stop": 178.0713,
      "targets": [
        201.4358,
        210.9791
      ]
    },
    "atr14": 9.5991,
    "sector": "Consumer Cyclical",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=ORLY+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30309.34
  }
}
2025-09-18 04:18:59 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 11:19:02.477754', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 04:19:02 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 04:19:09 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 04:19:09 Sleeping 5m before next iteration
2025-09-18 04:24:09 === Iteration 103 ===
2025-09-18 04:24:09 venv exists
2025-09-18 04:24:09 Installing Python requirements
2025-09-18 04:24:10 shots: node_modules present
2025-09-18 04:24:10 frontend: node_modules present
2025-09-18 04:24:10 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 10.53s
2025-09-18 04:24:21 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 04:24:21 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 04:24:21 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 04:24:34 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758194684073.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9698.95
  }
}

2025-09-18 04:24:44 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758194690021.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5864
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758194699272.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9057.25
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 127,
  "sample": {
    "symbol": "MAS",
    "score": 85.33,
    "entry": 58.2197,
    "stop": 54.9945,
    "targets": [
      62.9115,
      66.0394
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 107.6719,
          "x2": "2025-09-15",
          "y2": 57.93,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 99.8522,
          "x2": "2025-09-15",
          "y2": 55.55,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 56.74
        }
      ],
      "priceLevels": {
        "entry": 58.2197,
        "stop": 54.9945,
        "targets": [
          62.9115,
          66.0394
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.30",
        "slope gap 0.0213"
      ],
      "direction": "falling",
      "atr14": 4.0684
    },
    "avg_price": 53.6756591796875,
    "avg_volume": 10765186.766666668,
    "key_levels": {
      "entry": 58.2197,
      "stop": 54.9945,
      "targets": [
        62.9115,
        66.0394
      ]
    },
    "atr14": 4.0684,
    "chart_url": "https://legend-shots.onrender.com/reports/MAS-1758194760552.png"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758194784187.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 21770.85
  }
}
2025-09-18 04:26:24 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 11:26:28.050314', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 04:26:28 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 04:26:34 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 04:26:34 Sleeping 5m before next iteration
2025-09-18 04:31:34 === Iteration 104 ===
2025-09-18 04:31:34 venv exists
2025-09-18 04:31:34 Installing Python requirements
2025-09-18 04:31:35 shots: node_modules present
2025-09-18 04:31:35 frontend: node_modules present
2025-09-18 04:31:35 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 9.73s
2025-09-18 04:31:45 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 04:31:45 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 04:31:45 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 04:31:57 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758195127655.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9642.6
  }
}

2025-09-18 04:32:07 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758195133658.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5850
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758195142971.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9211.21
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 176,
  "sample": {
    "symbol": "DVA",
    "score": 83.38,
    "entry": 99.2035,
    "stop": 93.951,
    "targets": [
      105.1075,
      109.0435
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 145.09,
          "x2": "2025-09-15",
          "y2": 98.71,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 135.25,
          "x2": "2025-09-15",
          "y2": 94.9,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 96.805
        }
      ],
      "priceLevels": {
        "entry": 99.2035,
        "stop": 93.951,
        "targets": [
          105.1075,
          109.0435
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.39",
        "slope gap 0.0125"
      ],
      "direction": "falling",
      "atr14": 5.8479,
      "sector": "Healthcare"
    },
    "avg_price": 92.20166702270508,
    "avg_volume": 21920093.3,
    "key_levels": {
      "entry": 99.2035,
      "stop": 93.951,
      "targets": [
        105.1075,
        109.0435
      ]
    },
    "atr14": 5.8479,
    "sector": "Healthcare",
    "chart_url": "https://legend-shots.onrender.com/reports/DVA-1758195189685.png"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758195216453.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 25928.02
  }
}
2025-09-18 04:33:36 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 11:33:40.134845', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 04:33:40 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 04:33:46 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 04:33:46 Sleeping 5m before next iteration
2025-09-18 04:38:46 === Iteration 105 ===
2025-09-18 04:38:46 venv exists
2025-09-18 04:38:46 Installing Python requirements
2025-09-18 04:38:46 shots: node_modules present
2025-09-18 04:38:46 frontend: node_modules present
2025-09-18 04:38:46 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 9.02s
2025-09-18 04:38:56 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 04:38:56 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 04:38:57 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 04:39:08 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758195558272.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9884.83
  }
}

2025-09-18 04:39:18 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758195563450.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5063
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758195572273.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8764.38
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 162,
  "sample": {
    "symbol": "BMY",
    "score": 83.77,
    "entry": 28.2506,
    "stop": 26.8389,
    "targets": [
      29.9898,
      31.1494
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 55.3463,
          "x2": "2025-09-15",
          "y2": 28.11,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 52.4474,
          "x2": "2025-09-15",
          "y2": 27.11,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 27.61
        }
      ],
      "priceLevels": {
        "entry": 28.2506,
        "stop": 26.8389,
        "targets": [
          29.9898,
          31.1494
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.34",
        "slope gap 0.0026"
      ],
      "direction": "falling",
      "atr14": 1.9824
    },
    "avg_price": 30.92552458445231,
    "avg_volume": 18955150.0,
    "key_levels": {
      "entry": 28.2506,
      "stop": 26.8389,
      "targets": [
        29.9898,
        31.1494
      ]
    },
    "atr14": 1.9824,
    "chart_url": "https://legend-shots.onrender.com/reports/BMY-1758195615768.png"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758195635184.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 18522.91
  }
}
2025-09-18 04:40:35 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 11:40:38.898515', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 04:40:38 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 04:40:45 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 04:40:45 Sleeping 5m before next iteration
2025-09-18 04:45:45 === Iteration 106 ===
2025-09-18 04:45:45 venv exists
2025-09-18 04:45:45 Installing Python requirements
2025-09-18 04:45:46 shots: node_modules present
2025-09-18 04:45:46 frontend: node_modules present
2025-09-18 04:45:46 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 9.17s
2025-09-18 04:45:56 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 04:45:56 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 04:45:56 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 04:46:08 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758195977787.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9371.02
  }
}

2025-09-18 04:46:17 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758195983375.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5503
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758195992272.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9056.96
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 127,
  "sample": {
    "symbol": "NOW",
    "score": 85.78,
    "entry": 73.7469,
    "stop": 70.8939,
    "targets": [
      77.198,
      79.4988
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 104.2589,
          "x2": "2025-09-15",
          "y2": 73.38,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 98.5071,
          "x2": "2025-09-15",
          "y2": 71.61,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 72.495
        }
      ],
      "priceLevels": {
        "entry": 73.7469,
        "stop": 70.8939,
        "targets": [
          77.198,
          79.4988
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.31",
        "slope gap 0.0002"
      ],
      "direction": "falling",
      "atr14": 4.8596
    },
    "avg_price": 67.44640197753907,
    "avg_volume": 80247007.46666667,
    "key_levels": {
      "entry": 73.7469,
      "stop": 70.8939,
      "targets": [
        77.198,
        79.4988
      ]
    },
    "atr14": 4.8596,
    "chart_url": "https://legend-shots.onrender.com/reports/NOW-1758196040940.png"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758196069084.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 26210.65
  }
}
2025-09-18 04:47:49 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 11:47:52.768736', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 04:47:52 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 04:47:59 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 04:47:59 Sleeping 5m before next iteration
2025-09-18 04:52:59 === Iteration 107 ===
2025-09-18 04:52:59 venv exists
2025-09-18 04:52:59 Installing Python requirements
2025-09-18 04:52:59 shots: node_modules present
2025-09-18 04:52:59 frontend: node_modules present
2025-09-18 04:52:59 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 8.85s
2025-09-18 04:53:09 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 04:53:09 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 04:53:09 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 04:53:21 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758196410855.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9365.29
  }
}

2025-09-18 04:53:30 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758196416722.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5727
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758196425369.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8540.74
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 151,
  "sample": {
    "symbol": "DELL",
    "score": 89.73,
    "entry": 69.6163,
    "stop": 67.7259,
    "targets": [
      71.8387,
      73.3203
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 66.8,
          "x2": "2025-09-15",
          "y2": 69.27,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 63.096,
          "x2": "2025-09-15",
          "y2": 68.41,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 68.84
        }
      ],
      "priceLevels": {
        "entry": 69.6163,
        "stop": 67.7259,
        "targets": [
          71.8387,
          73.3203
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.23",
        "slope gap 0.0095"
      ],
      "direction": "falling",
      "atr14": 4.025
    },
    "avg_price": 58.824666595458986,
    "avg_volume": 10466750.766666668,
    "key_levels": {
      "entry": 69.6163,
      "stop": 67.7259,
      "targets": [
        71.8387,
        73.3203
      ]
    },
    "atr14": 4.025,
    "chart_url": "https://legend-shots.onrender.com/reports/DELL-1758196474652.png"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758196499268.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 12896.36
  }
}
2025-09-18 04:54:59 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 11:55:02.809277', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 04:55:02 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 04:55:09 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 04:55:09 Sleeping 5m before next iteration
2025-09-18 05:00:09 === Iteration 108 ===
2025-09-18 05:00:09 venv exists
2025-09-18 05:00:09 Installing Python requirements
2025-09-18 05:00:09 shots: node_modules present
2025-09-18 05:00:09 frontend: node_modules present
2025-09-18 05:00:09 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 9.02s
2025-09-18 05:00:19 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 05:00:19 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 05:00:19 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 05:00:31 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758196840470.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8934.76
  }
}

2025-09-18 05:00:40 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758196846057.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5496
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758196854952.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8873.47
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 96,
  "sample": {
    "symbol": "DE",
    "score": 89.73,
    "entry": 69.6163,
    "stop": 67.7259,
    "targets": [
      71.8387,
      73.3203
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 66.8,
          "x2": "2025-09-15",
          "y2": 69.27,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 63.096,
          "x2": "2025-09-15",
          "y2": 68.41,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 68.84
        }
      ],
      "priceLevels": {
        "entry": 69.6163,
        "stop": 67.7259,
        "targets": [
          71.8387,
          73.3203
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.23",
        "slope gap 0.0095"
      ],
      "direction": "falling",
      "atr14": 4.025
    },
    "avg_price": 58.824666595458986,
    "avg_volume": 10466750.766666668,
    "key_levels": {
      "entry": 69.6163,
      "stop": 67.7259,
      "targets": [
        71.8387,
        73.3203
      ]
    },
    "atr14": 4.025,
    "chart_url": "https://legend-shots.onrender.com/reports/DE-1758196911588.png"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758196921766.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9644.52
  }
}
2025-09-18 05:02:01 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 12:02:05.761469', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 05:02:05 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 05:02:12 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 05:02:12 Sleeping 5m before next iteration
2025-09-18 05:07:12 === Iteration 109 ===
2025-09-18 05:07:12 venv exists
2025-09-18 05:07:12 Installing Python requirements
2025-09-18 05:07:12 shots: node_modules present
2025-09-18 05:07:12 frontend: node_modules present
2025-09-18 05:07:12 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 9.14s
2025-09-18 05:07:22 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 05:07:23 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 05:07:23 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 05:07:35 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758197263854.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8743.66
  }
}

2025-09-18 05:07:44 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758197269637.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5572
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758197278468.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8645.83
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 210,
  "sample": {
    "symbol": "DHI",
    "score": 89.73,
    "entry": 69.6163,
    "stop": 67.7259,
    "targets": [
      71.8387,
      73.3203
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 66.8,
          "x2": "2025-09-15",
          "y2": 69.27,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 63.096,
          "x2": "2025-09-15",
          "y2": 68.41,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 68.84
        }
      ],
      "priceLevels": {
        "entry": 69.6163,
        "stop": 67.7259,
        "targets": [
          71.8387,
          73.3203
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.23",
        "slope gap 0.0095"
      ],
      "direction": "falling",
      "atr14": 4.025,
      "sector": "Consumer Cyclical"
    },
    "avg_price": 58.824666595458986,
    "avg_volume": 10466750.766666668,
    "key_levels": {
      "entry": 69.6163,
      "stop": 67.7259,
      "targets": [
        71.8387,
        73.3203
      ]
    },
    "atr14": 4.025,
    "sector": "Consumer Cyclical",
    "chart_url": "https://legend-shots.onrender.com/reports/DHI-1758197330248.png"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758197366465.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 31826.64
  }
}
2025-09-18 05:09:26 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 12:09:30.231200', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 05:09:30 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 05:09:36 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 05:09:36 Sleeping 5m before next iteration
2025-09-18 05:14:36 === Iteration 110 ===
2025-09-18 05:14:36 venv exists
2025-09-18 05:14:36 Installing Python requirements
2025-09-18 05:14:37 shots: node_modules present
2025-09-18 05:14:37 frontend: node_modules present
2025-09-18 05:14:37 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 9.34s
2025-09-18 05:14:47 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 05:14:47 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 05:14:47 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 05:14:59 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758197709370.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9442.5
  }
}

2025-09-18 05:15:09 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758197715673.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6090
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758197724551.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8862.23
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 119,
  "sample": {
    "symbol": "HON",
    "score": 78.56,
    "entry": 278.2946,
    "stop": 267.5871,
    "targets": [
      285.6572,
      290.5656
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 251.2054,
          "x2": "2025-09-15",
          "y2": 276.91,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 238.9344,
          "x2": "2025-09-15",
          "y2": 270.29,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 273.6
        }
      ],
      "priceLevels": {
        "entry": 278.2946,
        "stop": 267.5871,
        "targets": [
          285.6572,
          290.5656
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.54",
        "slope gap 0.0526"
      ],
      "direction": "falling",
      "atr14": 12.9797
    },
    "avg_price": 234.40657450358074,
    "avg_volume": 2861699.6,
    "key_levels": {
      "entry": 278.2946,
      "stop": 267.5871,
      "targets": [
        285.6572,
        290.5656
      ]
    },
    "atr14": 12.9797,
    "chart_url": "https://legend-shots.onrender.com/reports/HON-1758197771655.png"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758197797966.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9530.45
  }
}
2025-09-18 05:16:38 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 12:16:42.555622', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 05:16:42 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 05:16:49 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 05:16:49 Sleeping 5m before next iteration
2025-09-18 05:21:49 === Iteration 111 ===
2025-09-18 05:21:49 venv exists
2025-09-18 05:21:49 Installing Python requirements
2025-09-18 05:21:50 shots: node_modules present
2025-09-18 05:21:50 frontend: node_modules present
2025-09-18 05:21:50 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 9.27s
2025-09-18 05:22:00 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 05:22:00 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 05:22:00 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 05:22:13 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758198142569.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8968.02
  }
}

2025-09-18 05:22:22 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758198149168.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6360
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758198158252.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9152.97
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 151,
  "sample": {
    "symbol": "MMM",
    "score": 88.91,
    "entry": 187.121,
    "stop": 178.0713,
    "targets": [
      201.4358,
      210.9791
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 284.755,
          "x2": "2025-09-15",
          "y2": 186.19,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 260.8969,
          "x2": "2025-09-15",
          "y2": 179.87,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 183.03
        }
      ],
      "priceLevels": {
        "entry": 187.121,
        "stop": 178.0713,
        "targets": [
          201.4358,
          210.9791
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.26",
        "slope gap 0.0683"
      ],
      "direction": "falling",
      "atr14": 9.5991
    },
    "avg_price": 208.48872884114584,
    "avg_volume": 2946465.566666667,
    "key_levels": {
      "entry": 187.121,
      "stop": 178.0713,
      "targets": [
        201.4358,
        210.9791
      ]
    },
    "atr14": 9.5991,
    "chart_url": "https://legend-shots.onrender.com/reports/MMM-1758198208339.png"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758198235764.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 23022.17
  }
}
2025-09-18 05:23:55 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 12:23:59.468627', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 05:23:59 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 05:24:05 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 05:24:05 Sleeping 5m before next iteration
2025-09-18 05:29:05 === Iteration 112 ===
2025-09-18 05:29:05 venv exists
2025-09-18 05:29:05 Installing Python requirements
2025-09-18 05:29:06 shots: node_modules present
2025-09-18 05:29:06 frontend: node_modules present
2025-09-18 05:29:06 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 9.34s
2025-09-18 05:29:16 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 05:29:16 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 05:29:16 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 05:29:28 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758198578184.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9402.15
  }
}

2025-09-18 05:29:38 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758198583977.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5590
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758198592965.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8998.75
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 162,
  "sample": {
    "symbol": "NDSN",
    "score": 88.78,
    "entry": 83.1637,
    "stop": 79.7346,
    "targets": [
      87.9836,
      91.1968
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 111.318,
          "x2": "2025-09-15",
          "y2": 82.75,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 103.285,
          "x2": "2025-09-15",
          "y2": 80.54,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 81.645
        }
      ],
      "priceLevels": {
        "entry": 83.1637,
        "stop": 79.7346,
        "targets": [
          87.9836,
          91.1968
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.28",
        "slope gap 0.0030"
      ],
      "direction": "falling",
      "atr14": 4.3001
    },
    "avg_price": 81.5468859354655,
    "avg_volume": 71813879.73333333,
    "key_levels": {
      "entry": 83.1637,
      "stop": 79.7346,
      "targets": [
        87.9836,
        91.1968
      ]
    },
    "atr14": 4.3001,
    "chart_url": "https://legend-shots.onrender.com/reports/NDSN-1758198657396.png"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758198667164.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9570.28
  }
}
2025-09-18 05:31:07 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 12:31:10.832144', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 05:31:10 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 05:31:17 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 05:31:17 Sleeping 5m before next iteration
2025-09-18 05:36:17 === Iteration 113 ===
2025-09-18 05:36:17 venv exists
2025-09-18 05:36:17 Installing Python requirements
2025-09-18 05:36:17 shots: node_modules present
2025-09-18 05:36:17 frontend: node_modules present
2025-09-18 05:36:17 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 9.55s
2025-09-18 05:36:28 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 05:36:28 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 05:36:28 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 05:36:40 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758199010049.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9052.33
  }
}

2025-09-18 05:36:50 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758199015767.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5453
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758199024965.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9166.02
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 117,
  "sample": {
    "symbol": "DVN",
    "score": 88.5,
    "entry": 106.7712,
    "stop": 102.3066,
    "targets": [
      112.9863,
      117.1297
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 136.2477,
          "x2": "2025-09-15",
          "y2": 106.24,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 125.8892,
          "x2": "2025-09-15",
          "y2": 103.34,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 104.79
        }
      ],
      "priceLevels": {
        "entry": 106.7712,
        "stop": 102.3066,
        "targets": [
          112.9863,
          117.1297
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.28",
        "slope gap 0.0487"
      ],
      "direction": "falling",
      "atr14": 5.3883,
      "sector": "Energy"
    },
    "avg_price": 100.27833760579428,
    "avg_volume": 18073049.5,
    "key_levels": {
      "entry": 106.7712,
      "stop": 102.3066,
      "targets": [
        112.9863,
        117.1297
      ]
    },
    "atr14": 5.3883,
    "sector": "Energy",
    "chart_url": "https://legend-shots.onrender.com/reports/DVN-1758199073997.png"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758199091964.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 16742.33
  }
}
2025-09-18 05:38:12 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 12:38:15.656423', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 05:38:15 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 05:38:22 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 05:38:22 Sleeping 5m before next iteration
2025-09-18 05:43:22 === Iteration 114 ===
2025-09-18 05:43:22 venv exists
2025-09-18 05:43:22 Installing Python requirements
2025-09-18 05:43:22 shots: node_modules present
2025-09-18 05:43:22 frontend: node_modules present
2025-09-18 05:43:22 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 8.94s
2025-09-18 05:43:32 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 05:43:32 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 05:43:32 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 05:43:44 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758199434166.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9415.65
  }
}

2025-09-18 05:43:54 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758199440181.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5807
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758199449232.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9083.26
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 121,
  "sample": {
    "symbol": "ON",
    "score": 78.4,
    "entry": 227.7832,
    "stop": 213.4935,
    "targets": [
      241.2435,
      250.2171
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 220.3246,
          "x2": "2025-09-15",
          "y2": 226.65,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 197.8908,
          "x2": "2025-09-15",
          "y2": 215.65,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 221.15
        }
      ],
      "priceLevels": {
        "entry": 227.7832,
        "stop": 213.4935,
        "targets": [
          241.2435,
          250.2171
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.49",
        "slope gap 0.0174"
      ],
      "direction": "falling",
      "atr14": 14.9904,
      "sector": "Technology"
    },
    "avg_price": 206.47969512939454,
    "avg_volume": 14133272.3,
    "key_levels": {
      "entry": 227.7832,
      "stop": 213.4935,
      "targets": [
        241.2435,
        250.2171
      ]
    },
    "atr14": 14.9904,
    "sector": "Technology",
    "chart_url": "https://legend-shots.onrender.com/reports/ON-1758199495138.png"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758199511964.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 16082.24
  }
}
2025-09-18 05:45:12 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 12:45:15.613379', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 05:45:15 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 05:45:21 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 05:45:21 Sleeping 5m before next iteration
2025-09-18 05:50:21 === Iteration 115 ===
2025-09-18 05:50:21 venv exists
2025-09-18 05:50:22 Installing Python requirements
2025-09-18 05:50:22 shots: node_modules present
2025-09-18 05:50:22 frontend: node_modules present
2025-09-18 05:50:22 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 9.26s
2025-09-18 05:50:32 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 05:50:32 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 05:50:32 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 05:50:45 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758199856667.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 11334.91
  }
}

2025-09-18 05:50:56 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758199862568.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5702
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758199871482.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8854.42
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 104,
  "sample": {
    "symbol": "NCLH",
    "score": 88.78,
    "entry": 83.1637,
    "stop": 79.7346,
    "targets": [
      87.9836,
      91.1968
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 111.318,
          "x2": "2025-09-15",
          "y2": 82.75,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 103.285,
          "x2": "2025-09-15",
          "y2": 80.54,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 81.645
        }
      ],
      "priceLevels": {
        "entry": 83.1637,
        "stop": 79.7346,
        "targets": [
          87.9836,
          91.1968
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.28",
        "slope gap 0.0030"
      ],
      "direction": "falling",
      "atr14": 4.3001
    },
    "avg_price": 81.54688568115235,
    "avg_volume": 71813879.73333333,
    "key_levels": {
      "entry": 83.1637,
      "stop": 79.7346,
      "targets": [
        87.9836,
        91.1968
      ]
    },
    "atr14": 4.3001,
    "chart_url": "https://legend-shots.onrender.com/reports/NCLH-1758199918438.png"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758199938347.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 19229.42
  }
}
2025-09-18 05:52:18 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 12:52:22.093915', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 05:52:22 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 05:52:28 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 05:52:28 Sleeping 5m before next iteration
2025-09-18 05:57:28 === Iteration 116 ===
2025-09-18 05:57:28 venv exists
2025-09-18 05:57:28 Installing Python requirements
2025-09-18 05:57:29 shots: node_modules present
2025-09-18 05:57:29 frontend: node_modules present
2025-09-18 05:57:29 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 9.58s
2025-09-18 05:57:39 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 05:57:39 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 05:57:39 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 05:57:55 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758200284650.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9499.97
  }
}

2025-09-18 05:58:04 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758200290552.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5773
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758200299565.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8968.62
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 160,
  "sample": {
    "symbol": "DLR",
    "score": 88.5,
    "entry": 106.7712,
    "stop": 102.3066,
    "targets": [
      112.9863,
      117.1297
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 136.2477,
          "x2": "2025-09-15",
          "y2": 106.24,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 125.8892,
          "x2": "2025-09-15",
          "y2": 103.34,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 104.79
        }
      ],
      "priceLevels": {
        "entry": 106.7712,
        "stop": 102.3066,
        "targets": [
          112.9863,
          117.1297
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.28",
        "slope gap 0.0487"
      ],
      "direction": "falling",
      "atr14": 5.3883,
      "sector": "Real Estate"
    },
    "avg_price": 100.27833760579428,
    "avg_volume": 18073049.5,
    "key_levels": {
      "entry": 106.7712,
      "stop": 102.3066,
      "targets": [
        112.9863,
        117.1297
      ]
    },
    "atr14": 5.3883,
    "sector": "Real Estate",
    "chart_url": "https://legend-shots.onrender.com/reports/DLR-1758200345699.png"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758200366262.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 18992.53
  }
}
2025-09-18 05:59:26 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 12:59:30.066954', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 05:59:30 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 05:59:36 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 05:59:36 Sleeping 5m before next iteration
2025-09-18 06:04:36 === Iteration 117 ===
2025-09-18 06:04:36 venv exists
2025-09-18 06:04:36 Installing Python requirements
2025-09-18 06:04:36 shots: node_modules present
2025-09-18 06:04:36 frontend: node_modules present
2025-09-18 06:04:36 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 9.36s
2025-09-18 06:04:46 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 06:04:46 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 06:04:46 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 06:04:58 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758200707782.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9287.58
  }
}

2025-09-18 06:05:07 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758200712835.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 4853
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758200721848.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8991.53
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 121,
  "sample": {
    "symbol": "APA",
    "score": 88.1,
    "entry": 85.0733,
    "stop": 80.3286,
    "targets": [
      92.5013,
      97.4533
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 91.66,
          "x2": "2025-09-15",
          "y2": 84.65,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 79.28,
          "x2": "2025-09-15",
          "y2": 81.14,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 82.895
        }
      ],
      "priceLevels": {
        "entry": 85.0733,
        "stop": 80.3286,
        "targets": [
          92.5013,
          97.4533
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.28",
        "slope gap 0.0170"
      ],
      "direction": "falling",
      "atr14": 4.5893
    },
    "avg_price": 67.01066678365072,
    "avg_volume": 13724511.066666666,
    "key_levels": {
      "entry": 85.0733,
      "stop": 80.3286,
      "targets": [
        92.5013,
        97.4533
      ]
    },
    "atr14": 4.5893,
    "chart_url": "https://legend-shots.onrender.com/reports/APA-1758200770948.png"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758200797079.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 22060.9
  }
}
2025-09-18 06:06:37 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 13:06:40.824795', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 06:06:40 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 06:06:46 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 06:06:46 Sleeping 5m before next iteration
2025-09-18 06:11:46 === Iteration 118 ===
2025-09-18 06:11:46 venv exists
2025-09-18 06:11:46 Installing Python requirements
2025-09-18 06:11:47 shots: node_modules present
2025-09-18 06:11:47 frontend: node_modules present
2025-09-18 06:11:47 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 8.71s
2025-09-18 06:11:57 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 06:11:57 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 06:11:57 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 06:12:09 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758201138865.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9506.52
  }
}

2025-09-18 06:12:19 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758201144722.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5686
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758201153568.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8808.16
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 88,
  "sample": {
    "symbol": "HRL",
    "score": 78.56,
    "entry": 278.2946,
    "stop": 267.5871,
    "targets": [
      285.6572,
      290.5656
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 251.2054,
          "x2": "2025-09-15",
          "y2": 276.91,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 238.9343,
          "x2": "2025-09-15",
          "y2": 270.29,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 273.6
        }
      ],
      "priceLevels": {
        "entry": 278.2946,
        "stop": 267.5871,
        "targets": [
          285.6572,
          290.5656
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.54",
        "slope gap 0.0526"
      ],
      "direction": "falling",
      "atr14": 12.9797,
      "sector": "Consumer Defensive"
    },
    "avg_price": 234.40657450358074,
    "avg_volume": 2861699.6,
    "key_levels": {
      "entry": 278.2946,
      "stop": 267.5871,
      "targets": [
        285.6572,
        290.5656
      ]
    },
    "atr14": 12.9797,
    "sector": "Consumer Defensive",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=HRL+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758201233761.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9730.68
  }
}
2025-09-18 06:13:53 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 13:13:58.086408', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 06:13:58 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 06:14:04 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 06:14:04 Sleeping 5m before next iteration
2025-09-18 06:19:04 === Iteration 119 ===
2025-09-18 06:19:04 venv exists
2025-09-18 06:19:04 Installing Python requirements
2025-09-18 06:19:04 shots: node_modules present
2025-09-18 06:19:04 frontend: node_modules present
2025-09-18 06:19:04 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 9.54s
2025-09-18 06:19:15 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 06:19:15 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 06:19:15 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 06:19:28 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758201577064.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8748.28
  }
}

2025-09-18 06:19:37 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758201582658.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5377
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758201591847.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9241.76
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 147,
  "sample": {
    "symbol": "NCLH",
    "score": 88.78,
    "entry": 83.1637,
    "stop": 79.7346,
    "targets": [
      87.9836,
      91.1968
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 111.318,
          "x2": "2025-09-15",
          "y2": 82.75,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 103.285,
          "x2": "2025-09-15",
          "y2": 80.54,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 81.645
        }
      ],
      "priceLevels": {
        "entry": 83.1637,
        "stop": 79.7346,
        "targets": [
          87.9836,
          91.1968
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.28",
        "slope gap 0.0030"
      ],
      "direction": "falling",
      "atr14": 4.3001
    },
    "avg_price": 81.5468859354655,
    "avg_volume": 71813879.73333333,
    "key_levels": {
      "entry": 83.1637,
      "stop": 79.7346,
      "targets": [
        87.9836,
        91.1968
      ]
    },
    "atr14": 4.3001,
    "chart_url": "https://legend-shots.onrender.com/reports/NCLH-1758201641872.png"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758201676477.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 31055.09
  }
}
2025-09-18 06:21:16 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 13:21:20.252136', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 06:21:20 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 06:21:26 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 06:21:26 Sleeping 5m before next iteration
2025-09-18 06:26:26 === Iteration 120 ===
2025-09-18 06:26:26 venv exists
2025-09-18 06:26:26 Installing Python requirements
2025-09-18 06:26:26 shots: node_modules present
2025-09-18 06:26:26 frontend: node_modules present
2025-09-18 06:26:26 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 9.58s
2025-09-18 06:26:37 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 06:26:37 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 06:26:37 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 06:26:49 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758202019380.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9519.34
  }
}

2025-09-18 06:26:59 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758202026696.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 7122
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758202035480.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8735.45
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 143,
  "sample": {
    "symbol": "WMT",
    "score": 82.58,
    "entry": 10.0399,
    "stop": 9.3951,
    "targets": [
      10.7557,
      11.2328
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 11.1702,
          "x2": "2025-09-15",
          "y2": 9.99,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 9.9774,
          "x2": "2025-09-15",
          "y2": 9.49,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 9.74
        }
      ],
      "priceLevels": {
        "entry": 10.0399,
        "stop": 9.3951,
        "targets": [
          10.7557,
          11.2328
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.42",
        "slope gap 0.0011"
      ],
      "direction": "falling",
      "atr14": 0.5566
    },
    "avg_price": 8.93813354174296,
    "avg_volume": 63375603.5,
    "key_levels": {
      "entry": 10.0399,
      "stop": 9.3951,
      "targets": [
        10.7557,
        11.2328
      ]
    },
    "atr14": 0.5566,
    "chart_url": "https://legend-shots.onrender.com/reports/WMT-1758202084893.png"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758202119660.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 32992.95
  }
}
2025-09-18 06:28:39 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 13:28:43.458096', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 06:28:43 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 06:28:49 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 06:28:49 Sleeping 5m before next iteration
2025-09-18 06:33:49 === Iteration 121 ===
2025-09-18 06:33:49 venv exists
2025-09-18 06:33:49 Installing Python requirements
2025-09-18 06:33:50 shots: node_modules present
2025-09-18 06:33:50 frontend: node_modules present
2025-09-18 06:33:50 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 9.59s
2025-09-18 06:34:00 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 06:34:00 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 06:34:00 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 06:34:12 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758202461479.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9149.73
  }
}

2025-09-18 06:34:21 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758202466441.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 4688
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758202475261.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8837.61
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 157,
  "sample": {
    "symbol": "TTWO",
    "score": 81.43,
    "entry": 76.5106,
    "stop": 71.7552,
    "targets": [
      81.487,
      84.8045
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 104.7729,
          "x2": "2025-09-15",
          "y2": 76.13,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 96.479,
          "x2": "2025-09-15",
          "y2": 72.48,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 74.305
        }
      ],
      "priceLevels": {
        "entry": 76.5106,
        "stop": 71.7552,
        "targets": [
          81.487,
          84.8045
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.44",
        "slope gap 0.0196"
      ],
      "direction": "falling",
      "atr14": 4.3772
    },
    "avg_price": 68.83448944091796,
    "avg_volume": 15854105.133333333,
    "key_levels": {
      "entry": 76.5106,
      "stop": 71.7552,
      "targets": [
        81.487,
        84.8045
      ]
    },
    "atr14": 4.3772,
    "chart_url": "https://legend-shots.onrender.com/reports/TTWO-1758202531546.png"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758202560848.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 23416.34
  }
}
2025-09-18 06:36:01 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 13:36:04.872267', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 06:36:04 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 06:36:10 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 06:36:10 Sleeping 5m before next iteration
2025-09-18 06:41:10 === Iteration 122 ===
2025-09-18 06:41:10 venv exists
2025-09-18 06:41:10 Installing Python requirements
2025-09-18 06:41:11 shots: node_modules present
2025-09-18 06:41:11 frontend: node_modules present
2025-09-18 06:41:11 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 10.32s
2025-09-18 06:41:22 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 06:41:22 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 06:41:22 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 06:41:34 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758202904262.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9276.38
  }
}

2025-09-18 06:41:44 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758202910375.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5973
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758202919278.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8848.12
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 151,
  "sample": {
    "symbol": "ARE",
    "score": 88.1,
    "entry": 85.0733,
    "stop": 80.3286,
    "targets": [
      92.5013,
      97.4533
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 91.66,
          "x2": "2025-09-15",
          "y2": 84.65,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 79.28,
          "x2": "2025-09-15",
          "y2": 81.14,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 82.895
        }
      ],
      "priceLevels": {
        "entry": 85.0733,
        "stop": 80.3286,
        "targets": [
          92.5013,
          97.4533
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.28",
        "slope gap 0.0170"
      ],
      "direction": "falling",
      "atr14": 4.5893,
      "sector": "Real Estate"
    },
    "avg_price": 67.01133359273275,
    "avg_volume": 13668356.466666667,
    "key_levels": {
      "entry": 85.0733,
      "stop": 80.3286,
      "targets": [
        92.5013,
        97.4533
      ]
    },
    "atr14": 4.5893,
    "sector": "Real Estate",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=ARE+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758202998758.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9866.82
  }
}
2025-09-18 06:43:18 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 13:43:22.871419', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 06:43:22 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 06:43:28 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 06:43:28 Sleeping 5m before next iteration
2025-09-18 06:48:28 === Iteration 123 ===
2025-09-18 06:48:29 venv exists
2025-09-18 06:48:29 Installing Python requirements
2025-09-18 06:48:29 shots: node_modules present
2025-09-18 06:48:29 frontend: node_modules present
2025-09-18 06:48:29 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 9.17s
2025-09-18 06:48:39 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 06:48:39 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 06:48:39 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 06:48:51 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758203340060.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8833.99
  }
}

2025-09-18 06:49:00 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758203345690.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5461
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758203354453.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8785.75
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 84,
  "sample": {
    "symbol": "BG",
    "score": 83.77,
    "entry": 28.2506,
    "stop": 26.8389,
    "targets": [
      29.9898,
      31.1494
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 55.3463,
          "x2": "2025-09-15",
          "y2": 28.11,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 52.4474,
          "x2": "2025-09-15",
          "y2": 27.11,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 27.61
        }
      ],
      "priceLevels": {
        "entry": 28.2506,
        "stop": 26.8389,
        "targets": [
          29.9898,
          31.1494
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.34",
        "slope gap 0.0026"
      ],
      "direction": "falling",
      "atr14": 1.9824
    },
    "avg_price": 30.930024274190266,
    "avg_volume": 18848795.8,
    "key_levels": {
      "entry": 28.2506,
      "stop": 26.8389,
      "targets": [
        29.9898,
        31.1494
      ]
    },
    "atr14": 1.9824,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=BG+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758203444873.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 16218.1
  }
}
2025-09-18 06:50:45 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 13:50:49.010003', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 06:50:49 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 06:50:55 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 06:50:55 Sleeping 5m before next iteration
2025-09-18 06:55:55 === Iteration 124 ===
2025-09-18 06:55:55 venv exists
2025-09-18 06:55:55 Installing Python requirements
2025-09-18 06:55:56 shots: node_modules present
2025-09-18 06:55:56 frontend: node_modules present
2025-09-18 06:55:56 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 8.52s
2025-09-18 06:56:05 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 06:56:05 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 06:56:05 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 06:56:17 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758203787776.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9695.73
  }
}

2025-09-18 06:56:27 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758203793749.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5822
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758203802875.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9112.31
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 112,
  "sample": {
    "symbol": "DIS",
    "score": 89.73,
    "entry": 69.6163,
    "stop": 67.7259,
    "targets": [
      71.8387,
      73.3203
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 66.8,
          "x2": "2025-09-15",
          "y2": 69.27,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 63.096,
          "x2": "2025-09-15",
          "y2": 68.41,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 68.84
        }
      ],
      "priceLevels": {
        "entry": 69.6163,
        "stop": 67.7259,
        "targets": [
          71.8387,
          73.3203
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.23",
        "slope gap 0.0095"
      ],
      "direction": "falling",
      "atr14": 4.025,
      "sector": "Communication Services"
    },
    "avg_price": 58.84599990844727,
    "avg_volume": 10354211.533333333,
    "key_levels": {
      "entry": 69.6163,
      "stop": 67.7259,
      "targets": [
        71.8387,
        73.3203
      ]
    },
    "atr14": 4.025,
    "sector": "Communication Services",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=DIS+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758203891271.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 14700.12
  }
}
2025-09-18 06:58:11 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 13:58:14.905199', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 06:58:14 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (249, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (249, 1) instead"
  }
]
2025-09-18 06:58:21 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 06:58:21 Sleeping 5m before next iteration
2025-09-18 07:03:21 === Iteration 125 ===
2025-09-18 07:03:21 venv exists
2025-09-18 07:03:21 Installing Python requirements
2025-09-18 07:03:22 shots: node_modules present
2025-09-18 07:03:22 frontend: node_modules present
2025-09-18 07:03:22 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 9.41s
2025-09-18 07:03:32 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 07:03:32 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 07:03:32 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 07:03:44 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758204234657.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9534.34
  }
}

2025-09-18 07:03:54 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758204240543.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5739
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758204249658.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9018.94
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 146,
  "sample": {
    "symbol": "AZO",
    "score": 82.61,
    "entry": 88.44,
    "stop": 83.7738,
    "targets": [
      93.1964,
      96.3673
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 121.5084,
          "x2": "2025-09-15",
          "y2": 88.0,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 113.5811,
          "x2": "2025-09-15",
          "y2": 84.62,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 86.31
        }
      ],
      "priceLevels": {
        "entry": 88.44,
        "stop": 83.7738,
        "targets": [
          93.1964,
          96.3673
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.43",
        "slope gap 0.0229"
      ],
      "direction": "falling",
      "atr14": 4.5838,
      "sector": "Consumer Cyclical"
    },
    "avg_price": 79.39146550496419,
    "avg_volume": 7650045.066666666,
    "key_levels": {
      "entry": 88.44,
      "stop": 83.7738,
      "targets": [
        93.1964,
        96.3673
      ]
    },
    "atr14": 4.5838,
    "sector": "Consumer Cyclical",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AZO+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758204343269.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 19698.74
  }
}
2025-09-18 07:05:43 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 14:05:47.479621', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 07:05:47 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (249, 1) instead"
  }
]
2025-09-18 07:05:54 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 07:05:54 Sleeping 5m before next iteration
2025-09-18 07:10:54 === Iteration 126 ===
2025-09-18 07:10:54 venv exists
2025-09-18 07:10:54 Installing Python requirements
2025-09-18 07:10:55 shots: node_modules present
2025-09-18 07:10:55 frontend: node_modules present
2025-09-18 07:10:55 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 8.66s
2025-09-18 07:11:04 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 07:11:04 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 07:11:04 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 07:11:16 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758204686158.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9556.39
  }
}

2025-09-18 07:11:26 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758204692350.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6033
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758204701272.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8851.19
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 105,
  "sample": {
    "symbol": "DUK",
    "score": 89.73,
    "entry": 69.6163,
    "stop": 67.7259,
    "targets": [
      71.8387,
      73.3203
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 66.8,
          "x2": "2025-09-15",
          "y2": 69.27,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 63.096,
          "x2": "2025-09-15",
          "y2": 68.41,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 68.84
        }
      ],
      "priceLevels": {
        "entry": 69.6163,
        "stop": 67.7259,
        "targets": [
          71.8387,
          73.3203
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.23",
        "slope gap 0.0095"
      ],
      "direction": "falling",
      "atr14": 4.025,
      "sector": "Utilities"
    },
    "avg_price": 58.84633305867513,
    "avg_volume": 10355276.366666667,
    "key_levels": {
      "entry": 69.6163,
      "stop": 67.7259,
      "targets": [
        71.8387,
        73.3203
      ]
    },
    "atr14": 4.025,
    "sector": "Utilities",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=DUK+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758204798469.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 22428.15
  }
}
2025-09-18 07:13:18 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 14:13:22.345061', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 07:13:22 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (249, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 07:13:28 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 07:13:28 Sleeping 5m before next iteration
2025-09-18 07:18:28 === Iteration 127 ===
2025-09-18 07:18:28 venv exists
2025-09-18 07:18:28 Installing Python requirements
2025-09-18 07:18:29 shots: node_modules present
2025-09-18 07:18:29 frontend: node_modules present
2025-09-18 07:18:29 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 8.58s
2025-09-18 07:18:38 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 07:18:38 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 07:18:38 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 07:18:50 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758205140272.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9257.15
  }
}

2025-09-18 07:19:00 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758205146193.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5800
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758205155071.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8856.87
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 114,
  "sample": {
    "symbol": "BF-B",
    "score": 88.1,
    "entry": 85.0733,
    "stop": 80.3286,
    "targets": [
      92.5013,
      97.4533
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 91.66,
          "x2": "2025-09-15",
          "y2": 84.65,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 79.28,
          "x2": "2025-09-15",
          "y2": 81.14,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 82.895
        }
      ],
      "priceLevels": {
        "entry": 85.0733,
        "stop": 80.3286,
        "targets": [
          92.5013,
          97.4533
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.28",
        "slope gap 0.0170"
      ],
      "direction": "falling",
      "atr14": 4.5893,
      "sector": "Consumer Defensive"
    },
    "avg_price": 67.02933362325032,
    "avg_volume": 13672347.866666667,
    "key_levels": {
      "entry": 85.0733,
      "stop": 80.3286,
      "targets": [
        92.5013,
        97.4533
      ]
    },
    "atr14": 4.5893,
    "sector": "Consumer Defensive",
    "chart_url": "https://legend-shots.onrender.com/reports/BF-B-1758205190356.png"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758205235602.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9644.37
  }
}
2025-09-18 07:20:35 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 14:20:39.444538', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 07:20:39 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 07:20:46 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 07:20:46 Sleeping 5m before next iteration
2025-09-18 07:25:46 === Iteration 128 ===
2025-09-18 07:25:46 venv exists
2025-09-18 07:25:46 Installing Python requirements
2025-09-18 07:25:46 shots: node_modules present
2025-09-18 07:25:46 frontend: node_modules present
2025-09-18 07:25:46 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 8.86s
2025-09-18 07:25:56 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 07:25:56 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 07:25:56 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 07:26:08 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758205577404.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8799.68
  }
}

2025-09-18 07:26:17 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758205583458.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5942
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758205592655.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9163.96
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 135,
  "sample": {
    "symbol": "DDOG",
    "score": 89.73,
    "entry": 69.6163,
    "stop": 67.7259,
    "targets": [
      71.8387,
      73.3203
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 66.8,
          "x2": "2025-09-15",
          "y2": 69.27,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 63.096,
          "x2": "2025-09-15",
          "y2": 68.41,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 68.84
        }
      ],
      "priceLevels": {
        "entry": 69.6163,
        "stop": 67.7259,
        "targets": [
          71.8387,
          73.3203
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.23",
        "slope gap 0.0095"
      ],
      "direction": "falling",
      "atr14": 4.025,
      "sector": "Technology"
    },
    "avg_price": 58.846666463216145,
    "avg_volume": 10356075.133333333,
    "key_levels": {
      "entry": 69.6163,
      "stop": 67.7259,
      "targets": [
        71.8387,
        73.3203
      ]
    },
    "atr14": 4.025,
    "sector": "Technology",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=DDOG+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758205680549.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 14191.75
  }
}
2025-09-18 07:28:00 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 14:28:04.189272', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 07:28:04 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 07:28:10 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 07:28:10 Sleeping 5m before next iteration
2025-09-18 07:33:10 === Iteration 129 ===
2025-09-18 07:33:10 venv exists
2025-09-18 07:33:10 Installing Python requirements
2025-09-18 07:33:10 shots: node_modules present
2025-09-18 07:33:10 frontend: node_modules present
2025-09-18 07:33:10 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 8.64s
2025-09-18 07:33:20 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 07:33:20 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 07:33:20 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 07:33:32 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758206021270.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9199.66
  }
}

2025-09-18 07:33:41 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758206027238.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5778
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758206036065.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8760.49
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 105,
  "sample": {
    "symbol": "MO",
    "score": 85.33,
    "entry": 58.2197,
    "stop": 54.9945,
    "targets": [
      62.9115,
      66.0394
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 107.6719,
          "x2": "2025-09-15",
          "y2": 57.93,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 99.8522,
          "x2": "2025-09-15",
          "y2": 55.55,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 56.74
        }
      ],
      "priceLevels": {
        "entry": 58.2197,
        "stop": 54.9945,
        "targets": [
          62.9115,
          66.0394
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.30",
        "slope gap 0.0213"
      ],
      "direction": "falling",
      "atr14": 4.0684
    },
    "avg_price": 53.720325978597,
    "avg_volume": 10722557.5,
    "key_levels": {
      "entry": 58.2197,
      "stop": 54.9945,
      "targets": [
        62.9115,
        66.0394
      ]
    },
    "atr14": 4.0684,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=MO+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758206119748.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10418.44
  }
}
2025-09-18 07:35:19 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 14:35:23.497084', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 07:35:23 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 07:35:29 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 07:35:29 Sleeping 5m before next iteration
2025-09-18 07:40:29 === Iteration 130 ===
2025-09-18 07:40:29 venv exists
2025-09-18 07:40:29 Installing Python requirements
2025-09-18 07:40:30 shots: node_modules present
2025-09-18 07:40:30 frontend: node_modules present
2025-09-18 07:40:30 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 8.83s
2025-09-18 07:40:40 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 07:40:40 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 07:40:40 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 07:40:52 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758206461685.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9057.84
  }
}

2025-09-18 07:41:01 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758206467564.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5727
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758206476669.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8993.97
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 141,
  "sample": {
    "symbol": "APA",
    "score": 88.1,
    "entry": 85.0733,
    "stop": 80.3286,
    "targets": [
      92.5013,
      97.4533
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 91.66,
          "x2": "2025-09-15",
          "y2": 84.65,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 79.28,
          "x2": "2025-09-15",
          "y2": 81.14,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 82.895
        }
      ],
      "priceLevels": {
        "entry": 85.0733,
        "stop": 80.3286,
        "targets": [
          92.5013,
          97.4533
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.28",
        "slope gap 0.0170"
      ],
      "direction": "falling",
      "atr14": 4.5893
    },
    "avg_price": 67.03766695658366,
    "avg_volume": 13673573.233333332,
    "key_levels": {
      "entry": 85.0733,
      "stop": 80.3286,
      "targets": [
        92.5013,
        97.4533
      ]
    },
    "atr14": 4.5893,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=APA+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758206562548.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10251.0
  }
}
2025-09-18 07:42:42 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 14:42:46.405785', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 07:42:46 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 07:42:52 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 07:42:52 Sleeping 5m before next iteration
2025-09-18 07:47:52 === Iteration 131 ===
2025-09-18 07:47:52 venv exists
2025-09-18 07:47:52 Installing Python requirements
2025-09-18 07:47:53 shots: node_modules present
2025-09-18 07:47:53 frontend: node_modules present
2025-09-18 07:47:53 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 9.07s
2025-09-18 07:48:03 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 07:48:03 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 07:48:03 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 07:48:15 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758206904066.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8911.01
  }
}

2025-09-18 07:48:24 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758206909927.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5631
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758206918782.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8777.11
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 78,
  "sample": {
    "symbol": "CF",
    "score": 82.7,
    "entry": 19.4367,
    "stop": 18.4635,
    "targets": [
      20.4152,
      21.0676
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 27.1964,
          "x2": "2025-09-15",
          "y2": 19.34,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 25.5656,
          "x2": "2025-09-15",
          "y2": 18.65,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 18.995
        }
      ],
      "priceLevels": {
        "entry": 19.4367,
        "stop": 18.4635,
        "targets": [
          20.4152,
          21.0676
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.42",
        "slope gap 0.0009"
      ],
      "direction": "falling",
      "atr14": 1.0326,
      "sector": "Basic Materials"
    },
    "avg_price": 21.752242660522462,
    "avg_volume": 41393012.5,
    "key_levels": {
      "entry": 19.4367,
      "stop": 18.4635,
      "targets": [
        20.4152,
        21.0676
      ]
    },
    "atr14": 1.0326,
    "sector": "Basic Materials",
    "chart_url": "https://legend-shots.onrender.com/reports/CF-1758206970254.png"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758206998980.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10118.82
  }
}
2025-09-18 07:49:59 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 14:50:02.748688', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 07:50:02 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 07:50:08 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 07:50:08 Sleeping 5m before next iteration
2025-09-18 07:55:08 === Iteration 132 ===
2025-09-18 07:55:08 venv exists
2025-09-18 07:55:08 Installing Python requirements
2025-09-18 07:55:09 shots: node_modules present
2025-09-18 07:55:09 frontend: node_modules present
2025-09-18 07:55:09 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 10.56s
2025-09-18 07:55:21 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 07:55:21 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 07:55:21 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 07:55:33 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758207342082.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8958.98
  }
}

2025-09-18 07:55:42 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758207347678.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5437
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758207361065.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 13317.63
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 126,
  "sample": {
    "symbol": "CHTR",
    "score": 82.7,
    "entry": 19.4367,
    "stop": 18.4635,
    "targets": [
      20.4152,
      21.0676
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 27.1964,
          "x2": "2025-09-15",
          "y2": 19.34,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 25.5656,
          "x2": "2025-09-15",
          "y2": 18.65,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 18.995
        }
      ],
      "priceLevels": {
        "entry": 19.4367,
        "stop": 18.4635,
        "targets": [
          20.4152,
          21.0676
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.42",
        "slope gap 0.0009"
      ],
      "direction": "falling",
      "atr14": 1.0326,
      "sector": "Communication Services"
    },
    "avg_price": 21.749742698669433,
    "avg_volume": 41417482.93333333,
    "key_levels": {
      "entry": 19.4367,
      "stop": 18.4635,
      "targets": [
        20.4152,
        21.0676
      ]
    },
    "atr14": 1.0326,
    "sector": "Communication Services",
    "chart_url": "https://legend-shots.onrender.com/reports/CHTR-1758207405941.png"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758207424080.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 16924.66
  }
}
2025-09-18 07:57:04 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 14:57:08.661850', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 07:57:08 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 07:57:14 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 07:57:14 Sleeping 5m before next iteration
2025-09-18 08:02:14 === Iteration 133 ===
2025-09-18 08:02:14 venv exists
2025-09-18 08:02:14 Installing Python requirements
2025-09-18 08:02:15 shots: node_modules present
2025-09-18 08:02:15 frontend: node_modules present
2025-09-18 08:02:15 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 9.18s
2025-09-18 08:02:25 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 08:02:25 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 08:02:25 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 08:02:36 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758207766433.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9485.18
  }
}

2025-09-18 08:02:46 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758207771782.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5243
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758207780899.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9003.74
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 96,
  "sample": {
    "symbol": "REG",
    "score": 88.91,
    "entry": 187.121,
    "stop": 178.0713,
    "targets": [
      201.4358,
      210.9791
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 284.755,
          "x2": "2025-09-15",
          "y2": 186.19,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 260.8969,
          "x2": "2025-09-15",
          "y2": 179.87,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 183.03
        }
      ],
      "priceLevels": {
        "entry": 187.121,
        "stop": 178.0713,
        "targets": [
          201.4358,
          210.9791
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.26",
        "slope gap 0.0683"
      ],
      "direction": "falling",
      "atr14": 9.5991,
      "sector": "Real Estate"
    },
    "avg_price": 208.43106231689453,
    "avg_volume": 2931537.966666667,
    "key_levels": {
      "entry": 187.121,
      "stop": 178.0713,
      "targets": [
        201.4358,
        210.9791
      ]
    },
    "atr14": 9.5991,
    "sector": "Real Estate",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=REG+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758207878579.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 23240.8
  }
}
2025-09-18 08:04:38 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 15:04:42.759698', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 08:04:42 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 08:04:49 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 08:04:49 Sleeping 5m before next iteration
2025-09-18 08:09:49 === Iteration 134 ===
2025-09-18 08:09:49 venv exists
2025-09-18 08:09:49 Installing Python requirements
2025-09-18 08:09:49 shots: node_modules present
2025-09-18 08:09:49 frontend: node_modules present
2025-09-18 08:09:49 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 8.93s
2025-09-18 08:09:59 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 08:09:59 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 08:09:59 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 08:10:11 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758208221068.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9384.31
  }
}

2025-09-18 08:10:21 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758208226709.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5560
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758208235764.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9015.3
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 114,
  "sample": {
    "symbol": "META",
    "score": 85.33,
    "entry": 58.2197,
    "stop": 54.9945,
    "targets": [
      62.9115,
      66.0394
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 107.672,
          "x2": "2025-09-15",
          "y2": 57.93,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 99.8522,
          "x2": "2025-09-15",
          "y2": 55.55,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 56.74
        }
      ],
      "priceLevels": {
        "entry": 58.2197,
        "stop": 54.9945,
        "targets": [
          62.9115,
          66.0394
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.30",
        "slope gap 0.0213"
      ],
      "direction": "falling",
      "atr14": 4.0684,
      "sector": "Communication Services"
    },
    "avg_price": 53.70565910339356,
    "avg_volume": 10725492.233333332,
    "key_levels": {
      "entry": 58.2197,
      "stop": 54.9945,
      "targets": [
        62.9115,
        66.0394
      ]
    },
    "atr14": 4.0684,
    "sector": "Communication Services",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=META+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758208319444.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10103.45
  }
}
2025-09-18 08:11:59 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 15:12:03.337848', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 08:12:03 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 08:12:10 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 08:12:10 Sleeping 5m before next iteration
2025-09-18 08:17:10 === Iteration 135 ===
2025-09-18 08:17:10 venv exists
2025-09-18 08:17:10 Installing Python requirements
2025-09-18 08:17:10 shots: node_modules present
2025-09-18 08:17:10 frontend: node_modules present
2025-09-18 08:17:10 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 8.99s
2025-09-18 08:17:20 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 08:17:20 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 08:17:20 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 08:17:32 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758208661380.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9122.76
  }
}

2025-09-18 08:17:41 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758208666611.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5060
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758208675363.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8663.53
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 122,
  "sample": {
    "symbol": "WRB",
    "score": 82.58,
    "entry": 10.0399,
    "stop": 9.3951,
    "targets": [
      10.7557,
      11.2328
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 11.1702,
          "x2": "2025-09-15",
          "y2": 9.99,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 9.9774,
          "x2": "2025-09-15",
          "y2": 9.49,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 9.74
        }
      ],
      "priceLevels": {
        "entry": 10.0399,
        "stop": 9.3951,
        "targets": [
          10.7557,
          11.2328
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.42",
        "slope gap 0.0011"
      ],
      "direction": "falling",
      "atr14": 0.5566
    },
    "avg_price": 8.937470165888469,
    "avg_volume": 63057286.166666664,
    "key_levels": {
      "entry": 10.0399,
      "stop": 9.3951,
      "targets": [
        10.7557,
        11.2328
      ]
    },
    "atr14": 0.5566,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=WRB+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758208772575.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 22929.38
  }
}
2025-09-18 08:19:32 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 15:19:37.043585', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 08:19:37 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 08:19:43 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 08:19:43 Sleeping 5m before next iteration
2025-09-18 08:24:43 === Iteration 136 ===
2025-09-18 08:24:43 venv exists
2025-09-18 08:24:43 Installing Python requirements
2025-09-18 08:24:44 shots: node_modules present
2025-09-18 08:24:44 frontend: node_modules present
2025-09-18 08:24:44 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 9.06s
2025-09-18 08:24:54 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 08:24:54 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 08:24:54 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 08:25:06 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758209116261.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9189.2
  }
}

2025-09-18 08:25:16 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758209121943.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5554
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758209130977.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8952.05
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 98,
  "sample": {
    "symbol": "NDAQ",
    "score": 88.91,
    "entry": 187.121,
    "stop": 178.0713,
    "targets": [
      201.4358,
      210.9791
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 284.7549,
          "x2": "2025-09-15",
          "y2": 186.19,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 260.8968,
          "x2": "2025-09-15",
          "y2": 179.87,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 183.03
        }
      ],
      "priceLevels": {
        "entry": 187.121,
        "stop": 178.0713,
        "targets": [
          201.4358,
          210.9791
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.26",
        "slope gap 0.0683"
      ],
      "direction": "falling",
      "atr14": 9.5991
    },
    "avg_price": 208.4390625,
    "avg_volume": 2931946.566666667,
    "key_levels": {
      "entry": 187.121,
      "stop": 178.0713,
      "targets": [
        201.4358,
        210.9791
      ]
    },
    "atr14": 9.5991,
    "chart_url": "https://legend-shots.onrender.com/reports/NDAQ-1758209182543.png"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758209223474.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 18702.3
  }
}
2025-09-18 08:27:03 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 15:27:07.075735', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 08:27:07 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (249, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 08:27:13 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 08:27:13 Sleeping 5m before next iteration
2025-09-18 08:32:13 === Iteration 137 ===
2025-09-18 08:32:13 venv exists
2025-09-18 08:32:13 Installing Python requirements
2025-09-18 08:32:14 shots: node_modules present
2025-09-18 08:32:14 frontend: node_modules present
2025-09-18 08:32:14 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 8.58s
2025-09-18 08:32:23 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 08:32:23 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 08:32:23 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 08:32:35 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758209565060.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9446.9
  }
}

2025-09-18 08:32:45 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758209570702.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5461
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758209579427.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8656.65
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 71,
  "sample": {
    "symbol": "CHTR",
    "score": 82.7,
    "entry": 19.4367,
    "stop": 18.4635,
    "targets": [
      20.4152,
      21.0676
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 27.1964,
          "x2": "2025-09-15",
          "y2": 19.34,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 25.5656,
          "x2": "2025-09-15",
          "y2": 18.65,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 18.995
        }
      ],
      "priceLevels": {
        "entry": 19.4367,
        "stop": 18.4635,
        "targets": [
          20.4152,
          21.0676
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.42",
        "slope gap 0.0009"
      ],
      "direction": "falling",
      "atr14": 1.0326,
      "sector": "Communication Services"
    },
    "avg_price": 21.753575960795086,
    "avg_volume": 41438265.766666666,
    "key_levels": {
      "entry": 19.4367,
      "stop": 18.4635,
      "targets": [
        20.4152,
        21.0676
      ]
    },
    "atr14": 1.0326,
    "sector": "Communication Services",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=CHTR+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758209663456.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10305.77
  }
}
2025-09-18 08:34:23 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 15:34:27.182842', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 08:34:27 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 08:34:33 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 08:34:33 Sleeping 5m before next iteration
2025-09-18 08:39:33 === Iteration 138 ===
2025-09-18 08:39:33 venv exists
2025-09-18 08:39:33 Installing Python requirements
2025-09-18 08:39:34 shots: node_modules present
2025-09-18 08:39:34 frontend: node_modules present
2025-09-18 08:39:34 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 11.57s
2025-09-18 08:39:46 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 08:39:46 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 08:39:46 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 08:39:58 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758210007880.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8747.09
  }
}

2025-09-18 08:40:07 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758210013586.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5615
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758210022558.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8923.51
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 106,
  "sample": {
    "symbol": "PCAR",
    "score": 88.78,
    "entry": 83.1637,
    "stop": 79.7346,
    "targets": [
      87.9836,
      91.1968
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 111.318,
          "x2": "2025-09-15",
          "y2": 82.75,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 103.285,
          "x2": "2025-09-15",
          "y2": 80.54,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 81.645
        }
      ],
      "priceLevels": {
        "entry": 83.1637,
        "stop": 79.7346,
        "targets": [
          87.9836,
          91.1968
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.28",
        "slope gap 0.0030"
      ],
      "direction": "falling",
      "atr14": 4.3001,
      "sector": "Industrials"
    },
    "avg_price": 81.54755274454753,
    "avg_volume": 71477632.1,
    "key_levels": {
      "entry": 83.1637,
      "stop": 79.7346,
      "targets": [
        87.9836,
        91.1968
      ]
    },
    "atr14": 4.3001,
    "sector": "Industrials",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=PCAR+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758210118573.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 22085.73
  }
}
2025-09-18 08:41:58 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 15:42:02.543402', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 08:42:02 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 08:42:09 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 08:42:09 Sleeping 5m before next iteration
2025-09-18 08:47:09 === Iteration 139 ===
2025-09-18 08:47:09 venv exists
2025-09-18 08:47:09 Installing Python requirements
2025-09-18 08:47:09 shots: node_modules present
2025-09-18 08:47:09 frontend: node_modules present
2025-09-18 08:47:09 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 11.94s
2025-09-18 08:47:22 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 08:47:22 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 08:47:22 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 08:47:34 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758210464062.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9419.01
  }
}

2025-09-18 08:47:44 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758210470261.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6062
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758210479357.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8981.85
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 129,
  "sample": {
    "symbol": "ARE",
    "score": 88.1,
    "entry": 85.0733,
    "stop": 80.3286,
    "targets": [
      92.5013,
      97.4533
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 91.66,
          "x2": "2025-09-15",
          "y2": 84.65,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 79.28,
          "x2": "2025-09-15",
          "y2": 81.14,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 82.895
        }
      ],
      "priceLevels": {
        "entry": 85.0733,
        "stop": 80.3286,
        "targets": [
          92.5013,
          97.4533
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.28",
        "slope gap 0.0170"
      ],
      "direction": "falling",
      "atr14": 4.5893,
      "sector": "Real Estate"
    },
    "avg_price": 67.03966687520345,
    "avg_volume": 13676855.8,
    "key_levels": {
      "entry": 85.0733,
      "stop": 80.3286,
      "targets": [
        92.5013,
        97.4533
      ]
    },
    "atr14": 4.5893,
    "sector": "Real Estate",
    "chart_url": "https://legend-shots.onrender.com/reports/ARE-1758210540545.png"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758210576071.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 32740.55
  }
}
2025-09-18 08:49:36 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 15:49:39.733213', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 08:49:39 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 08:49:46 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 08:49:46 Sleeping 5m before next iteration
2025-09-18 08:54:46 === Iteration 140 ===
2025-09-18 08:54:46 venv exists
2025-09-18 08:54:46 Installing Python requirements
2025-09-18 08:54:46 shots: node_modules present
2025-09-18 08:54:46 frontend: node_modules present
2025-09-18 08:54:46 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 9.74s
2025-09-18 08:54:57 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 08:54:57 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 08:54:57 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 08:55:10 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758210920156.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9929.84
  }
}

2025-09-18 08:55:20 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758210925001.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 4722
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758210933772.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8802.17
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 151,
  "sample": {
    "symbol": "DDOG",
    "score": 89.73,
    "entry": 69.6163,
    "stop": 67.7259,
    "targets": [
      71.8387,
      73.3203
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 66.8,
          "x2": "2025-09-15",
          "y2": 69.27,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 63.096,
          "x2": "2025-09-15",
          "y2": 68.41,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 68.84
        }
      ],
      "priceLevels": {
        "entry": 69.6163,
        "stop": 67.7259,
        "targets": [
          71.8387,
          73.3203
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.23",
        "slope gap 0.0095"
      ],
      "direction": "falling",
      "atr14": 4.025,
      "sector": "Technology"
    },
    "avg_price": 58.84033304850261,
    "avg_volume": 10361312.866666667,
    "key_levels": {
      "entry": 69.6163,
      "stop": 67.7259,
      "targets": [
        71.8387,
        73.3203
      ]
    },
    "atr14": 4.025,
    "sector": "Technology",
    "chart_url": "https://legend-shots.onrender.com/reports/DDOG-1758210981851.png"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758211009887.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 23101.45
  }
}
2025-09-18 08:56:50 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 15:56:53.578934', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 08:56:53 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (249, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 08:56:59 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 08:56:59 Sleeping 5m before next iteration
2025-09-18 09:01:59 === Iteration 141 ===
2025-09-18 09:01:59 venv exists
2025-09-18 09:01:59 Installing Python requirements
2025-09-18 09:02:00 shots: node_modules present
2025-09-18 09:02:00 frontend: node_modules present
2025-09-18 09:02:00 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 12.60s
2025-09-18 09:02:14 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 09:02:14 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 09:02:14 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 09:02:25 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758211355006.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9793.12
  }
}

2025-09-18 09:02:35 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758211360321.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5137
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758211369571.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9202.35
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 137,
  "sample": {
    "symbol": "NWS",
    "score": 84.74,
    "entry": 73.8976,
    "stop": 70.8939,
    "targets": [
      77.3488,
      79.6495
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 104.2589,
          "x2": "2025-09-15",
          "y2": 73.53,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 98.507,
          "x2": "2025-09-15",
          "y2": 71.61,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 72.57
        }
      ],
      "priceLevels": {
        "entry": 73.8976,
        "stop": 70.8939,
        "targets": [
          77.3488,
          79.6495
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.33",
        "slope gap 0.0001"
      ],
      "direction": "falling",
      "atr14": 4.8703
    },
    "avg_price": 67.44440231323242,
    "avg_volume": 80121172.33333333,
    "key_levels": {
      "entry": 73.8976,
      "stop": 70.8939,
      "targets": [
        77.3488,
        79.6495
      ]
    },
    "atr14": 4.8703,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=NWS+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758211466385.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 22755.63
  }
}
2025-09-18 09:04:26 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 16:04:30.071798', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 09:04:30 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 09:04:35 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 09:04:35 Sleeping 5m before next iteration
2025-09-18 09:09:35 === Iteration 142 ===
2025-09-18 09:09:35 venv exists
2025-09-18 09:09:35 Installing Python requirements
2025-09-18 09:09:36 shots: node_modules present
2025-09-18 09:09:36 frontend: node_modules present
2025-09-18 09:09:36 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 8.58s
2025-09-18 09:09:45 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 09:09:45 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 09:09:46 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 09:09:57 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758211806991.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9098.33
  }
}

2025-09-18 09:10:07 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758211812774.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5576
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758211821854.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9027.81
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 106,
  "sample": {
    "symbol": "DTE",
    "score": 89.73,
    "entry": 69.6163,
    "stop": 67.7259,
    "targets": [
      71.8387,
      73.3203
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 66.8,
          "x2": "2025-09-15",
          "y2": 69.27,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 63.096,
          "x2": "2025-09-15",
          "y2": 68.41,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 68.84
        }
      ],
      "priceLevels": {
        "entry": 69.6163,
        "stop": 67.7259,
        "targets": [
          71.8387,
          73.3203
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.23",
        "slope gap 0.0095"
      ],
      "direction": "falling",
      "atr14": 4.025,
      "sector": "Utilities"
    },
    "avg_price": 58.839333089192706,
    "avg_volume": 10362800.0,
    "key_levels": {
      "entry": 69.6163,
      "stop": 67.7259,
      "targets": [
        71.8387,
        73.3203
      ]
    },
    "atr14": 4.025,
    "sector": "Utilities",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=DTE+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758211909267.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 13650.84
  }
}
2025-09-18 09:11:49 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 16:11:53.001318', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 09:11:53 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 09:11:58 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 09:11:58 Sleeping 5m before next iteration
2025-09-18 09:16:58 === Iteration 143 ===
2025-09-18 09:16:58 venv exists
2025-09-18 09:16:58 Installing Python requirements
2025-09-18 09:16:59 shots: node_modules present
2025-09-18 09:16:59 frontend: node_modules present
2025-09-18 09:16:59 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 8.80s
2025-09-18 09:17:09 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 09:17:09 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 09:17:09 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 09:17:22 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758212251570.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9352.82
  }
}

2025-09-18 09:17:31 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758212257888.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6149
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758212266618.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8667.23
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 138,
  "sample": {
    "symbol": "CAG",
    "score": 83.77,
    "entry": 28.2506,
    "stop": 26.8389,
    "targets": [
      29.9898,
      31.1494
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 55.3463,
          "x2": "2025-09-15",
          "y2": 28.11,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 52.4474,
          "x2": "2025-09-15",
          "y2": 27.11,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 27.61
        }
      ],
      "priceLevels": {
        "entry": 28.2506,
        "stop": 26.8389,
        "targets": [
          29.9898,
          31.1494
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.34",
        "slope gap 0.0026"
      ],
      "direction": "falling",
      "atr14": 1.9824
    },
    "avg_price": 30.92835744222005,
    "avg_volume": 18881989.033333335,
    "key_levels": {
      "entry": 28.2506,
      "stop": 26.8389,
      "targets": [
        29.9898,
        31.1494
      ]
    },
    "atr14": 1.9824,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=CAG+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758212347667.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10123.16
  }
}
2025-09-18 09:19:07 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 16:19:11.616271', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 09:19:11 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (249, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 09:19:17 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 09:19:17 Sleeping 5m before next iteration
2025-09-18 09:24:17 === Iteration 144 ===
2025-09-18 09:24:17 venv exists
2025-09-18 09:24:17 Installing Python requirements
2025-09-18 09:24:18 shots: node_modules present
2025-09-18 09:24:18 frontend: node_modules present
2025-09-18 09:24:18 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 9.50s
2025-09-18 09:24:28 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 09:24:28 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 09:24:28 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 09:24:40 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758212689569.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9004.42
  }
}

2025-09-18 09:24:49 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758212695459.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5660
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758212704252.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8749.39
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 119,
  "sample": {
    "symbol": "DG",
    "score": 89.73,
    "entry": 69.6163,
    "stop": 67.7259,
    "targets": [
      71.8387,
      73.3203
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 66.8,
          "x2": "2025-09-15",
          "y2": 69.27,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 63.096,
          "x2": "2025-09-15",
          "y2": 68.41,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 68.84
        }
      ],
      "priceLevels": {
        "entry": 69.6163,
        "stop": 67.7259,
        "targets": [
          71.8387,
          73.3203
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.23",
        "slope gap 0.0095"
      ],
      "direction": "falling",
      "atr14": 4.025
    },
    "avg_price": 58.83983306884765,
    "avg_volume": 10363284.3,
    "key_levels": {
      "entry": 69.6163,
      "stop": 67.7259,
      "targets": [
        71.8387,
        73.3203
      ]
    },
    "atr14": 4.025,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=DG+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758212789350.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10321.8
  }
}
2025-09-18 09:26:29 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 16:26:33.224671', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 09:26:33 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (249, 1) instead"
  }
]
2025-09-18 09:26:40 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 09:26:40 Sleeping 5m before next iteration
2025-09-18 09:31:40 === Iteration 145 ===
2025-09-18 09:31:40 venv exists
2025-09-18 09:31:40 Installing Python requirements
2025-09-18 09:31:40 shots: node_modules present
2025-09-18 09:31:40 frontend: node_modules present
2025-09-18 09:31:40 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 8.57s
2025-09-18 09:31:50 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 09:31:50 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 09:31:50 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 09:32:01 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758213130752.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8915.63
  }
}

2025-09-18 09:32:10 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758213135894.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 4944
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758213144570.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8680.7
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 69,
  "sample": {
    "symbol": "MNST",
    "score": 88.91,
    "entry": 187.121,
    "stop": 178.0713,
    "targets": [
      201.4358,
      210.9791
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 284.7549,
          "x2": "2025-09-15",
          "y2": 186.19,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 260.8968,
          "x2": "2025-09-15",
          "y2": 179.87,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 183.03
        }
      ],
      "priceLevels": {
        "entry": 187.121,
        "stop": 178.0713,
        "targets": [
          201.4358,
          210.9791
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.26",
        "slope gap 0.0683"
      ],
      "direction": "falling",
      "atr14": 9.5991,
      "sector": "Consumer Defensive"
    },
    "avg_price": 208.4477294921875,
    "avg_volume": 2934310.066666667,
    "key_levels": {
      "entry": 187.121,
      "stop": 178.0713,
      "targets": [
        201.4358,
        210.9791
      ]
    },
    "atr14": 9.5991,
    "sector": "Consumer Defensive",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=MNST+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758213225648.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9965.57
  }
}
2025-09-18 09:33:45 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 16:33:49.513838', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 09:33:49 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 09:33:56 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 09:33:56 Sleeping 5m before next iteration
2025-09-18 09:38:56 === Iteration 146 ===
2025-09-18 09:38:56 venv exists
2025-09-18 09:38:56 Installing Python requirements
2025-09-18 09:38:57 shots: node_modules present
2025-09-18 09:38:57 frontend: node_modules present
2025-09-18 09:38:57 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 8.74s
2025-09-18 09:39:06 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 09:39:06 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 09:39:06 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 09:39:18 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758213567801.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9195.46
  }
}

2025-09-18 09:39:28 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758213573811.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5691
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758213582784.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8907.85
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 124,
  "sample": {
    "symbol": "AVGO",
    "score": 82.61,
    "entry": 88.44,
    "stop": 83.7738,
    "targets": [
      93.1964,
      96.3673
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 121.5084,
          "x2": "2025-09-15",
          "y2": 88.0,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 113.5811,
          "x2": "2025-09-15",
          "y2": 84.62,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 86.31
        }
      ],
      "priceLevels": {
        "entry": 88.44,
        "stop": 83.7738,
        "targets": [
          93.1964,
          96.3673
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.43",
        "slope gap 0.0229"
      ],
      "direction": "falling",
      "atr14": 4.5838,
      "sector": "Technology"
    },
    "avg_price": 79.4241325378418,
    "avg_volume": 7659839.166666667,
    "key_levels": {
      "entry": 88.44,
      "stop": 83.7738,
      "targets": [
        93.1964,
        96.3673
      ]
    },
    "atr14": 4.5838,
    "sector": "Technology",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AVGO+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758213677563.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 16768.78
  }
}
2025-09-18 09:41:17 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 16:41:21.571905', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 09:41:21 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 09:41:28 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 09:41:28 Sleeping 5m before next iteration
2025-09-18 09:46:28 === Iteration 147 ===
2025-09-18 09:46:28 venv exists
2025-09-18 09:46:28 Installing Python requirements
2025-09-18 09:46:29 shots: node_modules present
2025-09-18 09:46:29 frontend: node_modules present
2025-09-18 09:46:29 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 9.44s
2025-09-18 09:46:39 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 09:46:39 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 09:46:39 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 09:46:50 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758214020900.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9844.11
  }
}

2025-09-18 09:47:01 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758214026429.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5393
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758214035448.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8994.72
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 130,
  "sample": {
    "symbol": "ARE",
    "score": 88.1,
    "entry": 85.0733,
    "stop": 80.3286,
    "targets": [
      92.5013,
      97.4533
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 91.66,
          "x2": "2025-09-15",
          "y2": 84.65,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 79.28,
          "x2": "2025-09-15",
          "y2": 81.14,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 82.895
        }
      ],
      "priceLevels": {
        "entry": 85.0733,
        "stop": 80.3286,
        "targets": [
          92.5013,
          97.4533
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.28",
        "slope gap 0.0170"
      ],
      "direction": "falling",
      "atr14": 4.5893,
      "sector": "Real Estate"
    },
    "avg_price": 67.06300010681153,
    "avg_volume": 13680794.466666667,
    "key_levels": {
      "entry": 85.0733,
      "stop": 80.3286,
      "targets": [
        92.5013,
        97.4533
      ]
    },
    "atr14": 4.5893,
    "sector": "Real Estate",
    "chart_url": "https://legend-shots.onrender.com/reports/ARE-1758214084263.png"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758214120862.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30494.96
  }
}
2025-09-18 09:48:41 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 16:48:44.583052', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 09:48:44 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 09:48:50 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 09:48:50 Sleeping 5m before next iteration
2025-09-18 09:53:50 === Iteration 148 ===
2025-09-18 09:53:50 venv exists
2025-09-18 09:53:50 Installing Python requirements
2025-09-18 09:53:51 shots: node_modules present
2025-09-18 09:53:51 frontend: node_modules present
2025-09-18 09:53:51 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 8.78s
2025-09-18 09:54:01 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 09:54:01 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 09:54:01 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 09:54:12 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758214462182.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9409.65
  }
}

2025-09-18 09:54:22 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758214467534.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5145
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758214476281.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8764.18
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 88,
  "sample": {
    "symbol": "DDOG",
    "score": 89.73,
    "entry": 69.6163,
    "stop": 67.7259,
    "targets": [
      71.8387,
      73.3203
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 66.8,
          "x2": "2025-09-15",
          "y2": 69.27,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 63.096,
          "x2": "2025-09-15",
          "y2": 68.41,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 68.84
        }
      ],
      "priceLevels": {
        "entry": 69.6163,
        "stop": 67.7259,
        "targets": [
          71.8387,
          73.3203
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.23",
        "slope gap 0.0095"
      ],
      "direction": "falling",
      "atr14": 4.025,
      "sector": "Technology"
    },
    "avg_price": 58.83999989827474,
    "avg_volume": 10364771.433333334,
    "key_levels": {
      "entry": 69.6163,
      "stop": 67.7259,
      "targets": [
        71.8387,
        73.3203
      ]
    },
    "atr14": 4.025,
    "sector": "Technology",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=DDOG+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758214559879.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10008.78
  }
}
2025-09-18 09:56:00 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 16:56:05.121471', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 09:56:05 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 09:56:12 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 09:56:12 Sleeping 5m before next iteration
2025-09-18 10:01:12 === Iteration 149 ===
2025-09-18 10:01:12 venv exists
2025-09-18 10:01:12 Installing Python requirements
2025-09-18 10:01:13 shots: node_modules present
2025-09-18 10:01:13 frontend: node_modules present
2025-09-18 10:01:13 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 13.22s
2025-09-18 10:01:27 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 10:01:27 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 10:01:27 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 10:01:39 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758214909003.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9033.26
  }
}

2025-09-18 10:01:49 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758214914690.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5613
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758214923664.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8833.41
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 107,
  "sample": {
    "symbol": "SYK",
    "score": 79.91,
    "entry": 24.5119,
    "stop": 23.4432,
    "targets": [
      25.3329,
      25.8802
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 27.0789,
          "x2": "2025-09-15",
          "y2": 24.39,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 25.7106,
          "x2": "2025-09-15",
          "y2": 23.68,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 24.035
        }
      ],
      "priceLevels": {
        "entry": 24.5119,
        "stop": 23.4432,
        "targets": [
          25.3329,
          25.8802
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.52",
        "slope gap 0.0006"
      ],
      "direction": "falling",
      "atr14": 1.0895
    },
    "avg_price": 23.85327517191569,
    "avg_volume": 222936820.66666666,
    "key_levels": {
      "entry": 24.5119,
      "stop": 23.4432,
      "targets": [
        25.3329,
        25.8802
      ]
    },
    "atr14": 1.0895,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=SYK+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758215017879.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 20070.32
  }
}
2025-09-18 10:03:38 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 17:03:41.834550', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 10:03:41 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 10:03:48 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 10:03:48 Sleeping 5m before next iteration
2025-09-18 10:08:48 === Iteration 150 ===
2025-09-18 10:08:48 venv exists
2025-09-18 10:08:48 Installing Python requirements
2025-09-18 10:08:48 shots: node_modules present
2025-09-18 10:08:48 frontend: node_modules present
2025-09-18 10:08:48 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 8.82s
2025-09-18 10:08:58 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 10:08:58 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 10:08:58 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 10:09:10 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758215360467.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9401.03
  }
}

2025-09-18 10:09:20 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758215366306.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5692
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758215375061.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8756.15
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 96,
  "sample": {
    "symbol": "NFLX",
    "score": 85.33,
    "entry": 58.2197,
    "stop": 54.9945,
    "targets": [
      62.9115,
      66.0394
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 107.6719,
          "x2": "2025-09-15",
          "y2": 57.93,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 99.8522,
          "x2": "2025-09-15",
          "y2": 55.55,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 56.74
        }
      ],
      "priceLevels": {
        "entry": 58.2197,
        "stop": 54.9945,
        "targets": [
          62.9115,
          66.0394
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.30",
        "slope gap 0.0213"
      ],
      "direction": "falling",
      "atr14": 4.0684
    },
    "avg_price": 53.71465924580892,
    "avg_volume": 10731996.266666668,
    "key_levels": {
      "entry": 58.2197,
      "stop": 54.9945,
      "targets": [
        62.9115,
        66.0394
      ]
    },
    "atr14": 4.0684,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=NFLX+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758215475591.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 25918.91
  }
}
2025-09-18 10:11:15 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 17:11:19.445884', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 10:11:19 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 10:11:25 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 10:11:25 Sleeping 5m before next iteration
2025-09-18 10:16:25 === Iteration 151 ===
2025-09-18 10:16:25 venv exists
2025-09-18 10:16:25 Installing Python requirements
2025-09-18 10:16:26 shots: node_modules present
2025-09-18 10:16:26 frontend: node_modules present
2025-09-18 10:16:26 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 27.80s
2025-09-18 10:16:55 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 10:16:55 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 10:16:55 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 10:17:07 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758215837059.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9397.0
  }
}

2025-09-18 10:17:17 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758215842601.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5272
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758215851676.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9066.81
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 129,
  "sample": {
    "symbol": "PLD",
    "score": 89.73,
    "entry": 69.6163,
    "stop": 67.7259,
    "targets": [
      71.8387,
      73.3203
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 66.8,
          "x2": "2025-09-15",
          "y2": 69.27,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 63.096,
          "x2": "2025-09-15",
          "y2": 68.41,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 68.84
        }
      ],
      "priceLevels": {
        "entry": 69.6163,
        "stop": 67.7259,
        "targets": [
          71.8387,
          73.3203
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.23",
        "slope gap 0.0095"
      ],
      "direction": "falling",
      "atr14": 4.025
    },
    "avg_price": 58.84016647338867,
    "avg_volume": 10366999.9,
    "key_levels": {
      "entry": 69.6163,
      "stop": 67.7259,
      "targets": [
        71.8387,
        73.3203
      ]
    },
    "atr14": 4.025,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=PLD+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758215937256.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10051.26
  }
}
2025-09-18 10:18:57 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 17:19:01.344149', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 10:19:01 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 10:19:07 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 10:19:07 Sleeping 5m before next iteration
2025-09-18 10:24:07 === Iteration 152 ===
2025-09-18 10:24:07 venv exists
2025-09-18 10:24:07 Installing Python requirements
2025-09-18 10:24:07 shots: node_modules present
2025-09-18 10:24:07 frontend: node_modules present
2025-09-18 10:24:07 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 9.70s
2025-09-18 10:24:18 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 10:24:18 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 10:24:18 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 10:24:30 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758216280158.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9210.56
  }
}

2025-09-18 10:24:40 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758216285735.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5368
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758216294575.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8809.28
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 95,
  "sample": {
    "symbol": "DTE",
    "score": 83.38,
    "entry": 99.2035,
    "stop": 93.951,
    "targets": [
      105.1075,
      109.0435
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 145.09,
          "x2": "2025-09-15",
          "y2": 98.71,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 135.25,
          "x2": "2025-09-15",
          "y2": 94.9,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 96.805
        }
      ],
      "priceLevels": {
        "entry": 99.2035,
        "stop": 93.951,
        "targets": [
          105.1075,
          109.0435
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.39",
        "slope gap 0.0125"
      ],
      "direction": "falling",
      "atr14": 5.8479,
      "sector": "Utilities"
    },
    "avg_price": 92.20700047810872,
    "avg_volume": 21804483.5,
    "key_levels": {
      "entry": 99.2035,
      "stop": 93.951,
      "targets": [
        105.1075,
        109.0435
      ]
    },
    "atr14": 5.8479,
    "sector": "Utilities",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=DTE+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758216391854.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 23627.71
  }
}
2025-09-18 10:26:32 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 17:26:35.822941', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 10:26:35 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 10:26:41 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 10:26:41 Sleeping 5m before next iteration
2025-09-18 10:31:41 === Iteration 153 ===
2025-09-18 10:31:41 venv exists
2025-09-18 10:31:41 Installing Python requirements
2025-09-18 10:31:42 shots: node_modules present
2025-09-18 10:31:42 frontend: node_modules present
2025-09-18 10:31:42 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 8.69s
2025-09-18 10:31:52 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 10:31:52 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 10:31:52 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 10:32:05 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758216734174.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8751.28
  }
}

2025-09-18 10:32:14 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758216741105.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6635
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758216750073.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8869.81
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 143,
  "sample": {
    "symbol": "BRK-B",
    "score": 83.77,
    "entry": 28.2506,
    "stop": 26.8389,
    "targets": [
      29.9898,
      31.1494
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 55.3463,
          "x2": "2025-09-15",
          "y2": 28.11,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 52.4474,
          "x2": "2025-09-15",
          "y2": 27.11,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 27.61
        }
      ],
      "priceLevels": {
        "entry": 28.2506,
        "stop": 26.8389,
        "targets": [
          29.9898,
          31.1494
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.34",
        "slope gap 0.0026"
      ],
      "direction": "falling",
      "atr14": 1.9824
    },
    "avg_price": 30.92785790761312,
    "avg_volume": 18890132.533333335,
    "key_levels": {
      "entry": 28.2506,
      "stop": 26.8389,
      "targets": [
        29.9898,
        31.1494
      ]
    },
    "atr14": 1.9824,
    "chart_url": "https://legend-shots.onrender.com/reports/BRK-B-1758216783842.png"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758216828755.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9505.48
  }
}
2025-09-18 10:33:48 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 17:33:52.393213', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 10:33:52 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 10:33:58 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 10:33:58 Sleeping 5m before next iteration
2025-09-18 10:38:58 === Iteration 154 ===
2025-09-18 10:38:58 venv exists
2025-09-18 10:38:58 Installing Python requirements
2025-09-18 10:38:59 shots: node_modules present
2025-09-18 10:38:59 frontend: node_modules present
2025-09-18 10:38:59 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 10.87s
2025-09-18 10:39:11 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 10:39:11 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 10:39:11 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 10:39:23 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758217172558.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8936.59
  }
}

2025-09-18 10:39:32 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758217178564.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5834
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758217187473.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8782.68
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 153,
  "sample": {
    "symbol": "BA",
    "score": 87.35,
    "entry": 85.3044,
    "stop": 80.3286,
    "targets": [
      92.7324,
      97.6844
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 91.66,
          "x2": "2025-09-15",
          "y2": 84.88,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 79.28,
          "x2": "2025-09-15",
          "y2": 81.14,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 83.01
        }
      ],
      "priceLevels": {
        "entry": 85.3044,
        "stop": 80.3286,
        "targets": [
          92.7324,
          97.6844
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.30",
        "slope gap 0.0168"
      ],
      "direction": "falling",
      "atr14": 4.6057,
      "sector": "Industrials"
    },
    "avg_price": 67.07733345031738,
    "avg_volume": 13686970.966666667,
    "key_levels": {
      "entry": 85.3044,
      "stop": 80.3286,
      "targets": [
        92.7324,
        97.6844
      ]
    },
    "atr14": 4.6057,
    "sector": "Industrials",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=BA+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758217282970.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 21368.27
  }
}
2025-09-18 10:41:23 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 17:41:27.772125', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 10:41:27 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 10:41:34 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 10:41:34 Sleeping 5m before next iteration
2025-09-18 10:48:10 === Iteration 155 ===
2025-09-18 10:48:10 venv exists
2025-09-18 10:48:10 Installing Python requirements
2025-09-18 10:48:10 shots: node_modules present
2025-09-18 10:48:10 frontend: node_modules present
2025-09-18 10:48:10 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 9.18s
2025-09-18 10:50:19 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 10:50:19 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 10:50:19 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 10:50:42 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758217852963.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9535.88
  }
}

2025-09-18 10:50:53 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758217860635.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 7352
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758217869594.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8793.04
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 109,
  "sample": {
    "symbol": "TSCO",
    "score": 88.78,
    "entry": 83.1637,
    "stop": 79.7346,
    "targets": [
      87.9836,
      91.1968
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 111.318,
          "x2": "2025-09-15",
          "y2": 82.75,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 103.285,
          "x2": "2025-09-15",
          "y2": 80.54,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 81.645
        }
      ],
      "priceLevels": {
        "entry": 83.1637,
        "stop": 79.7346,
        "targets": [
          87.9836,
          91.1968
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.28",
        "slope gap 0.0030"
      ],
      "direction": "falling",
      "atr14": 4.3001,
      "sector": "Consumer Cyclical"
    },
    "avg_price": 81.55645294189453,
    "avg_volume": 71537739.9,
    "key_levels": {
      "entry": 83.1637,
      "stop": 79.7346,
      "targets": [
        87.9836,
        91.1968
      ]
    },
    "atr14": 4.3001,
    "sector": "Consumer Cyclical",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=TSCO+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758217964958.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 15692.34
  }
}
2025-09-18 10:52:45 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 17:52:49.784119', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 10:52:50 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 10:53:00 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 10:53:00 Sleeping 5m before next iteration
2025-09-18 10:58:00 === Iteration 156 ===
2025-09-18 10:58:00 venv exists
2025-09-18 10:58:00 Installing Python requirements
2025-09-18 10:58:01 shots: node_modules present
2025-09-18 10:58:01 frontend: node_modules present
2025-09-18 10:58:01 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 11.64s
2025-09-18 10:58:15 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 10:58:15 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 10:58:16 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 10:58:38 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758218328677.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9725.15
  }
}

2025-09-18 10:58:48 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758218337254.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 8363
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758218346382.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8977.87
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 71,
  "sample": {
    "symbol": "ODFL",
    "score": 88.91,
    "entry": 187.121,
    "stop": 178.0713,
    "targets": [
      201.4358,
      210.9791
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 284.7549,
          "x2": "2025-09-15",
          "y2": 186.19,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 260.8968,
          "x2": "2025-09-15",
          "y2": 179.87,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 183.03
        }
      ],
      "priceLevels": {
        "entry": 187.121,
        "stop": 178.0713,
        "targets": [
          201.4358,
          210.9791
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.26",
        "slope gap 0.0683"
      ],
      "direction": "falling",
      "atr14": 9.5991
    },
    "avg_price": 208.41739603678386,
    "avg_volume": 2936833.1,
    "key_levels": {
      "entry": 187.121,
      "stop": 178.0713,
      "targets": [
        201.4358,
        210.9791
      ]
    },
    "atr14": 9.5991,
    "chart_url": "https://legend-shots.onrender.com/reports/ODFL-1758218468155.png"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758218503353.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 21646.41
  }
}
2025-09-18 11:01:43 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 18:01:54.558020', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 11:01:55 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 11:02:30 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 11:02:30 Sleeping 5m before next iteration
2025-09-18 11:07:31 === Iteration 157 ===
2025-09-18 11:07:31 venv exists
2025-09-18 11:07:31 Installing Python requirements
2025-09-18 11:07:35 shots: node_modules present
2025-09-18 11:07:35 frontend: node_modules present
2025-09-18 11:07:35 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 28.56s
2025-09-18 11:08:10 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 11:08:10 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 11:08:10 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 11:08:46 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758218937569.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9284.77
  }
}

2025-09-18 11:08:57 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758218955371.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 17343
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758218964871.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8910.02
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 110,
  "sample": {
    "symbol": "DHI",
    "score": 89.73,
    "entry": 69.6163,
    "stop": 67.7259,
    "targets": [
      71.8387,
      73.3203
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 66.8,
          "x2": "2025-09-15",
          "y2": 69.27,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 63.096,
          "x2": "2025-09-15",
          "y2": 68.41,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 68.84
        }
      ],
      "priceLevels": {
        "entry": 69.6163,
        "stop": 67.7259,
        "targets": [
          71.8387,
          73.3203
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.23",
        "slope gap 0.0095"
      ],
      "direction": "falling",
      "atr14": 4.025,
      "sector": "Consumer Cyclical"
    },
    "avg_price": 58.84066645304362,
    "avg_volume": 10368579.633333333,
    "key_levels": {
      "entry": 69.6163,
      "stop": 67.7259,
      "targets": [
        71.8387,
        73.3203
      ]
    },
    "atr14": 4.025,
    "sector": "Consumer Cyclical",
    "chart_url": "https://legend-shots.onrender.com/reports/DHI-1758219113963.png"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758219147461.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 20254.33
  }
}
2025-09-18 11:12:27 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 18:12:40.381483', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 11:12:41 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 11:13:17 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 11:13:17 Sleeping 5m before next iteration
2025-09-18 11:18:17 === Iteration 158 ===
2025-09-18 11:18:17 venv exists
2025-09-18 11:18:17 Installing Python requirements
2025-09-18 11:18:22 shots: node_modules present
2025-09-18 11:18:22 frontend: node_modules present
2025-09-18 11:18:22 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 33.15s
2025-09-18 11:19:04 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 11:19:04 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 11:19:04 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 11:19:47 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758219598660.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9364.38
  }
}

2025-09-18 11:19:58 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758219616694.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 17648
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758219626361.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8953.41
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 103,
  "sample": {
    "symbol": "DE",
    "score": 89.73,
    "entry": 69.6163,
    "stop": 67.7259,
    "targets": [
      71.8387,
      73.3203
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 66.8,
          "x2": "2025-09-15",
          "y2": 69.27,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 63.096,
          "x2": "2025-09-15",
          "y2": 68.41,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 68.84
        }
      ],
      "priceLevels": {
        "entry": 69.6163,
        "stop": 67.7259,
        "targets": [
          71.8387,
          73.3203
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.23",
        "slope gap 0.0095"
      ],
      "direction": "falling",
      "atr14": 4.025
    },
    "avg_price": 58.84166641235352,
    "avg_volume": 10368859.366666667,
    "key_levels": {
      "entry": 69.6163,
      "stop": 67.7259,
      "targets": [
        71.8387,
        73.3203
      ]
    },
    "atr14": 4.025,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=DE+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758219901664.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 11786.59
  }
}
2025-09-18 11:25:01 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 18:25:34.317271', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 11:25:35 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (249, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (249, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 11:26:34 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 11:26:34 Sleeping 5m before next iteration
2025-09-18 11:31:34 === Iteration 159 ===
2025-09-18 11:31:34 venv exists
2025-09-18 11:31:34 Installing Python requirements
2025-09-18 11:31:39 shots: node_modules present
2025-09-18 11:31:39 frontend: node_modules present
2025-09-18 11:31:39 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

service_api.py:216
  /Users/kyleholthaus/Projects/LegendAI/service_api.py:216: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    @app.on_event("startup")

.venv/lib/python3.13/site-packages/fastapi/applications.py:4495
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/fastapi/applications.py:4495: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    return self.router.on_event(event_type)

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 4 warnings in 47.83s
2025-09-18 11:32:37 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 11:32:37 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 11:32:38 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 11:33:08 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758220399462.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9287.71
  }
}

2025-09-18 11:33:19 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758220409285.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 9881
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758220418860.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8798.49
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 93,
  "sample": {
    "symbol": "NWS",
    "score": 88.91,
    "entry": 187.121,
    "stop": 178.0713,
    "targets": [
      201.4358,
      210.9791
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 284.755,
          "x2": "2025-09-15",
          "y2": 186.19,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 260.8969,
          "x2": "2025-09-15",
          "y2": 179.87,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 183.03
        }
      ],
      "priceLevels": {
        "entry": 187.121,
        "stop": 178.0713,
        "targets": [
          201.4358,
          210.9791
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.26",
        "slope gap 0.0683"
      ],
      "direction": "falling",
      "atr14": 9.5991
    },
    "avg_price": 208.3898956298828,
    "avg_volume": 2938173.7333333334,
    "key_levels": {
      "entry": 187.121,
      "stop": 178.0713,
      "targets": [
        201.4358,
        210.9791
      ]
    },
    "atr14": 9.5991,
    "chart_url": "https://legend-shots.onrender.com/reports/NWS-1758220479640.png"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758220497258.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 16454.93
  }
}
2025-09-18 11:34:57 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 18:35:02.693471', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 11:35:03 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (249, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (249, 1) instead"
  }
]
2025-09-18 11:35:20 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 11:35:20 Sleeping 5m before next iteration
2025-09-18 11:40:20 === Iteration 160 ===
2025-09-18 11:40:20 venv exists
2025-09-18 11:40:20 Installing Python requirements
2025-09-18 11:40:21 shots: node_modules present
2025-09-18 11:40:21 frontend: node_modules present
2025-09-18 11:40:21 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

service_api.py:216
  /Users/kyleholthaus/Projects/LegendAI/service_api.py:216: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    @app.on_event("startup")

.venv/lib/python3.13/site-packages/fastapi/applications.py:4495
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/fastapi/applications.py:4495: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    return self.router.on_event(event_type)

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 4 warnings in 8.98s
2025-09-18 11:40:31 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 11:40:31 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 11:40:31 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 11:40:44 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758220857309.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 12882.73
  }
}

2025-09-18 11:40:57 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758220863809.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6638
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758220873292.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8936.24
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 117,
  "sample": {
    "symbol": "DIS",
    "score": 89.73,
    "entry": 69.6163,
    "stop": 67.7259,
    "targets": [
      71.8387,
      73.3203
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 66.8,
          "x2": "2025-09-15",
          "y2": 69.27,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 63.096,
          "x2": "2025-09-15",
          "y2": 68.41,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 68.84
        }
      ],
      "priceLevels": {
        "entry": 69.6163,
        "stop": 67.7259,
        "targets": [
          71.8387,
          73.3203
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.23",
        "slope gap 0.0095"
      ],
      "direction": "falling",
      "atr14": 4.025,
      "sector": "Communication Services"
    },
    "avg_price": 58.84069976806641,
    "avg_volume": 10369663.0,
    "key_levels": {
      "entry": 69.6163,
      "stop": 67.7259,
      "targets": [
        71.8387,
        73.3203
      ]
    },
    "atr14": 4.025,
    "sector": "Communication Services",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=DIS+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758220952773.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10071.2
  }
}
2025-09-18 11:42:32 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 18:42:36.255794', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 11:42:36 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 11:42:43 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 11:42:43 Sleeping 5m before next iteration
2025-09-18 11:47:43 === Iteration 161 ===
2025-09-18 11:47:43 venv exists
2025-09-18 11:47:43 Installing Python requirements
2025-09-18 11:47:43 shots: node_modules present
2025-09-18 11:47:43 frontend: node_modules present
2025-09-18 11:47:43 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

service_api.py:216
  /Users/kyleholthaus/Projects/LegendAI/service_api.py:216: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    @app.on_event("startup")

.venv/lib/python3.13/site-packages/fastapi/applications.py:4495
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/fastapi/applications.py:4495: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    return self.router.on_event(event_type)

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 4 warnings in 10.62s
2025-09-18 11:47:55 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 11:47:55 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 11:47:55 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 11:48:07 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758221296475.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8861.3
  }
}

2025-09-18 11:48:16 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758221302748.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6408
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758221312074.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8856.52
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 104,
  "sample": {
    "symbol": "ADI",
    "score": 77.54,
    "entry": 130.7304,
    "stop": 122.463,
    "targets": [
      137.8328,
      142.5678
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 139.0324,
          "x2": "2025-09-15",
          "y2": 130.08,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 127.195,
          "x2": "2025-09-15",
          "y2": 123.7,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 126.89
        }
      ],
      "priceLevels": {
        "entry": 130.7304,
        "stop": 122.463,
        "targets": [
          137.8328,
          142.5678
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.54",
        "slope gap 0.0027"
      ],
      "direction": "falling",
      "atr14": 7.5038
    },
    "avg_price": 116.41472676595052,
    "avg_volume": 9664711.666666666,
    "key_levels": {
      "entry": 130.7304,
      "stop": 122.463,
      "targets": [
        137.8328,
        142.5678
      ]
    },
    "atr14": 7.5038,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=ADI+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758221413253.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 27713.68
  }
}
2025-09-18 11:50:13 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 18:50:16.534406', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 11:50:16 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 11:50:22 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 11:50:22 Sleeping 5m before next iteration
2025-09-18 11:55:22 === Iteration 162 ===
2025-09-18 11:55:22 venv exists
2025-09-18 11:55:22 Installing Python requirements
2025-09-18 11:55:23 shots: node_modules present
2025-09-18 11:55:23 frontend: node_modules present
2025-09-18 11:55:23 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:28: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

service_api.py:216
  /Users/kyleholthaus/Projects/LegendAI/service_api.py:216: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    @app.on_event("startup")

.venv/lib/python3.13/site-packages/fastapi/applications.py:4495
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/fastapi/applications.py:4495: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    return self.router.on_event(event_type)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
!!!!!!!!!!!!!!!!!!!! Interrupted: 1 error during collection !!!!!!!!!!!!!!!!!!!!
3 warnings, 1 error in 1.59s
2025-09-18 11:55:26 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 11:55:26 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 11:55:26 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 11:55:38 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758221748274.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9567.31
  }
}

2025-09-18 11:55:48 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758221753870.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5811
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758221763040.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8804.79
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 100,
  "sample": {
    "symbol": "DIS",
    "score": 89.73,
    "entry": 69.6163,
    "stop": 67.7259,
    "targets": [
      71.8387,
      73.3203
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 66.8,
          "x2": "2025-09-15",
          "y2": 69.27,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 63.096,
          "x2": "2025-09-15",
          "y2": 68.41,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 68.84
        }
      ],
      "priceLevels": {
        "entry": 69.6163,
        "stop": 67.7259,
        "targets": [
          71.8387,
          73.3203
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.23",
        "slope gap 0.0095"
      ],
      "direction": "falling",
      "atr14": 4.025,
      "sector": "Communication Services"
    },
    "avg_price": 58.841366577148435,
    "avg_volume": 10370600.866666667,
    "key_levels": {
      "entry": 69.6163,
      "stop": 67.7259,
      "targets": [
        71.8387,
        73.3203
      ]
    },
    "atr14": 4.025,
    "sector": "Communication Services",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=DIS+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758221852454.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 13857.64
  }
}
2025-09-18 11:57:32 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 18:57:35.651259', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 11:57:35 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (249, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 11:57:42 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 11:57:42 Sleeping 5m before next iteration
2025-09-18 12:02:42 === Iteration 163 ===
2025-09-18 12:02:42 venv exists
2025-09-18 12:02:42 Installing Python requirements
2025-09-18 12:02:42 shots: node_modules present
2025-09-18 12:02:42 frontend: node_modules present
2025-09-18 12:02:42 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:28: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

service_api.py:216
  /Users/kyleholthaus/Projects/LegendAI/service_api.py:216: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    @app.on_event("startup")

.venv/lib/python3.13/site-packages/fastapi/applications.py:4495
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/fastapi/applications.py:4495: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    return self.router.on_event(event_type)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
!!!!!!!!!!!!!!!!!!!! Interrupted: 1 error during collection !!!!!!!!!!!!!!!!!!!!
3 warnings, 1 error in 1.57s
2025-09-18 12:02:45 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 12:02:45 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 12:02:45 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 12:02:57 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758222203072.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 24675.52
  }
}

2025-09-18 12:03:22 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758222209236.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6297
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758222218972.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9244.7
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 103,
  "sample": {
    "symbol": "AVB",
    "score": 82.61,
    "entry": 88.44,
    "stop": 83.7738,
    "targets": [
      93.1964,
      96.3673
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 121.5084,
          "x2": "2025-09-15",
          "y2": 88.0,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 113.5811,
          "x2": "2025-09-15",
          "y2": 84.62,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 86.31
        }
      ],
      "priceLevels": {
        "entry": 88.44,
        "stop": 83.7738,
        "targets": [
          93.1964,
          96.3673
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.43",
        "slope gap 0.0229"
      ],
      "direction": "falling",
      "atr14": 4.5838,
      "sector": "Real Estate"
    },
    "avg_price": 79.43213246663412,
    "avg_volume": 7668801.4,
    "key_levels": {
      "entry": 88.44,
      "stop": 83.7738,
      "targets": [
        93.1964,
        96.3673
      ]
    },
    "atr14": 4.5838,
    "sector": "Real Estate",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AVB+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30270.51
  }
}
2025-09-18 12:05:23 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 19:05:28.874170', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 12:05:28 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 12:05:35 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 12:05:35 Sleeping 5m before next iteration
2025-09-18 12:10:35 === Iteration 164 ===
2025-09-18 12:10:35 venv exists
2025-09-18 12:10:35 Installing Python requirements
2025-09-18 12:10:35 shots: node_modules present
2025-09-18 12:10:35 frontend: node_modules present
2025-09-18 12:10:35 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:28: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

service_api.py:216
  /Users/kyleholthaus/Projects/LegendAI/service_api.py:216: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    @app.on_event("startup")

.venv/lib/python3.13/site-packages/fastapi/applications.py:4495
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/fastapi/applications.py:4495: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    return self.router.on_event(event_type)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
!!!!!!!!!!!!!!!!!!!! Interrupted: 1 error during collection !!!!!!!!!!!!!!!!!!!!
3 warnings, 1 error in 1.61s
2025-09-18 12:10:38 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 12:10:38 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 12:10:38 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 12:10:51 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758222662986.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10333.93
  }
}

2025-09-18 12:11:02 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758222668913.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6233
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758222678668.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9228.87
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 98,
  "sample": {
    "symbol": "DIS",
    "score": 89.73,
    "entry": 69.6163,
    "stop": 67.7259,
    "targets": [
      71.8387,
      73.3203
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 66.8,
          "x2": "2025-09-15",
          "y2": 69.27,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 63.096,
          "x2": "2025-09-15",
          "y2": 68.41,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 68.84
        }
      ],
      "priceLevels": {
        "entry": 69.6163,
        "stop": 67.7259,
        "targets": [
          71.8387,
          73.3203
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.23",
        "slope gap 0.0095"
      ],
      "direction": "falling",
      "atr14": 4.025,
      "sector": "Communication Services"
    },
    "avg_price": 58.84249979654948,
    "avg_volume": 10371190.433333334,
    "key_levels": {
      "entry": 69.6163,
      "stop": 67.7259,
      "targets": [
        71.8387,
        73.3203
      ]
    },
    "atr14": 4.025,
    "sector": "Communication Services",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=DIS+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758222785582.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 32600.41
  }
}
2025-09-18 12:13:05 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 19:13:09.047098', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 12:13:09 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 12:13:17 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 12:13:17 Sleeping 5m before next iteration
2025-09-18 12:18:17 === Iteration 165 ===
2025-09-18 12:18:17 venv exists
2025-09-18 12:18:17 Installing Python requirements
2025-09-18 12:18:18 shots: node_modules present
2025-09-18 12:18:18 frontend: node_modules present
2025-09-18 12:18:18 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:28: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

service_api.py:216
  /Users/kyleholthaus/Projects/LegendAI/service_api.py:216: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    @app.on_event("startup")

.venv/lib/python3.13/site-packages/fastapi/applications.py:4495
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/fastapi/applications.py:4495: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    return self.router.on_event(event_type)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
!!!!!!!!!!!!!!!!!!!! Interrupted: 1 error during collection !!!!!!!!!!!!!!!!!!!!
3 warnings, 1 error in 1.78s
2025-09-18 12:18:21 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 12:18:21 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 12:18:21 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 12:18:37 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758223127670.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9592.57
  }
}

2025-09-18 12:18:47 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758223133296.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5983
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758223143263.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9304.94
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 74,
  "sample": {
    "symbol": "OTIS",
    "score": 84.74,
    "entry": 73.8976,
    "stop": 70.8939,
    "targets": [
      77.3488,
      79.6495
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 104.2589,
          "x2": "2025-09-15",
          "y2": 73.53,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 98.507,
          "x2": "2025-09-15",
          "y2": 71.61,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 72.57
        }
      ],
      "priceLevels": {
        "entry": 73.8976,
        "stop": 70.8939,
        "targets": [
          77.3488,
          79.6495
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.33",
        "slope gap 0.0001"
      ],
      "direction": "falling",
      "atr14": 4.8703,
      "sector": "Industrials"
    },
    "avg_price": 67.43056869506836,
    "avg_volume": 80238018.5,
    "key_levels": {
      "entry": 73.8976,
      "stop": 70.8939,
      "targets": [
        77.3488,
        79.6495
      ]
    },
    "atr14": 4.8703,
    "sector": "Industrials",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=OTIS+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758223250262.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 32883.88
  }
}
2025-09-18 12:20:49 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 19:20:53.683250', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 12:20:53 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (249, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 12:21:01 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 12:21:01 Sleeping 5m before next iteration
2025-09-18 12:26:01 === Iteration 166 ===
2025-09-18 12:26:01 venv exists
2025-09-18 12:26:01 Installing Python requirements
2025-09-18 12:26:02 shots: node_modules present
2025-09-18 12:26:02 frontend: node_modules present
2025-09-18 12:26:02 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:28: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

service_api.py:216
  /Users/kyleholthaus/Projects/LegendAI/service_api.py:216: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    @app.on_event("startup")

.venv/lib/python3.13/site-packages/fastapi/applications.py:4495
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/fastapi/applications.py:4495: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    return self.router.on_event(event_type)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
!!!!!!!!!!!!!!!!!!!! Interrupted: 1 error during collection !!!!!!!!!!!!!!!!!!!!
3 warnings, 1 error in 1.59s
2025-09-18 12:26:05 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 12:26:05 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 12:26:05 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 12:26:18 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758223602541.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 23825.35
  }
}

2025-09-18 12:26:42 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758223609892.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 7602
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758223620040.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9531.08
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 94,
  "sample": {
    "symbol": "DUK",
    "score": 89.73,
    "entry": 69.6163,
    "stop": 67.7259,
    "targets": [
      71.8387,
      73.3203
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 66.8,
          "x2": "2025-09-15",
          "y2": 69.27,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 63.096,
          "x2": "2025-09-15",
          "y2": 68.41,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 68.84
        }
      ],
      "priceLevels": {
        "entry": 69.6163,
        "stop": 67.7259,
        "targets": [
          71.8387,
          73.3203
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.23",
        "slope gap 0.0095"
      ],
      "direction": "falling",
      "atr14": 4.025,
      "sector": "Utilities"
    },
    "avg_price": 58.8418332417806,
    "avg_volume": 10372043.333333334,
    "key_levels": {
      "entry": 69.6163,
      "stop": 67.7259,
      "targets": [
        71.8387,
        73.3203
      ]
    },
    "atr14": 4.025,
    "sector": "Utilities",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=DUK+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30268.15
  }
}
2025-09-18 12:28:44 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 19:28:49.394221', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 12:28:49 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (249, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 12:28:56 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 12:28:56 Sleeping 5m before next iteration
2025-09-18 12:33:56 === Iteration 167 ===
2025-09-18 12:33:56 venv exists
2025-09-18 12:33:56 Installing Python requirements
2025-09-18 12:33:57 shots: node_modules present
2025-09-18 12:33:57 frontend: node_modules present
2025-09-18 12:33:57 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:28: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

service_api.py:216
  /Users/kyleholthaus/Projects/LegendAI/service_api.py:216: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    @app.on_event("startup")

.venv/lib/python3.13/site-packages/fastapi/applications.py:4495
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/fastapi/applications.py:4495: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    return self.router.on_event(event_type)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
!!!!!!!!!!!!!!!!!!!! Interrupted: 1 error during collection !!!!!!!!!!!!!!!!!!!!
3 warnings, 1 error in 1.59s
2025-09-18 12:34:00 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 12:34:00 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 12:34:00 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 12:34:13 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758224064046.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10382.82
  }
}

2025-09-18 12:34:23 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758224069651.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5977
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758224080255.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9919.97
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 93,
  "sample": {
    "symbol": "ORCL",
    "score": 88.78,
    "entry": 83.1637,
    "stop": 79.7346,
    "targets": [
      87.9836,
      91.1968
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 111.318,
          "x2": "2025-09-15",
          "y2": 82.75,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 103.285,
          "x2": "2025-09-15",
          "y2": 80.54,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 81.645
        }
      ],
      "priceLevels": {
        "entry": 83.1637,
        "stop": 79.7346,
        "targets": [
          87.9836,
          91.1968
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.28",
        "slope gap 0.0030"
      ],
      "direction": "falling",
      "atr14": 4.3001,
      "sector": "Technology"
    },
    "avg_price": 81.55371907552083,
    "avg_volume": 71593344.9,
    "key_levels": {
      "entry": 83.1637,
      "stop": 79.7346,
      "targets": [
        87.9836,
        91.1968
      ]
    },
    "atr14": 4.3001,
    "sector": "Technology",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=ORCL+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30309.91
  }
}
2025-09-18 12:36:24 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 19:36:27.925331', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 12:36:28 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (249, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (249, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 12:36:34 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 12:36:34 Sleeping 5m before next iteration
2025-09-18 12:41:34 === Iteration 168 ===
2025-09-18 12:41:34 venv exists
2025-09-18 12:41:34 Installing Python requirements
2025-09-18 12:41:35 shots: node_modules present
2025-09-18 12:41:35 frontend: node_modules present
2025-09-18 12:41:35 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:28: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

service_api.py:216
  /Users/kyleholthaus/Projects/LegendAI/service_api.py:216: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    @app.on_event("startup")

.venv/lib/python3.13/site-packages/fastapi/applications.py:4495
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/fastapi/applications.py:4495: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    return self.router.on_event(event_type)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
!!!!!!!!!!!!!!!!!!!! Interrupted: 1 error during collection !!!!!!!!!!!!!!!!!!!!
3 warnings, 1 error in 1.63s
2025-09-18 12:41:38 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 12:41:38 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 12:41:38 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 12:41:50 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758224522021.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10506.03
  }
}

2025-09-18 12:42:01 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758224527487.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5801
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758224538151.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10008.46
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 126,
  "sample": {
    "symbol": "NCLH",
    "score": 88.78,
    "entry": 83.1637,
    "stop": 79.7346,
    "targets": [
      87.9836,
      91.1968
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 111.318,
          "x2": "2025-09-15",
          "y2": 82.75,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 103.285,
          "x2": "2025-09-15",
          "y2": 80.54,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 81.645
        }
      ],
      "priceLevels": {
        "entry": 83.1637,
        "stop": 79.7346,
        "targets": [
          87.9836,
          91.1968
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.28",
        "slope gap 0.0030"
      ],
      "direction": "falling",
      "atr14": 4.3001
    },
    "avg_price": 81.5546490987142,
    "avg_volume": 71599040.76666667,
    "key_levels": {
      "entry": 83.1637,
      "stop": 79.7346,
      "targets": [
        87.9836,
        91.1968
      ]
    },
    "atr14": 4.3001,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=NCLH+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30246.46
  }
}
2025-09-18 12:44:01 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 19:44:05.717752', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 12:44:05 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (249, 1) instead"
  }
]
2025-09-18 12:44:13 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 12:44:13 Sleeping 5m before next iteration
2025-09-18 12:49:13 === Iteration 169 ===
2025-09-18 12:49:13 venv exists
2025-09-18 12:49:13 Installing Python requirements
2025-09-18 12:49:14 shots: node_modules present
2025-09-18 12:49:14 frontend: node_modules present
2025-09-18 12:49:14 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:28: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

service_api.py:216
  /Users/kyleholthaus/Projects/LegendAI/service_api.py:216: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    @app.on_event("startup")

.venv/lib/python3.13/site-packages/fastapi/applications.py:4495
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/fastapi/applications.py:4495: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    return self.router.on_event(event_type)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
!!!!!!!!!!!!!!!!!!!! Interrupted: 1 error during collection !!!!!!!!!!!!!!!!!!!!
3 warnings, 1 error in 1.56s
2025-09-18 12:49:17 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 12:49:17 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 12:49:17 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 12:49:29 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758224981169.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 11097.31
  }
}

2025-09-18 12:49:40 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758224987779.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5553
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758224999035.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10670.46
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 97,
  "sample": {
    "symbol": "ON",
    "score": 84.74,
    "entry": 73.8976,
    "stop": 70.8939,
    "targets": [
      77.3488,
      79.6495
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 104.2589,
          "x2": "2025-09-15",
          "y2": 73.53,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 98.507,
          "x2": "2025-09-15",
          "y2": 71.61,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 72.57
        }
      ],
      "priceLevels": {
        "entry": 73.8976,
        "stop": 70.8939,
        "targets": [
          77.3488,
          79.6495
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.33",
        "slope gap 0.0001"
      ],
      "direction": "falling",
      "atr14": 4.8703,
      "sector": "Technology"
    },
    "avg_price": 67.43056869506836,
    "avg_volume": 80272285.4,
    "key_levels": {
      "entry": 73.8976,
      "stop": 70.8939,
      "targets": [
        77.3488,
        79.6495
      ]
    },
    "atr14": 4.8703,
    "sector": "Technology",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=ON+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758225109347.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 36580.92
  }
}
2025-09-18 12:51:48 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 19:51:52.622285', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 12:51:52 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (249, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (249, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 12:51:58 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 12:51:58 Sleeping 5m before next iteration
2025-09-18 12:56:58 === Iteration 170 ===
2025-09-18 12:56:58 venv exists
2025-09-18 12:56:58 Installing Python requirements
2025-09-18 12:56:59 shots: node_modules present
2025-09-18 12:56:59 frontend: node_modules present
2025-09-18 12:56:59 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:28: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

service_api.py:216
  /Users/kyleholthaus/Projects/LegendAI/service_api.py:216: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    @app.on_event("startup")

.venv/lib/python3.13/site-packages/fastapi/applications.py:4495
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/fastapi/applications.py:4495: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    return self.router.on_event(event_type)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
!!!!!!!!!!!!!!!!!!!! Interrupted: 1 error during collection !!!!!!!!!!!!!!!!!!!!
3 warnings, 1 error in 1.63s
2025-09-18 12:57:02 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 12:57:02 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 12:57:02 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 12:57:14 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758225445835.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10205.85
  }
}

2025-09-18 12:57:25 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758225455920.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 10459
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758225466034.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9174.3
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 139,
  "sample": {
    "symbol": "DIS",
    "score": 89.73,
    "entry": 69.6163,
    "stop": 67.7259,
    "targets": [
      71.8387,
      73.3203
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 66.8,
          "x2": "2025-09-15",
          "y2": 69.27,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 63.096,
          "x2": "2025-09-15",
          "y2": 68.41,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 68.84
        }
      ],
      "priceLevels": {
        "entry": 69.6163,
        "stop": 67.7259,
        "targets": [
          71.8387,
          73.3203
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.23",
        "slope gap 0.0095"
      ],
      "direction": "falling",
      "atr14": 4.025,
      "sector": "Communication Services"
    },
    "avg_price": 58.84149983723958,
    "avg_volume": 10376790.6,
    "key_levels": {
      "entry": 69.6163,
      "stop": 67.7259,
      "targets": [
        71.8387,
        73.3203
      ]
    },
    "atr14": 4.025,
    "sector": "Communication Services",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=DIS+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758225564547.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 23578.87
  }
}
2025-09-18 12:59:24 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 19:59:28.071140', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 12:59:28 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (249, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (249, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (249, 1) instead"
  }
]
2025-09-18 12:59:35 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 12:59:35 Sleeping 5m before next iteration
2025-09-18 13:04:35 === Iteration 171 ===
2025-09-18 13:04:35 venv exists
2025-09-18 13:04:35 Installing Python requirements
2025-09-18 13:04:37 shots: node_modules present
2025-09-18 13:04:37 frontend: node_modules present
2025-09-18 13:04:37 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:28: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

service_api.py:216
  /Users/kyleholthaus/Projects/LegendAI/service_api.py:216: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    @app.on_event("startup")

.venv/lib/python3.13/site-packages/fastapi/applications.py:4495
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/fastapi/applications.py:4495: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    return self.router.on_event(event_type)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
!!!!!!!!!!!!!!!!!!!! Interrupted: 1 error during collection !!!!!!!!!!!!!!!!!!!!
3 warnings, 1 error in 1.79s
2025-09-18 13:04:40 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 13:04:40 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 13:04:40 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 13:04:56 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758225906349.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9338.01
  }
}

2025-09-18 13:05:06 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758225914349.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 7634
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758225923948.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9477.39
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 122,
  "sample": {
    "symbol": "PG",
    "score": 84.74,
    "entry": 73.8976,
    "stop": 70.8939,
    "targets": [
      77.3488,
      79.6495
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 104.2589,
          "x2": "2025-09-15",
          "y2": 73.53,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 98.507,
          "x2": "2025-09-15",
          "y2": 71.61,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 72.57
        }
      ],
      "priceLevels": {
        "entry": 73.8976,
        "stop": 70.8939,
        "targets": [
          77.3488,
          79.6495
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.33",
        "slope gap 0.0001"
      ],
      "direction": "falling",
      "atr14": 4.8703
    },
    "avg_price": 67.43873558044433,
    "avg_volume": 80322481.63333334,
    "key_levels": {
      "entry": 73.8976,
      "stop": 70.8939,
      "targets": [
        77.3488,
        79.6495
      ]
    },
    "atr14": 4.8703,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=PG+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30405.85
  }
}
2025-09-18 13:07:10 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 20:07:16.580693', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 13:07:16 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 13:07:26 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 13:07:26 Sleeping 5m before next iteration
2025-09-18 13:12:26 === Iteration 172 ===
2025-09-18 13:12:26 venv exists
2025-09-18 13:12:26 Installing Python requirements
2025-09-18 13:12:26 shots: node_modules present
2025-09-18 13:12:26 frontend: node_modules present
2025-09-18 13:12:26 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:28: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

service_api.py:216
  /Users/kyleholthaus/Projects/LegendAI/service_api.py:216: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    @app.on_event("startup")

.venv/lib/python3.13/site-packages/fastapi/applications.py:4495
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/fastapi/applications.py:4495: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    return self.router.on_event(event_type)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
!!!!!!!!!!!!!!!!!!!! Interrupted: 1 error during collection !!!!!!!!!!!!!!!!!!!!
3 warnings, 1 error in 1.80s
2025-09-18 13:12:29 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 13:12:29 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 13:12:30 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 13:12:49 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758226379647.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10186.48
  }
}

2025-09-18 13:12:59 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758226386256.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6528
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758226395446.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8999.24
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 89,
  "sample": {
    "symbol": "EG",
    "score": 84.52,
    "entry": 107.8013,
    "stop": 102.3066,
    "targets": [
      114.0164,
      118.1598
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 136.2477,
          "x2": "2025-09-15",
          "y2": 107.265,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 125.8891,
          "x2": "2025-09-15",
          "y2": 103.34,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 105.3025
        }
      ],
      "priceLevels": {
        "entry": 107.8013,
        "stop": 102.3066,
        "targets": [
          114.0164,
          118.1598
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.38",
        "slope gap 0.0480"
      ],
      "direction": "falling",
      "atr14": 5.4615
    },
    "avg_price": 100.3036710103353,
    "avg_volume": 18085757.866666667,
    "key_levels": {
      "entry": 107.8013,
      "stop": 102.3066,
      "targets": [
        114.0164,
        118.1598
      ]
    },
    "atr14": 5.4615,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=EG+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758226489242.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 19636.18
  }
}
2025-09-18 13:14:49 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 20:14:52.901546', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 13:14:53 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 13:14:58 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 13:14:58 Sleeping 5m before next iteration
2025-09-18 13:19:58 === Iteration 173 ===
2025-09-18 13:19:58 venv exists
2025-09-18 13:19:58 Installing Python requirements
2025-09-18 13:20:00 shots: node_modules present
2025-09-18 13:20:00 frontend: node_modules present
2025-09-18 13:20:00 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:28: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

service_api.py:216
  /Users/kyleholthaus/Projects/LegendAI/service_api.py:216: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    @app.on_event("startup")

.venv/lib/python3.13/site-packages/fastapi/applications.py:4495
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/fastapi/applications.py:4495: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    return self.router.on_event(event_type)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
!!!!!!!!!!!!!!!!!!!! Interrupted: 1 error during collection !!!!!!!!!!!!!!!!!!!!
3 warnings, 1 error in 2.03s
2025-09-18 13:20:04 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 13:20:04 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 13:20:04 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 13:20:18 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758226828229.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9601.87
  }
}

2025-09-18 13:20:28 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758226834462.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5925
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758226843545.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8978.26
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 79,
  "sample": {
    "symbol": "MRNA",
    "score": 88.44,
    "entry": 187.121,
    "stop": 177.804,
    "targets": [
      201.4358,
      210.9791
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 284.755,
          "x2": "2025-09-15",
          "y2": 186.19,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 260.8969,
          "x2": "2025-09-15",
          "y2": 179.6,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 182.895
        }
      ],
      "priceLevels": {
        "entry": 187.121,
        "stop": 177.804,
        "targets": [
          201.4358,
          210.9791
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.28",
        "slope gap 0.0681"
      ],
      "direction": "falling",
      "atr14": 9.6184
    },
    "avg_price": 208.36139628092448,
    "avg_volume": 2949403.8333333335,
    "key_levels": {
      "entry": 187.121,
      "stop": 177.804,
      "targets": [
        201.4358,
        210.9791
      ]
    },
    "atr14": 9.6184,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=MRNA+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30240.57
  }
}
2025-09-18 13:22:27 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 20:22:31.365291', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 13:22:31 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 13:22:38 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 13:22:38 Sleeping 5m before next iteration
2025-09-18 13:27:38 === Iteration 174 ===
2025-09-18 13:27:38 venv exists
2025-09-18 13:27:38 Installing Python requirements
2025-09-18 13:27:38 shots: node_modules present
2025-09-18 13:27:38 frontend: node_modules present
2025-09-18 13:27:38 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:28: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

service_api.py:216
  /Users/kyleholthaus/Projects/LegendAI/service_api.py:216: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    @app.on_event("startup")

.venv/lib/python3.13/site-packages/fastapi/applications.py:4495
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/fastapi/applications.py:4495: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    return self.router.on_event(event_type)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
!!!!!!!!!!!!!!!!!!!! Interrupted: 1 error during collection !!!!!!!!!!!!!!!!!!!!
3 warnings, 1 error in 3.63s
2025-09-18 13:27:44 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 13:27:44 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 13:27:45 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 13:27:58 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758227287959.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9043.29
  }
}

2025-09-18 13:28:08 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758227294325.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6160
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758227303444.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8984.46
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 109,
  "sample": {
    "symbol": "DVA",
    "score": 89.73,
    "entry": 69.6163,
    "stop": 67.7259,
    "targets": [
      71.8387,
      73.3203
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 66.8,
          "x2": "2025-09-15",
          "y2": 69.27,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 63.096,
          "x2": "2025-09-15",
          "y2": 68.41,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 68.84
        }
      ],
      "priceLevels": {
        "entry": 69.6163,
        "stop": 67.7259,
        "targets": [
          71.8387,
          73.3203
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.23",
        "slope gap 0.0095"
      ],
      "direction": "falling",
      "atr14": 4.025,
      "sector": "Healthcare"
    },
    "avg_price": 58.84266637166341,
    "avg_volume": 10378986.166666666,
    "key_levels": {
      "entry": 69.6163,
      "stop": 67.7259,
      "targets": [
        71.8387,
        73.3203
      ]
    },
    "atr14": 4.025,
    "sector": "Healthcare",
    "chart_url": "https://legend-shots.onrender.com/reports/DVA-1758227342334.png"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758227375440.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9935.48
  }
}
2025-09-18 13:29:35 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 20:29:39.738635', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 13:29:39 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 13:29:50 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 13:29:50 Sleeping 5m before next iteration
2025-09-18 13:34:50 === Iteration 175 ===
2025-09-18 13:34:50 venv exists
2025-09-18 13:34:50 Installing Python requirements
2025-09-18 13:34:52 shots: node_modules present
2025-09-18 13:34:52 frontend: node_modules present
2025-09-18 13:34:52 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:28: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

service_api.py:217
  /Users/kyleholthaus/Projects/LegendAI/service_api.py:217: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    @app.on_event("startup")

.venv/lib/python3.13/site-packages/fastapi/applications.py:4495
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/fastapi/applications.py:4495: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    return self.router.on_event(event_type)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
!!!!!!!!!!!!!!!!!!!! Interrupted: 1 error during collection !!!!!!!!!!!!!!!!!!!!
3 warnings, 1 error in 1.86s
2025-09-18 13:34:55 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 13:34:55 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 13:34:55 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 13:35:10 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758227720343.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9097.73
  }
}

2025-09-18 13:35:20 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758227727227.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6404
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758227736542.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8967.1
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 112,
  "sample": {
    "symbol": "NI",
    "score": 88.78,
    "entry": 83.1637,
    "stop": 79.7346,
    "targets": [
      87.9836,
      91.1968
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 111.318,
          "x2": "2025-09-15",
          "y2": 82.75,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 103.285,
          "x2": "2025-09-15",
          "y2": 80.54,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 81.645
        }
      ],
      "priceLevels": {
        "entry": 83.1637,
        "stop": 79.7346,
        "targets": [
          87.9836,
          91.1968
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.28",
        "slope gap 0.0030"
      ],
      "direction": "falling",
      "atr14": 4.3001
    },
    "avg_price": 81.5598856608073,
    "avg_volume": 71628806.3,
    "key_levels": {
      "entry": 83.1637,
      "stop": 79.7346,
      "targets": [
        87.9836,
        91.1968
      ]
    },
    "atr14": 4.3001,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=NI+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758227828838.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 16499.62
  }
}
2025-09-18 13:37:08 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 20:37:12.525024', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 13:37:12 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 13:37:19 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 13:37:19 Sleeping 5m before next iteration
2025-09-18 13:42:19 === Iteration 176 ===
2025-09-18 13:42:19 venv exists
2025-09-18 13:42:19 Installing Python requirements
2025-09-18 13:42:19 shots: node_modules present
2025-09-18 13:42:19 frontend: node_modules present
2025-09-18 13:42:19 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:28: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

service_api.py:217
  /Users/kyleholthaus/Projects/LegendAI/service_api.py:217: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    @app.on_event("startup")

.venv/lib/python3.13/site-packages/fastapi/applications.py:4495
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/fastapi/applications.py:4495: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    return self.router.on_event(event_type)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
!!!!!!!!!!!!!!!!!!!! Interrupted: 1 error during collection !!!!!!!!!!!!!!!!!!!!
3 warnings, 1 error in 1.62s
2025-09-18 13:42:22 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 13:42:22 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 13:42:22 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 13:42:36 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758228167025.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10882.46
  }
}

2025-09-18 13:42:47 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758228174053.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6821
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758228183825.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9698.3
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 79,
  "sample": {
    "symbol": "MSCI",
    "score": 88.44,
    "entry": 187.121,
    "stop": 177.804,
    "targets": [
      201.4358,
      210.9791
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 284.755,
          "x2": "2025-09-15",
          "y2": 186.19,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 260.8969,
          "x2": "2025-09-15",
          "y2": 179.6,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 182.895
        }
      ],
      "priceLevels": {
        "entry": 187.121,
        "stop": 177.804,
        "targets": [
          201.4358,
          210.9791
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.28",
        "slope gap 0.0681"
      ],
      "direction": "falling",
      "atr14": 9.6184,
      "sector": "Financial Services"
    },
    "avg_price": 208.36139628092448,
    "avg_volume": 2949403.8333333335,
    "key_levels": {
      "entry": 187.121,
      "stop": 177.804,
      "targets": [
        201.4358,
        210.9791
      ]
    },
    "atr14": 9.6184,
    "sector": "Financial Services",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=MSCI+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758228296852.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 38731.85
  }
}
2025-09-18 13:44:56 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 20:45:00.623243', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 13:45:00 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 13:45:07 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 13:45:07 Sleeping 5m before next iteration
2025-09-18 13:50:07 === Iteration 177 ===
2025-09-18 13:50:07 venv exists
2025-09-18 13:50:07 Installing Python requirements
2025-09-18 13:50:07 shots: node_modules present
2025-09-18 13:50:07 frontend: node_modules present
2025-09-18 13:50:07 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:28: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

service_api.py:217
  /Users/kyleholthaus/Projects/LegendAI/service_api.py:217: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    @app.on_event("startup")

.venv/lib/python3.13/site-packages/fastapi/applications.py:4495
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/fastapi/applications.py:4495: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    return self.router.on_event(event_type)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
!!!!!!!!!!!!!!!!!!!! Interrupted: 1 error during collection !!!!!!!!!!!!!!!!!!!!
3 warnings, 1 error in 1.72s
2025-09-18 13:50:11 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 13:50:11 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 13:50:11 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 13:50:23 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758228635439.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 11584.58
  }
}

2025-09-18 13:50:35 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758228641956.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6250
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758228653126.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 11268.58
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 92,
  "sample": {
    "symbol": "ATO",
    "score": 85.14,
    "entry": 85.9878,
    "stop": 80.3286,
    "targets": [
      93.4158,
      98.3678
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 91.66,
          "x2": "2025-09-15",
          "y2": 85.56,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 79.28,
          "x2": "2025-09-15",
          "y2": 81.14,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 83.35
        }
      ],
      "priceLevels": {
        "entry": 85.9878,
        "stop": 80.3286,
        "targets": [
          93.4158,
          98.3678
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.36",
        "slope gap 0.0163"
      ],
      "direction": "falling",
      "atr14": 4.6543,
      "sector": "Utilities"
    },
    "avg_price": 67.09366696675619,
    "avg_volume": 13721236.566666666,
    "key_levels": {
      "entry": 85.9878,
      "stop": 80.3286,
      "targets": [
        93.4158,
        98.3678
      ]
    },
    "atr14": 4.6543,
    "sector": "Utilities",
    "chart_url": "https://legend-shots.onrender.com/reports/ATO-1758228691828.png"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758228734437.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 23094.34
  }
}
2025-09-18 13:52:14 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 20:52:18.239302', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 13:52:18 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 13:52:25 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 13:52:25 Sleeping 5m before next iteration
2025-09-18 14:14:14 === Iteration 178 ===
2025-09-18 14:14:14 venv exists
2025-09-18 14:14:14 Installing Python requirements
2025-09-18 14:14:14 shots: node_modules present
2025-09-18 14:14:14 frontend: node_modules present
2025-09-18 14:14:14 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:28: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

service_api.py:217
  /Users/kyleholthaus/Projects/LegendAI/service_api.py:217: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    @app.on_event("startup")

.venv/lib/python3.13/site-packages/fastapi/applications.py:4495
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/fastapi/applications.py:4495: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    return self.router.on_event(event_type)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
!!!!!!!!!!!!!!!!!!!! Interrupted: 1 error during collection !!!!!!!!!!!!!!!!!!!!
3 warnings, 1 error in 2.30s
2025-09-18 14:14:18 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 14:14:18 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 14:14:18 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 14:14:31 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758230081248.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9307.84
  }
}

2025-09-18 14:14:41 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758230087167.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5759
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758230097315.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10119.95
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 129,
  "sample": {
    "symbol": "CARR",
    "score": 82.7,
    "entry": 19.4367,
    "stop": 18.4635,
    "targets": [
      20.4152,
      21.0676
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 27.1964,
          "x2": "2025-09-15",
          "y2": 19.34,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 25.5656,
          "x2": "2025-09-15",
          "y2": 18.65,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 18.995
        }
      ],
      "priceLevels": {
        "entry": 19.4367,
        "stop": 18.4635,
        "targets": [
          20.4152,
          21.0676
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.42",
        "slope gap 0.0009"
      ],
      "direction": "falling",
      "atr14": 1.0326
    },
    "avg_price": 21.7514092763265,
    "avg_volume": 41686782.8,
    "key_levels": {
      "entry": 19.4367,
      "stop": 18.4635,
      "targets": [
        20.4152,
        21.0676
      ]
    },
    "atr14": 1.0326,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=CARR+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758230212243.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 39821.11
  }
}
2025-09-18 14:16:52 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 21:16:55.898325', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 14:16:55 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 14:17:04 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 14:17:04 Sleeping 5m before next iteration
2025-09-18 14:22:04 === Iteration 179 ===
2025-09-18 14:22:04 venv exists
2025-09-18 14:22:04 Installing Python requirements
2025-09-18 14:22:05 shots: node_modules present
2025-09-18 14:22:05 frontend: node_modules present
2025-09-18 14:22:05 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:28: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

service_api.py:217
  /Users/kyleholthaus/Projects/LegendAI/service_api.py:217: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    @app.on_event("startup")

.venv/lib/python3.13/site-packages/fastapi/applications.py:4495
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/fastapi/applications.py:4495: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    return self.router.on_event(event_type)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
!!!!!!!!!!!!!!!!!!!! Interrupted: 1 error during collection !!!!!!!!!!!!!!!!!!!!
3 warnings, 1 error in 1.69s
2025-09-18 14:22:08 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 14:22:08 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 14:22:08 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 14:22:19 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758230549330.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9879.95
  }
}

2025-09-18 14:22:29 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758230554419.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 4973
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758230563646.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9153.99
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 131,
  "sample": {
    "symbol": "MS",
    "score": 77.86,
    "entry": 187.0104,
    "stop": 177.0912,
    "targets": [
      194.6881,
      199.8066
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 156.3973,
          "x2": "2025-09-15",
          "y2": 186.08,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 143.601,
          "x2": "2025-09-15",
          "y2": 178.88,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 182.48
        }
      ],
      "priceLevels": {
        "entry": 187.0104,
        "stop": 177.0912,
        "targets": [
          194.6881,
          199.8066
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.56",
        "slope gap 0.0132"
      ],
      "direction": "falling",
      "atr14": 8.6737,
      "sector": "Financial Services"
    },
    "avg_price": 157.52360305786132,
    "avg_volume": 11881996.8,
    "key_levels": {
      "entry": 187.0104,
      "stop": 177.0912,
      "targets": [
        194.6881,
        199.8066
      ]
    },
    "atr14": 8.6737,
    "sector": "Financial Services",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=MS+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758230673842.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 36449.38
  }
}
2025-09-18 14:24:33 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 21:24:37.386964', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 14:24:37 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 14:24:43 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 14:24:43 Sleeping 5m before next iteration
2025-09-18 14:30:51 === Iteration 180 ===
2025-09-18 14:30:51 venv exists
2025-09-18 14:30:51 Installing Python requirements
2025-09-18 14:30:52 shots: node_modules present
2025-09-18 14:30:52 frontend: node_modules present
2025-09-18 14:30:52 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:28: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

service_api.py:217
  /Users/kyleholthaus/Projects/LegendAI/service_api.py:217: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    @app.on_event("startup")

.venv/lib/python3.13/site-packages/fastapi/applications.py:4495
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/fastapi/applications.py:4495: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    return self.router.on_event(event_type)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
!!!!!!!!!!!!!!!!!!!! Interrupted: 1 error during collection !!!!!!!!!!!!!!!!!!!!
3 warnings, 1 error in 1.51s
2025-09-18 14:30:54 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 14:30:54 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 14:30:54 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 14:31:06 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758231076265.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9726.95
  }
}

2025-09-18 14:31:16 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758231081544.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5144
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758231090542.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8936.68
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 66,
  "sample": {
    "symbol": "BXP",
    "score": 83.77,
    "entry": 28.2506,
    "stop": 26.8389,
    "targets": [
      29.9898,
      31.1494
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 55.3463,
          "x2": "2025-09-15",
          "y2": 28.11,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 52.4474,
          "x2": "2025-09-15",
          "y2": 27.11,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 27.61
        }
      ],
      "priceLevels": {
        "entry": 28.2506,
        "stop": 26.8389,
        "targets": [
          29.9898,
          31.1494
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.34",
        "slope gap 0.0026"
      ],
      "direction": "falling",
      "atr14": 1.9824
    },
    "avg_price": 30.927191098531086,
    "avg_volume": 18948695.1,
    "key_levels": {
      "entry": 28.2506,
      "stop": 26.8389,
      "targets": [
        29.9898,
        31.1494
      ]
    },
    "atr14": 1.9824,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=BXP+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758231181456.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 16653.04
  }
}
2025-09-18 14:33:01 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 21:33:05.136996', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 14:33:05 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 14:33:10 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 14:33:10 Sleeping 5m before next iteration
2025-09-18 14:38:10 === Iteration 181 ===
2025-09-18 14:38:10 venv exists
2025-09-18 14:38:10 Installing Python requirements
2025-09-18 14:38:11 shots: node_modules present
2025-09-18 14:38:11 frontend: node_modules present
2025-09-18 14:38:11 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:28: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

service_api.py:217
  /Users/kyleholthaus/Projects/LegendAI/service_api.py:217: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    @app.on_event("startup")

.venv/lib/python3.13/site-packages/fastapi/applications.py:4495
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/fastapi/applications.py:4495: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    return self.router.on_event(event_type)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
!!!!!!!!!!!!!!!!!!!! Interrupted: 1 error during collection !!!!!!!!!!!!!!!!!!!!
3 warnings, 1 error in 1.49s
2025-09-18 14:38:13 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 14:38:13 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 14:38:13 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 14:38:25 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758231514743.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9290.32
  }
}

2025-09-18 14:38:34 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758231519431.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 4538
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758231528641.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9185.39
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 73,
  "sample": {
    "symbol": "ATO",
    "score": 85.14,
    "entry": 85.9878,
    "stop": 80.3286,
    "targets": [
      93.4158,
      98.3678
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 91.66,
          "x2": "2025-09-15",
          "y2": 85.56,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 79.28,
          "x2": "2025-09-15",
          "y2": 81.14,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 83.35
        }
      ],
      "priceLevels": {
        "entry": 85.9878,
        "stop": 80.3286,
        "targets": [
          93.4158,
          98.3678
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.36",
        "slope gap 0.0163"
      ],
      "direction": "falling",
      "atr14": 4.6543,
      "sector": "Utilities"
    },
    "avg_price": 67.09366696675619,
    "avg_volume": 13734938.533333333,
    "key_levels": {
      "entry": 85.9878,
      "stop": 80.3286,
      "targets": [
        93.4158,
        98.3678
      ]
    },
    "atr14": 4.6543,
    "sector": "Utilities",
    "chart_url": "https://legend-shots.onrender.com/reports/ATO-1758231590421.png"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758231636236.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 32553.28
  }
}
2025-09-18 14:40:36 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 21:40:39.922629', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 14:40:40 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 14:40:49 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 14:40:49 Sleeping 5m before next iteration
2025-09-18 14:45:50 === Iteration 182 ===
2025-09-18 14:45:50 venv exists
2025-09-18 14:45:50 Installing Python requirements
2025-09-18 14:45:50 shots: node_modules present
2025-09-18 14:45:50 frontend: node_modules present
2025-09-18 14:45:50 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:28: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

service_api.py:217
  /Users/kyleholthaus/Projects/LegendAI/service_api.py:217: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    @app.on_event("startup")

.venv/lib/python3.13/site-packages/fastapi/applications.py:4495
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/fastapi/applications.py:4495: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    return self.router.on_event(event_type)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
!!!!!!!!!!!!!!!!!!!! Interrupted: 1 error during collection !!!!!!!!!!!!!!!!!!!!
3 warnings, 1 error in 1.60s
2025-09-18 14:45:53 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 14:45:53 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 14:45:53 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 14:46:04 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758231974439.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9755.84
  }
}

2025-09-18 14:46:14 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758231979781.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5104
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758231988655.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8834.09
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 143,
  "sample": {
    "symbol": "PCAR",
    "score": 84.74,
    "entry": 73.8976,
    "stop": 70.8939,
    "targets": [
      77.3488,
      79.6495
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 104.2589,
          "x2": "2025-09-15",
          "y2": 73.53,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 98.507,
          "x2": "2025-09-15",
          "y2": 71.61,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 72.57
        }
      ],
      "priceLevels": {
        "entry": 73.8976,
        "stop": 70.8939,
        "targets": [
          77.3488,
          79.6495
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.33",
        "slope gap 0.0001"
      ],
      "direction": "falling",
      "atr14": 4.8703,
      "sector": "Industrials"
    },
    "avg_price": 67.43940200805665,
    "avg_volume": 80431000.46666667,
    "key_levels": {
      "entry": 73.8976,
      "stop": 70.8939,
      "targets": [
        77.3488,
        79.6495
      ]
    },
    "atr14": 4.8703,
    "sector": "Industrials",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=PCAR+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30271.5
  }
}
2025-09-18 14:48:12 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 21:48:16.624944', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 14:48:16 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 14:48:22 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 14:48:22 Sleeping 5m before next iteration
2025-09-18 14:53:22 === Iteration 183 ===
2025-09-18 14:53:22 venv exists
2025-09-18 14:53:22 Installing Python requirements
2025-09-18 14:53:22 shots: node_modules present
2025-09-18 14:53:22 frontend: node_modules present
2025-09-18 14:53:22 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:28: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

service_api.py:217
  /Users/kyleholthaus/Projects/LegendAI/service_api.py:217: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    @app.on_event("startup")

.venv/lib/python3.13/site-packages/fastapi/applications.py:4495
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/fastapi/applications.py:4495: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    return self.router.on_event(event_type)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
!!!!!!!!!!!!!!!!!!!! Interrupted: 1 error during collection !!!!!!!!!!!!!!!!!!!!
3 warnings, 1 error in 1.51s
2025-09-18 14:53:25 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 14:53:25 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 14:53:25 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 14:53:36 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758232426322.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10150.69
  }
}

2025-09-18 14:53:46 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758232431434.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 4939
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758232440338.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8906.53
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 60,
  "sample": {
    "symbol": "DOC",
    "score": 84.52,
    "entry": 107.8013,
    "stop": 102.3066,
    "targets": [
      114.0164,
      118.1598
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 136.2477,
          "x2": "2025-09-15",
          "y2": 107.265,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 125.8892,
          "x2": "2025-09-15",
          "y2": 103.34,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 105.3025
        }
      ],
      "priceLevels": {
        "entry": 107.8013,
        "stop": 102.3066,
        "targets": [
          114.0164,
          118.1598
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.38",
        "slope gap 0.0480"
      ],
      "direction": "falling",
      "atr14": 5.4615,
      "sector": "Real Estate"
    },
    "avg_price": 100.3036710103353,
    "avg_volume": 18085757.866666667,
    "key_levels": {
      "entry": 107.8013,
      "stop": 102.3066,
      "targets": [
        114.0164,
        118.1598
      ]
    },
    "atr14": 5.4615,
    "sector": "Real Estate",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=DOC+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758232533651.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 18309.61
  }
}
2025-09-18 14:55:34 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 21:55:37.597455', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 14:55:37 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 14:55:43 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 14:55:43 Sleeping 5m before next iteration
2025-09-18 15:00:44 === Iteration 184 ===
2025-09-18 15:00:44 venv exists
2025-09-18 15:00:44 Installing Python requirements
2025-09-18 15:00:44 shots: node_modules present
2025-09-18 15:00:44 frontend: node_modules present
2025-09-18 15:00:44 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:28: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

service_api.py:217
  /Users/kyleholthaus/Projects/LegendAI/service_api.py:217: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    @app.on_event("startup")

.venv/lib/python3.13/site-packages/fastapi/applications.py:4495
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/fastapi/applications.py:4495: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    return self.router.on_event(event_type)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
!!!!!!!!!!!!!!!!!!!! Interrupted: 1 error during collection !!!!!!!!!!!!!!!!!!!!
3 warnings, 1 error in 1.81s
2025-09-18 15:00:47 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 15:00:48 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 15:00:48 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 15:01:02 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758232872237.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9698.69
  }
}

2025-09-18 15:01:12 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758232879974.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 7509
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758232888970.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8897.66
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 81,
  "sample": {
    "symbol": "BRK-B",
    "score": 83.77,
    "entry": 28.2506,
    "stop": 26.8389,
    "targets": [
      29.9898,
      31.1494
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 55.3463,
          "x2": "2025-09-15",
          "y2": 28.11,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 52.4474,
          "x2": "2025-09-15",
          "y2": 27.11,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 27.61
        }
      ],
      "priceLevels": {
        "entry": 28.2506,
        "stop": 26.8389,
        "targets": [
          29.9898,
          31.1494
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.34",
        "slope gap 0.0026"
      ],
      "direction": "falling",
      "atr14": 1.9824
    },
    "avg_price": 30.92719122568766,
    "avg_volume": 18948695.1,
    "key_levels": {
      "entry": 28.2506,
      "stop": 26.8389,
      "targets": [
        29.9898,
        31.1494
      ]
    },
    "atr14": 1.9824,
    "chart_url": "https://legend-shots.onrender.com/reports/BRK-B-1758232925324.png"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758232998349.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 34922.04
  }
}
2025-09-18 15:03:18 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 22:03:22.297756', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 15:03:22 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 15:03:29 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 15:03:29 Sleeping 5m before next iteration
2025-09-18 15:08:29 === Iteration 185 ===
2025-09-18 15:08:29 venv exists
2025-09-18 15:08:29 Installing Python requirements
2025-09-18 15:08:30 shots: node_modules present
2025-09-18 15:08:30 frontend: node_modules present
2025-09-18 15:08:30 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:28: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

service_api.py:217
  /Users/kyleholthaus/Projects/LegendAI/service_api.py:217: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    @app.on_event("startup")

.venv/lib/python3.13/site-packages/fastapi/applications.py:4495
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/fastapi/applications.py:4495: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    return self.router.on_event(event_type)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
!!!!!!!!!!!!!!!!!!!! Interrupted: 1 error during collection !!!!!!!!!!!!!!!!!!!!
3 warnings, 1 error in 1.58s
2025-09-18 15:08:32 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 15:08:32 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 15:08:32 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 15:08:44 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758233334435.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9723.96
  }
}

2025-09-18 15:08:54 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758233339701.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5146
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758233348735.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9057.09
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 45,
  "sample": {
    "symbol": "DTE",
    "score": 83.38,
    "entry": 99.2035,
    "stop": 93.951,
    "targets": [
      105.1075,
      109.0435
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 145.09,
          "x2": "2025-09-15",
          "y2": 98.71,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 135.25,
          "x2": "2025-09-15",
          "y2": 94.9,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 96.805
        }
      ],
      "priceLevels": {
        "entry": 99.2035,
        "stop": 93.951,
        "targets": [
          105.1075,
          109.0435
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.39",
        "slope gap 0.0125"
      ],
      "direction": "falling",
      "atr14": 5.8479,
      "sector": "Utilities"
    },
    "avg_price": 92.21766713460286,
    "avg_volume": 21870338.466666665,
    "key_levels": {
      "entry": 99.2035,
      "stop": 93.951,
      "targets": [
        105.1075,
        109.0435
      ]
    },
    "atr14": 5.8479,
    "sector": "Utilities",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=DTE+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758233441731.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 19143.59
  }
}
2025-09-18 15:10:41 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 22:10:45.209300', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 15:10:45 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 15:10:51 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 15:10:51 Sleeping 5m before next iteration
2025-09-18 15:15:51 === Iteration 186 ===
2025-09-18 15:15:51 venv exists
2025-09-18 15:15:51 Installing Python requirements
2025-09-18 15:15:51 shots: node_modules present
2025-09-18 15:15:51 frontend: node_modules present
2025-09-18 15:15:51 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:28: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

service_api.py:217
  /Users/kyleholthaus/Projects/LegendAI/service_api.py:217: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    @app.on_event("startup")

.venv/lib/python3.13/site-packages/fastapi/applications.py:4495
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/fastapi/applications.py:4495: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    return self.router.on_event(event_type)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
!!!!!!!!!!!!!!!!!!!! Interrupted: 1 error during collection !!!!!!!!!!!!!!!!!!!!
3 warnings, 1 error in 1.49s
2025-09-18 15:15:54 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 15:15:54 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 15:15:54 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 15:16:05 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758233775351.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9343.2
  }
}

2025-09-18 15:16:15 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758233781304.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5861
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758233790434.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9017.13
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 110,
  "sample": {
    "symbol": "RTX",
    "score": 88.44,
    "entry": 187.121,
    "stop": 177.804,
    "targets": [
      201.4358,
      210.9791
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 284.7549,
          "x2": "2025-09-15",
          "y2": 186.19,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 260.8968,
          "x2": "2025-09-15",
          "y2": 179.6,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 182.895
        }
      ],
      "priceLevels": {
        "entry": 187.121,
        "stop": 177.804,
        "targets": [
          201.4358,
          210.9791
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.28",
        "slope gap 0.0681"
      ],
      "direction": "falling",
      "atr14": 9.6184,
      "sector": "Industrials"
    },
    "avg_price": 208.36139577229818,
    "avg_volume": 2949403.8333333335,
    "key_levels": {
      "entry": 187.121,
      "stop": 177.804,
      "targets": [
        201.4358,
        210.9791
      ]
    },
    "atr14": 9.6184,
    "sector": "Industrials",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=RTX+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30420.3
  }
}
2025-09-18 15:18:15 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 22:18:21.804537', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 15:18:21 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 15:18:27 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 15:18:27 Sleeping 5m before next iteration
2025-09-18 15:23:27 === Iteration 187 ===
2025-09-18 15:23:27 venv exists
2025-09-18 15:23:27 Installing Python requirements
2025-09-18 15:23:28 shots: node_modules present
2025-09-18 15:23:28 frontend: node_modules present
2025-09-18 15:23:28 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:28: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

service_api.py:217
  /Users/kyleholthaus/Projects/LegendAI/service_api.py:217: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    @app.on_event("startup")

.venv/lib/python3.13/site-packages/fastapi/applications.py:4495
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/fastapi/applications.py:4495: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    return self.router.on_event(event_type)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
!!!!!!!!!!!!!!!!!!!! Interrupted: 1 error during collection !!!!!!!!!!!!!!!!!!!!
3 warnings, 1 error in 1.61s
2025-09-18 15:23:31 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 15:23:31 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 15:23:31 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 15:23:43 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758234233232.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9828.56
  }
}

2025-09-18 15:23:53 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758234238767.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5442
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758234247748.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8893.94
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 133,
  "sample": {
    "symbol": "CARR",
    "score": 83.77,
    "entry": 28.2506,
    "stop": 26.8389,
    "targets": [
      29.9898,
      31.1494
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 55.3463,
          "x2": "2025-09-15",
          "y2": 28.11,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 52.4474,
          "x2": "2025-09-15",
          "y2": 27.11,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 27.61
        }
      ],
      "priceLevels": {
        "entry": 28.2506,
        "stop": 26.8389,
        "targets": [
          29.9898,
          31.1494
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.34",
        "slope gap 0.0026"
      ],
      "direction": "falling",
      "atr14": 1.9824
    },
    "avg_price": 30.92719078063965,
    "avg_volume": 18948695.1,
    "key_levels": {
      "entry": 28.2506,
      "stop": 26.8389,
      "targets": [
        29.9898,
        31.1494
      ]
    },
    "atr14": 1.9824,
    "chart_url": "https://legend-shots.onrender.com/reports/CARR-1758234302828.png"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758234333929.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 29830.98
  }
}
2025-09-18 15:25:34 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 22:25:37.778133', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-18 15:25:37 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-18 15:25:45 Deploy skipped (DO_DEPLOY!=1)
2025-09-18 15:25:45 Sleeping 5m before next iteration
2025-09-18 15:30:45 === Iteration 188 ===
2025-09-18 15:30:45 venv exists
2025-09-18 15:30:45 Installing Python requirements
2025-09-18 15:30:45 shots: node_modules present
2025-09-18 15:30:45 frontend: node_modules present
2025-09-18 15:30:45 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:28: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

service_api.py:217
  /Users/kyleholthaus/Projects/LegendAI/service_api.py:217: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    @app.on_event("startup")

.venv/lib/python3.13/site-packages/fastapi/applications.py:4495
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/fastapi/applications.py:4495: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    return self.router.on_event(event_type)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
!!!!!!!!!!!!!!!!!!!! Interrupted: 1 error during collection !!!!!!!!!!!!!!!!!!!!
3 warnings, 1 error in 1.67s
2025-09-18 15:30:48 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-18 15:30:48 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-18 15:30:48 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-18 15:31:00 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758234669866.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9213.35
  }
}

2025-09-18 15:31:10 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758234675534.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5493
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758234684432.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8805.27
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 155,
  "sample": {
    "symbol": "BMY",
    "score": 77.72,
    "entry": 190.9701,
    "stop": 183.3084,
    "targets": [
      196.0797,
      199.4861
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 240.8199,
          "x2": "2025-09-15",
          "y2": 190.02,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 232.3038,
          "x2": "2025-09-15",
          "y2": 185.16,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 187.59
        }
      ],
      "priceLevels": {
        "entry": 190.9701,
        "stop": 183.3084,
        "targets": [
          196.0797,
          199.4861
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.57",
        "slope gap 0.0104"
      ],
      "direction": "falling",
      "atr14": 8.5888
    },
    "avg_price": 189.4176040649414,
    "avg_volume": 12740236.2,
    "key_levels": {
      "entry": 190.9701,
      "stop": 183.3084,
      "targets": [
        196.0797,
        199.4861
      ]
    },
    "atr14": 8.5888,
    "chart_url": "https://legend-shots.onrender.com/reports/BMY-1758234740263.png"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
2025-09-19 20:05:31 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-19 20:05:31 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-19 20:05:31 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-19 20:05:45 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758337555823.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9791.94
  }
}

2025-09-19 20:05:55 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758337561866.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5911
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758337571122.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9193.06
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 88,
  "sample": {
    "symbol": "MCD",
    "score": 85.18,
    "entry": 58.2197,
    "stop": 54.9648,
    "targets": [
      62.9115,
      66.0394
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 107.6719,
          "x2": "2025-09-15",
          "y2": 57.93,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 99.8522,
          "x2": "2025-09-15",
          "y2": 55.52,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 56.725
        }
      ],
      "priceLevels": {
        "entry": 58.2197,
        "stop": 54.9648,
        "targets": [
          62.9115,
          66.0394
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.31",
        "slope gap 0.0213"
      ],
      "direction": "falling",
      "atr14": 4.0705
    },
    "avg_price": 53.67599245707194,
    "avg_volume": 10904334.166666666,
    "key_levels": {
      "entry": 58.2197,
      "stop": 54.9648,
      "targets": [
        62.9115,
        66.0394
      ]
    },
    "atr14": 4.0705,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=MCD+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758337669262.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 24357.85
  }
}
2025-09-19 20:07:49 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-20 03:07:53.117744', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-19 20:07:53 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-19 20:07:59 Deploy skipped (DO_DEPLOY!=1)
2025-09-19 20:07:59 Sleeping 5m before next iteration
2025-09-19 20:12:59 === Iteration 412 ===
2025-09-19 20:12:59 venv exists
2025-09-19 20:12:59 Installing Python requirements
2025-09-19 20:12:59 shots: node_modules present
2025-09-19 20:12:59 frontend: node_modules present
2025-09-19 20:12:59 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_analytics_api.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_analytics_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_analytics_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
________________ ERROR collecting tests/test_backtest_smoke.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_backtest_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_backtest_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
___________________ ERROR collecting tests/test_chart_api.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_chart_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_chart_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:30: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
___________________ ERROR collecting tests/test_scan_api.py ____________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
__________________ ERROR collecting tests/test_scan_smoke.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_analytics_api.py
ERROR tests/test_backtest_smoke.py
ERROR tests/test_chart_api.py
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
ERROR tests/test_scan_api.py
ERROR tests/test_scan_smoke.py
!!!!!!!!!!!!!!!!!!! Interrupted: 6 errors during collection !!!!!!!!!!!!!!!!!!!!
1 warning, 6 errors in 1.80s
2025-09-19 20:13:02 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-19 20:13:02 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-19 20:13:02 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-19 20:13:14 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758338004059.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9639.09
  }
}

2025-09-19 20:13:24 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758338010031.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5892
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758338019762.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9700.93
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 133,
  "sample": {
    "symbol": "MHK",
    "score": 85.18,
    "entry": 58.2197,
    "stop": 54.9648,
    "targets": [
      62.9115,
      66.0394
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 107.672,
          "x2": "2025-09-15",
          "y2": 57.93,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 99.8522,
          "x2": "2025-09-15",
          "y2": 55.52,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 56.725
        }
      ],
      "priceLevels": {
        "entry": 58.2197,
        "stop": 54.9648,
        "targets": [
          62.9115,
          66.0394
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.31",
        "slope gap 0.0213"
      ],
      "direction": "falling",
      "atr14": 4.0705,
      "sector": "Consumer Cyclical"
    },
    "avg_price": 53.67599245707194,
    "avg_volume": 10904334.166666666,
    "key_levels": {
      "entry": 58.2197,
      "stop": 54.9648,
      "targets": [
        62.9115,
        66.0394
      ]
    },
    "atr14": 4.0705,
    "sector": "Consumer Cyclical",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=MHK+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758338118676.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 24770.63
  }
}
2025-09-19 20:15:18 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-20 03:15:22.446830', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-19 20:15:22 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-19 20:15:28 Deploy skipped (DO_DEPLOY!=1)
2025-09-19 20:15:28 Sleeping 5m before next iteration
2025-09-19 20:20:28 === Iteration 413 ===
2025-09-19 20:20:28 venv exists
2025-09-19 20:20:28 Installing Python requirements
2025-09-19 20:20:29 shots: node_modules present
2025-09-19 20:20:29 frontend: node_modules present
2025-09-19 20:20:29 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_analytics_api.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_analytics_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_analytics_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
________________ ERROR collecting tests/test_backtest_smoke.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_backtest_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_backtest_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
___________________ ERROR collecting tests/test_chart_api.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_chart_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_chart_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:30: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
___________________ ERROR collecting tests/test_scan_api.py ____________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
__________________ ERROR collecting tests/test_scan_smoke.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_analytics_api.py
ERROR tests/test_backtest_smoke.py
ERROR tests/test_chart_api.py
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
ERROR tests/test_scan_api.py
ERROR tests/test_scan_smoke.py
!!!!!!!!!!!!!!!!!!! Interrupted: 6 errors during collection !!!!!!!!!!!!!!!!!!!!
1 warning, 6 errors in 1.58s
2025-09-19 20:20:32 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-19 20:20:32 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-19 20:20:32 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-19 20:20:45 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758338461746.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 15457.09
  }
}

2025-09-19 20:21:01 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758338467149.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5342
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758338476245.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8963.97
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 60,
  "sample": {
    "symbol": "DDOG",
    "score": 89.73,
    "entry": 69.6163,
    "stop": 67.7259,
    "targets": [
      71.8387,
      73.3203
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 66.8,
          "x2": "2025-09-15",
          "y2": 69.27,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 63.096,
          "x2": "2025-09-15",
          "y2": 68.41,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 68.84
        }
      ],
      "priceLevels": {
        "entry": 69.6163,
        "stop": 67.7259,
        "targets": [
          71.8387,
          73.3203
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.23",
        "slope gap 0.0095"
      ],
      "direction": "falling",
      "atr14": 4.025,
      "sector": "Technology"
    },
    "avg_price": 58.837666575113936,
    "avg_volume": 10589611.533333333,
    "key_levels": {
      "entry": 69.6163,
      "stop": 67.7259,
      "targets": [
        71.8387,
        73.3203
      ]
    },
    "atr14": 4.025,
    "sector": "Technology",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=DDOG+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30269.34
  }
}
2025-09-19 20:23:00 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-20 03:23:03.975794', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-19 20:23:04 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-19 20:23:09 Deploy skipped (DO_DEPLOY!=1)
2025-09-19 20:23:09 Sleeping 5m before next iteration
2025-09-19 21:05:35 === Iteration 414 ===
2025-09-19 21:05:36 venv exists
2025-09-19 21:05:36 Installing Python requirements
2025-09-19 21:05:36 shots: node_modules present
2025-09-19 21:05:36 frontend: node_modules present
2025-09-19 21:05:36 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_analytics_api.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_analytics_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_analytics_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
________________ ERROR collecting tests/test_backtest_smoke.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_backtest_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_backtest_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
___________________ ERROR collecting tests/test_chart_api.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_chart_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_chart_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:30: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
___________________ ERROR collecting tests/test_scan_api.py ____________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
__________________ ERROR collecting tests/test_scan_smoke.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_analytics_api.py
ERROR tests/test_backtest_smoke.py
ERROR tests/test_chart_api.py
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
ERROR tests/test_scan_api.py
ERROR tests/test_scan_smoke.py
!!!!!!!!!!!!!!!!!!! Interrupted: 6 errors during collection !!!!!!!!!!!!!!!!!!!!
1 warning, 6 errors in 2.46s
2025-09-19 21:05:40 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-19 21:05:40 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-19 21:05:40 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-19 21:05:54 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758341165052.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10325.9
  }
}

2025-09-19 21:06:05 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758341171119.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5852
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758341180353.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9271.24
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 86,
  "sample": {
    "symbol": "SMCI",
    "score": 80.57,
    "entry": 144.2476,
    "stop": 138.5109,
    "targets": [
      148.5605,
      151.4357
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 164.837,
          "x2": "2025-09-15",
          "y2": 143.53,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 157.6489,
          "x2": "2025-09-15",
          "y2": 139.91,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 141.72
        }
      ],
      "priceLevels": {
        "entry": 144.2476,
        "stop": 138.5109,
        "targets": [
          148.5605,
          151.4357
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.50",
        "slope gap 0.0137"
      ],
      "direction": "falling",
      "atr14": 6.2749
    },
    "avg_price": 138.5080691019694,
    "avg_volume": 43099725.266666666,
    "key_levels": {
      "entry": 144.2476,
      "stop": 138.5109,
      "targets": [
        148.5605,
        151.4357
      ]
    },
    "atr14": 6.2749,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=SMCI+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758341259151.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 11033.93
  }
}
2025-09-19 21:07:39 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-20 04:07:44.122216', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-19 21:07:44 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-19 21:07:50 Deploy skipped (DO_DEPLOY!=1)
2025-09-19 21:07:50 Sleeping 5m before next iteration
2025-09-19 21:12:50 === Iteration 415 ===
2025-09-19 21:12:50 venv exists
2025-09-19 21:12:50 Installing Python requirements
2025-09-19 21:12:51 shots: node_modules present
2025-09-19 21:12:51 frontend: node_modules present
2025-09-19 21:12:51 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_analytics_api.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_analytics_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_analytics_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
________________ ERROR collecting tests/test_backtest_smoke.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_backtest_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_backtest_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
___________________ ERROR collecting tests/test_chart_api.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_chart_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_chart_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:30: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
___________________ ERROR collecting tests/test_scan_api.py ____________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
__________________ ERROR collecting tests/test_scan_smoke.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_analytics_api.py
ERROR tests/test_backtest_smoke.py
ERROR tests/test_chart_api.py
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
ERROR tests/test_scan_api.py
ERROR tests/test_scan_smoke.py
!!!!!!!!!!!!!!!!!!! Interrupted: 6 errors during collection !!!!!!!!!!!!!!!!!!!!
1 warning, 6 errors in 1.72s
2025-09-19 21:12:53 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-19 21:12:54 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-19 21:12:54 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-19 21:13:07 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758341596870.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9174.69
  }
}

2025-09-19 21:13:17 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758341602586.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5541
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758341611853.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9275.11
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 82,
  "sample": {
    "symbol": "AVGO",
    "score": 82.31,
    "entry": 86.8622,
    "stop": 80.3286,
    "targets": [
      94.2902,
      99.2422
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 91.66,
          "x2": "2025-09-15",
          "y2": 86.43,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 79.28,
          "x2": "2025-09-15",
          "y2": 81.14,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 83.785
        }
      ],
      "priceLevels": {
        "entry": 86.8622,
        "stop": 80.3286,
        "targets": [
          94.2902,
          99.2422
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.43",
        "slope gap 0.0157"
      ],
      "direction": "falling",
      "atr14": 4.7164,
      "sector": "Technology"
    },
    "avg_price": 67.09066683451334,
    "avg_volume": 13974299.5,
    "key_levels": {
      "entry": 86.8622,
      "stop": 80.3286,
      "targets": [
        94.2902,
        99.2422
      ]
    },
    "atr14": 4.7164,
    "sector": "Technology",
    "chart_url": "https://legend-shots.onrender.com/reports/AVGO-1758341675470.png"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758341694766.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 17846.18
  }
}
2025-09-19 21:14:55 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-20 04:14:58.486856', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-19 21:14:58 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-19 21:15:06 Deploy skipped (DO_DEPLOY!=1)
2025-09-19 21:15:06 Sleeping 5m before next iteration
2025-09-19 21:20:06 === Iteration 416 ===
2025-09-19 21:20:06 venv exists
2025-09-19 21:20:06 Installing Python requirements
2025-09-19 21:20:06 shots: node_modules present
2025-09-19 21:20:06 frontend: node_modules present
2025-09-19 21:20:06 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_analytics_api.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_analytics_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_analytics_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
________________ ERROR collecting tests/test_backtest_smoke.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_backtest_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_backtest_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
___________________ ERROR collecting tests/test_chart_api.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_chart_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_chart_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:30: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
___________________ ERROR collecting tests/test_scan_api.py ____________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
__________________ ERROR collecting tests/test_scan_smoke.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_analytics_api.py
ERROR tests/test_backtest_smoke.py
ERROR tests/test_chart_api.py
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
ERROR tests/test_scan_api.py
ERROR tests/test_scan_smoke.py
!!!!!!!!!!!!!!!!!!! Interrupted: 6 errors during collection !!!!!!!!!!!!!!!!!!!!
1 warning, 6 errors in 1.63s
2025-09-19 21:20:09 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-19 21:20:09 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-19 21:20:09 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-19 21:20:22 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758342032270.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9643.31
  }
}

2025-09-19 21:20:32 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758342038480.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6042
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758342047752.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9245.17
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 65,
  "sample": {
    "symbol": "HUM",
    "score": 77.9,
    "entry": 25.3461,
    "stop": 24.4233,
    "targets": [
      25.965,
      26.3777
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 30.966,
          "x2": "2025-09-15",
          "y2": 25.22,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 29.9345,
          "x2": "2025-09-15",
          "y2": 24.67,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 24.945
        }
      ],
      "priceLevels": {
        "entry": 25.3461,
        "stop": 24.4233,
        "targets": [
          25.965,
          26.3777
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.53",
        "slope gap 0.0002"
      ],
      "direction": "falling",
      "atr14": 1.4303
    },
    "avg_price": 28.91617603302002,
    "avg_volume": 16859249.366666667,
    "key_levels": {
      "entry": 25.3461,
      "stop": 24.4233,
      "targets": [
        25.965,
        26.3777
      ]
    },
    "atr14": 1.4303,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=HUM+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30345.32
  }
}
2025-09-19 21:22:31 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-20 04:22:35.323159', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-19 21:22:35 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-19 21:22:43 Deploy skipped (DO_DEPLOY!=1)
2025-09-19 21:22:43 Sleeping 5m before next iteration
2025-09-19 21:27:43 === Iteration 417 ===
2025-09-19 21:27:43 venv exists
2025-09-19 21:27:43 Installing Python requirements
2025-09-19 21:27:44 shots: node_modules present
2025-09-19 21:27:44 frontend: node_modules present
2025-09-19 21:27:44 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_analytics_api.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_analytics_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_analytics_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
________________ ERROR collecting tests/test_backtest_smoke.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_backtest_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_backtest_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
___________________ ERROR collecting tests/test_chart_api.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_chart_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_chart_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:30: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
___________________ ERROR collecting tests/test_scan_api.py ____________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
__________________ ERROR collecting tests/test_scan_smoke.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_analytics_api.py
ERROR tests/test_backtest_smoke.py
ERROR tests/test_chart_api.py
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
ERROR tests/test_scan_api.py
ERROR tests/test_scan_smoke.py
!!!!!!!!!!!!!!!!!!! Interrupted: 6 errors during collection !!!!!!!!!!!!!!!!!!!!
1 warning, 6 errors in 1.72s
2025-09-19 21:27:46 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-19 21:27:46 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-19 21:27:47 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-19 21:27:58 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758342489168.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10644.2
  }
}

2025-09-19 21:28:09 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758342496165.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6658
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758342502368.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 6202.61
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 94,
  "sample": {
    "symbol": "DTE",
    "score": 89.73,
    "entry": 69.6163,
    "stop": 67.7259,
    "targets": [
      71.8387,
      73.3203
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 66.8,
          "x2": "2025-09-15",
          "y2": 69.27,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 63.096,
          "x2": "2025-09-15",
          "y2": 68.41,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 68.84
        }
      ],
      "priceLevels": {
        "entry": 69.6163,
        "stop": 67.7259,
        "targets": [
          71.8387,
          73.3203
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.23",
        "slope gap 0.0095"
      ],
      "direction": "falling",
      "atr14": 4.025,
      "sector": "Utilities"
    },
    "avg_price": 58.837666575113936,
    "avg_volume": 10589611.533333333,
    "key_levels": {
      "entry": 69.6163,
      "stop": 67.7259,
      "targets": [
        71.8387,
        73.3203
      ]
    },
    "atr14": 4.025,
    "sector": "Utilities",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=DTE+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30339.91
  }
}
2025-09-19 21:30:06 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-20 04:30:10.218229', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-19 21:30:10 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-19 21:30:16 Deploy skipped (DO_DEPLOY!=1)
2025-09-19 21:30:16 Sleeping 5m before next iteration
2025-09-19 21:43:00 === Iteration 418 ===
2025-09-19 21:43:00 venv exists
2025-09-19 21:43:00 Installing Python requirements
2025-09-19 21:43:01 shots: node_modules present
2025-09-19 21:43:02 frontend: node_modules present
2025-09-19 21:43:02 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_analytics_api.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_analytics_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_analytics_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
________________ ERROR collecting tests/test_backtest_smoke.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_backtest_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_backtest_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
___________________ ERROR collecting tests/test_chart_api.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_chart_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_chart_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:30: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
___________________ ERROR collecting tests/test_scan_api.py ____________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
__________________ ERROR collecting tests/test_scan_smoke.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_analytics_api.py
ERROR tests/test_backtest_smoke.py
ERROR tests/test_chart_api.py
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
ERROR tests/test_scan_api.py
ERROR tests/test_scan_smoke.py
!!!!!!!!!!!!!!!!!!! Interrupted: 6 errors during collection !!!!!!!!!!!!!!!!!!!!
1 warning, 6 errors in 2.37s
2025-09-19 21:43:06 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-19 21:43:06 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-19 21:43:06 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-19 21:43:22 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758343412681.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10004.95
  }
}

2025-09-19 21:43:32 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758343419486.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6594
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758343428947.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9309.0
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 61,
  "sample": {
    "symbol": "TRV",
    "score": 78.41,
    "entry": 91.264,
    "stop": 86.9319,
    "targets": [
      94.9374,
      97.3862
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 135.8186,
          "x2": "2025-09-15",
          "y2": 90.81,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 129.6964,
          "x2": "2025-09-15",
          "y2": 87.81,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 89.31
        }
      ],
      "priceLevels": {
        "entry": 91.264,
        "stop": 86.9319,
        "targets": [
          94.9374,
          97.3862
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.49",
        "slope gap 0.0279"
      ],
      "direction": "falling",
      "atr14": 5.9722,
      "sector": "Financial Services"
    },
    "avg_price": 98.32547531127929,
    "avg_volume": 37724541.0,
    "key_levels": {
      "entry": 91.264,
      "stop": 86.9319,
      "targets": [
        94.9374,
        97.3862
      ]
    },
    "atr14": 5.9722,
    "sector": "Financial Services",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=TRV+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758343532160.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 28365.28
  }
}
2025-09-19 21:45:32 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-20 04:45:35.788238', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-19 21:45:35 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-19 21:45:42 Deploy skipped (DO_DEPLOY!=1)
2025-09-19 21:45:42 Sleeping 5m before next iteration
2025-09-19 21:50:42 === Iteration 419 ===
2025-09-19 21:50:42 venv exists
2025-09-19 21:50:42 Installing Python requirements
2025-09-19 21:50:42 shots: node_modules present
2025-09-19 21:50:42 frontend: node_modules present
2025-09-19 21:50:42 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_analytics_api.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_analytics_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_analytics_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
________________ ERROR collecting tests/test_backtest_smoke.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_backtest_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_backtest_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
___________________ ERROR collecting tests/test_chart_api.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_chart_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_chart_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:30: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
___________________ ERROR collecting tests/test_scan_api.py ____________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
__________________ ERROR collecting tests/test_scan_smoke.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_analytics_api.py
ERROR tests/test_backtest_smoke.py
ERROR tests/test_chart_api.py
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
ERROR tests/test_scan_api.py
ERROR tests/test_scan_smoke.py
!!!!!!!!!!!!!!!!!!! Interrupted: 6 errors during collection !!!!!!!!!!!!!!!!!!!!
1 warning, 6 errors in 1.63s
2025-09-19 21:50:45 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-19 21:50:45 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-19 21:50:45 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-19 21:50:59 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758343868983.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9419.45
  }
}

2025-09-19 21:51:09 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758343875248.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5909
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758343884778.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9475.21
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 94,
  "sample": {
    "symbol": "PPL",
    "score": 79.91,
    "entry": 24.5119,
    "stop": 23.4432,
    "targets": [
      25.3329,
      25.8802
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 27.0789,
          "x2": "2025-09-15",
          "y2": 24.39,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 25.7106,
          "x2": "2025-09-15",
          "y2": 23.68,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 24.035
        }
      ],
      "priceLevels": {
        "entry": 24.5119,
        "stop": 23.4432,
        "targets": [
          25.3329,
          25.8802
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.52",
        "slope gap 0.0006"
      ],
      "direction": "falling",
      "atr14": 1.0895
    },
    "avg_price": 23.848441886901856,
    "avg_volume": 229270023.86666667,
    "key_levels": {
      "entry": 24.5119,
      "stop": 23.4432,
      "targets": [
        25.3329,
        25.8802
      ]
    },
    "atr14": 1.0895,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=PPL+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758343976374.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 17852.78
  }
}
2025-09-19 21:52:56 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-20 04:53:00.074777', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-19 21:53:00 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-19 21:53:07 Deploy skipped (DO_DEPLOY!=1)
2025-09-19 21:53:07 Sleeping 5m before next iteration
2025-09-19 21:58:07 === Iteration 420 ===
2025-09-19 21:58:07 venv exists
2025-09-19 21:58:07 Installing Python requirements
2025-09-19 21:58:07 shots: node_modules present
2025-09-19 21:58:07 frontend: node_modules present
2025-09-19 21:58:07 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_analytics_api.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_analytics_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_analytics_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
________________ ERROR collecting tests/test_backtest_smoke.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_backtest_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_backtest_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
___________________ ERROR collecting tests/test_chart_api.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_chart_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_chart_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:30: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
___________________ ERROR collecting tests/test_scan_api.py ____________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
__________________ ERROR collecting tests/test_scan_smoke.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_analytics_api.py
ERROR tests/test_backtest_smoke.py
ERROR tests/test_chart_api.py
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
ERROR tests/test_scan_api.py
ERROR tests/test_scan_smoke.py
!!!!!!!!!!!!!!!!!!! Interrupted: 6 errors during collection !!!!!!!!!!!!!!!!!!!!
1 warning, 6 errors in 1.58s
2025-09-19 21:58:10 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-19 21:58:10 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-19 21:58:10 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-19 21:58:22 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758344311262.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9180.08
  }
}

2025-09-19 21:58:31 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758344316624.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5230
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758344326043.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9414.19
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 95,
  "sample": {
    "symbol": "PTC",
    "score": 77.63,
    "entry": 116.9921,
    "stop": 111.7512,
    "targets": [
      120.6223,
      123.0425
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 126.9555,
          "x2": "2025-09-15",
          "y2": 116.41,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 120.9051,
          "x2": "2025-09-15",
          "y2": 112.88,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 114.645
        }
      ],
      "priceLevels": {
        "entry": 116.9921,
        "stop": 111.7512,
        "targets": [
          120.6223,
          123.0425
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.58",
        "slope gap 0.0041"
      ],
      "direction": "falling",
      "atr14": 4.8872,
      "sector": "Technology"
    },
    "avg_price": 106.91113357543945,
    "avg_volume": 21778796.066666666,
    "key_levels": {
      "entry": 116.9921,
      "stop": 111.7512,
      "targets": [
        120.6223,
        123.0425
      ]
    },
    "atr14": 4.8872,
    "sector": "Technology",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=PTC+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758344414042.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 14025.76
  }
}
2025-09-19 22:00:14 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-20 05:00:17.704764', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-19 22:00:17 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-19 22:00:23 Deploy skipped (DO_DEPLOY!=1)
2025-09-19 22:00:23 Sleeping 5m before next iteration
2025-09-19 22:05:23 === Iteration 421 ===
2025-09-19 22:05:23 venv exists
2025-09-19 22:05:23 Installing Python requirements
2025-09-19 22:05:24 shots: node_modules present
2025-09-19 22:05:24 frontend: node_modules present
2025-09-19 22:05:24 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_analytics_api.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_analytics_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_analytics_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
________________ ERROR collecting tests/test_backtest_smoke.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_backtest_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_backtest_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
___________________ ERROR collecting tests/test_chart_api.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_chart_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_chart_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:30: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
___________________ ERROR collecting tests/test_scan_api.py ____________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
__________________ ERROR collecting tests/test_scan_smoke.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_analytics_api.py
ERROR tests/test_backtest_smoke.py
ERROR tests/test_chart_api.py
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
ERROR tests/test_scan_api.py
ERROR tests/test_scan_smoke.py
!!!!!!!!!!!!!!!!!!! Interrupted: 6 errors during collection !!!!!!!!!!!!!!!!!!!!
1 warning, 6 errors in 1.62s
2025-09-19 22:05:27 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-19 22:05:27 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-19 22:05:27 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-19 22:05:38 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758344748144.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9730.44
  }
}

2025-09-19 22:05:48 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758344753482.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5211
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758344762961.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9423.67
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 72,
  "sample": {
    "symbol": "HPE",
    "score": 78.27,
    "entry": 278.385,
    "stop": 267.5871,
    "targets": [
      285.7476,
      290.656
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 251.2054,
          "x2": "2025-09-15",
          "y2": 277.0,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 238.9343,
          "x2": "2025-09-15",
          "y2": 270.29,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 273.645
        }
      ],
      "priceLevels": {
        "entry": 278.385,
        "stop": 267.5871,
        "targets": [
          285.7476,
          290.656
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.55",
        "slope gap 0.0526"
      ],
      "direction": "falling",
      "atr14": 12.9861,
      "sector": "Technology"
    },
    "avg_price": 234.49557495117188,
    "avg_volume": 2954659.066666667,
    "key_levels": {
      "entry": 278.385,
      "stop": 267.5871,
      "targets": [
        285.7476,
        290.656
      ]
    },
    "atr14": 12.9861,
    "sector": "Technology",
    "chart_url": "https://legend-shots.onrender.com/reports/HPE-1758344799544.png"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30307.85
  }
}
2025-09-19 22:07:47 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-20 05:07:50.703590', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-19 22:07:50 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-19 22:07:57 Deploy skipped (DO_DEPLOY!=1)
2025-09-19 22:07:57 Sleeping 5m before next iteration
2025-09-19 22:12:57 === Iteration 422 ===
2025-09-19 22:12:57 venv exists
2025-09-19 22:12:57 Installing Python requirements
2025-09-19 22:12:58 shots: node_modules present
2025-09-19 22:12:58 frontend: node_modules present
2025-09-19 22:12:58 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_analytics_api.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_analytics_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_analytics_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
________________ ERROR collecting tests/test_backtest_smoke.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_backtest_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_backtest_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
___________________ ERROR collecting tests/test_chart_api.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_chart_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_chart_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:30: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
___________________ ERROR collecting tests/test_scan_api.py ____________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
__________________ ERROR collecting tests/test_scan_smoke.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_analytics_api.py
ERROR tests/test_backtest_smoke.py
ERROR tests/test_chart_api.py
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
ERROR tests/test_scan_api.py
ERROR tests/test_scan_smoke.py
!!!!!!!!!!!!!!!!!!! Interrupted: 6 errors during collection !!!!!!!!!!!!!!!!!!!!
1 warning, 6 errors in 1.69s
2025-09-19 22:13:01 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-19 22:13:01 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-19 22:13:01 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-19 22:13:13 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758345204660.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 11010.83
  }
}

2025-09-19 22:13:25 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758345210582.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5512
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758345219873.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9231.59
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 53,
  "sample": {
    "symbol": "NEM",
    "score": 88.78,
    "entry": 83.1637,
    "stop": 79.7346,
    "targets": [
      87.9836,
      91.1968
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 111.318,
          "x2": "2025-09-15",
          "y2": 82.75,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 103.285,
          "x2": "2025-09-15",
          "y2": 80.54,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 81.645
        }
      ],
      "priceLevels": {
        "entry": 83.1637,
        "stop": 79.7346,
        "targets": [
          87.9836,
          91.1968
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.28",
        "slope gap 0.0030"
      ],
      "direction": "falling",
      "atr14": 4.3001
    },
    "avg_price": 81.55921910603841,
    "avg_volume": 72961568.2,
    "key_levels": {
      "entry": 83.1637,
      "stop": 79.7346,
      "targets": [
        87.9836,
        91.1968
      ]
    },
    "atr14": 4.3001,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=NEM+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30416.91
  }
}
2025-09-19 22:15:24 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-20 05:15:28.002037', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-19 22:15:28 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-19 22:15:34 Deploy skipped (DO_DEPLOY!=1)
2025-09-19 22:15:34 Sleeping 5m before next iteration
2025-09-19 22:20:34 === Iteration 423 ===
2025-09-19 22:20:34 venv exists
2025-09-19 22:20:34 Installing Python requirements
2025-09-19 22:20:35 shots: node_modules present
2025-09-19 22:20:35 frontend: node_modules present
2025-09-19 22:20:35 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_analytics_api.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_analytics_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_analytics_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
________________ ERROR collecting tests/test_backtest_smoke.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_backtest_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_backtest_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
___________________ ERROR collecting tests/test_chart_api.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_chart_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_chart_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:30: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
___________________ ERROR collecting tests/test_scan_api.py ____________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
__________________ ERROR collecting tests/test_scan_smoke.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_analytics_api.py
ERROR tests/test_backtest_smoke.py
ERROR tests/test_chart_api.py
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
ERROR tests/test_scan_api.py
ERROR tests/test_scan_smoke.py
!!!!!!!!!!!!!!!!!!! Interrupted: 6 errors during collection !!!!!!!!!!!!!!!!!!!!
1 warning, 6 errors in 1.66s
2025-09-19 22:20:38 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-19 22:20:38 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-19 22:20:38 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-19 22:20:50 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758345660056.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9917.77
  }
}

2025-09-19 22:21:00 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758345665929.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5713
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758345675256.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9253.97
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 71,
  "sample": {
    "symbol": "BMY",
    "score": 83.77,
    "entry": 28.2506,
    "stop": 26.8389,
    "targets": [
      29.9898,
      31.1494
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 55.3463,
          "x2": "2025-09-15",
          "y2": 28.11,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 52.4474,
          "x2": "2025-09-15",
          "y2": 27.11,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 27.61
        }
      ],
      "priceLevels": {
        "entry": 28.2506,
        "stop": 26.8389,
        "targets": [
          29.9898,
          31.1494
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.34",
        "slope gap 0.0026"
      ],
      "direction": "falling",
      "atr14": 1.9824
    },
    "avg_price": 30.927190907796223,
    "avg_volume": 19501862.066666666,
    "key_levels": {
      "entry": 28.2506,
      "stop": 26.8389,
      "targets": [
        29.9898,
        31.1494
      ]
    },
    "atr14": 1.9824,
    "chart_url": "https://legend-shots.onrender.com/reports/BMY-1758345738479.png"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758345766454.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 17068.32
  }
}
2025-09-19 22:22:46 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-20 05:22:49.912050', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-19 22:22:50 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-19 22:22:56 Deploy skipped (DO_DEPLOY!=1)
2025-09-19 22:22:56 Sleeping 5m before next iteration
2025-09-19 22:28:13 === Iteration 424 ===
2025-09-19 22:28:13 venv exists
2025-09-19 22:28:13 Installing Python requirements
2025-09-19 22:28:13 shots: node_modules present
2025-09-19 22:28:13 frontend: node_modules present
2025-09-19 22:28:13 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_analytics_api.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_analytics_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_analytics_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
________________ ERROR collecting tests/test_backtest_smoke.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_backtest_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_backtest_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
___________________ ERROR collecting tests/test_chart_api.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_chart_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_chart_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:30: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
___________________ ERROR collecting tests/test_scan_api.py ____________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
__________________ ERROR collecting tests/test_scan_smoke.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_analytics_api.py
ERROR tests/test_backtest_smoke.py
ERROR tests/test_chart_api.py
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
ERROR tests/test_scan_api.py
ERROR tests/test_scan_smoke.py
!!!!!!!!!!!!!!!!!!! Interrupted: 6 errors during collection !!!!!!!!!!!!!!!!!!!!
1 warning, 6 errors in 1.68s
2025-09-19 22:28:16 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-19 22:28:16 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-19 22:28:16 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-19 22:28:28 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758346118456.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9865.78
  }
}

2025-09-19 22:28:38 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758346124435.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5856
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758346133856.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9511.8
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 69,
  "sample": {
    "symbol": "MCD",
    "score": 85.18,
    "entry": 58.2197,
    "stop": 54.9648,
    "targets": [
      62.9115,
      66.0394
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 107.672,
          "x2": "2025-09-15",
          "y2": 57.93,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 99.8522,
          "x2": "2025-09-15",
          "y2": 55.52,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 56.725
        }
      ],
      "priceLevels": {
        "entry": 58.2197,
        "stop": 54.9648,
        "targets": [
          62.9115,
          66.0394
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.31",
        "slope gap 0.0213"
      ],
      "direction": "falling",
      "atr14": 4.0705
    },
    "avg_price": 53.67599258422852,
    "avg_volume": 10904334.166666666,
    "key_levels": {
      "entry": 58.2197,
      "stop": 54.9648,
      "targets": [
        62.9115,
        66.0394
      ]
    },
    "atr14": 4.0705,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=MCD+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30406.2
  }
}
2025-09-19 22:30:38 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-20 05:30:42.966369', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-19 22:30:43 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-19 22:30:49 Deploy skipped (DO_DEPLOY!=1)
2025-09-19 22:30:49 Sleeping 5m before next iteration
2025-09-19 22:35:49 === Iteration 425 ===
2025-09-19 22:35:49 venv exists
2025-09-19 22:35:50 Installing Python requirements
2025-09-19 22:35:50 shots: node_modules present
2025-09-19 22:35:50 frontend: node_modules present
2025-09-19 22:35:50 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_analytics_api.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_analytics_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_analytics_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
________________ ERROR collecting tests/test_backtest_smoke.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_backtest_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_backtest_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
___________________ ERROR collecting tests/test_chart_api.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_chart_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_chart_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:30: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
___________________ ERROR collecting tests/test_scan_api.py ____________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
__________________ ERROR collecting tests/test_scan_smoke.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_analytics_api.py
ERROR tests/test_backtest_smoke.py
ERROR tests/test_chart_api.py
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
ERROR tests/test_scan_api.py
ERROR tests/test_scan_smoke.py
!!!!!!!!!!!!!!!!!!! Interrupted: 6 errors during collection !!!!!!!!!!!!!!!!!!!!
1 warning, 6 errors in 1.84s
2025-09-19 22:35:53 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-19 22:35:53 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-19 22:35:53 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-19 22:36:06 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758346577255.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10360.79
  }
}

2025-09-19 22:36:17 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758346582460.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5057
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758346592154.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9613.58
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 72,
  "sample": {
    "symbol": "EG",
    "score": 89.73,
    "entry": 69.6163,
    "stop": 67.7259,
    "targets": [
      71.8387,
      73.3203
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 66.8,
          "x2": "2025-09-15",
          "y2": 69.27,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 63.096,
          "x2": "2025-09-15",
          "y2": 68.41,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 68.84
        }
      ],
      "priceLevels": {
        "entry": 69.6163,
        "stop": 67.7259,
        "targets": [
          71.8387,
          73.3203
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.23",
        "slope gap 0.0095"
      ],
      "direction": "falling",
      "atr14": 4.025
    },
    "avg_price": 58.837666575113936,
    "avg_volume": 10589611.533333333,
    "key_levels": {
      "entry": 69.6163,
      "stop": 67.7259,
      "targets": [
        71.8387,
        73.3203
      ]
    },
    "atr14": 4.025,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=EG+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758346683251.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 15640.34
  }
}
2025-09-19 22:38:03 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-20 05:38:06.918573', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-19 22:38:07 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-19 22:38:14 Deploy skipped (DO_DEPLOY!=1)
2025-09-19 22:38:14 Sleeping 5m before next iteration
2025-09-19 22:43:14 === Iteration 426 ===
2025-09-19 22:43:14 venv exists
2025-09-19 22:43:14 Installing Python requirements
2025-09-19 22:43:14 shots: node_modules present
2025-09-19 22:43:14 frontend: node_modules present
2025-09-19 22:43:14 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_analytics_api.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_analytics_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_analytics_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
________________ ERROR collecting tests/test_backtest_smoke.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_backtest_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_backtest_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
___________________ ERROR collecting tests/test_chart_api.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_chart_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_chart_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:30: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
___________________ ERROR collecting tests/test_scan_api.py ____________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
__________________ ERROR collecting tests/test_scan_smoke.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_analytics_api.py
ERROR tests/test_backtest_smoke.py
ERROR tests/test_chart_api.py
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
ERROR tests/test_scan_api.py
ERROR tests/test_scan_smoke.py
!!!!!!!!!!!!!!!!!!! Interrupted: 6 errors during collection !!!!!!!!!!!!!!!!!!!!
1 warning, 6 errors in 1.59s
2025-09-19 22:43:17 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-19 22:43:17 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-19 22:43:17 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-19 22:43:29 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758347020052.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10671.47
  }
}

2025-09-19 22:43:40 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758347025588.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5425
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758347034922.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9245.52
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 97,
  "sample": {
    "symbol": "META",
    "score": 85.18,
    "entry": 58.2197,
    "stop": 54.9648,
    "targets": [
      62.9115,
      66.0394
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 107.672,
          "x2": "2025-09-15",
          "y2": 57.93,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 99.8522,
          "x2": "2025-09-15",
          "y2": 55.52,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 56.725
        }
      ],
      "priceLevels": {
        "entry": 58.2197,
        "stop": 54.9648,
        "targets": [
          62.9115,
          66.0394
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.31",
        "slope gap 0.0213"
      ],
      "direction": "falling",
      "atr14": 4.0705,
      "sector": "Communication Services"
    },
    "avg_price": 53.67599258422852,
    "avg_volume": 10904334.166666666,
    "key_levels": {
      "entry": 58.2197,
      "stop": 54.9648,
      "targets": [
        62.9115,
        66.0394
      ]
    },
    "atr14": 4.0705,
    "sector": "Communication Services",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=META+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30279.19
  }
}
2025-09-19 22:45:38 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-20 05:45:42.275148', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-19 22:45:42 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-19 22:45:48 Deploy skipped (DO_DEPLOY!=1)
2025-09-19 22:45:48 Sleeping 5m before next iteration
2025-09-19 22:50:48 === Iteration 427 ===
2025-09-19 22:50:48 venv exists
2025-09-19 22:50:48 Installing Python requirements
2025-09-19 22:50:48 shots: node_modules present
2025-09-19 22:50:48 frontend: node_modules present
2025-09-19 22:50:48 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_analytics_api.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_analytics_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_analytics_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
________________ ERROR collecting tests/test_backtest_smoke.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_backtest_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_backtest_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
___________________ ERROR collecting tests/test_chart_api.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_chart_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_chart_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:30: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
___________________ ERROR collecting tests/test_scan_api.py ____________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
__________________ ERROR collecting tests/test_scan_smoke.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_analytics_api.py
ERROR tests/test_backtest_smoke.py
ERROR tests/test_chart_api.py
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
ERROR tests/test_scan_api.py
ERROR tests/test_scan_smoke.py
!!!!!!!!!!!!!!!!!!! Interrupted: 6 errors during collection !!!!!!!!!!!!!!!!!!!!
1 warning, 6 errors in 1.63s
2025-09-19 22:50:51 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-19 22:50:51 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-19 22:50:51 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-19 22:51:03 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758347473953.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10712.2
  }
}

2025-09-19 22:51:14 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758347479616.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5478
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758347488850.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9125.85
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 84,
  "sample": {
    "symbol": "DDOG",
    "score": 89.73,
    "entry": 69.6163,
    "stop": 67.7259,
    "targets": [
      71.8387,
      73.3203
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 66.8,
          "x2": "2025-09-15",
          "y2": 69.27,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 63.096,
          "x2": "2025-09-15",
          "y2": 68.41,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 68.84
        }
      ],
      "priceLevels": {
        "entry": 69.6163,
        "stop": 67.7259,
        "targets": [
          71.8387,
          73.3203
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.23",
        "slope gap 0.0095"
      ],
      "direction": "falling",
      "atr14": 4.025,
      "sector": "Technology"
    },
    "avg_price": 58.837666575113936,
    "avg_volume": 10589611.533333333,
    "key_levels": {
      "entry": 69.6163,
      "stop": 67.7259,
      "targets": [
        71.8387,
        73.3203
      ]
    },
    "atr14": 4.025,
    "sector": "Technology",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=DDOG+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758347597263.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 35096.68
  }
}
2025-09-19 22:53:17 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-20 05:53:20.745766', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-19 22:53:20 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-19 22:53:26 Deploy skipped (DO_DEPLOY!=1)
2025-09-19 22:53:26 Sleeping 5m before next iteration
2025-09-19 22:58:26 === Iteration 428 ===
2025-09-19 22:58:26 venv exists
2025-09-19 22:58:26 Installing Python requirements
2025-09-19 22:58:27 shots: node_modules present
2025-09-19 22:58:27 frontend: node_modules present
2025-09-19 22:58:27 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_analytics_api.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_analytics_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_analytics_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
________________ ERROR collecting tests/test_backtest_smoke.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_backtest_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_backtest_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
___________________ ERROR collecting tests/test_chart_api.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_chart_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_chart_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:30: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
___________________ ERROR collecting tests/test_scan_api.py ____________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
__________________ ERROR collecting tests/test_scan_smoke.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_analytics_api.py
ERROR tests/test_backtest_smoke.py
ERROR tests/test_chart_api.py
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
ERROR tests/test_scan_api.py
ERROR tests/test_scan_smoke.py
!!!!!!!!!!!!!!!!!!! Interrupted: 6 errors during collection !!!!!!!!!!!!!!!!!!!!
1 warning, 6 errors in 1.65s
2025-09-19 22:58:29 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-19 22:58:29 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-19 22:58:29 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-19 22:58:41 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758347930666.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9483.83
  }
}

2025-09-19 22:58:50 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758347935897.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5116
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758347945068.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9086.01
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 67,
  "sample": {
    "symbol": "BMY",
    "score": 83.77,
    "entry": 28.2506,
    "stop": 26.8389,
    "targets": [
      29.9898,
      31.1494
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 55.3463,
          "x2": "2025-09-15",
          "y2": 28.11,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 52.4474,
          "x2": "2025-09-15",
          "y2": 27.11,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 27.61
        }
      ],
      "priceLevels": {
        "entry": 28.2506,
        "stop": 26.8389,
        "targets": [
          29.9898,
          31.1494
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.34",
        "slope gap 0.0026"
      ],
      "direction": "falling",
      "atr14": 1.9824
    },
    "avg_price": 30.927191098531086,
    "avg_volume": 19501862.066666666,
    "key_levels": {
      "entry": 28.2506,
      "stop": 26.8389,
      "targets": [
        29.9898,
        31.1494
      ]
    },
    "atr14": 1.9824,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=BMY+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758348036965.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 18233.83
  }
}
2025-09-19 23:00:37 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-20 06:00:40.275266', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-19 23:00:40 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-19 23:00:46 Deploy skipped (DO_DEPLOY!=1)
2025-09-19 23:00:46 Sleeping 5m before next iteration
2025-09-19 23:05:46 === Iteration 429 ===
2025-09-19 23:05:46 venv exists
2025-09-19 23:05:46 Installing Python requirements
2025-09-19 23:05:46 shots: node_modules present
2025-09-19 23:05:46 frontend: node_modules present
2025-09-19 23:05:46 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_analytics_api.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_analytics_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_analytics_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
________________ ERROR collecting tests/test_backtest_smoke.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_backtest_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_backtest_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
___________________ ERROR collecting tests/test_chart_api.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_chart_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_chart_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:30: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
___________________ ERROR collecting tests/test_scan_api.py ____________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
__________________ ERROR collecting tests/test_scan_smoke.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_analytics_api.py
ERROR tests/test_backtest_smoke.py
ERROR tests/test_chart_api.py
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
ERROR tests/test_scan_api.py
ERROR tests/test_scan_smoke.py
!!!!!!!!!!!!!!!!!!! Interrupted: 6 errors during collection !!!!!!!!!!!!!!!!!!!!
1 warning, 6 errors in 1.73s
2025-09-19 23:05:49 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-19 23:05:49 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-19 23:05:49 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-19 23:06:02 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758348372849.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9687.3
  }
}

2025-09-19 23:06:13 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758348378302.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5260
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758348387465.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9088.44
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 84,
  "sample": {
    "symbol": "PFG",
    "score": 79.91,
    "entry": 24.5119,
    "stop": 23.4432,
    "targets": [
      25.3329,
      25.8802
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 27.0789,
          "x2": "2025-09-15",
          "y2": 24.39,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 25.7106,
          "x2": "2025-09-15",
          "y2": 23.68,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 24.035
        }
      ],
      "priceLevels": {
        "entry": 24.5119,
        "stop": 23.4432,
        "targets": [
          25.3329,
          25.8802
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.52",
        "slope gap 0.0006"
      ],
      "direction": "falling",
      "atr14": 1.0895
    },
    "avg_price": 23.848441632588706,
    "avg_volume": 229270023.86666667,
    "key_levels": {
      "entry": 24.5119,
      "stop": 23.4432,
      "targets": [
        25.3329,
        25.8802
      ]
    },
    "atr14": 1.0895,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=PFG+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758348473679.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 11648.16
  }
}
2025-09-19 23:07:53 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-20 06:07:57.531721', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-19 23:07:57 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-19 23:08:05 Deploy skipped (DO_DEPLOY!=1)
2025-09-19 23:08:05 Sleeping 5m before next iteration
2025-09-19 23:13:06 === Iteration 430 ===
2025-09-19 23:13:06 venv exists
2025-09-19 23:13:06 Installing Python requirements
2025-09-19 23:13:06 shots: node_modules present
2025-09-19 23:13:06 frontend: node_modules present
2025-09-19 23:13:06 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_analytics_api.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_analytics_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_analytics_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
________________ ERROR collecting tests/test_backtest_smoke.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_backtest_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_backtest_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
___________________ ERROR collecting tests/test_chart_api.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_chart_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_chart_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:30: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
___________________ ERROR collecting tests/test_scan_api.py ____________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
__________________ ERROR collecting tests/test_scan_smoke.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_analytics_api.py
ERROR tests/test_backtest_smoke.py
ERROR tests/test_chart_api.py
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
ERROR tests/test_scan_api.py
ERROR tests/test_scan_smoke.py
!!!!!!!!!!!!!!!!!!! Interrupted: 6 errors during collection !!!!!!!!!!!!!!!!!!!!
1 warning, 6 errors in 1.91s
2025-09-19 23:13:09 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-19 23:13:09 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-19 23:13:09 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-19 23:13:21 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758348811353.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9667.73
  }
}

2025-09-19 23:13:31 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758348816773.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5262
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758348825963.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9073.11
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 119,
  "sample": {
    "symbol": "BK",
    "score": 79.31,
    "entry": 147.9661,
    "stop": 139.7088,
    "targets": [
      155.7181,
      160.8861
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 268.3,
          "x2": "2025-09-15",
          "y2": 147.23,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 255.38,
          "x2": "2025-09-15",
          "y2": 141.12,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 144.175
        }
      ],
      "priceLevels": {
        "entry": 147.9661,
        "stop": 139.7088,
        "targets": [
          155.7181,
          160.8861
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.47",
        "slope gap 0.0523"
      ],
      "direction": "falling",
      "atr14": 9.2671
    },
    "avg_price": 131.64499944051107,
    "avg_volume": 7870458.8,
    "key_levels": {
      "entry": 147.9661,
      "stop": 139.7088,
      "targets": [
        155.7181,
        160.8861
      ]
    },
    "atr14": 9.2671,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=BK+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758348935776.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 33023.3
  }
}
2025-09-19 23:15:35 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-20 06:15:40.240546', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-19 23:15:40 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-19 23:15:46 Deploy skipped (DO_DEPLOY!=1)
2025-09-19 23:15:46 Sleeping 5m before next iteration
2025-09-19 23:20:46 === Iteration 431 ===
2025-09-19 23:20:46 venv exists
2025-09-19 23:20:46 Installing Python requirements
2025-09-19 23:20:47 shots: node_modules present
2025-09-19 23:20:47 frontend: node_modules present
2025-09-19 23:20:47 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_analytics_api.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_analytics_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_analytics_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
________________ ERROR collecting tests/test_backtest_smoke.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_backtest_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_backtest_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
___________________ ERROR collecting tests/test_chart_api.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_chart_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_chart_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:30: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
___________________ ERROR collecting tests/test_scan_api.py ____________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
__________________ ERROR collecting tests/test_scan_smoke.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_analytics_api.py
ERROR tests/test_backtest_smoke.py
ERROR tests/test_chart_api.py
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
ERROR tests/test_scan_api.py
ERROR tests/test_scan_smoke.py
!!!!!!!!!!!!!!!!!!! Interrupted: 6 errors during collection !!!!!!!!!!!!!!!!!!!!
1 warning, 6 errors in 1.67s
2025-09-19 23:20:49 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-19 23:20:49 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-19 23:20:49 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-19 23:21:02 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758349272347.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9808.33
  }
}

2025-09-19 23:21:12 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758349277702.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5171
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758349286963.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9182.08
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 96,
  "sample": {
    "symbol": "DTE",
    "score": 81.65,
    "entry": 99.3644,
    "stop": 93.6936,
    "targets": [
      105.2684,
      109.2043
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 145.09,
          "x2": "2025-09-15",
          "y2": 98.87,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 135.25,
          "x2": "2025-09-15",
          "y2": 94.64,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 96.755
        }
      ],
      "priceLevels": {
        "entry": 99.3644,
        "stop": 93.6936,
        "targets": [
          105.2684,
          109.2043
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.43",
        "slope gap 0.0121"
      ],
      "direction": "falling",
      "atr14": 5.8779,
      "sector": "Utilities"
    },
    "avg_price": 92.11766713460287,
    "avg_volume": 22313216.8,
    "key_levels": {
      "entry": 99.3644,
      "stop": 93.6936,
      "targets": [
        105.2684,
        109.2043
      ]
    },
    "atr14": 5.8779,
    "sector": "Utilities",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=DTE+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30330.92
  }
}
2025-09-19 23:23:11 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-20 06:23:14.637629', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-19 23:23:14 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-19 23:23:20 Deploy skipped (DO_DEPLOY!=1)
2025-09-19 23:23:20 Sleeping 5m before next iteration
2025-09-19 23:28:20 === Iteration 432 ===
2025-09-19 23:28:20 venv exists
2025-09-19 23:28:20 Installing Python requirements
2025-09-19 23:28:21 shots: node_modules present
2025-09-19 23:28:21 frontend: node_modules present
2025-09-19 23:28:21 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_analytics_api.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_analytics_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_analytics_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
________________ ERROR collecting tests/test_backtest_smoke.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_backtest_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_backtest_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
___________________ ERROR collecting tests/test_chart_api.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_chart_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_chart_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:30: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
___________________ ERROR collecting tests/test_scan_api.py ____________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
__________________ ERROR collecting tests/test_scan_smoke.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_analytics_api.py
ERROR tests/test_backtest_smoke.py
ERROR tests/test_chart_api.py
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
ERROR tests/test_scan_api.py
ERROR tests/test_scan_smoke.py
!!!!!!!!!!!!!!!!!!! Interrupted: 6 errors during collection !!!!!!!!!!!!!!!!!!!!
1 warning, 6 errors in 1.74s
2025-09-19 23:28:23 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-19 23:28:23 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-19 23:28:24 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-19 23:28:37 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758349727745.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10241.05
  }
}

2025-09-19 23:28:47 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758349734600.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6671
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758349744044.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9345.94
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 96,
  "sample": {
    "symbol": "NEE",
    "score": 88.78,
    "entry": 83.1637,
    "stop": 79.7346,
    "targets": [
      87.9836,
      91.1968
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 111.318,
          "x2": "2025-09-15",
          "y2": 82.75,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 103.285,
          "x2": "2025-09-15",
          "y2": 80.54,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 81.645
        }
      ],
      "priceLevels": {
        "entry": 83.1637,
        "stop": 79.7346,
        "targets": [
          87.9836,
          91.1968
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.28",
        "slope gap 0.0030"
      ],
      "direction": "falling",
      "atr14": 4.3001
    },
    "avg_price": 81.55921910603841,
    "avg_volume": 72961568.2,
    "key_levels": {
      "entry": 83.1637,
      "stop": 79.7346,
      "targets": [
        87.9836,
        91.1968
      ]
    },
    "atr14": 4.3001,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=NEE+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30398.99
  }
}
2025-09-19 23:30:48 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-20 06:30:51.739311', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-19 23:30:51 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-19 23:30:58 Deploy skipped (DO_DEPLOY!=1)
2025-09-19 23:30:58 Sleeping 5m before next iteration
2025-09-19 23:35:58 === Iteration 433 ===
2025-09-19 23:35:58 venv exists
2025-09-19 23:35:58 Installing Python requirements
2025-09-19 23:35:58 shots: node_modules present
2025-09-19 23:35:58 frontend: node_modules present
2025-09-19 23:35:58 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_analytics_api.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_analytics_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_analytics_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
________________ ERROR collecting tests/test_backtest_smoke.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_backtest_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_backtest_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
___________________ ERROR collecting tests/test_chart_api.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_chart_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_chart_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:30: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
___________________ ERROR collecting tests/test_scan_api.py ____________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
__________________ ERROR collecting tests/test_scan_smoke.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_analytics_api.py
ERROR tests/test_backtest_smoke.py
ERROR tests/test_chart_api.py
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
ERROR tests/test_scan_api.py
ERROR tests/test_scan_smoke.py
!!!!!!!!!!!!!!!!!!! Interrupted: 6 errors during collection !!!!!!!!!!!!!!!!!!!!
1 warning, 6 errors in 1.66s
2025-09-19 23:36:01 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-19 23:36:01 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-19 23:36:01 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-19 23:36:14 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758350185709.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10729.76
  }
}

2025-09-19 23:36:25 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758350192109.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6228
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758350201358.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9530.68
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 95,
  "sample": {
    "symbol": "NVR",
    "score": 78.1,
    "entry": 73.968,
    "stop": 70.0326,
    "targets": [
      77.4191,
      79.7199
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 104.2589,
          "x2": "2025-09-15",
          "y2": 73.6,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 98.507,
          "x2": "2025-09-15",
          "y2": 70.74,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 72.17
        }
      ],
      "priceLevels": {
        "entry": 73.968,
        "stop": 70.0326,
        "targets": [
          77.4191,
          79.7199
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.50",
        "slope gap 0.0006"
      ],
      "direction": "falling",
      "atr14": 4.9375
    },
    "avg_price": 67.39906870524088,
    "avg_volume": 82092737.9,
    "key_levels": {
      "entry": 73.968,
      "stop": 70.0326,
      "targets": [
        77.4191,
        79.7199
      ]
    },
    "atr14": 4.9375,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=NVR+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30459.77
  }
}
2025-09-19 23:38:26 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-20 06:38:29.618590', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-19 23:38:29 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-19 23:38:35 Deploy skipped (DO_DEPLOY!=1)
2025-09-19 23:38:35 Sleeping 5m before next iteration
2025-09-19 23:43:35 === Iteration 434 ===
2025-09-19 23:43:35 venv exists
2025-09-19 23:43:35 Installing Python requirements
2025-09-19 23:43:36 shots: node_modules present
2025-09-19 23:43:36 frontend: node_modules present
2025-09-19 23:43:36 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_analytics_api.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_analytics_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_analytics_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
________________ ERROR collecting tests/test_backtest_smoke.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_backtest_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_backtest_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
___________________ ERROR collecting tests/test_chart_api.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_chart_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_chart_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:30: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
___________________ ERROR collecting tests/test_scan_api.py ____________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
__________________ ERROR collecting tests/test_scan_smoke.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_analytics_api.py
ERROR tests/test_backtest_smoke.py
ERROR tests/test_chart_api.py
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
ERROR tests/test_scan_api.py
ERROR tests/test_scan_smoke.py
!!!!!!!!!!!!!!!!!!! Interrupted: 6 errors during collection !!!!!!!!!!!!!!!!!!!!
1 warning, 6 errors in 1.63s
2025-09-19 23:43:38 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-19 23:43:39 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-19 23:43:39 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-19 23:43:51 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758350641678.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10475.32
  }
}

2025-09-19 23:44:01 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758350647840.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6022
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758350657159.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9282.88
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 90,
  "sample": {
    "symbol": "DDOG",
    "score": 89.73,
    "entry": 69.6163,
    "stop": 67.7259,
    "targets": [
      71.8387,
      73.3203
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 66.8,
          "x2": "2025-09-15",
          "y2": 69.27,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 63.096,
          "x2": "2025-09-15",
          "y2": 68.41,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 68.84
        }
      ],
      "priceLevels": {
        "entry": 69.6163,
        "stop": 67.7259,
        "targets": [
          71.8387,
          73.3203
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.23",
        "slope gap 0.0095"
      ],
      "direction": "falling",
      "atr14": 4.025,
      "sector": "Technology"
    },
    "avg_price": 58.837666575113936,
    "avg_volume": 10589611.533333333,
    "key_levels": {
      "entry": 69.6163,
      "stop": 67.7259,
      "targets": [
        71.8387,
        73.3203
      ]
    },
    "atr14": 4.025,
    "sector": "Technology",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=DDOG+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30367.03
  }
}
2025-09-19 23:46:01 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-20 06:46:05.033850', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-19 23:46:05 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-19 23:46:10 Deploy skipped (DO_DEPLOY!=1)
2025-09-19 23:46:10 Sleeping 5m before next iteration
2025-09-19 23:51:10 === Iteration 435 ===
2025-09-19 23:51:10 venv exists
2025-09-19 23:51:10 Installing Python requirements
2025-09-19 23:51:11 shots: node_modules present
2025-09-19 23:51:11 frontend: node_modules present
2025-09-19 23:51:11 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_analytics_api.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_analytics_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_analytics_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
________________ ERROR collecting tests/test_backtest_smoke.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_backtest_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_backtest_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
___________________ ERROR collecting tests/test_chart_api.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_chart_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_chart_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:30: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
___________________ ERROR collecting tests/test_scan_api.py ____________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
__________________ ERROR collecting tests/test_scan_smoke.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_analytics_api.py
ERROR tests/test_backtest_smoke.py
ERROR tests/test_chart_api.py
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
ERROR tests/test_scan_api.py
ERROR tests/test_scan_smoke.py
!!!!!!!!!!!!!!!!!!! Interrupted: 6 errors during collection !!!!!!!!!!!!!!!!!!!!
1 warning, 6 errors in 1.61s
2025-09-19 23:51:14 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-19 23:51:14 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-19 23:51:14 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-19 23:51:26 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758351096657.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10378.15
  }
}

2025-09-19 23:51:36 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758351103234.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6398
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758351112674.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9321.49
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 84,
  "sample": {
    "symbol": "C",
    "score": 79.31,
    "entry": 147.9661,
    "stop": 139.7088,
    "targets": [
      155.7181,
      160.8861
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 268.3,
          "x2": "2025-09-15",
          "y2": 147.23,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 255.38,
          "x2": "2025-09-15",
          "y2": 141.12,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 144.175
        }
      ],
      "priceLevels": {
        "entry": 147.9661,
        "stop": 139.7088,
        "targets": [
          155.7181,
          160.8861
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.47",
        "slope gap 0.0523"
      ],
      "direction": "falling",
      "atr14": 9.2671
    },
    "avg_price": 131.64499944051107,
    "avg_volume": 7870458.8,
    "key_levels": {
      "entry": 147.9661,
      "stop": 139.7088,
      "targets": [
        155.7181,
        160.8861
      ]
    },
    "atr14": 9.2671,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=C+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30427.7
  }
}
2025-09-19 23:53:37 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-20 06:53:40.700523', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-19 23:53:40 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-19 23:53:47 Deploy skipped (DO_DEPLOY!=1)
2025-09-19 23:53:47 Sleeping 5m before next iteration
2025-09-19 23:58:47 === Iteration 436 ===
2025-09-19 23:58:47 venv exists
2025-09-19 23:58:47 Installing Python requirements
2025-09-19 23:58:47 shots: node_modules present
2025-09-19 23:58:47 frontend: node_modules present
2025-09-19 23:58:47 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_analytics_api.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_analytics_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_analytics_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
________________ ERROR collecting tests/test_backtest_smoke.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_backtest_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_backtest_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
___________________ ERROR collecting tests/test_chart_api.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_chart_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_chart_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:30: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
___________________ ERROR collecting tests/test_scan_api.py ____________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
__________________ ERROR collecting tests/test_scan_smoke.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_analytics_api.py
ERROR tests/test_backtest_smoke.py
ERROR tests/test_chart_api.py
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
ERROR tests/test_scan_api.py
ERROR tests/test_scan_smoke.py
!!!!!!!!!!!!!!!!!!! Interrupted: 6 errors during collection !!!!!!!!!!!!!!!!!!!!
1 warning, 6 errors in 1.86s
2025-09-19 23:58:50 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-19 23:58:50 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-19 23:58:50 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-19 23:59:03 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758351554056.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10241.43
  }
}

2025-09-19 23:59:14 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758351559351.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5188
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758351568638.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9186.74
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 107,
  "sample": {
    "symbol": "KR",
    "score": 89.73,
    "entry": 69.6163,
    "stop": 67.7259,
    "targets": [
      71.8387,
      73.3203
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 66.8,
          "x2": "2025-09-15",
          "y2": 69.27,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 63.096,
          "x2": "2025-09-15",
          "y2": 68.41,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 68.84
        }
      ],
      "priceLevels": {
        "entry": 69.6163,
        "stop": 67.7259,
        "targets": [
          71.8387,
          73.3203
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.23",
        "slope gap 0.0095"
      ],
      "direction": "falling",
      "atr14": 4.025,
      "sector": "Consumer Defensive"
    },
    "avg_price": 58.837666575113936,
    "avg_volume": 10589611.533333333,
    "key_levels": {
      "entry": 69.6163,
      "stop": 67.7259,
      "targets": [
        71.8387,
        73.3203
      ]
    },
    "atr14": 4.025,
    "sector": "Consumer Defensive",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=KR+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758351677067.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 32357.92
  }
}
2025-09-20 00:01:17 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-20 07:01:20.683344', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-20 00:01:20 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-20 00:01:27 Deploy skipped (DO_DEPLOY!=1)
2025-09-20 00:01:27 Sleeping 5m before next iteration
2025-09-20 00:06:27 === Iteration 437 ===
2025-09-20 00:06:27 venv exists
2025-09-20 00:06:27 Installing Python requirements
2025-09-20 00:06:27 shots: node_modules present
2025-09-20 00:06:27 frontend: node_modules present
2025-09-20 00:06:27 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_analytics_api.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_analytics_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_analytics_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
________________ ERROR collecting tests/test_backtest_smoke.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_backtest_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_backtest_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
___________________ ERROR collecting tests/test_chart_api.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_chart_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_chart_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:30: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
___________________ ERROR collecting tests/test_scan_api.py ____________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
__________________ ERROR collecting tests/test_scan_smoke.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_analytics_api.py
ERROR tests/test_backtest_smoke.py
ERROR tests/test_chart_api.py
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
ERROR tests/test_scan_api.py
ERROR tests/test_scan_smoke.py
!!!!!!!!!!!!!!!!!!! Interrupted: 6 errors during collection !!!!!!!!!!!!!!!!!!!!
1 warning, 6 errors in 1.69s
2025-09-20 00:06:30 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-20 00:06:30 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-20 00:06:30 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-20 00:06:42 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758352012671.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9765.7
  }
}

2025-09-20 00:06:52 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758352018843.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6009
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758352028553.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9581.42
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 56,
  "sample": {
    "symbol": "MNST",
    "score": 85.42,
    "entry": 187.121,
    "stop": 176.0616,
    "targets": [
      201.4358,
      210.9791
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 284.7549,
          "x2": "2025-09-15",
          "y2": 186.19,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 260.8968,
          "x2": "2025-09-15",
          "y2": 177.84,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 182.015
        }
      ],
      "priceLevels": {
        "entry": 187.121,
        "stop": 176.0616,
        "targets": [
          201.4358,
          210.9791
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.35",
        "slope gap 0.0668"
      ],
      "direction": "falling",
      "atr14": 9.7441,
      "sector": "Consumer Defensive"
    },
    "avg_price": 208.3150629679362,
    "avg_volume": 3596418.8666666667,
    "key_levels": {
      "entry": 187.121,
      "stop": 176.0616,
      "targets": [
        201.4358,
        210.9791
      ]
    },
    "atr14": 9.7441,
    "sector": "Consumer Defensive",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=MNST+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30474.78
  }
}
2025-09-20 00:08:53 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-20 07:08:56.638159', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-20 00:08:56 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-20 00:09:03 Deploy skipped (DO_DEPLOY!=1)
2025-09-20 00:09:03 Sleeping 5m before next iteration
2025-09-20 00:14:03 === Iteration 438 ===
2025-09-20 00:14:03 venv exists
2025-09-20 00:14:03 Installing Python requirements
2025-09-20 00:14:04 shots: node_modules present
2025-09-20 00:14:04 frontend: node_modules present
2025-09-20 00:14:04 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_analytics_api.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_analytics_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_analytics_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
________________ ERROR collecting tests/test_backtest_smoke.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_backtest_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_backtest_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
___________________ ERROR collecting tests/test_chart_api.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_chart_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_chart_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:30: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
___________________ ERROR collecting tests/test_scan_api.py ____________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
__________________ ERROR collecting tests/test_scan_smoke.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_analytics_api.py
ERROR tests/test_backtest_smoke.py
ERROR tests/test_chart_api.py
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
ERROR tests/test_scan_api.py
ERROR tests/test_scan_smoke.py
!!!!!!!!!!!!!!!!!!! Interrupted: 6 errors during collection !!!!!!!!!!!!!!!!!!!!
1 warning, 6 errors in 1.63s
2025-09-20 00:14:06 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-20 00:14:07 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-20 00:14:07 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-20 00:14:19 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758352469652.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10175.06
  }
}

2025-09-20 00:14:29 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758352476313.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6498
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758352485768.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9400.1
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 45,
  "sample": {
    "symbol": "WDAY",
    "score": 75.39,
    "entry": 43.0835,
    "stop": 44.8541,
    "targets": [
      41.6435,
      40.6834
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 36.0187,
          "x2": "2025-09-15",
          "y2": 44.41,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 33.6187,
          "x2": "2025-09-15",
          "y2": 43.3,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Rising wedge",
          "x": "2025-07-14",
          "y": 43.855
        }
      ],
      "priceLevels": {
        "entry": 43.0835,
        "stop": 44.8541,
        "targets": [
          41.6435,
          40.6834
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.46",
        "slope gap 0.0009"
      ],
      "direction": "rising",
      "atr14": 1.4733,
      "sector": "Technology"
    },
    "avg_price": 42.83451461791992,
    "avg_volume": 99902805.2,
    "key_levels": {
      "entry": 43.0835,
      "stop": 44.8541,
      "targets": [
        41.6435,
        40.6834
      ]
    },
    "atr14": 1.4733,
    "sector": "Technology",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=WDAY+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758352592666.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 33306.4
  }
}
2025-09-20 00:16:32 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-20 07:16:36.301461', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-20 00:16:36 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-20 00:16:42 Deploy skipped (DO_DEPLOY!=1)
2025-09-20 00:16:42 Sleeping 5m before next iteration
2025-09-20 00:21:42 === Iteration 439 ===
2025-09-20 00:21:42 venv exists
2025-09-20 00:21:42 Installing Python requirements
2025-09-20 00:21:42 shots: node_modules present
2025-09-20 00:21:42 frontend: node_modules present
2025-09-20 00:21:42 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_analytics_api.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_analytics_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_analytics_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
________________ ERROR collecting tests/test_backtest_smoke.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_backtest_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_backtest_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
___________________ ERROR collecting tests/test_chart_api.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_chart_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_chart_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:30: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
___________________ ERROR collecting tests/test_scan_api.py ____________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
__________________ ERROR collecting tests/test_scan_smoke.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_analytics_api.py
ERROR tests/test_backtest_smoke.py
ERROR tests/test_chart_api.py
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
ERROR tests/test_scan_api.py
ERROR tests/test_scan_smoke.py
!!!!!!!!!!!!!!!!!!! Interrupted: 6 errors during collection !!!!!!!!!!!!!!!!!!!!
1 warning, 6 errors in 1.63s
2025-09-20 00:21:45 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-20 00:21:45 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-20 00:21:45 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-20 00:21:56 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758352926174.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9891.76
  }
}

2025-09-20 00:22:06 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758352932319.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5959
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758352941656.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9331.6
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 69,
  "sample": {
    "symbol": "MS",
    "score": 88.78,
    "entry": 83.1637,
    "stop": 79.7346,
    "targets": [
      87.9836,
      91.1968
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 111.318,
          "x2": "2025-09-15",
          "y2": 82.75,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 103.285,
          "x2": "2025-09-15",
          "y2": 80.54,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 81.645
        }
      ],
      "priceLevels": {
        "entry": 83.1637,
        "stop": 79.7346,
        "targets": [
          87.9836,
          91.1968
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.28",
        "slope gap 0.0030"
      ],
      "direction": "falling",
      "atr14": 4.3001,
      "sector": "Financial Services"
    },
    "avg_price": 81.55921961466471,
    "avg_volume": 72961568.2,
    "key_levels": {
      "entry": 83.1637,
      "stop": 79.7346,
      "targets": [
        87.9836,
        91.1968
      ]
    },
    "atr14": 4.3001,
    "sector": "Financial Services",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=MS+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30194.41
  }
}
2025-09-20 00:24:05 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-20 07:24:09.262960', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-20 00:24:09 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-20 00:24:15 Deploy skipped (DO_DEPLOY!=1)
2025-09-20 00:24:15 Sleeping 5m before next iteration
2025-09-20 00:29:15 === Iteration 440 ===
2025-09-20 00:29:15 venv exists
2025-09-20 00:29:15 Installing Python requirements
2025-09-20 00:29:15 shots: node_modules present
2025-09-20 00:29:15 frontend: node_modules present
2025-09-20 00:29:15 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_analytics_api.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_analytics_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_analytics_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
________________ ERROR collecting tests/test_backtest_smoke.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_backtest_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_backtest_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
___________________ ERROR collecting tests/test_chart_api.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_chart_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_chart_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:30: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
___________________ ERROR collecting tests/test_scan_api.py ____________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
__________________ ERROR collecting tests/test_scan_smoke.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_analytics_api.py
ERROR tests/test_backtest_smoke.py
ERROR tests/test_chart_api.py
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
ERROR tests/test_scan_api.py
ERROR tests/test_scan_smoke.py
!!!!!!!!!!!!!!!!!!! Interrupted: 6 errors during collection !!!!!!!!!!!!!!!!!!!!
1 warning, 6 errors in 1.75s
2025-09-20 00:29:18 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-20 00:29:18 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-20 00:29:18 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-20 00:29:30 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758353381147.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10844.3
  }
}

2025-09-20 00:29:41 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758353386705.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5282
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758353395781.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9026.95
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 89,
  "sample": {
    "symbol": "DG",
    "score": 89.73,
    "entry": 69.6163,
    "stop": 67.7259,
    "targets": [
      71.8387,
      73.3203
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 66.8,
          "x2": "2025-09-15",
          "y2": 69.27,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 63.096,
          "x2": "2025-09-15",
          "y2": 68.41,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 68.84
        }
      ],
      "priceLevels": {
        "entry": 69.6163,
        "stop": 67.7259,
        "targets": [
          71.8387,
          73.3203
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.23",
        "slope gap 0.0095"
      ],
      "direction": "falling",
      "atr14": 4.025
    },
    "avg_price": 58.837666575113936,
    "avg_volume": 10589611.533333333,
    "key_levels": {
      "entry": 69.6163,
      "stop": 67.7259,
      "targets": [
        71.8387,
        73.3203
      ]
    },
    "atr14": 4.025,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=DG+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30314.07
  }
}
2025-09-20 00:31:41 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-20 07:31:45.139263', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-20 00:31:45 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-20 00:31:51 Deploy skipped (DO_DEPLOY!=1)
2025-09-20 00:31:51 Sleeping 5m before next iteration
2025-09-20 00:36:51 === Iteration 441 ===
2025-09-20 00:36:51 venv exists
2025-09-20 00:36:51 Installing Python requirements
2025-09-20 00:36:52 shots: node_modules present
2025-09-20 00:36:52 frontend: node_modules present
2025-09-20 00:36:52 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_analytics_api.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_analytics_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_analytics_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
________________ ERROR collecting tests/test_backtest_smoke.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_backtest_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_backtest_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
___________________ ERROR collecting tests/test_chart_api.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_chart_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_chart_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:30: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
___________________ ERROR collecting tests/test_scan_api.py ____________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
__________________ ERROR collecting tests/test_scan_smoke.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_analytics_api.py
ERROR tests/test_backtest_smoke.py
ERROR tests/test_chart_api.py
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
ERROR tests/test_scan_api.py
ERROR tests/test_scan_smoke.py
!!!!!!!!!!!!!!!!!!! Interrupted: 6 errors during collection !!!!!!!!!!!!!!!!!!!!
1 warning, 6 errors in 1.83s
2025-09-20 00:36:55 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-20 00:36:55 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-20 00:36:55 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-20 00:37:10 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758353840663.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10531.0
  }
}

2025-09-20 00:37:20 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758353846456.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5581
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758353855846.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9354.19
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 61,
  "sample": {
    "symbol": "DIS",
    "score": 89.73,
    "entry": 69.6163,
    "stop": 67.7259,
    "targets": [
      71.8387,
      73.3203
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 66.8,
          "x2": "2025-09-15",
          "y2": 69.27,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 63.096,
          "x2": "2025-09-15",
          "y2": 68.41,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 68.84
        }
      ],
      "priceLevels": {
        "entry": 69.6163,
        "stop": 67.7259,
        "targets": [
          71.8387,
          73.3203
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.23",
        "slope gap 0.0095"
      ],
      "direction": "falling",
      "atr14": 4.025,
      "sector": "Communication Services"
    },
    "avg_price": 58.837666575113936,
    "avg_volume": 10589611.533333333,
    "key_levels": {
      "entry": 69.6163,
      "stop": 67.7259,
      "targets": [
        71.8387,
        73.3203
      ]
    },
    "atr14": 4.025,
    "sector": "Communication Services",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=DIS+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758353963842.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 34105.38
  }
}
2025-09-20 00:39:24 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-20 07:39:27.645005', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-20 00:39:27 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-20 00:39:33 Deploy skipped (DO_DEPLOY!=1)
2025-09-20 00:39:33 Sleeping 5m before next iteration
2025-09-20 00:44:33 === Iteration 442 ===
2025-09-20 00:44:33 venv exists
2025-09-20 00:44:33 Installing Python requirements
2025-09-20 00:44:34 shots: node_modules present
2025-09-20 00:44:34 frontend: node_modules present
2025-09-20 00:44:34 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_analytics_api.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_analytics_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_analytics_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
________________ ERROR collecting tests/test_backtest_smoke.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_backtest_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_backtest_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
___________________ ERROR collecting tests/test_chart_api.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_chart_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_chart_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:30: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
___________________ ERROR collecting tests/test_scan_api.py ____________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
__________________ ERROR collecting tests/test_scan_smoke.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_analytics_api.py
ERROR tests/test_backtest_smoke.py
ERROR tests/test_chart_api.py
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
ERROR tests/test_scan_api.py
ERROR tests/test_scan_smoke.py
!!!!!!!!!!!!!!!!!!! Interrupted: 6 errors during collection !!!!!!!!!!!!!!!!!!!!
1 warning, 6 errors in 1.76s
2025-09-20 00:44:37 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-20 00:44:37 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-20 00:44:37 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-20 00:44:49 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758354299462.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9859.57
  }
}

2025-09-20 00:44:59 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758354305416.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5660
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758354314759.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9326.91
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 80,
  "sample": {
    "symbol": "TPR",
    "score": 78.41,
    "entry": 91.264,
    "stop": 86.9319,
    "targets": [
      94.9374,
      97.3862
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 135.8186,
          "x2": "2025-09-15",
          "y2": 90.81,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 129.6964,
          "x2": "2025-09-15",
          "y2": 87.81,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 89.31
        }
      ],
      "priceLevels": {
        "entry": 91.264,
        "stop": 86.9319,
        "targets": [
          94.9374,
          97.3862
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.49",
        "slope gap 0.0279"
      ],
      "direction": "falling",
      "atr14": 5.9722,
      "sector": "Consumer Cyclical"
    },
    "avg_price": 98.32547531127929,
    "avg_volume": 37724541.0,
    "key_levels": {
      "entry": 91.264,
      "stop": 86.9319,
      "targets": [
        94.9374,
        97.3862
      ]
    },
    "atr14": 5.9722,
    "sector": "Consumer Cyclical",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=TPR+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30351.0
  }
}
2025-09-20 00:46:59 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-20 07:47:02.738897', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-20 00:47:02 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-20 00:47:09 Deploy skipped (DO_DEPLOY!=1)
2025-09-20 00:47:09 Sleeping 5m before next iteration
2025-09-20 00:52:09 === Iteration 443 ===
2025-09-20 00:52:09 venv exists
2025-09-20 00:52:09 Installing Python requirements
2025-09-20 00:52:10 shots: node_modules present
2025-09-20 00:52:10 frontend: node_modules present
2025-09-20 00:52:10 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_analytics_api.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_analytics_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_analytics_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
________________ ERROR collecting tests/test_backtest_smoke.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_backtest_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_backtest_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
___________________ ERROR collecting tests/test_chart_api.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_chart_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_chart_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:30: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
___________________ ERROR collecting tests/test_scan_api.py ____________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
__________________ ERROR collecting tests/test_scan_smoke.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_analytics_api.py
ERROR tests/test_backtest_smoke.py
ERROR tests/test_chart_api.py
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
ERROR tests/test_scan_api.py
ERROR tests/test_scan_smoke.py
!!!!!!!!!!!!!!!!!!! Interrupted: 6 errors during collection !!!!!!!!!!!!!!!!!!!!
1 warning, 6 errors in 1.93s
2025-09-20 00:52:13 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-20 00:52:13 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-20 00:52:13 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-20 00:52:25 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758354755177.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9952.08
  }
}

2025-09-20 00:52:35 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758354759931.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 4657
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758354768960.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9073.14
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 80,
  "sample": {
    "symbol": "POOL",
    "score": 80.57,
    "entry": 144.2476,
    "stop": 138.5109,
    "targets": [
      148.5605,
      151.4357
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 164.837,
          "x2": "2025-09-15",
          "y2": 143.53,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 157.6489,
          "x2": "2025-09-15",
          "y2": 139.91,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 141.72
        }
      ],
      "priceLevels": {
        "entry": 144.2476,
        "stop": 138.5109,
        "targets": [
          148.5605,
          151.4357
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.50",
        "slope gap 0.0137"
      ],
      "direction": "falling",
      "atr14": 6.2749
    },
    "avg_price": 138.50807088216146,
    "avg_volume": 43099725.266666666,
    "key_levels": {
      "entry": 144.2476,
      "stop": 138.5109,
      "targets": [
        148.5605,
        151.4357
      ]
    },
    "atr14": 6.2749,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=POOL+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758354879738.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 37090.33
  }
}
2025-09-20 00:54:39 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-20 07:54:43.579935', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-20 00:54:43 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-20 00:54:49 Deploy skipped (DO_DEPLOY!=1)
2025-09-20 00:54:49 Sleeping 5m before next iteration
2025-09-20 00:59:49 === Iteration 444 ===
2025-09-20 00:59:49 venv exists
2025-09-20 00:59:49 Installing Python requirements
2025-09-20 00:59:50 shots: node_modules present
2025-09-20 00:59:50 frontend: node_modules present
2025-09-20 00:59:50 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_analytics_api.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_analytics_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_analytics_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
________________ ERROR collecting tests/test_backtest_smoke.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_backtest_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_backtest_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
___________________ ERROR collecting tests/test_chart_api.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_chart_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_chart_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:30: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
___________________ ERROR collecting tests/test_scan_api.py ____________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
__________________ ERROR collecting tests/test_scan_smoke.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_analytics_api.py
ERROR tests/test_backtest_smoke.py
ERROR tests/test_chart_api.py
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
ERROR tests/test_scan_api.py
ERROR tests/test_scan_smoke.py
!!!!!!!!!!!!!!!!!!! Interrupted: 6 errors during collection !!!!!!!!!!!!!!!!!!!!
1 warning, 6 errors in 1.61s
2025-09-20 00:59:52 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-20 00:59:52 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-20 00:59:52 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-20 01:00:05 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758355214861.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9555.64
  }
}

2025-09-20 01:00:14 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758355219764.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 4774
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758355229158.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9451.9
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 48,
  "sample": {
    "symbol": "BMY",
    "score": 83.77,
    "entry": 28.2506,
    "stop": 26.8389,
    "targets": [
      29.9898,
      31.1494
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 55.3463,
          "x2": "2025-09-15",
          "y2": 28.11,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 52.4474,
          "x2": "2025-09-15",
          "y2": 27.11,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 27.61
        }
      ],
      "priceLevels": {
        "entry": 28.2506,
        "stop": 26.8389,
        "targets": [
          29.9898,
          31.1494
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.34",
        "slope gap 0.0026"
      ],
      "direction": "falling",
      "atr14": 1.9824
    },
    "avg_price": 30.927190907796223,
    "avg_volume": 19501862.066666666,
    "key_levels": {
      "entry": 28.2506,
      "stop": 26.8389,
      "targets": [
        29.9898,
        31.1494
      ]
    },
    "atr14": 1.9824,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=BMY+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758355310872.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 11136.14
  }
}
2025-09-20 01:01:51 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-20 08:01:54.458096', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-20 01:01:54 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-20 01:02:02 Deploy skipped (DO_DEPLOY!=1)
2025-09-20 01:02:02 Sleeping 5m before next iteration
2025-09-20 01:07:02 === Iteration 445 ===
2025-09-20 01:07:02 venv exists
2025-09-20 01:07:02 Installing Python requirements
2025-09-20 01:07:03 shots: node_modules present
2025-09-20 01:07:03 frontend: node_modules present
2025-09-20 01:07:03 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_analytics_api.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_analytics_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_analytics_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
________________ ERROR collecting tests/test_backtest_smoke.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_backtest_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_backtest_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
___________________ ERROR collecting tests/test_chart_api.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_chart_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_chart_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:30: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
___________________ ERROR collecting tests/test_scan_api.py ____________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
__________________ ERROR collecting tests/test_scan_smoke.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_analytics_api.py
ERROR tests/test_backtest_smoke.py
ERROR tests/test_chart_api.py
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
ERROR tests/test_scan_api.py
ERROR tests/test_scan_smoke.py
!!!!!!!!!!!!!!!!!!! Interrupted: 6 errors during collection !!!!!!!!!!!!!!!!!!!!
1 warning, 6 errors in 1.64s
2025-09-20 01:07:06 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-20 01:07:06 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-20 01:07:06 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-20 01:07:17 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758355647259.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9643.82
  }
}

2025-09-20 01:07:27 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758355653236.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5713
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758355662658.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9423.26
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 105,
  "sample": {
    "symbol": "CAG",
    "score": 83.77,
    "entry": 28.2506,
    "stop": 26.8389,
    "targets": [
      29.9898,
      31.1494
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 55.3463,
          "x2": "2025-09-15",
          "y2": 28.11,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 52.4474,
          "x2": "2025-09-15",
          "y2": 27.11,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 27.61
        }
      ],
      "priceLevels": {
        "entry": 28.2506,
        "stop": 26.8389,
        "targets": [
          29.9898,
          31.1494
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.34",
        "slope gap 0.0026"
      ],
      "direction": "falling",
      "atr14": 1.9824
    },
    "avg_price": 30.927191098531086,
    "avg_volume": 19501862.066666666,
    "key_levels": {
      "entry": 28.2506,
      "stop": 26.8389,
      "targets": [
        29.9898,
        31.1494
      ]
    },
    "atr14": 1.9824,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=CAG+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758355745670.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10770.36
  }
}
2025-09-20 01:09:05 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-20 08:09:09.122813', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-20 01:09:09 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-20 01:09:14 Deploy skipped (DO_DEPLOY!=1)
2025-09-20 01:09:14 Sleeping 5m before next iteration
2025-09-20 01:14:14 === Iteration 446 ===
2025-09-20 01:14:14 venv exists
2025-09-20 01:14:14 Installing Python requirements
2025-09-20 01:14:15 shots: node_modules present
2025-09-20 01:14:15 frontend: node_modules present
2025-09-20 01:14:15 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_analytics_api.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_analytics_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_analytics_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
________________ ERROR collecting tests/test_backtest_smoke.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_backtest_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_backtest_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
___________________ ERROR collecting tests/test_chart_api.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_chart_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_chart_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:30: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
___________________ ERROR collecting tests/test_scan_api.py ____________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
__________________ ERROR collecting tests/test_scan_smoke.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_analytics_api.py
ERROR tests/test_backtest_smoke.py
ERROR tests/test_chart_api.py
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
ERROR tests/test_scan_api.py
ERROR tests/test_scan_smoke.py
!!!!!!!!!!!!!!!!!!! Interrupted: 6 errors during collection !!!!!!!!!!!!!!!!!!!!
1 warning, 6 errors in 1.59s
2025-09-20 01:14:18 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-20 01:14:18 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-20 01:14:18 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-20 01:14:29 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758356079158.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9477.24
  }
}

2025-09-20 01:14:39 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758356084656.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5303
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758356093857.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9240.56
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 110,
  "sample": {
    "symbol": "DDOG",
    "score": 89.73,
    "entry": 69.6163,
    "stop": 67.7259,
    "targets": [
      71.8387,
      73.3203
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 66.8,
          "x2": "2025-09-15",
          "y2": 69.27,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 63.096,
          "x2": "2025-09-15",
          "y2": 68.41,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 68.84
        }
      ],
      "priceLevels": {
        "entry": 69.6163,
        "stop": 67.7259,
        "targets": [
          71.8387,
          73.3203
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.23",
        "slope gap 0.0095"
      ],
      "direction": "falling",
      "atr14": 4.025,
      "sector": "Technology"
    },
    "avg_price": 58.837666575113936,
    "avg_volume": 10589611.533333333,
    "key_levels": {
      "entry": 69.6163,
      "stop": 67.7259,
      "targets": [
        71.8387,
        73.3203
      ]
    },
    "atr14": 4.025,
    "sector": "Technology",
    "chart_url": "https://legend-shots.onrender.com/reports/DDOG-1758356130566.png"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30404.98
  }
}
2025-09-20 01:16:38 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-20 08:16:41.584959', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-20 01:16:41 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-20 01:16:47 Deploy skipped (DO_DEPLOY!=1)
2025-09-20 01:16:47 Sleeping 5m before next iteration
2025-09-20 01:21:47 === Iteration 447 ===
2025-09-20 01:21:47 venv exists
2025-09-20 01:21:47 Installing Python requirements
2025-09-20 01:21:47 shots: node_modules present
2025-09-20 01:21:47 frontend: node_modules present
2025-09-20 01:21:47 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_analytics_api.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_analytics_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_analytics_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
________________ ERROR collecting tests/test_backtest_smoke.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_backtest_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_backtest_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
___________________ ERROR collecting tests/test_chart_api.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_chart_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_chart_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:30: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
___________________ ERROR collecting tests/test_scan_api.py ____________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
__________________ ERROR collecting tests/test_scan_smoke.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_analytics_api.py
ERROR tests/test_backtest_smoke.py
ERROR tests/test_chart_api.py
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
ERROR tests/test_scan_api.py
ERROR tests/test_scan_smoke.py
!!!!!!!!!!!!!!!!!!! Interrupted: 6 errors during collection !!!!!!!!!!!!!!!!!!!!
1 warning, 6 errors in 1.58s
2025-09-20 01:21:50 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-20 01:21:50 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-20 01:21:50 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-20 01:22:02 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758356533373.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10760.23
  }
}

2025-09-20 01:22:13 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758356538795.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5219
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758356548156.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9303.3
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 66,
  "sample": {
    "symbol": "WTW",
    "score": 75.39,
    "entry": 43.0835,
    "stop": 44.8541,
    "targets": [
      41.6435,
      40.6834
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 36.0187,
          "x2": "2025-09-15",
          "y2": 44.41,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 33.6187,
          "x2": "2025-09-15",
          "y2": 43.3,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Rising wedge",
          "x": "2025-07-14",
          "y": 43.855
        }
      ],
      "priceLevels": {
        "entry": 43.0835,
        "stop": 44.8541,
        "targets": [
          41.6435,
          40.6834
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.46",
        "slope gap 0.0009"
      ],
      "direction": "rising",
      "atr14": 1.4733
    },
    "avg_price": 42.83451449076335,
    "avg_volume": 99902805.2,
    "key_levels": {
      "entry": 43.0835,
      "stop": 44.8541,
      "targets": [
        41.6435,
        40.6834
      ]
    },
    "atr14": 1.4733,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=WTW+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30314.36
  }
}
2025-09-20 01:24:12 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-20 08:24:15.695307', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-20 01:24:15 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-20 01:24:21 Deploy skipped (DO_DEPLOY!=1)
2025-09-20 01:24:21 Sleeping 5m before next iteration
2025-09-20 01:29:21 === Iteration 448 ===
2025-09-20 01:29:21 venv exists
2025-09-20 01:29:21 Installing Python requirements
2025-09-20 01:29:21 shots: node_modules present
2025-09-20 01:29:21 frontend: node_modules present
2025-09-20 01:29:21 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_analytics_api.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_analytics_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_analytics_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
________________ ERROR collecting tests/test_backtest_smoke.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_backtest_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_backtest_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
___________________ ERROR collecting tests/test_chart_api.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_chart_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_chart_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:30: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
___________________ ERROR collecting tests/test_scan_api.py ____________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
__________________ ERROR collecting tests/test_scan_smoke.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_analytics_api.py
ERROR tests/test_backtest_smoke.py
ERROR tests/test_chart_api.py
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
ERROR tests/test_scan_api.py
ERROR tests/test_scan_smoke.py
!!!!!!!!!!!!!!!!!!! Interrupted: 6 errors during collection !!!!!!!!!!!!!!!!!!!!
1 warning, 6 errors in 1.60s
2025-09-20 01:29:24 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-20 01:29:24 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-20 01:29:24 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-20 01:29:35 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758356986137.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10161.59
  }
}

2025-09-20 01:29:46 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758356991659.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5305
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758357000970.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9205.38
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 146,
  "sample": {
    "symbol": "MCD",
    "score": 85.18,
    "entry": 58.2197,
    "stop": 54.9648,
    "targets": [
      62.9115,
      66.0394
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 107.6719,
          "x2": "2025-09-15",
          "y2": 57.93,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 99.8522,
          "x2": "2025-09-15",
          "y2": 55.52,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 56.725
        }
      ],
      "priceLevels": {
        "entry": 58.2197,
        "stop": 54.9648,
        "targets": [
          62.9115,
          66.0394
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.31",
        "slope gap 0.0213"
      ],
      "direction": "falling",
      "atr14": 4.0705
    },
    "avg_price": 53.67599245707194,
    "avg_volume": 10904334.166666666,
    "key_levels": {
      "entry": 58.2197,
      "stop": 54.9648,
      "targets": [
        62.9115,
        66.0394
      ]
    },
    "atr14": 4.0705,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=MCD+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "dummy",
    "overlay_applied": true,
    "fallback": true,
    "error": "shots status 502",
    "dry_run": false,
    "duration_ms": 16261.85,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    }
  }
}
2025-09-20 01:31:31 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-20 08:31:34.955002', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-20 01:31:35 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-20 01:31:41 Deploy skipped (DO_DEPLOY!=1)
2025-09-20 01:31:41 Sleeping 5m before next iteration
2025-09-20 01:36:41 === Iteration 449 ===
2025-09-20 01:36:41 venv exists
2025-09-20 01:36:41 Installing Python requirements
2025-09-20 01:36:41 shots: node_modules present
2025-09-20 01:36:41 frontend: node_modules present
2025-09-20 01:36:41 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_analytics_api.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_analytics_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_analytics_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
________________ ERROR collecting tests/test_backtest_smoke.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_backtest_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_backtest_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
___________________ ERROR collecting tests/test_chart_api.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_chart_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_chart_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:30: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
___________________ ERROR collecting tests/test_scan_api.py ____________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
__________________ ERROR collecting tests/test_scan_smoke.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_analytics_api.py
ERROR tests/test_backtest_smoke.py
ERROR tests/test_chart_api.py
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
ERROR tests/test_scan_api.py
ERROR tests/test_scan_smoke.py
!!!!!!!!!!!!!!!!!!! Interrupted: 6 errors during collection !!!!!!!!!!!!!!!!!!!!
1 warning, 6 errors in 1.64s
2025-09-20 01:36:44 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-20 01:36:44 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-20 01:36:44 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-20 01:36:55 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758357425469.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10131.81
  }
}

2025-09-20 01:37:05 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758357431913.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6018
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758357441052.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9077.01
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 68,
  "sample": {
    "symbol": "BMY",
    "score": 79.31,
    "entry": 147.9661,
    "stop": 139.7088,
    "targets": [
      155.7181,
      160.8861
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 268.3,
          "x2": "2025-09-15",
          "y2": 147.23,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 255.38,
          "x2": "2025-09-15",
          "y2": 141.12,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 144.175
        }
      ],
      "priceLevels": {
        "entry": 147.9661,
        "stop": 139.7088,
        "targets": [
          155.7181,
          160.8861
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.47",
        "slope gap 0.0523"
      ],
      "direction": "falling",
      "atr14": 9.2671
    },
    "avg_price": 131.64499944051107,
    "avg_volume": 7870458.8,
    "key_levels": {
      "entry": 147.9661,
      "stop": 139.7088,
      "targets": [
        155.7181,
        160.8861
      ]
    },
    "atr14": 9.2671,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=BMY+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30351.57
  }
}
2025-09-20 01:39:05 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-20 08:39:08.701066', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-20 01:39:08 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-20 01:39:14 Deploy skipped (DO_DEPLOY!=1)
2025-09-20 01:39:14 Sleeping 5m before next iteration
2025-09-20 01:44:14 === Iteration 450 ===
2025-09-20 01:44:14 venv exists
2025-09-20 01:44:14 Installing Python requirements
2025-09-20 01:44:15 shots: node_modules present
2025-09-20 01:44:15 frontend: node_modules present
2025-09-20 01:44:15 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_analytics_api.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_analytics_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_analytics_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
________________ ERROR collecting tests/test_backtest_smoke.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_backtest_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_backtest_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
___________________ ERROR collecting tests/test_chart_api.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_chart_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_chart_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:30: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
___________________ ERROR collecting tests/test_scan_api.py ____________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
__________________ ERROR collecting tests/test_scan_smoke.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_analytics_api.py
ERROR tests/test_backtest_smoke.py
ERROR tests/test_chart_api.py
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
ERROR tests/test_scan_api.py
ERROR tests/test_scan_smoke.py
!!!!!!!!!!!!!!!!!!! Interrupted: 6 errors during collection !!!!!!!!!!!!!!!!!!!!
1 warning, 6 errors in 1.61s
2025-09-20 01:44:17 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-20 01:44:17 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-20 01:44:17 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-20 01:44:28 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758357879069.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10254.8
  }
}

2025-09-20 01:44:39 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758357884430.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5022
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758357893785.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9335.19
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 100,
  "sample": {
    "symbol": "PODD",
    "score": 77.63,
    "entry": 116.9921,
    "stop": 111.7512,
    "targets": [
      120.6223,
      123.0425
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 126.9555,
          "x2": "2025-09-15",
          "y2": 116.41,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 120.9051,
          "x2": "2025-09-15",
          "y2": 112.88,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 114.645
        }
      ],
      "priceLevels": {
        "entry": 116.9921,
        "stop": 111.7512,
        "targets": [
          120.6223,
          123.0425
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.58",
        "slope gap 0.0041"
      ],
      "direction": "falling",
      "atr14": 4.8872
    },
    "avg_price": 106.9111338297526,
    "avg_volume": 21778796.066666666,
    "key_levels": {
      "entry": 116.9921,
      "stop": 111.7512,
      "targets": [
        120.6223,
        123.0425
      ]
    },
    "atr14": 4.8872,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=PODD+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30298.43
  }
}
2025-09-20 01:46:38 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-20 08:46:41.555850', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-20 01:46:41 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-20 01:46:47 Deploy skipped (DO_DEPLOY!=1)
2025-09-20 01:46:47 Sleeping 5m before next iteration
2025-09-20 01:51:47 === Iteration 451 ===
2025-09-20 01:51:47 venv exists
2025-09-20 01:51:47 Installing Python requirements
2025-09-20 01:51:48 shots: node_modules present
2025-09-20 01:51:48 frontend: node_modules present
2025-09-20 01:51:48 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_analytics_api.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_analytics_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_analytics_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
________________ ERROR collecting tests/test_backtest_smoke.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_backtest_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_backtest_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
___________________ ERROR collecting tests/test_chart_api.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_chart_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_chart_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:30: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
___________________ ERROR collecting tests/test_scan_api.py ____________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
__________________ ERROR collecting tests/test_scan_smoke.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_analytics_api.py
ERROR tests/test_backtest_smoke.py
ERROR tests/test_chart_api.py
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
ERROR tests/test_scan_api.py
ERROR tests/test_scan_smoke.py
!!!!!!!!!!!!!!!!!!! Interrupted: 6 errors during collection !!!!!!!!!!!!!!!!!!!!
1 warning, 6 errors in 1.68s
2025-09-20 01:51:50 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-20 01:51:50 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-20 01:51:50 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-20 01:52:03 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758358333268.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10060.31
  }
}

2025-09-20 01:52:13 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758358338539.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5065
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758358347851.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9238.59
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 121,
  "sample": {
    "symbol": "DDOG",
    "score": 89.73,
    "entry": 69.6163,
    "stop": 67.7259,
    "targets": [
      71.8387,
      73.3203
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 66.8,
          "x2": "2025-09-15",
          "y2": 69.27,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 63.096,
          "x2": "2025-09-15",
          "y2": 68.41,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 68.84
        }
      ],
      "priceLevels": {
        "entry": 69.6163,
        "stop": 67.7259,
        "targets": [
          71.8387,
          73.3203
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.23",
        "slope gap 0.0095"
      ],
      "direction": "falling",
      "atr14": 4.025,
      "sector": "Technology"
    },
    "avg_price": 58.837666575113936,
    "avg_volume": 10589611.533333333,
    "key_levels": {
      "entry": 69.6163,
      "stop": 67.7259,
      "targets": [
        71.8387,
        73.3203
      ]
    },
    "atr14": 4.025,
    "sector": "Technology",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=DDOG+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758358428772.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10377.91
  }
}
2025-09-20 01:53:48 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-20 08:53:52.321011', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-20 01:53:52 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-20 01:53:59 Deploy skipped (DO_DEPLOY!=1)
2025-09-20 01:53:59 Sleeping 5m before next iteration
2025-09-20 01:58:59 === Iteration 452 ===
2025-09-20 01:58:59 venv exists
2025-09-20 01:58:59 Installing Python requirements
2025-09-20 01:58:59 shots: node_modules present
2025-09-20 01:58:59 frontend: node_modules present
2025-09-20 01:58:59 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_analytics_api.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_analytics_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_analytics_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
________________ ERROR collecting tests/test_backtest_smoke.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_backtest_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_backtest_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
___________________ ERROR collecting tests/test_chart_api.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_chart_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_chart_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:30: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
___________________ ERROR collecting tests/test_scan_api.py ____________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
__________________ ERROR collecting tests/test_scan_smoke.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_analytics_api.py
ERROR tests/test_backtest_smoke.py
ERROR tests/test_chart_api.py
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
ERROR tests/test_scan_api.py
ERROR tests/test_scan_smoke.py
!!!!!!!!!!!!!!!!!!! Interrupted: 6 errors during collection !!!!!!!!!!!!!!!!!!!!
1 warning, 6 errors in 1.62s
2025-09-20 01:59:02 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-20 01:59:02 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-20 01:59:02 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-20 01:59:14 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758358763267.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9145.37
  }
}

2025-09-20 01:59:23 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758358768478.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5051
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758358777766.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9496.13
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 86,
  "sample": {
    "symbol": "WDAY",
    "score": 79.2,
    "entry": 10.1405,
    "stop": 9.3951,
    "targets": [
      10.8562,
      11.3333
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 11.1702,
          "x2": "2025-09-15",
          "y2": 10.09,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 9.9774,
          "x2": "2025-09-15",
          "y2": 9.49,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 9.79
        }
      ],
      "priceLevels": {
        "entry": 10.1405,
        "stop": 9.3951,
        "targets": [
          10.8562,
          11.3333
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.50",
        "slope gap 0.0010"
      ],
      "direction": "falling",
      "atr14": 0.5638,
      "sector": "Technology"
    },
    "avg_price": 8.947466834386189,
    "avg_volume": 66231772.46666667,
    "key_levels": {
      "entry": 10.1405,
      "stop": 9.3951,
      "targets": [
        10.8562,
        11.3333
      ]
    },
    "atr14": 0.5638,
    "sector": "Technology",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=WDAY+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30252.75
  }
}
2025-09-20 02:01:22 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-20 09:01:26.036717', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-20 02:01:26 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-20 02:01:32 Deploy skipped (DO_DEPLOY!=1)
2025-09-20 02:01:32 Sleeping 5m before next iteration
2025-09-20 02:06:32 === Iteration 453 ===
2025-09-20 02:06:32 venv exists
2025-09-20 02:06:32 Installing Python requirements
2025-09-20 02:06:33 shots: node_modules present
2025-09-20 02:06:33 frontend: node_modules present
2025-09-20 02:06:33 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_analytics_api.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_analytics_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_analytics_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
________________ ERROR collecting tests/test_backtest_smoke.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_backtest_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_backtest_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
___________________ ERROR collecting tests/test_chart_api.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_chart_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_chart_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:30: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
___________________ ERROR collecting tests/test_scan_api.py ____________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
__________________ ERROR collecting tests/test_scan_smoke.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_analytics_api.py
ERROR tests/test_backtest_smoke.py
ERROR tests/test_chart_api.py
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
ERROR tests/test_scan_api.py
ERROR tests/test_scan_smoke.py
!!!!!!!!!!!!!!!!!!! Interrupted: 6 errors during collection !!!!!!!!!!!!!!!!!!!!
1 warning, 6 errors in 1.61s
2025-09-20 02:06:35 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-20 02:06:35 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-20 02:06:35 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-20 02:06:46 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758359216448.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10119.73
  }
}

2025-09-20 02:06:56 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758359222958.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6319
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758359232163.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9173.65
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 117,
  "sample": {
    "symbol": "DOC",
    "score": 81.65,
    "entry": 99.3644,
    "stop": 93.6936,
    "targets": [
      105.2684,
      109.2043
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 145.09,
          "x2": "2025-09-15",
          "y2": 98.87,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 135.25,
          "x2": "2025-09-15",
          "y2": 94.64,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 96.755
        }
      ],
      "priceLevels": {
        "entry": 99.3644,
        "stop": 93.6936,
        "targets": [
          105.2684,
          109.2043
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.43",
        "slope gap 0.0121"
      ],
      "direction": "falling",
      "atr14": 5.8779,
      "sector": "Real Estate"
    },
    "avg_price": 92.11766713460287,
    "avg_volume": 22313216.8,
    "key_levels": {
      "entry": 99.3644,
      "stop": 93.6936,
      "targets": [
        105.2684,
        109.2043
      ]
    },
    "atr14": 5.8779,
    "sector": "Real Estate",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=DOC+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758359338060.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 31214.63
  }
}
2025-09-20 02:08:58 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-20 09:09:01.700892', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-20 02:09:01 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-20 02:09:08 Deploy skipped (DO_DEPLOY!=1)
2025-09-20 02:09:08 Sleeping 5m before next iteration
2025-09-20 02:14:08 === Iteration 454 ===
2025-09-20 02:14:08 venv exists
2025-09-20 02:14:08 Installing Python requirements
2025-09-20 02:14:08 shots: node_modules present
2025-09-20 02:14:08 frontend: node_modules present
2025-09-20 02:14:08 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_analytics_api.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_analytics_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_analytics_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
________________ ERROR collecting tests/test_backtest_smoke.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_backtest_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_backtest_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
___________________ ERROR collecting tests/test_chart_api.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_chart_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_chart_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:30: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
___________________ ERROR collecting tests/test_scan_api.py ____________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
__________________ ERROR collecting tests/test_scan_smoke.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_analytics_api.py
ERROR tests/test_backtest_smoke.py
ERROR tests/test_chart_api.py
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
ERROR tests/test_scan_api.py
ERROR tests/test_scan_smoke.py
!!!!!!!!!!!!!!!!!!! Interrupted: 6 errors during collection !!!!!!!!!!!!!!!!!!!!
1 warning, 6 errors in 1.64s
2025-09-20 02:14:11 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-20 02:14:11 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-20 02:14:11 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-20 02:14:23 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758359673164.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9634.22
  }
}

2025-09-20 02:14:33 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758359678971.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5618
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758359688257.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9224.49
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 109,
  "sample": {
    "symbol": "MOH",
    "score": 85.42,
    "entry": 187.121,
    "stop": 176.0616,
    "targets": [
      201.4358,
      210.9791
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 284.755,
          "x2": "2025-09-15",
          "y2": 186.19,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 260.8969,
          "x2": "2025-09-15",
          "y2": 177.84,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 182.015
        }
      ],
      "priceLevels": {
        "entry": 187.121,
        "stop": 176.0616,
        "targets": [
          201.4358,
          210.9791
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.35",
        "slope gap 0.0668"
      ],
      "direction": "falling",
      "atr14": 9.7441,
      "sector": "Healthcare"
    },
    "avg_price": 208.3150629679362,
    "avg_volume": 3596418.8666666667,
    "key_levels": {
      "entry": 187.121,
      "stop": 176.0616,
      "targets": [
        201.4358,
        210.9791
      ]
    },
    "atr14": 9.7441,
    "sector": "Healthcare",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=MOH+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758359798859.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 36690.52
  }
}
2025-09-20 02:16:39 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-20 09:16:42.404539', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-20 02:16:42 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-20 02:16:48 Deploy skipped (DO_DEPLOY!=1)
2025-09-20 02:16:48 Sleeping 5m before next iteration
2025-09-20 02:21:48 === Iteration 455 ===
2025-09-20 02:21:48 venv exists
2025-09-20 02:21:48 Installing Python requirements
2025-09-20 02:21:49 shots: node_modules present
2025-09-20 02:21:49 frontend: node_modules present
2025-09-20 02:21:49 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_analytics_api.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_analytics_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_analytics_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
________________ ERROR collecting tests/test_backtest_smoke.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_backtest_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_backtest_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
___________________ ERROR collecting tests/test_chart_api.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_chart_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_chart_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:30: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
___________________ ERROR collecting tests/test_scan_api.py ____________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
__________________ ERROR collecting tests/test_scan_smoke.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_analytics_api.py
ERROR tests/test_backtest_smoke.py
ERROR tests/test_chart_api.py
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
ERROR tests/test_scan_api.py
ERROR tests/test_scan_smoke.py
!!!!!!!!!!!!!!!!!!! Interrupted: 6 errors during collection !!!!!!!!!!!!!!!!!!!!
1 warning, 6 errors in 1.65s
2025-09-20 02:21:51 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-20 02:21:51 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-20 02:21:52 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-20 02:22:03 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758360133051.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9463.84
  }
}

2025-09-20 02:22:13 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758360137967.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 4809
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758360147362.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9318.98
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 70,
  "sample": {
    "symbol": "PH",
    "score": 79.91,
    "entry": 24.5119,
    "stop": 23.4432,
    "targets": [
      25.3329,
      25.8802
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 27.0789,
          "x2": "2025-09-15",
          "y2": 24.39,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 25.7106,
          "x2": "2025-09-15",
          "y2": 23.68,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 24.035
        }
      ],
      "priceLevels": {
        "entry": 24.5119,
        "stop": 23.4432,
        "targets": [
          25.3329,
          25.8802
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.52",
        "slope gap 0.0006"
      ],
      "direction": "falling",
      "atr14": 1.0895
    },
    "avg_price": 23.848441632588706,
    "avg_volume": 229270023.86666667,
    "key_levels": {
      "entry": 24.5119,
      "stop": 23.4432,
      "targets": [
        25.3329,
        25.8802
      ]
    },
    "atr14": 1.0895,
    "chart_url": "https://legend-shots.onrender.com/reports/PH-1758360206234.png"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758360243573.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 32159.26
  }
}
2025-09-20 02:24:03 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-20 09:24:07.226687', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-20 02:24:07 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-20 02:24:13 Deploy skipped (DO_DEPLOY!=1)
2025-09-20 02:24:13 Sleeping 5m before next iteration
2025-09-20 02:29:13 === Iteration 456 ===
2025-09-20 02:29:13 venv exists
2025-09-20 02:29:13 Installing Python requirements
2025-09-20 02:29:14 shots: node_modules present
2025-09-20 02:29:14 frontend: node_modules present
2025-09-20 02:29:14 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_analytics_api.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_analytics_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_analytics_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
________________ ERROR collecting tests/test_backtest_smoke.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_backtest_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_backtest_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
___________________ ERROR collecting tests/test_chart_api.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_chart_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_chart_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:30: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
___________________ ERROR collecting tests/test_scan_api.py ____________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
__________________ ERROR collecting tests/test_scan_smoke.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_analytics_api.py
ERROR tests/test_backtest_smoke.py
ERROR tests/test_chart_api.py
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
ERROR tests/test_scan_api.py
ERROR tests/test_scan_smoke.py
!!!!!!!!!!!!!!!!!!! Interrupted: 6 errors during collection !!!!!!!!!!!!!!!!!!!!
1 warning, 6 errors in 1.62s
2025-09-20 02:29:16 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-20 02:29:16 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-20 02:29:16 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-20 02:29:28 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758360578244.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9880.81
  }
}

2025-09-20 02:29:38 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758360584129.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5712
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758360593194.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9152.92
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 74,
  "sample": {
    "symbol": "MCD",
    "score": 85.18,
    "entry": 58.2197,
    "stop": 54.9648,
    "targets": [
      62.9115,
      66.0394
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 107.672,
          "x2": "2025-09-15",
          "y2": 57.93,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 99.8522,
          "x2": "2025-09-15",
          "y2": 55.52,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 56.725
        }
      ],
      "priceLevels": {
        "entry": 58.2197,
        "stop": 54.9648,
        "targets": [
          62.9115,
          66.0394
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.31",
        "slope gap 0.0213"
      ],
      "direction": "falling",
      "atr14": 4.0705
    },
    "avg_price": 53.67599258422852,
    "avg_volume": 10904334.166666666,
    "key_levels": {
      "entry": 58.2197,
      "stop": 54.9648,
      "targets": [
        62.9115,
        66.0394
      ]
    },
    "atr14": 4.0705,
    "chart_url": "https://legend-shots.onrender.com/reports/MCD-1758360645077.png"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758360687357.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 38362.53
  }
}
2025-09-20 02:31:27 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-20 09:31:31.062038', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-20 02:31:31 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-20 02:31:36 Deploy skipped (DO_DEPLOY!=1)
2025-09-20 02:31:36 Sleeping 5m before next iteration
2025-09-20 02:36:36 === Iteration 457 ===
2025-09-20 02:36:36 venv exists
2025-09-20 02:36:36 Installing Python requirements
2025-09-20 02:36:37 shots: node_modules present
2025-09-20 02:36:37 frontend: node_modules present
2025-09-20 02:36:37 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_analytics_api.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_analytics_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_analytics_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
________________ ERROR collecting tests/test_backtest_smoke.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_backtest_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_backtest_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
___________________ ERROR collecting tests/test_chart_api.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_chart_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_chart_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:30: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
___________________ ERROR collecting tests/test_scan_api.py ____________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
__________________ ERROR collecting tests/test_scan_smoke.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_analytics_api.py
ERROR tests/test_backtest_smoke.py
ERROR tests/test_chart_api.py
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
ERROR tests/test_scan_api.py
ERROR tests/test_scan_smoke.py
!!!!!!!!!!!!!!!!!!! Interrupted: 6 errors during collection !!!!!!!!!!!!!!!!!!!!
1 warning, 6 errors in 1.62s
2025-09-20 02:36:40 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-20 02:36:40 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-20 02:36:40 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      72383 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-20 02:36:51 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758361021160.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9867.54
  }
}

2025-09-20 02:37:01 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758361027229.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5890
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758361036943.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9780.16
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 93,
  "sample": {
    "symbol": "MOH",
    "score": 85.42,
    "entry": 187.121,
    "stop": 176.0616,
    "targets": [
      201.4358,
      210.9791
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 284.7549,
          "x2": "2025-09-15",
          "y2": 186.19,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 260.8968,
          "x2": "2025-09-15",
          "y2": 177.84,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 182.015
        }
      ],
      "priceLevels": {
        "entry": 187.121,
        "stop": 176.0616,
        "targets": [
          201.4358,
          210.9791
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.35",
        "slope gap 0.0668"
      ],
      "direction": "falling",
      "atr14": 9.7441,
      "sector": "Healthcare"
    },
    "avg_price": 208.3150629679362,
    "avg_volume": 3596418.8666666667,
    "key_levels": {
      "entry": 187.121,
      "stop": 176.0616,
      "targets": [
        201.4358,
        210.9791
      ]
    },
    "atr14": 9.7441,
    "sector": "Healthcare",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=MOH+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30248.47
  }
}
2025-09-20 02:39:00 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-20 09:39:04.400624', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-20 02:39:04 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-20 02:39:10 Deploy skipped (DO_DEPLOY!=1)
2025-09-20 02:39:10 Sleeping 5m before next iteration
2025-09-20 02:44:10 === Iteration 458 ===
2025-09-20 02:44:10 venv exists
2025-09-20 02:44:10 Installing Python requirements
2025-09-20 02:44:11 shots: node_modules present
2025-09-20 02:44:11 frontend: node_modules present
2025-09-20 02:44:11 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_analytics_api.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_analytics_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_analytics_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
________________ ERROR collecting tests/test_backtest_smoke.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_backtest_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_backtest_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
___________________ ERROR collecting tests/test_chart_api.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_chart_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_chart_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:30: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
___________________ ERROR collecting tests/test_scan_api.py ____________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
__________________ ERROR collecting tests/test_scan_smoke.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_analytics_api.py
ERROR tests/test_backtest_smoke.py
ERROR tests/test_chart_api.py
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
ERROR tests/test_scan_api.py
ERROR tests/test_scan_smoke.py
!!!!!!!!!!!!!!!!!!! Interrupted: 6 errors during collection !!!!!!!!!!!!!!!!!!!!
1 warning, 6 errors in 1.61s
2025-09-20 02:44:13 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-20 02:44:13 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-20 02:44:13 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      73459 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-20 02:44:25 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758361475374.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10148.45
  }
}

2025-09-20 02:44:35 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758361480695.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5251
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758361489965.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9220.55
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 114,
  "sample": {
    "symbol": "BMY",
    "score": 79.31,
    "entry": 147.9661,
    "stop": 139.7088,
    "targets": [
      155.7181,
      160.8861
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 268.3,
          "x2": "2025-09-15",
          "y2": 147.23,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 255.38,
          "x2": "2025-09-15",
          "y2": 141.12,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 144.175
        }
      ],
      "priceLevels": {
        "entry": 147.9661,
        "stop": 139.7088,
        "targets": [
          155.7181,
          160.8861
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.47",
        "slope gap 0.0523"
      ],
      "direction": "falling",
      "atr14": 9.2671
    },
    "avg_price": 131.64499944051107,
    "avg_volume": 7870458.8,
    "key_levels": {
      "entry": 147.9661,
      "stop": 139.7088,
      "targets": [
        155.7181,
        160.8861
      ]
    },
    "atr14": 9.2671,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=BMY+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30466.46
  }
}
2025-09-20 02:46:34 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-20 09:46:38.056698', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-20 02:46:38 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-20 02:46:43 Deploy skipped (DO_DEPLOY!=1)
2025-09-20 02:46:43 Sleeping 5m before next iteration
2025-09-20 02:51:43 === Iteration 459 ===
2025-09-20 02:51:43 venv exists
2025-09-20 02:51:43 Installing Python requirements
2025-09-20 02:51:44 shots: node_modules present
2025-09-20 02:51:44 frontend: node_modules present
2025-09-20 02:51:44 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_analytics_api.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_analytics_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_analytics_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
________________ ERROR collecting tests/test_backtest_smoke.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_backtest_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_backtest_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
___________________ ERROR collecting tests/test_chart_api.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_chart_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_chart_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:30: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
___________________ ERROR collecting tests/test_scan_api.py ____________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
__________________ ERROR collecting tests/test_scan_smoke.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_analytics_api.py
ERROR tests/test_backtest_smoke.py
ERROR tests/test_chart_api.py
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
ERROR tests/test_scan_api.py
ERROR tests/test_scan_smoke.py
!!!!!!!!!!!!!!!!!!! Interrupted: 6 errors during collection !!!!!!!!!!!!!!!!!!!!
1 warning, 6 errors in 1.63s
2025-09-20 02:51:46 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-20 02:51:47 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-20 02:51:47 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      73459 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-20 02:51:58 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758361928474.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9994.85
  }
}

2025-09-20 02:52:08 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758361934343.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5663
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758361943562.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9188.82
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 85,
  "sample": {
    "symbol": "BMY",
    "score": 78.05,
    "entry": 212.0644,
    "stop": 220.2305,
    "targets": [
      202.7104,
      196.4744
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 258.59,
          "x2": "2025-09-15",
          "y2": 218.05,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 243.0,
          "x2": "2025-09-15",
          "y2": 213.13,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Rising wedge",
          "x": "2025-07-14",
          "y": 215.59
        }
      ],
      "priceLevels": {
        "entry": 212.0644,
        "stop": 220.2305,
        "targets": [
          202.7104,
          196.4744
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.32",
        "slope gap 0.0312"
      ],
      "direction": "rising",
      "atr14": 12.6664
    },
    "avg_price": 200.43299916585286,
    "avg_volume": 40516107.0,
    "key_levels": {
      "entry": 212.0644,
      "stop": 220.2305,
      "targets": [
        202.7104,
        196.4744
      ]
    },
    "atr14": 12.6664,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=BMY+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758362033153.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 15650.29
  }
}
2025-09-20 02:53:53 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-20 09:53:56.694273', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-20 02:53:56 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-20 02:54:03 Deploy skipped (DO_DEPLOY!=1)
2025-09-20 02:54:03 Sleeping 5m before next iteration
2025-09-20 02:59:03 === Iteration 460 ===
2025-09-20 02:59:03 venv exists
2025-09-20 02:59:03 Installing Python requirements
2025-09-20 02:59:04 shots: node_modules present
2025-09-20 02:59:04 frontend: node_modules present
2025-09-20 02:59:04 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)

==================================== ERRORS ====================================
_________________ ERROR collecting tests/test_analytics_api.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_analytics_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_analytics_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
________________ ERROR collecting tests/test_backtest_smoke.py _________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_backtest_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_backtest_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
___________________ ERROR collecting tests/test_chart_api.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_chart_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_chart_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
_________________ ERROR collecting tests/test_foreman_utils.py _________________
tests/test_foreman_utils.py:3: in <module>
    from foreman_bot import _slugify, _branch_name
foreman_bot.py:30: in <module>
    app = slack_bolt.App(token=SLACK_BOT_TOKEN)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:379: in __init__
    self._init_middleware_list(
.venv/lib/python3.13/site-packages/slack_bolt/app/app.py:442: in _init_middleware_list
    raise BoltError(error_token_required())
E   slack_bolt.error.BoltError: Either an env variable `SLACK_BOT_TOKEN` or `token` argument in the constructor is required.
___________________ ERROR collecting tests/test_scan_api.py ____________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_api.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_api.py:5: in <module>
    import service_api
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
__________________ ERROR collecting tests/test_scan_smoke.py ___________________
ImportError while importing test module '/Users/kyleholthaus/Projects/LegendAI/tests/test_scan_smoke.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.13/3.13.4/Frameworks/Python.framework/Versions/3.13/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_scan_smoke.py:5: in <module>
    from service_api import app
service_api.py:33: in <module>
    from legend_room_backend.paper_trade import record as record_paper_trade
E   ModuleNotFoundError: No module named 'legend_room_backend.paper_trade'
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
ERROR tests/test_analytics_api.py
ERROR tests/test_backtest_smoke.py
ERROR tests/test_chart_api.py
ERROR tests/test_foreman_utils.py - slack_bolt.error.BoltError: Either an env...
ERROR tests/test_scan_api.py
ERROR tests/test_scan_smoke.py
!!!!!!!!!!!!!!!!!!! Interrupted: 6 errors during collection !!!!!!!!!!!!!!!!!!!!
1 warning, 6 errors in 1.66s
2025-09-20 02:59:06 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-20 02:59:06 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-20 02:59:06 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      73459 kyleholthaus   16u  IPv6 0xb653d600593d84fd      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:33,135", "levelname": "INFO", "message": "request", "request_id": "0524dcf8-f2da-460b-a4e7-b13463939142", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64322 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:33,175", "levelname": "INFO", "message": "request", "request_id": "b43de1c9-671f-465a-a032-30c1a4dbfe64", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 20}
INFO:     127.0.0.1:64323 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:48,993", "levelname": "INFO", "message": "request", "request_id": "7685bd47-8838-4335-92b2-bf536dee9cd9", "path": "/api/v1/chart", "method": "GET", "status_code": 200, "duration_ms": 9912}
INFO:     127.0.0.1:64354 - "GET /api/v1/chart?symbol=NVDA HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:02,867", "levelname": "INFO", "message": "request", "request_id": "c7ffa19d-e823-4d99-9521-d9b45858d419", "path": "/api/v1/scan", "method": "GET", "status_code": 200, "duration_ms": 73814}
INFO:     127.0.0.1:64357 - "GET /api/v1/scan?pattern=wedge&universe=sp500&timeframe=1wk&limit=3 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:52:33,362", "levelname": "INFO", "message": "request", "request_id": "0faa4644-cb62-47cb-9c96-2e1887253ba3", "path": "/api/v1/chart", "method": "POST", "status_code": 200, "duration_ms": 30437}
INFO:     127.0.0.1:64921 - "POST /api/v1/chart?symbol=AAPL HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5762,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167438773.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-20 02:59:18 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758362367952.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9747.87
  }
}

2025-09-20 02:59:28 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758362372692.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 4636
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758362382070.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9322.36
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 86,
  "sample": {
    "symbol": "MCD",
    "score": 85.18,
    "entry": 58.2197,
    "stop": 54.9648,
    "targets": [
      62.9115,
      66.0394
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 107.672,
          "x2": "2025-09-15",
          "y2": 57.93,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 99.8522,
          "x2": "2025-09-15",
          "y2": 55.52,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 56.725
        }
      ],
      "priceLevels": {
        "entry": 58.2197,
        "stop": 54.9648,
        "targets": [
          62.9115,
          66.0394
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.31",
        "slope gap 0.0213"
      ],
      "direction": "falling",
      "atr14": 4.0705
    },
    "avg_price": 53.67599245707194,
    "avg_volume": 10904334.166666666,
    "key_levels": {
      "entry": 58.2197,
      "stop": 54.9648,
      "targets": [
        62.9115,
        66.0394
      ]
    },
    "atr14": 4.0705,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=MCD+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758362488768.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 32927.92
  }
}
2025-09-20 03:01:29 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-20 10:01:32.291226', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-20 03:01:32 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-20 03:01:38 Deploy skipped (DO_DEPLOY!=1)
2025-09-20 03:01:38 Sleeping 5m before next iteration
