[ERROR] warp-run-docs not found. Install it or provide the command to run.
2025-09-16 23:45:44 === LegendAI Doc Superrun starting (PROJECT_DIR=/Users/kyleholthaus/Projects/LegendAI/scripts/..) ===
2025-09-16 23:45:44 === Iteration 1 ===
2025-09-16 23:45:44 venv exists
2025-09-16 23:45:44 Installing Python requirements
2025-09-16 23:45:45 shots: node_modules present
2025-09-16 23:45:45 frontend: node_modules present
2025-09-16 23:45:45 Running unit tests (pytest)
2025-09-16 23:45:45 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-16 23:45:45 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-16 23:45:45 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Tue Sep 16 23:24:30 2025)
fe: 1 windows (created Tue Sep 16 23:24:30 2025)
legend-docs: 1 windows (created Tue Sep 16 23:45:43 2025)
shots: 1 windows (created Tue Sep 16 23:24:30 2025)

Ports:
python3.1 13856 kyleholthaus    3u  IPv4 0x4abf832ca3f99a36      0t0  TCP 127.0.0.1:8000 (LISTEN)
node      13863 kyleholthaus   14u  IPv6 0x5cc7c8cf63bff8a9      0t0  TCP *:3010 (LISTEN)
node      13929 kyleholthaus   16u  IPv6  0x83471d01bbeda1e      0t0  TCP *:3001 (LISTEN)
python3.1 17179 kyleholthaus    3u  IPv4 0x4abf832ca3f99a36      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-16 23:39:07,650", "levelname": "INFO", "message": "request", "request_id": "ddc6c52d-dd1c-45c4-bb76-ab0ffc3c2d2a", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 94}
INFO:     127.0.0.1:58144 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-16 23:39:07,658", "levelname": "INFO", "message": "request", "request_id": "0ac19e07-b6b7-449f-9d16-8d2c2d3016a9", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 5}
INFO:     127.0.0.1:58147 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-16 23:45:45,267", "levelname": "INFO", "message": "request", "request_id": "450d0eb9-ef41-40ed-b411-a76b28e631ff", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:58326 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-16 23:45:45,401", "levelname": "INFO", "message": "request", "request_id": "b3abc967-a220-4dc0-b4f8-0532e5b05dce", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:58329 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-16 23:45:45,666", "levelname": "INFO", "message": "request", "request_id": "89f6fb10-293f-4e73-aac9-18036e82617c", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 252}
INFO:     127.0.0.1:58330 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
legend-shots listening on :3010
---- logs/fe.log ----

> kyle-thomas-portfolio@0.1.0 dev
> next dev -p 3001

  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1238ms
2025-09-16 23:45:45 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

67.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=NVDA+Chart",
  "meta": {
    "source": "dummy",
    "overlay_applied": false,
    "fallback": true,
    "error": "shots status 500"
  }
}

2025-09-16 23:45:46 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
67.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=NVDA+Chart",
  "dry_run": true
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=NVDA+Chart",
  "meta": {
    "source": "dummy",
    "overlay_applied": false,
    "fallback": true,
    "error": "shots status 500"
  }
}
2025-09-16 23:45:46 Running sample backtest
2025-09-16 23:45:46 Phase 4 optional: AI trading demo
2025-09-16 23:45:46 Deploy skipped (DO_DEPLOY!=1)
2025-09-16 23:45:46 Sleeping 5m before next iteration
2025-09-16 23:47:10 === LegendAI Doc Superrun starting (PROJECT_DIR=/Users/kyleholthaus/Projects/LegendAI/scripts/..) ===
2025-09-16 23:47:10 === Iteration 1 ===
2025-09-16 23:47:10 venv exists
2025-09-16 23:47:10 Installing Python requirements
2025-09-16 23:47:11 shots: node_modules present
2025-09-16 23:47:11 frontend: node_modules present
2025-09-16 23:47:11 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
...................                                                      [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

test_production.py::test_health_endpoint
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_health_endpoint returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_vcp_scan
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_vcp_scan returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_api_endpoints
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_api_endpoints returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_database_operations
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_database_operations returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_performance
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_performance returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
19 passed, 6 warnings in 11.36s
2025-09-16 23:47:24 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-16 23:47:24 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-16 23:47:24 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Tue Sep 16 23:24:30 2025)
fe: 1 windows (created Tue Sep 16 23:24:30 2025)
legend-docs: 1 windows (created Tue Sep 16 23:47:09 2025)
shots: 1 windows (created Tue Sep 16 23:24:30 2025)

Ports:
python3.1 13856 kyleholthaus    3u  IPv4 0x4abf832ca3f99a36      0t0  TCP 127.0.0.1:8000 (LISTEN)
node      13863 kyleholthaus   14u  IPv6 0x5cc7c8cf63bff8a9      0t0  TCP *:3010 (LISTEN)
node      13929 kyleholthaus   16u  IPv6  0x83471d01bbeda1e      0t0  TCP *:3001 (LISTEN)
python3.1 17179 kyleholthaus    3u  IPv4 0x4abf832ca3f99a36      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-16 23:47:18,879", "levelname": "INFO", "message": "request", "request_id": "4b7b4be8-b757-46c9-9121-6c2476612a99", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 40}
INFO:     127.0.0.1:58395 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-16 23:47:18,885", "levelname": "INFO", "message": "request", "request_id": "af0d24fe-41d7-4377-8ff9-9fe6e417d636", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:58398 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-16 23:47:24,238", "levelname": "INFO", "message": "request", "request_id": "2c2a01e8-2c36-46f4-a45c-8275efd32fff", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:58423 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-16 23:47:24,361", "levelname": "INFO", "message": "request", "request_id": "4d6b354d-6c1d-4394-b1cb-193b79ba25eb", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 0}
INFO:     127.0.0.1:58426 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-16 23:47:24,394", "levelname": "INFO", "message": "request", "request_id": "36a0c904-50be-40f5-9d4f-9682ebdce28d", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 22}
INFO:     127.0.0.1:58427 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
legend-shots listening on :3010
---- logs/fe.log ----

> kyle-thomas-portfolio@0.1.0 dev
> next dev -p 3001

  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1238ms
2025-09-16 23:47:24 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

67.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=NVDA+Chart",
  "meta": {
    "source": "dummy",
    "overlay_applied": false,
    "fallback": true,
    "error": "shots status 500"
  }
}

2025-09-16 23:47:24 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
67.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=NVDA+Chart",
  "dry_run": true
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=NVDA+Chart",
  "meta": {
    "source": "dummy",
    "overlay_applied": false,
    "fallback": true,
    "error": "shots status 500"
  }
}
2025-09-16 23:47:24 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-16 23:47:28 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
üì¶ installed ta
üì¶ installed transformers
üì¶ installed torch
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-16 23:48:19 Deploy skipped (DO_DEPLOY!=1)
2025-09-16 23:48:19 Sleeping 5m before next iteration
2025-09-16 23:53:19 === Iteration 2 ===
2025-09-16 23:53:19 venv exists
2025-09-16 23:53:19 Installing Python requirements
2025-09-16 23:53:21 shots: node_modules present
2025-09-16 23:53:21 frontend: node_modules present
2025-09-16 23:53:21 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
...................                                                      [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

test_production.py::test_health_endpoint
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_health_endpoint returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_vcp_scan
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_vcp_scan returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_api_endpoints
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_api_endpoints returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_database_operations
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_database_operations returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_performance
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_performance returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
19 passed, 6 warnings in 7.97s
2025-09-16 23:53:31 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-16 23:53:31 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-16 23:53:31 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Tue Sep 16 23:24:30 2025)
fe: 1 windows (created Tue Sep 16 23:24:30 2025)
legend-docs: 1 windows (created Tue Sep 16 23:47:09 2025)
shots: 1 windows (created Tue Sep 16 23:24:30 2025)

Ports:
python3.1 13856 kyleholthaus    3u  IPv4 0x4abf832ca3f99a36      0t0  TCP 127.0.0.1:8000 (LISTEN)
node      13863 kyleholthaus   14u  IPv6 0x5cc7c8cf63bff8a9      0t0  TCP *:3010 (LISTEN)
node      13929 kyleholthaus   16u  IPv6  0x83471d01bbeda1e      0t0  TCP *:3001 (LISTEN)
python3.1 17179 kyleholthaus    3u  IPv4 0x4abf832ca3f99a36      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-16 23:53:26,385", "levelname": "INFO", "message": "request", "request_id": "155173bf-2c32-4eb0-b4d4-f0e377661808", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 9}
INFO:     127.0.0.1:58686 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-16 23:53:26,389", "levelname": "INFO", "message": "request", "request_id": "f1e08d6d-e661-44ce-86b8-a3face60a536", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:58689 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-16 23:53:31,182", "levelname": "INFO", "message": "request", "request_id": "5977e767-d3be-49a3-a25e-69b865f8b52e", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:58713 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-16 23:53:31,271", "levelname": "INFO", "message": "request", "request_id": "24670296-c84a-49af-a165-ebd4c20d36de", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 0}
INFO:     127.0.0.1:58716 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-16 23:53:31,294", "levelname": "INFO", "message": "request", "request_id": "57bd117a-c49a-43e4-acb5-fa232d7486d8", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 14}
INFO:     127.0.0.1:58717 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
legend-shots listening on :3010
---- logs/fe.log ----

> kyle-thomas-portfolio@0.1.0 dev
> next dev -p 3001

  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1238ms
2025-09-16 23:53:31 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

67.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=NVDA+Chart",
  "meta": {
    "source": "dummy",
    "overlay_applied": false,
    "fallback": true,
    "error": "shots status 500"
  }
}

2025-09-16 23:53:31 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
67.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=NVDA+Chart",
  "dry_run": true
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=NVDA+Chart",
  "meta": {
    "source": "dummy",
    "overlay_applied": false,
    "fallback": true,
    "error": "shots status 500"
  }
}
2025-09-16 23:53:31 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-17 06:53:35.095813', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-16 23:53:35 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-16 23:53:41 Deploy skipped (DO_DEPLOY!=1)
2025-09-16 23:53:41 Sleeping 5m before next iteration
2025-09-16 23:58:41 === Iteration 3 ===
2025-09-16 23:58:41 venv exists
2025-09-16 23:58:41 Installing Python requirements
2025-09-16 23:58:42 shots: node_modules present
2025-09-16 23:58:42 frontend: node_modules present
2025-09-16 23:58:42 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
...................                                                      [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

test_production.py::test_health_endpoint
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_health_endpoint returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_vcp_scan
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_vcp_scan returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_api_endpoints
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_api_endpoints returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_database_operations
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_database_operations returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_performance
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_performance returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
19 passed, 6 warnings in 8.02s
2025-09-16 23:58:51 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-16 23:58:51 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-16 23:58:52 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Tue Sep 16 23:24:30 2025)
fe: 1 windows (created Tue Sep 16 23:24:30 2025)
legend-docs: 1 windows (created Tue Sep 16 23:47:09 2025)
shots: 1 windows (created Tue Sep 16 23:24:30 2025)

Ports:
python3.1 13856 kyleholthaus    3u  IPv4 0x4abf832ca3f99a36      0t0  TCP 127.0.0.1:8000 (LISTEN)
node      13863 kyleholthaus   14u  IPv6 0x5cc7c8cf63bff8a9      0t0  TCP *:3010 (LISTEN)
node      13929 kyleholthaus   16u  IPv6  0x83471d01bbeda1e      0t0  TCP *:3001 (LISTEN)
python3.1 17179 kyleholthaus    3u  IPv4 0x4abf832ca3f99a36      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-16 23:58:47,051", "levelname": "INFO", "message": "request", "request_id": "34e915fc-3683-460a-9bfa-a7b101fd4447", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 9}
INFO:     127.0.0.1:58904 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-16 23:58:47,056", "levelname": "INFO", "message": "request", "request_id": "a7eafac0-a25f-4ade-b84f-8278850a5e82", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:58907 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-16 23:58:52,031", "levelname": "INFO", "message": "request", "request_id": "124fb2f1-1914-49b7-bd20-1985a70fb958", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 0}
INFO:     127.0.0.1:58938 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-16 23:58:52,172", "levelname": "INFO", "message": "request", "request_id": "28c08f7d-be59-440d-8b59-391fbcf911c3", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:58941 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-16 23:58:52,199", "levelname": "INFO", "message": "request", "request_id": "0b3777f2-a53b-4bc9-8cc3-e134d0c21a1e", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 15}
INFO:     127.0.0.1:58942 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
legend-shots listening on :3010
---- logs/fe.log ----

> kyle-thomas-portfolio@0.1.0 dev
> next dev -p 3001

  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1238ms
2025-09-16 23:58:52 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

67.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=NVDA+Chart",
  "meta": {
    "source": "dummy",
    "overlay_applied": false,
    "fallback": true,
    "error": "shots status 500"
  }
}

2025-09-16 23:58:52 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
67.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=NVDA+Chart",
  "dry_run": true
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=NVDA+Chart",
  "meta": {
    "source": "dummy",
    "overlay_applied": false,
    "fallback": true,
    "error": "shots status 500"
  }
}
2025-09-16 23:58:52 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-17 06:58:56.070244', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-16 23:58:56 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-16 23:59:02 Deploy skipped (DO_DEPLOY!=1)
2025-09-16 23:59:02 Sleeping 5m before next iteration
2025-09-17 13:42:26 === LegendAI Doc Superrun starting (PROJECT_DIR=/Users/kyleholthaus/Projects/LegendAI/scripts/..) ===
2025-09-17 13:42:26 === Iteration 1 ===
2025-09-17 13:42:26 venv exists
2025-09-17 13:42:26 Installing Python requirements
2025-09-17 13:42:27 shots: node_modules present
2025-09-17 13:42:27 frontend: node_modules present
2025-09-17 13:42:27 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
...................                                                      [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

test_production.py::test_health_endpoint
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_health_endpoint returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_vcp_scan
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_vcp_scan returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_api_endpoints
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_api_endpoints returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_database_operations
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_database_operations returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_performance
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_performance returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
19 passed, 6 warnings in 11.74s
2025-09-17 13:42:41 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 13:42:41 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 13:42:41 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 13:42:23 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 13:42:33,222", "levelname": "INFO", "message": "request", "request_id": "1da04e1b-8c8f-4612-9850-a975208ad9d1", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 22}
INFO:     127.0.0.1:61556 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 13:42:33,227", "levelname": "INFO", "message": "request", "request_id": "72420fb6-85c6-4691-bde4-6c95219eec2b", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:61559 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 13:42:41,287", "levelname": "INFO", "message": "request", "request_id": "9f3a3c3a-5dea-448d-bde4-39df59de3ce7", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:61582 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 13:42:53,632", "levelname": "INFO", "message": "request", "request_id": "5f4aea18-129f-4d97-b40a-a838011ce723", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 4}
INFO:     127.0.0.1:61616 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 13:42:53,938", "levelname": "INFO", "message": "request", "request_id": "6c4cc860-79e6-4520-858f-54af4049066d", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 285}
INFO:     127.0.0.1:61617 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 12052,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758141773329.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 7223,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758141781071.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 13:43:01 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758141788751.png",
  "meta": {
    "source": "http://127.0.0.1:3010",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 7066.97
  }
}

2025-09-17 13:43:08 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758141796056.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 7164
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758141805181.png",
  "meta": {
    "source": "http://127.0.0.1:3010",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8610.3
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 145,
  "sample": {
    "symbol": "DG",
    "score": 89.73,
    "entry": 69.6163,
    "stop": 67.7259,
    "targets": [
      71.8387,
      73.3203
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 66.8,
          "x2": "2025-09-15",
          "y2": 69.27,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 63.096,
          "x2": "2025-09-15",
          "y2": 68.41,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 68.84
        }
      ],
      "priceLevels": {
        "entry": 69.6163,
        "stop": 67.7259,
        "targets": [
          71.8387,
          73.3203
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.23",
        "slope gap 0.0095"
      ],
      "direction": "falling",
      "atr14": 4.025,
      "sector": "Consumer Defensive"
    },
    "avg_price": 58.824666595458986,
    "avg_volume": 10344398.1,
    "key_levels": {
      "entry": 69.6163,
      "stop": 67.7259,
      "targets": [
        71.8387,
        73.3203
      ]
    },
    "atr14": 4.025,
    "sector": "Consumer Defensive",
    "chart_url": "http://127.0.0.1:3010/reports/DG-1758141850165.png"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/AAPL-1758141858596.png",
  "meta": {
    "source": "http://127.0.0.1:3010",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8200.72
  }
}
2025-09-17 13:44:18 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 13:44:22 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 13:44:39 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 13:44:39 Sleeping 5m before next iteration
2025-09-17 13:47:32 === LegendAI Doc Superrun starting (PROJECT_DIR=/Users/kyleholthaus/Projects/LegendAI/scripts/..) ===
2025-09-17 13:47:32 === Iteration 1 ===
2025-09-17 13:47:32 venv exists
2025-09-17 13:47:32 Installing Python requirements
2025-09-17 13:47:34 shots: node_modules present
2025-09-17 13:47:34 frontend: node_modules present
2025-09-17 13:47:34 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
...................                                                      [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

test_production.py::test_health_endpoint
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_health_endpoint returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_vcp_scan
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_vcp_scan returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_api_endpoints
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_api_endpoints returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_database_operations
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_database_operations returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_performance
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_performance returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
19 passed, 6 warnings in 9.04s
2025-09-17 13:47:44 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 13:47:44 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 13:47:44 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 13:47:31 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 13:47:39,356", "levelname": "INFO", "message": "request", "request_id": "480d355a-fbcc-41e3-8625-937242764502", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 18}
INFO:     127.0.0.1:62879 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 13:47:39,363", "levelname": "INFO", "message": "request", "request_id": "76c0f7ed-7195-4a81-b7aa-4061484146b4", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:62882 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 13:47:44,968", "levelname": "INFO", "message": "request", "request_id": "181a9b5d-e249-482c-b61f-d4eebe6ae0cb", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:62907 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 13:47:52,165", "levelname": "INFO", "message": "request", "request_id": "6a8fc347-7114-42bc-9565-d7f3ab3da13c", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:62945 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 13:47:52,230", "levelname": "INFO", "message": "request", "request_id": "3bf184e2-776c-4af0-a335-cdd3aa4f968f", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 46}
INFO:     127.0.0.1:62946 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 7031,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758142071921.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5208,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758142077359.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 13:47:57 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758142082711.png",
  "meta": {
    "source": "http://127.0.0.1:3010",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 4919.73
  }
}

2025-09-17 13:48:02 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758142088448.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5548
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758142094125.png",
  "meta": {
    "source": "http://127.0.0.1:3010",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 5616.3
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 164,
  "sample": {
    "symbol": "ARE",
    "score": 88.11,
    "entry": 85.0699,
    "stop": 80.3286,
    "targets": [
      92.4979,
      97.4499
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 91.66,
          "x2": "2025-09-15",
          "y2": 84.6467,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 79.28,
          "x2": "2025-09-15",
          "y2": 81.14,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 82.8933
        }
      ],
      "priceLevels": {
        "entry": 85.0699,
        "stop": 80.3286,
        "targets": [
          92.4979,
          97.4499
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.28",
        "slope gap 0.0170"
      ],
      "direction": "falling",
      "atr14": 4.5891,
      "sector": "Real Estate"
    },
    "avg_price": 67.01066678365072,
    "avg_volume": 13664847.3,
    "key_levels": {
      "entry": 85.0699,
      "stop": 80.3286,
      "targets": [
        92.4979,
        97.4499
      ]
    },
    "atr14": 4.5891,
    "sector": "Real Estate",
    "chart_url": "http://127.0.0.1:3010/reports/ARE-1758142128442.png"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/AAPL-1758142133805.png",
  "meta": {
    "source": "http://127.0.0.1:3010",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 5226.74
  }
}
2025-09-17 13:48:53 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-17 20:48:57.458963', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 13:48:57 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 13:49:04 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 13:49:04 Sleeping 5m before next iteration
2025-09-17 13:54:04 === Iteration 2 ===
2025-09-17 13:54:04 venv exists
2025-09-17 13:54:04 Installing Python requirements
2025-09-17 13:54:05 shots: node_modules present
2025-09-17 13:54:05 frontend: node_modules present
2025-09-17 13:54:05 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
...................                                                      [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

test_production.py::test_health_endpoint
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_health_endpoint returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_vcp_scan
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_vcp_scan returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_api_endpoints
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_api_endpoints returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_database_operations
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_database_operations returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_performance
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_performance returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
19 passed, 6 warnings in 8.50s
2025-09-17 13:54:15 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 13:54:15 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 13:54:15 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 13:47:31 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 13:54:10,512", "levelname": "INFO", "message": "request", "request_id": "8f703556-36ca-4a37-a3dd-f5575957682e", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 16}
INFO:     127.0.0.1:64122 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 13:54:10,517", "levelname": "INFO", "message": "request", "request_id": "899583e5-1f67-4dfc-bbef-40cc1bc65256", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:64125 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 13:54:15,794", "levelname": "INFO", "message": "request", "request_id": "7a1c3b2d-553f-4593-b51f-b8be7655cb89", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64148 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 13:54:23,075", "levelname": "INFO", "message": "request", "request_id": "b9d101e8-d82a-48c6-83ef-dcd0e1820762", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:64180 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 13:54:23,143", "levelname": "INFO", "message": "request", "request_id": "138f2ca4-761a-4d02-b7f7-7a5c6a90d2df", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 48}
INFO:     127.0.0.1:64181 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 7125,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758142462856.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5197,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758142468254.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 13:54:28 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758142473073.png",
  "meta": {
    "source": "http://127.0.0.1:3010",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 4648.77
  }
}

2025-09-17 13:54:33 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758142477807.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 4626
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758142483595.png",
  "meta": {
    "source": "http://127.0.0.1:3010",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 5702.3
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 131,
  "sample": {
    "symbol": "MCD",
    "score": 85.33,
    "entry": 58.2197,
    "stop": 54.9945,
    "targets": [
      62.9115,
      66.0394
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 107.672,
          "x2": "2025-09-15",
          "y2": 57.93,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 99.8522,
          "x2": "2025-09-15",
          "y2": 55.55,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 56.74
        }
      ],
      "priceLevels": {
        "entry": 58.2197,
        "stop": 54.9945,
        "targets": [
          62.9115,
          66.0394
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.30",
        "slope gap 0.0213"
      ],
      "direction": "falling",
      "atr14": 4.0684,
      "sector": "Consumer Cyclical"
    },
    "avg_price": 53.675659306844075,
    "avg_volume": 10704263.433333334,
    "key_levels": {
      "entry": 58.2197,
      "stop": 54.9945,
      "targets": [
        62.9115,
        66.0394
      ]
    },
    "atr14": 4.0684,
    "sector": "Consumer Cyclical",
    "chart_url": "http://127.0.0.1:3010/reports/MCD-1758142515849.png"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/AAPL-1758142521568.png",
  "meta": {
    "source": "http://127.0.0.1:3010",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 5624.78
  }
}
2025-09-17 13:55:21 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-17 20:55:25.456927', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 13:55:25 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 13:55:31 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 13:55:31 Sleeping 5m before next iteration
2025-09-17 14:00:31 === Iteration 3 ===
2025-09-17 14:00:31 venv exists
2025-09-17 14:00:31 Installing Python requirements
2025-09-17 14:00:33 shots: node_modules present
2025-09-17 14:00:33 frontend: node_modules present
2025-09-17 14:00:33 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
...................                                                      [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

test_production.py::test_health_endpoint
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_health_endpoint returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_vcp_scan
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_vcp_scan returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_api_endpoints
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_api_endpoints returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_database_operations
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_database_operations returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_performance
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_performance returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
19 passed, 6 warnings in 9.39s
2025-09-17 14:00:44 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 14:00:44 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 14:00:45 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 13:47:31 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 14:00:39,342", "levelname": "INFO", "message": "request", "request_id": "75cf876e-86b2-499c-95dd-1bae063bcecb", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 23}
INFO:     127.0.0.1:65313 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 14:00:39,350", "levelname": "INFO", "message": "request", "request_id": "ad86bb84-0ee1-41bf-96aa-d34454d5016e", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 5}
INFO:     127.0.0.1:65316 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:00:44,960", "levelname": "INFO", "message": "request", "request_id": "b69f2606-0343-4f61-b522-dbe0a718f467", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 4}
INFO:     127.0.0.1:65340 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:00:53,183", "levelname": "INFO", "message": "request", "request_id": "45dd785f-20ce-47f0-b70d-b22f8e809962", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 6}
INFO:     127.0.0.1:65385 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:00:53,326", "levelname": "INFO", "message": "request", "request_id": "9ce29578-2dd2-49f7-abbf-077b5e9e9fec", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 108}
INFO:     127.0.0.1:65386 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 7802,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758142852914.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 6981,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758142860246.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 14:01:00 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758142867928.png",
  "meta": {
    "source": "http://127.0.0.1:3010",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 7115.81
  }
}

2025-09-17 14:01:08 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758142874846.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6682
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758142881442.png",
  "meta": {
    "source": "http://127.0.0.1:3010",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 7012.6
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 134,
  "sample": {
    "symbol": "NDAQ",
    "score": 88.91,
    "entry": 187.121,
    "stop": 178.0713,
    "targets": [
      201.4358,
      210.9791
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 284.755,
          "x2": "2025-09-15",
          "y2": 186.19,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 260.8969,
          "x2": "2025-09-15",
          "y2": 179.87,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 183.03
        }
      ],
      "priceLevels": {
        "entry": 187.121,
        "stop": 178.0713,
        "targets": [
          201.4358,
          210.9791
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.26",
        "slope gap 0.0683"
      ],
      "direction": "falling",
      "atr14": 9.5991,
      "sector": "Financial Services"
    },
    "avg_price": 208.48872934977214,
    "avg_volume": 2926685.566666667,
    "key_levels": {
      "entry": 187.121,
      "stop": 178.0713,
      "targets": [
        201.4358,
        210.9791
      ]
    },
    "atr14": 9.5991,
    "sector": "Financial Services",
    "chart_url": "http://127.0.0.1:3010/reports/NDAQ-1758142918630.png"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/AAPL-1758142927537.png",
  "meta": {
    "source": "http://127.0.0.1:3010",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 8506.11
  }
}
2025-09-17 14:02:07 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-17 21:02:11.549986', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 14:02:11 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 14:02:20 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 14:02:20 Sleeping 5m before next iteration
2025-09-17 14:03:04 === LegendAI Doc Superrun starting (PROJECT_DIR=/Users/kyleholthaus/Projects/LegendAI/scripts/..) ===
2025-09-17 14:03:04 === Iteration 1 ===
2025-09-17 14:03:04 venv exists
2025-09-17 14:03:04 Installing Python requirements
2025-09-17 14:03:06 shots: node_modules present
2025-09-17 14:03:06 frontend: node_modules present
2025-09-17 14:03:06 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
...................                                                      [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

test_production.py::test_health_endpoint
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_health_endpoint returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_vcp_scan
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_vcp_scan returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_api_endpoints
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_api_endpoints returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_database_operations
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_database_operations returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_performance
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_performance returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
19 passed, 6 warnings in 9.92s
2025-09-17 14:03:17 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 14:03:17 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 14:03:18 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:03:02 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 14:03:11,656", "levelname": "INFO", "message": "request", "request_id": "10785ff1-60b8-4f55-a792-ba083cda2d25", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 14}
INFO:     127.0.0.1:49956 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 14:03:11,661", "levelname": "INFO", "message": "request", "request_id": "b3c27caf-7e7a-4f62-9792-2a7849e4e251", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:49959 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:03:18,005", "levelname": "INFO", "message": "request", "request_id": "dad68973-caf3-44ad-9128-e2803df48286", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:49984 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:03:25,713", "levelname": "INFO", "message": "request", "request_id": "31073e7d-e05c-4ddc-b344-c5fb6ab7e1c1", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:50018 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:03:25,773", "levelname": "INFO", "message": "request", "request_id": "016dde93-74e0-4acc-967d-c272e8f1968e", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 48}
INFO:     127.0.0.1:50019 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 7531,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758143005511.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5089,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758143010795.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 14:03:30 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758143016528.png",
  "meta": {
    "source": "http://127.0.0.1:3010",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 5415.47
  }
}

2025-09-17 14:03:36 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758143021442.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 4800
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758143026214.png",
  "meta": {
    "source": "http://127.0.0.1:3010",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 4757.91
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 205,
  "sample": {
    "symbol": "NDAQ",
    "score": 88.91,
    "entry": 187.121,
    "stop": 178.0713,
    "targets": [
      201.4358,
      210.9791
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 284.755,
          "x2": "2025-09-15",
          "y2": 186.19,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 260.8969,
          "x2": "2025-09-15",
          "y2": 179.87,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 183.03
        }
      ],
      "priceLevels": {
        "entry": 187.121,
        "stop": 178.0713,
        "targets": [
          201.4358,
          210.9791
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.26",
        "slope gap 0.0683"
      ],
      "direction": "falling",
      "atr14": 9.5991,
      "sector": "Financial Services"
    },
    "avg_price": 208.48872934977214,
    "avg_volume": 2926685.566666667,
    "key_levels": {
      "entry": 187.121,
      "stop": 178.0713,
      "targets": [
        201.4358,
        210.9791
      ]
    },
    "atr14": 9.5991,
    "sector": "Financial Services",
    "chart_url": "http://127.0.0.1:3010/reports/NDAQ-1758143046791.png"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/AAPL-1758143054057.png",
  "meta": {
    "source": "http://127.0.0.1:3010",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 6803.87
  }
}
2025-09-17 14:04:14 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-17 21:04:18.044145', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 14:04:18 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 14:04:25 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 14:04:25 Sleeping 5m before next iteration
2025-09-17 14:09:25 === Iteration 2 ===
2025-09-17 14:09:25 venv exists
2025-09-17 14:09:25 Installing Python requirements
2025-09-17 14:09:27 shots: node_modules present
2025-09-17 14:09:27 frontend: node_modules present
2025-09-17 14:09:27 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
...................                                                      [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

test_production.py::test_health_endpoint
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_health_endpoint returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_vcp_scan
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_vcp_scan returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_api_endpoints
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_api_endpoints returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_database_operations
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_database_operations returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_performance
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_performance returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
19 passed, 6 warnings in 8.96s
2025-09-17 14:09:38 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 14:09:38 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 14:09:38 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:03:02 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 14:09:33,025", "levelname": "INFO", "message": "request", "request_id": "4c78baa9-9a9f-4a84-8868-f16dd38b5be4", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 26}
INFO:     127.0.0.1:50853 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 14:09:33,034", "levelname": "INFO", "message": "request", "request_id": "e9f8b9b9-b907-48da-a9d9-5295212bd2f0", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 5}
INFO:     127.0.0.1:50856 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:09:38,262", "levelname": "INFO", "message": "request", "request_id": "feb5f13a-0e72-4256-8b50-9931ab7549c3", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:50878 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:09:46,820", "levelname": "INFO", "message": "request", "request_id": "1c320c93-0bc6-4ed5-b6fc-1f510da7b820", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:50910 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:09:46,934", "levelname": "INFO", "message": "request", "request_id": "0c4f9129-1f7b-4fab-92c9-312c7798c794", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 76}
INFO:     127.0.0.1:50911 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 8303,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758143386503.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 8311,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758143395124.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 14:09:55 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758143405903.png",
  "meta": {
    "source": "http://127.0.0.1:3010",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9790.41
  }
}

2025-09-17 14:10:06 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758143416201.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 9409
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758143425684.png",
  "meta": {
    "source": "http://127.0.0.1:3010",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9223.73
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 142,
  "sample": {
    "symbol": "DIS",
    "score": 83.42,
    "entry": 99.1935,
    "stop": 93.951,
    "targets": [
      105.0975,
      109.0335
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 145.09,
          "x2": "2025-09-15",
          "y2": 98.7,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 135.25,
          "x2": "2025-09-15",
          "y2": 94.9,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 96.8
        }
      ],
      "priceLevels": {
        "entry": 99.1935,
        "stop": 93.951,
        "targets": [
          105.0975,
          109.0335
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.39",
        "slope gap 0.0125"
      ],
      "direction": "falling",
      "atr14": 5.8471,
      "sector": "Communication Services"
    },
    "avg_price": 92.20166702270508,
    "avg_volume": 21742586.633333333,
    "key_levels": {
      "entry": 99.1935,
      "stop": 93.951,
      "targets": [
        105.0975,
        109.0335
      ]
    },
    "atr14": 5.8471,
    "sector": "Communication Services",
    "chart_url": "http://127.0.0.1:3010/reports/DIS-1758143457964.png"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/AAPL-1758143465827.png",
  "meta": {
    "source": "http://127.0.0.1:3010",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 7732.83
  }
}
2025-09-17 14:11:06 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-17 21:11:11.064823', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 14:11:11 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 14:11:22 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 14:11:22 Sleeping 5m before next iteration
2025-09-17 14:16:22 === Iteration 3 ===
2025-09-17 14:16:22 venv exists
2025-09-17 14:16:22 Installing Python requirements
2025-09-17 14:16:24 shots: node_modules present
2025-09-17 14:16:24 frontend: node_modules present
2025-09-17 14:16:24 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

test_production.py::test_health_endpoint
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_health_endpoint returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_vcp_scan
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_vcp_scan returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_api_endpoints
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_api_endpoints returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_database_operations
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_database_operations returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

test_production.py::test_performance
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_production.py::test_performance returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 6 warnings in 12.57s
2025-09-17 14:16:39 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 14:16:39 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 14:16:39 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:03:02 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 14:16:33,448", "levelname": "INFO", "message": "request", "request_id": "460ec011-7a5b-4bdc-afdf-d88a52d1c67e", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 412}
INFO:     127.0.0.1:52138 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 14:16:33,533", "levelname": "INFO", "message": "request", "request_id": "04ec4090-0e6c-4089-848f-a8825622c20b", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 74}
INFO:     127.0.0.1:52142 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:16:39,580", "levelname": "INFO", "message": "request", "request_id": "b48c6a8d-7d3a-4d01-b88d-faeeb1a6e0c2", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:52165 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:16:48,505", "levelname": "INFO", "message": "request", "request_id": "dec78478-b2cd-43e2-8f0e-065734c3218c", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:52197 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:16:49,024", "levelname": "INFO", "message": "request", "request_id": "d5aca9d3-62d8-40e5-bfd2-214d0b2c6a53", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 499}
INFO:     127.0.0.1:52198 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 8577,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758143808205.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 7594,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758143816587.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 14:16:56 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=NVDA+Chart",
  "meta": {
    "source": "dummy",
    "overlay_applied": false,
    "fallback": true,
    "error": "shots status 502",
    "dry_run": false,
    "duration_ms": 3416.01
  }
}

2025-09-17 14:17:00 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758143827086.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6374
}
API ‚Üí chart (NVDA) ‚Ä¶
2025-09-17 14:17:25 === LegendAI Doc Superrun starting (PROJECT_DIR=/Users/kyleholthaus/Projects/LegendAI/scripts/..) ===
2025-09-17 14:17:25 === Iteration 1 ===
2025-09-17 14:17:25 venv exists
2025-09-17 14:17:25 Installing Python requirements
2025-09-17 14:17:28 shots: node_modules present
2025-09-17 14:17:28 frontend: node_modules present
2025-09-17 14:17:28 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 1 warning in 10.42s
2025-09-17 14:17:41 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 14:17:41 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 14:17:41 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:17:23 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 14:17:43,648", "levelname": "INFO", "message": "request", "request_id": "59fd7d04-d0a2-4f34-a566-2b3670e07099", "path": "/api/v1/vcp/metrics", "method": "GET", "status_code": 200, "duration_ms": 305}
INFO:     127.0.0.1:52368 - "GET /api/v1/vcp/metrics?start=2024-01-01&end=2024-12-31 HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:17:43,688", "levelname": "INFO", "message": "request", "request_id": "bc8df01e-1bc1-42e4-b8bb-cf2190b3d8d1", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 20}
INFO:     127.0.0.1:52369 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 14:17:43,722", "levelname": "INFO", "message": "request", "request_id": "afd0dfc8-abd7-4977-99dc-4af1c7b9a363", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 18}
INFO:     127.0.0.1:52372 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:17:50,987", "levelname": "INFO", "message": "request", "request_id": "33e815ff-1272-48f4-b7c1-bb0d35b0f228", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 15}
INFO:     127.0.0.1:52423 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:17:51,088", "levelname": "INFO", "message": "request", "request_id": "3f9c5038-da38-489f-8523-994f381f2631", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 61}
INFO:     127.0.0.1:52424 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 9067,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758143870553.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 9560,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758143880647.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 14:18:00 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758143892337.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10463.74
  }
}

2025-09-17 14:18:12 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758143899746.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 7636
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758143910236.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10026.67
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 130,
  "sample": {
    "symbol": "DHI",
    "score": 83.42,
    "entry": 99.1935,
    "stop": 93.951,
    "targets": [
      105.0975,
      109.0335
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 145.09,
          "x2": "2025-09-15",
          "y2": 98.7,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 135.25,
          "x2": "2025-09-15",
          "y2": 94.9,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 96.8
        }
      ],
      "priceLevels": {
        "entry": 99.1935,
        "stop": 93.951,
        "targets": [
          105.0975,
          109.0335
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.39",
        "slope gap 0.0125"
      ],
      "direction": "falling",
      "atr14": 5.8471,
      "sector": "Consumer Cyclical"
    },
    "avg_price": 92.20166702270508,
    "avg_volume": 21742586.633333333,
    "key_levels": {
      "entry": 99.1935,
      "stop": 93.951,
      "targets": [
        105.0975,
        109.0335
      ]
    },
    "atr14": 5.8471,
    "sector": "Consumer Cyclical",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=DHI+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758144010236.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 11375.19
  }
}
2025-09-17 14:20:10 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-17 21:20:14.066746', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 14:20:14 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 14:20:22 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 14:20:22 Sleeping 5m before next iteration
2025-09-17 14:25:22 === Iteration 2 ===
2025-09-17 14:25:22 venv exists
2025-09-17 14:25:22 Installing Python requirements
2025-09-17 14:25:24 shots: node_modules present
2025-09-17 14:25:24 frontend: node_modules present
2025-09-17 14:25:24 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 1 warning in 8.97s
2025-09-17 14:25:35 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 14:25:35 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 14:25:35 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:17:23 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 14:25:29,650", "levelname": "INFO", "message": "request", "request_id": "1fdd9f1f-2707-4d86-b8ac-5a7eb1ba03b5", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 32}
INFO:     127.0.0.1:53537 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 14:25:29,661", "levelname": "INFO", "message": "request", "request_id": "5a745614-16d0-475b-bf03-b47d435694c2", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 6}
INFO:     127.0.0.1:53540 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:25:35,258", "levelname": "INFO", "message": "request", "request_id": "59c313cc-8b7e-404f-a933-9a4cf6038cb3", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:53563 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:25:43,041", "levelname": "INFO", "message": "request", "request_id": "4650a3b1-f725-40fa-a4d4-1d4004f6621f", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:53595 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:25:43,113", "levelname": "INFO", "message": "request", "request_id": "87063167-b888-42d1-992a-4a302ba9d193", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 53}
INFO:     127.0.0.1:53596 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 7555,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758144342821.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 6175,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758144349216.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 14:25:49 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758144375233.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 25315.21
  }
}

2025-09-17 14:26:15 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758144381978.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6841
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758144391844.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9882.04
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
2025-09-17 14:26:53 === LegendAI Doc Superrun starting (PROJECT_DIR=/Users/kyleholthaus/Projects/LegendAI/scripts/..) ===
2025-09-17 14:26:53 === Iteration 1 ===
2025-09-17 14:26:53 venv exists
2025-09-17 14:26:53 Installing Python requirements
2025-09-17 14:26:55 shots: node_modules present
2025-09-17 14:26:55 frontend: node_modules present
2025-09-17 14:26:55 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 1 warning in 8.69s
2025-09-17 14:27:05 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 14:27:05 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 14:27:05 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 14:27:00,547", "levelname": "INFO", "message": "request", "request_id": "68a0fd25-efda-4fcb-afb1-63fe296f0e0f", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 18}
INFO:     127.0.0.1:54432 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 14:27:00,554", "levelname": "INFO", "message": "request", "request_id": "5f1aaa4c-c9b1-45ea-ac21-4ecdf5a0d4f9", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:54435 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:27:05,454", "levelname": "INFO", "message": "request", "request_id": "2b648ebb-328a-452e-b2e9-8afd658784f9", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:54458 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:27:12,409", "levelname": "INFO", "message": "request", "request_id": "f8a21ba3-0c56-4a0d-a626-ac46a00aee77", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 4}
INFO:     127.0.0.1:54489 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:27:12,465", "levelname": "INFO", "message": "request", "request_id": "dd801ff4-3ec4-47aa-a13d-25a91bc6ee0c", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 36}
INFO:     127.0.0.1:54490 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6804,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758144432206.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5577,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758144437990.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 14:27:18 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=NVDA+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30184.16
  }
}

2025-09-17 14:27:48 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758144474902.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6339
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758144505211.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30004.36
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 188,
  "sample": {
    "symbol": "MU",
    "score": 88.78,
    "entry": 83.1637,
    "stop": 79.7346,
    "targets": [
      87.9836,
      91.1968
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 111.318,
          "x2": "2025-09-15",
          "y2": 82.75,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 103.285,
          "x2": "2025-09-15",
          "y2": 80.54,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 81.645
        }
      ],
      "priceLevels": {
        "entry": 83.1637,
        "stop": 79.7346,
        "targets": [
          87.9836,
          91.1968
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.28",
        "slope gap 0.0030"
      ],
      "direction": "falling",
      "atr14": 4.3001
    },
    "avg_price": 81.54688618977865,
    "avg_volume": 71392666.4,
    "key_levels": {
      "entry": 83.1637,
      "stop": 79.7346,
      "targets": [
        87.9836,
        91.1968
      ]
    },
    "atr14": 4.3001,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=MU+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30371.62
  }
}
2025-09-17 14:30:13 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-17 21:30:16.799418', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 14:30:16 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 14:30:25 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 14:30:25 Sleeping 5m before next iteration
2025-09-17 14:35:25 === Iteration 2 ===
2025-09-17 14:35:25 venv exists
2025-09-17 14:35:25 Installing Python requirements
2025-09-17 14:35:26 shots: node_modules present
2025-09-17 14:35:26 frontend: node_modules present
2025-09-17 14:35:26 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 1 warning in 8.47s
2025-09-17 14:35:36 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 14:35:36 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 14:35:36 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 14:35:31,617", "levelname": "INFO", "message": "request", "request_id": "98428624-bf53-4753-86f5-02e1e549840e", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 15}
INFO:     127.0.0.1:55295 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 14:35:31,626", "levelname": "INFO", "message": "request", "request_id": "ad9ba3a2-59cb-4e25-9d87-e822fea579a8", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:55298 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:35:36,734", "levelname": "INFO", "message": "request", "request_id": "9597e86b-c36f-4361-8d30-c93dafe78a90", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:55321 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:35:44,396", "levelname": "INFO", "message": "request", "request_id": "06213efc-2bb8-448e-9a5a-28c0101be688", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:55353 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:35:44,478", "levelname": "INFO", "message": "request", "request_id": "35e5e868-9caa-4315-aa54-d0c74985a947", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 46}
INFO:     127.0.0.1:55354 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 7467,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758144944154.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 6655,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758144951075.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 14:35:51 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758144961954.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10700.02
  }
}

2025-09-17 14:36:02 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758144969206.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6988
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758144979156.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9809.08
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 126,
  "sample": {
    "symbol": "AVGO",
    "score": 88.11,
    "entry": 85.0699,
    "stop": 80.3286,
    "targets": [
      92.4979,
      97.4499
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 91.66,
          "x2": "2025-09-15",
          "y2": 84.6467,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 79.28,
          "x2": "2025-09-15",
          "y2": 81.14,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 82.8933
        }
      ],
      "priceLevels": {
        "entry": 85.0699,
        "stop": 80.3286,
        "targets": [
          92.4979,
          97.4499
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.28",
        "slope gap 0.0170"
      ],
      "direction": "falling",
      "atr14": 4.5891,
      "sector": "Technology"
    },
    "avg_price": 67.01066678365072,
    "avg_volume": 13664891.066666666,
    "key_levels": {
      "entry": 85.0699,
      "stop": 80.3286,
      "targets": [
        92.4979,
        97.4499
      ]
    },
    "atr14": 4.5891,
    "sector": "Technology",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AVGO+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758145101070.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 41212.58
  }
}
2025-09-17 14:38:21 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-17 21:38:25.395916', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 14:38:25 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 14:38:33 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 14:38:33 Sleeping 5m before next iteration
2025-09-17 14:43:33 === Iteration 3 ===
2025-09-17 14:43:33 venv exists
2025-09-17 14:43:33 Installing Python requirements
2025-09-17 14:43:34 shots: node_modules present
2025-09-17 14:43:34 frontend: node_modules present
2025-09-17 14:43:34 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 1 warning in 9.47s
2025-09-17 14:43:45 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 14:43:45 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 14:43:45 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 14:43:39,390", "levelname": "INFO", "message": "request", "request_id": "85f379f0-579a-4cbc-a1ca-99d81259ee13", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 12}
INFO:     127.0.0.1:56245 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 14:43:39,401", "levelname": "INFO", "message": "request", "request_id": "97915cc7-ed01-4a11-9b39-39feca920735", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 5}
INFO:     127.0.0.1:56248 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:43:45,587", "levelname": "INFO", "message": "request", "request_id": "184b3506-6129-471b-9693-5141f61feeed", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:56272 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:43:53,375", "levelname": "INFO", "message": "request", "request_id": "1f427914-afe5-4042-a4de-b2a3c4e8f92a", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:56307 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:43:53,440", "levelname": "INFO", "message": "request", "request_id": "04b0a376-2f54-4ef8-b390-b54d53eb0e18", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 50}
INFO:     127.0.0.1:56308 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 7610,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758145433143.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5830,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758145439206.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 14:43:59 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758145451158.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 11619.28
  }
}

2025-09-17 14:44:11 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758145456917.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5722
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758145466836.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9862.14
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 160,
  "sample": {
    "symbol": "DIS",
    "score": 89.73,
    "entry": 69.6163,
    "stop": 67.7259,
    "targets": [
      71.8387,
      73.3203
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 66.8,
          "x2": "2025-09-15",
          "y2": 69.27,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 63.096,
          "x2": "2025-09-15",
          "y2": 68.41,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 68.84
        }
      ],
      "priceLevels": {
        "entry": 69.6163,
        "stop": 67.7259,
        "targets": [
          71.8387,
          73.3203
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.23",
        "slope gap 0.0095"
      ],
      "direction": "falling",
      "atr14": 4.025,
      "sector": "Communication Services"
    },
    "avg_price": 58.824666595458986,
    "avg_volume": 10344460.766666668,
    "key_levels": {
      "entry": 69.6163,
      "stop": 67.7259,
      "targets": [
        71.8387,
        73.3203
      ]
    },
    "atr14": 4.025,
    "sector": "Communication Services",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=DIS+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758145566650.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 21530.98
  }
}
2025-09-17 14:46:06 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-17 21:46:10.367679', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 14:46:10 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 14:46:17 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 14:46:17 Sleeping 5m before next iteration
2025-09-17 14:51:17 === Iteration 4 ===
2025-09-17 14:51:17 venv exists
2025-09-17 14:51:17 Installing Python requirements
2025-09-17 14:51:18 shots: node_modules present
2025-09-17 14:51:18 frontend: node_modules present
2025-09-17 14:51:18 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 1 warning in 8.87s
2025-09-17 14:51:28 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 14:51:28 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 14:51:28 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 14:51:23,320", "levelname": "INFO", "message": "request", "request_id": "11494b84-38ff-4ba5-944d-e0ecc8afa9a1", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 12}
INFO:     127.0.0.1:57171 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 14:51:23,329", "levelname": "INFO", "message": "request", "request_id": "a1127ec0-e442-48ff-842c-4985f0ca0975", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:57174 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:51:28,957", "levelname": "INFO", "message": "request", "request_id": "641fe887-3e3a-4f48-a080-b2aac12dab7d", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:57203 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:51:36,124", "levelname": "INFO", "message": "request", "request_id": "7e0a6462-056c-4c3c-9850-669d972c2659", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:57235 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:51:36,194", "levelname": "INFO", "message": "request", "request_id": "e88bc727-6b5c-4f16-b2a0-2422b9dbfeb7", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 45}
INFO:     127.0.0.1:57236 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6948,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758145895852.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5451,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758145901585.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 14:51:41 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758145912453.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10596.2
  }
}

2025-09-17 14:51:52 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758145918617.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6066
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758145928283.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9688.08
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 155,
  "sample": {
    "symbol": "MKC",
    "score": 88.91,
    "entry": 187.121,
    "stop": 178.0713,
    "targets": [
      201.4358,
      210.9791
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 284.7549,
          "x2": "2025-09-15",
          "y2": 186.19,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 260.8968,
          "x2": "2025-09-15",
          "y2": 179.87,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 183.03
        }
      ],
      "priceLevels": {
        "entry": 187.121,
        "stop": 178.0713,
        "targets": [
          201.4358,
          210.9791
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.26",
        "slope gap 0.0683"
      ],
      "direction": "falling",
      "atr14": 9.5991
    },
    "avg_price": 208.48872934977214,
    "avg_volume": 2926685.566666667,
    "key_levels": {
      "entry": 187.121,
      "stop": 178.0713,
      "targets": [
        201.4358,
        210.9791
      ]
    },
    "atr14": 9.5991,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=MKC+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758146035348.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 28878.91
  }
}
2025-09-17 14:53:55 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-17 21:53:59.185419', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 14:53:59 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 14:54:06 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 14:54:06 Sleeping 5m before next iteration
2025-09-17 14:59:06 === Iteration 5 ===
2025-09-17 14:59:06 venv exists
2025-09-17 14:59:06 Installing Python requirements
2025-09-17 14:59:08 shots: node_modules present
2025-09-17 14:59:08 frontend: node_modules present
2025-09-17 14:59:08 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 1 warning in 8.60s
2025-09-17 14:59:18 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 14:59:18 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 14:59:18 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 14:59:13,831", "levelname": "INFO", "message": "request", "request_id": "e946b690-515c-4249-98e8-0c4bc53d482c", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 16}
INFO:     127.0.0.1:58111 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 14:59:13,842", "levelname": "INFO", "message": "request", "request_id": "132c8a5d-2ec4-4c09-b350-f02da6871e3f", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:58114 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:59:18,831", "levelname": "INFO", "message": "request", "request_id": "f97b6d91-79a9-48b7-b658-4355f0b27971", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:58136 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:59:26,382", "levelname": "INFO", "message": "request", "request_id": "386e5a9f-54e8-41b0-b94e-89f413bbfd26", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:58171 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 14:59:26,456", "levelname": "INFO", "message": "request", "request_id": "60c06599-19ad-4056-b91d-b384802cd8d8", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 52}
INFO:     127.0.0.1:58172 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 7382,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758146366169.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 6591,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758146373001.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 14:59:33 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758146383949.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10453.03
  }
}

2025-09-17 14:59:44 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758146390480.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6496
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758146400550.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9914.6
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 177,
  "sample": {
    "symbol": "DECK",
    "score": 89.73,
    "entry": 69.6163,
    "stop": 67.7259,
    "targets": [
      71.8387,
      73.3203
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 66.8,
          "x2": "2025-09-15",
          "y2": 69.27,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 63.096,
          "x2": "2025-09-15",
          "y2": 68.41,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 68.84
        }
      ],
      "priceLevels": {
        "entry": 69.6163,
        "stop": 67.7259,
        "targets": [
          71.8387,
          73.3203
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.23",
        "slope gap 0.0095"
      ],
      "direction": "falling",
      "atr14": 4.025
    },
    "avg_price": 58.824666595458986,
    "avg_volume": 10344460.766666668,
    "key_levels": {
      "entry": 69.6163,
      "stop": 67.7259,
      "targets": [
        71.8387,
        73.3203
      ]
    },
    "atr14": 4.025,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=DECK+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30306.17
  }
}
2025-09-17 15:01:48 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-17 22:01:52.694578', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 15:01:52 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 15:01:59 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 15:01:59 Sleeping 5m before next iteration
2025-09-17 15:06:59 === Iteration 6 ===
2025-09-17 15:06:59 venv exists
2025-09-17 15:06:59 Installing Python requirements
2025-09-17 15:07:02 shots: node_modules present
2025-09-17 15:07:02 frontend: node_modules present
2025-09-17 15:07:02 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 1 warning in 9.01s
2025-09-17 15:07:12 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 15:07:12 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 15:07:12 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 15:07:07,280", "levelname": "INFO", "message": "request", "request_id": "f3ae6a2a-993b-453f-a79d-1d10c193288d", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 30}
INFO:     127.0.0.1:59072 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 15:07:07,290", "levelname": "INFO", "message": "request", "request_id": "cc9e3b69-eac2-473e-aab7-7943d78f6c80", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 4}
INFO:     127.0.0.1:59075 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 15:07:12,681", "levelname": "INFO", "message": "request", "request_id": "45768ad7-2273-4eef-bd26-230279a03f59", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:59098 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 15:07:19,682", "levelname": "INFO", "message": "request", "request_id": "b861303f-1f3c-4f95-8afc-dd17d61c820d", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:59137 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 15:07:19,739", "levelname": "INFO", "message": "request", "request_id": "92b665e9-1746-4792-885d-fffc43a5f40c", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 46}
INFO:     127.0.0.1:59138 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6743,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758146839416.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5951,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758146845568.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 15:07:25 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758146856546.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10619.95
  }
}

2025-09-17 15:07:36 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758146862967.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6208
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758146872349.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9322.5
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 105,
  "sample": {
    "symbol": "EXC",
    "score": 83.42,
    "entry": 99.1935,
    "stop": 93.951,
    "targets": [
      105.0975,
      109.0335
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 145.09,
          "x2": "2025-09-15",
          "y2": 98.7,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 135.25,
          "x2": "2025-09-15",
          "y2": 94.9,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 96.8
        }
      ],
      "priceLevels": {
        "entry": 99.1935,
        "stop": 93.951,
        "targets": [
          105.0975,
          109.0335
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.39",
        "slope gap 0.0125"
      ],
      "direction": "falling",
      "atr14": 5.8471,
      "sector": "Utilities"
    },
    "avg_price": 92.20166702270508,
    "avg_volume": 21742586.633333333,
    "key_levels": {
      "entry": 99.1935,
      "stop": 93.951,
      "targets": [
        105.0975,
        109.0335
      ]
    },
    "atr14": 5.8471,
    "sector": "Utilities",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=EXC+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30227.63
  }
}
2025-09-17 15:09:41 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-17 22:09:45.155646', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 15:09:45 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 15:09:52 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 15:09:52 Sleeping 5m before next iteration
2025-09-17 15:14:52 === Iteration 7 ===
2025-09-17 15:14:52 venv exists
2025-09-17 15:14:52 Installing Python requirements
2025-09-17 15:14:53 shots: node_modules present
2025-09-17 15:14:53 frontend: node_modules present
2025-09-17 15:14:53 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 1 warning in 8.51s
2025-09-17 15:15:03 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 15:15:03 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 15:15:03 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 15:14:58,539", "levelname": "INFO", "message": "request", "request_id": "50dfcf4c-a843-4895-a318-77ffc7bf03e8", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 31}
INFO:     127.0.0.1:59959 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 15:14:58,546", "levelname": "INFO", "message": "request", "request_id": "5d7f79cd-b48c-4c5e-9c2c-5b5b0ef80cf3", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:59962 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 15:15:03,577", "levelname": "INFO", "message": "request", "request_id": "aa1640bf-0d0a-4b64-a7ea-826733aefcb5", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:59984 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 15:15:10,544", "levelname": "INFO", "message": "request", "request_id": "b45ad1e2-6e8d-4676-a4ff-1a3e4c3861fd", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:60016 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 15:15:10,594", "levelname": "INFO", "message": "request", "request_id": "50f2caa5-b918-4399-9059-727be25bdb5c", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 39}
INFO:     127.0.0.1:60017 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6742,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758147310317.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5517,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758147316064.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 15:15:16 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758147327249.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 11009.95
  }
}

2025-09-17 15:15:27 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758147333100.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5632
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758147342460.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9257.5
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 138,
  "sample": {
    "symbol": "APA",
    "score": 88.11,
    "entry": 85.0699,
    "stop": 80.3286,
    "targets": [
      92.4979,
      97.4499
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 91.66,
          "x2": "2025-09-15",
          "y2": 84.6467,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 79.28,
          "x2": "2025-09-15",
          "y2": 81.14,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 82.8933
        }
      ],
      "priceLevels": {
        "entry": 85.0699,
        "stop": 80.3286,
        "targets": [
          92.4979,
          97.4499
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.28",
        "slope gap 0.0170"
      ],
      "direction": "falling",
      "atr14": 4.5891
    },
    "avg_price": 67.01066678365072,
    "avg_volume": 13664891.066666666,
    "key_levels": {
      "entry": 85.0699,
      "stop": 80.3286,
      "targets": [
        92.4979,
        97.4499
      ]
    },
    "atr14": 4.5891,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=APA+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30287.3
  }
}
2025-09-17 15:17:28 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-17 22:17:32.733028', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 15:17:32 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 15:17:40 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 15:17:40 Sleeping 5m before next iteration
2025-09-17 15:22:40 === Iteration 8 ===
2025-09-17 15:22:40 venv exists
2025-09-17 15:22:40 Installing Python requirements
2025-09-17 15:22:41 shots: node_modules present
2025-09-17 15:22:41 frontend: node_modules present
2025-09-17 15:22:41 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 1 warning in 8.58s
2025-09-17 15:22:51 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 15:22:51 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 15:22:51 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 15:22:46,417", "levelname": "INFO", "message": "request", "request_id": "d5343e33-0ad3-428a-a108-83ad85854f19", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 24}
INFO:     127.0.0.1:60800 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 15:22:46,426", "levelname": "INFO", "message": "request", "request_id": "acd9e7d8-c80a-4d4d-a4c0-12a6aea34a99", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:60803 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 15:22:51,494", "levelname": "INFO", "message": "request", "request_id": "7db32695-57fa-4723-8292-790cb49a8310", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:60826 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 15:22:58,446", "levelname": "INFO", "message": "request", "request_id": "a8cba86d-c508-40ff-8239-ecfb0dc07dd4", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:60860 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 15:22:58,510", "levelname": "INFO", "message": "request", "request_id": "da5d8a5e-5084-4481-9381-4a17f272a55e", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 46}
INFO:     127.0.0.1:60861 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6788,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758147778246.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5338,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758147783796.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 15:23:03 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758147795646.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 11463.6
  }
}

2025-09-17 15:23:15 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758147801244.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5540
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758147810959.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9719.22
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 140,
  "sample": {
    "symbol": "MA",
    "score": 85.33,
    "entry": 58.2197,
    "stop": 54.9945,
    "targets": [
      62.9115,
      66.0394
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 107.672,
          "x2": "2025-09-15",
          "y2": 57.93,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 99.8522,
          "x2": "2025-09-15",
          "y2": 55.55,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 56.74
        }
      ],
      "priceLevels": {
        "entry": 58.2197,
        "stop": 54.9945,
        "targets": [
          62.9115,
          66.0394
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.30",
        "slope gap 0.0213"
      ],
      "direction": "falling",
      "atr14": 4.0684,
      "sector": "Financial Services"
    },
    "avg_price": 53.6756591796875,
    "avg_volume": 10704263.433333334,
    "key_levels": {
      "entry": 58.2197,
      "stop": 54.9945,
      "targets": [
        62.9115,
        66.0394
      ]
    },
    "atr14": 4.0684,
    "sector": "Financial Services",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=MA+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30517.86
  }
}
2025-09-17 15:25:16 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-17 22:25:20.996357', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 15:25:21 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 15:25:28 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 15:25:28 Sleeping 5m before next iteration
2025-09-17 15:30:28 === Iteration 9 ===
2025-09-17 15:30:28 venv exists
2025-09-17 15:30:28 Installing Python requirements
2025-09-17 15:30:29 shots: node_modules present
2025-09-17 15:30:29 frontend: node_modules present
2025-09-17 15:30:29 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 1 warning in 8.52s
2025-09-17 15:30:39 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 15:30:39 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 15:30:39 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 15:30:34,581", "levelname": "INFO", "message": "request", "request_id": "8577e044-8f53-4b06-88aa-058174efe5e7", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 11}
INFO:     127.0.0.1:61625 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 15:30:34,592", "levelname": "INFO", "message": "request", "request_id": "4cd1c774-1184-456a-af74-c9c5c65df45f", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:61628 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 15:30:39,770", "levelname": "INFO", "message": "request", "request_id": "40cc4385-5218-4eec-a3c9-8f5a83b70738", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:61650 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 15:30:47,275", "levelname": "INFO", "message": "request", "request_id": "2e52a90b-3040-4b3c-bab8-3b4f82df56e2", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:61680 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 15:30:47,350", "levelname": "INFO", "message": "request", "request_id": "1c5af01b-e90b-41f3-8f15-f16c0b252551", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 46}
INFO:     127.0.0.1:61681 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 7354,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758148247074.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 6069,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758148253379.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 15:30:53 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758148264056.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10356.64
  }
}

2025-09-17 15:31:04 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758148270576.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6258
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758148280124.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9460.17
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 127,
  "sample": {
    "symbol": "CHTR",
    "score": 82.7,
    "entry": 19.4367,
    "stop": 18.4635,
    "targets": [
      20.4152,
      21.0676
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 27.1964,
          "x2": "2025-09-15",
          "y2": 19.34,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 25.5656,
          "x2": "2025-09-15",
          "y2": 18.65,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 18.995
        }
      ],
      "priceLevels": {
        "entry": 19.4367,
        "stop": 18.4635,
        "targets": [
          20.4152,
          21.0676
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.42",
        "slope gap 0.0009"
      ],
      "direction": "falling",
      "atr14": 1.0326,
      "sector": "Communication Services"
    },
    "avg_price": 21.75607592264811,
    "avg_volume": 41265469.333333336,
    "key_levels": {
      "entry": 19.4367,
      "stop": 18.4635,
      "targets": [
        20.4152,
        21.0676
      ]
    },
    "atr14": 1.0326,
    "sector": "Communication Services",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=CHTR+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30229.75
  }
}
2025-09-17 15:33:07 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-17 22:33:11.359598', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 15:33:11 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 15:33:19 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 15:33:19 Sleeping 5m before next iteration
2025-09-17 15:38:19 === Iteration 10 ===
2025-09-17 15:38:19 venv exists
2025-09-17 15:38:19 Installing Python requirements
2025-09-17 15:38:20 shots: node_modules present
2025-09-17 15:38:20 frontend: node_modules present
2025-09-17 15:38:20 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 1 warning in 9.75s
2025-09-17 15:38:33 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 15:38:33 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 15:38:33 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 15:38:27,477", "levelname": "INFO", "message": "request", "request_id": "28b7ab7c-782b-4b16-80c3-eb0a893ac3ff", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 29}
INFO:     127.0.0.1:62505 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 15:38:27,493", "levelname": "INFO", "message": "request", "request_id": "5c37027a-3e62-4f68-af61-b52f853d682c", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 5}
INFO:     127.0.0.1:62508 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 15:38:33,324", "levelname": "INFO", "message": "request", "request_id": "ab407083-ba0e-4a0f-9d57-f6d16d4cad7a", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:62531 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 15:38:40,784", "levelname": "INFO", "message": "request", "request_id": "95a87898-0ff3-4092-a229-18b59b3f10d0", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:62596 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 15:38:40,855", "levelname": "INFO", "message": "request", "request_id": "3fbf67e1-391a-491a-950d-1c53eee620fa", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 59}
INFO:     127.0.0.1:62597 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 7133,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758148720495.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5716,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758148726493.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 15:38:46 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758148737738.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 11008.59
  }
}

2025-09-17 15:38:57 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758148745284.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 7299
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758148755239.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9869.78
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 119,
  "sample": {
    "symbol": "VICI",
    "score": 82.55,
    "entry": 91.2681,
    "stop": 87.5556,
    "targets": [
      94.9414,
      97.3903
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 135.8187,
          "x2": "2025-09-15",
          "y2": 90.814,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 129.6965,
          "x2": "2025-09-15",
          "y2": 88.44,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 89.627
        }
      ],
      "priceLevels": {
        "entry": 91.2681,
        "stop": 87.5556,
        "targets": [
          94.9414,
          97.3903
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.39",
        "slope gap 0.0283"
      ],
      "direction": "falling",
      "atr14": 5.9275,
      "sector": "Real Estate"
    },
    "avg_price": 98.35214207967122,
    "avg_volume": 36477690.1,
    "key_levels": {
      "entry": 91.2681,
      "stop": 87.5556,
      "targets": [
        94.9414,
        97.3903
      ]
    },
    "atr14": 5.9275,
    "sector": "Real Estate",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=VICI+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30269.12
  }
}
2025-09-17 15:41:01 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-17 22:41:05.974781', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 15:41:06 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 15:41:13 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 15:41:13 Sleeping 5m before next iteration
2025-09-17 15:46:13 === Iteration 11 ===
2025-09-17 15:46:13 venv exists
2025-09-17 15:46:13 Installing Python requirements
2025-09-17 15:46:14 shots: node_modules present
2025-09-17 15:46:14 frontend: node_modules present
2025-09-17 15:46:14 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 1 warning in 8.94s
2025-09-17 15:46:25 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 15:46:25 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 15:46:25 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 15:46:20,163", "levelname": "INFO", "message": "request", "request_id": "329ab52b-4643-4e27-aa8a-72256eb936da", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 52}
INFO:     127.0.0.1:63507 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 15:46:20,174", "levelname": "INFO", "message": "request", "request_id": "1929d6a8-11ee-4205-a770-4e02f3c3cb2b", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 4}
INFO:     127.0.0.1:63510 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 15:46:25,304", "levelname": "INFO", "message": "request", "request_id": "a723421d-d0d8-4c6f-9b24-1e40984da72b", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:63542 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 15:46:32,145", "levelname": "INFO", "message": "request", "request_id": "e3f14fef-b89b-4d83-ae69-0bb488fb85d0", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 4}
INFO:     127.0.0.1:63575 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 15:46:32,212", "levelname": "INFO", "message": "request", "request_id": "fed38a9e-a7a5-476b-a97a-7e29a10a96a9", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 52}
INFO:     127.0.0.1:63576 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6623,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758149191910.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5069,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758149197193.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 15:46:37 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758149208473.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 11018.66
  }
}

2025-09-17 15:46:48 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758149214960.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6382
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758149225503.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10565.83
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 172,
  "sample": {
    "symbol": "EMR",
    "score": 83.42,
    "entry": 99.1935,
    "stop": 93.951,
    "targets": [
      105.0975,
      109.0335
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 145.09,
          "x2": "2025-09-15",
          "y2": 98.7,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 135.25,
          "x2": "2025-09-15",
          "y2": 94.9,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 96.8
        }
      ],
      "priceLevels": {
        "entry": 99.1935,
        "stop": 93.951,
        "targets": [
          105.0975,
          109.0335
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.39",
        "slope gap 0.0125"
      ],
      "direction": "falling",
      "atr14": 5.8471
    },
    "avg_price": 92.20166702270508,
    "avg_volume": 21742586.633333333,
    "key_levels": {
      "entry": 99.1935,
      "stop": 93.951,
      "targets": [
        105.0975,
        109.0335
      ]
    },
    "atr14": 5.8471,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=EMR+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30246.34
  }
}
2025-09-17 15:48:52 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-17 22:48:58.351425', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 15:48:58 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 15:49:06 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 15:49:06 Sleeping 5m before next iteration
2025-09-17 15:54:06 === Iteration 12 ===
2025-09-17 15:54:06 venv exists
2025-09-17 15:54:06 Installing Python requirements
2025-09-17 15:54:08 shots: node_modules present
2025-09-17 15:54:08 frontend: node_modules present
2025-09-17 15:54:08 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 1 warning in 10.91s
2025-09-17 15:54:20 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 15:54:20 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 15:54:20 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 15:54:12,979", "levelname": "INFO", "message": "request", "request_id": "ab1d830b-d2ca-4ae4-8619-f333bbd08303", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 24}
INFO:     127.0.0.1:64349 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 15:54:12,988", "levelname": "INFO", "message": "request", "request_id": "6d12795d-a4ae-4eb7-90fd-39e8d9463f51", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:64352 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 15:54:20,187", "levelname": "INFO", "message": "request", "request_id": "55526210-03b2-4c19-8535-a6a9b70a674c", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 4}
INFO:     127.0.0.1:64374 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 15:54:26,680", "levelname": "INFO", "message": "request", "request_id": "21d85b21-6a24-4fa2-9d89-da3c833e2303", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64403 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 15:54:26,745", "levelname": "INFO", "message": "request", "request_id": "f3c623dd-9c7b-4818-bb8c-3210189b5dcb", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 45}
INFO:     127.0.0.1:64404 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6307,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758149666486.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 4906,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758149671571.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 15:54:31 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758149682368.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10555.6
  }
}

2025-09-17 15:54:42 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758149688688.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6169
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758149697950.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9246.97
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 123,
  "sample": {
    "symbol": "L",
    "score": 80.6,
    "entry": 192.6686,
    "stop": 182.9025,
    "targets": [
      202.3226,
      208.7586
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 232.68,
          "x2": "2025-09-15",
          "y2": 191.71,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 216.59,
          "x2": "2025-09-15",
          "y2": 184.75,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 188.23
        }
      ],
      "priceLevels": {
        "entry": 192.6686,
        "stop": 182.9025,
        "targets": [
          202.3226,
          208.7586
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.43",
        "slope gap 0.0045"
      ],
      "direction": "falling",
      "atr14": 12.9686,
      "sector": "Financial Services"
    },
    "avg_price": 168.3730005900065,
    "avg_volume": 9545966.633333333,
    "key_levels": {
      "entry": 192.6686,
      "stop": 182.9025,
      "targets": [
        202.3226,
        208.7586
      ]
    },
    "atr14": 12.9686,
    "sector": "Financial Services",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=L+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30344.81
  }
}
2025-09-17 15:56:43 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-17 22:56:46.995839', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 15:56:47 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 15:56:53 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 15:56:53 Sleeping 5m before next iteration
2025-09-17 16:01:53 === Iteration 13 ===
2025-09-17 16:01:53 venv exists
2025-09-17 16:01:53 Installing Python requirements
2025-09-17 16:01:54 shots: node_modules present
2025-09-17 16:01:54 frontend: node_modules present
2025-09-17 16:01:54 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 1 warning in 8.36s
2025-09-17 16:02:04 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 16:02:04 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 16:02:04 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 16:01:59,485", "levelname": "INFO", "message": "request", "request_id": "23a2313c-b104-4b54-b2cd-e1acf0313435", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 10}
INFO:     127.0.0.1:65206 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 16:01:59,495", "levelname": "INFO", "message": "request", "request_id": "8ab21207-f6c9-41cd-b105-f8a1d08ab0dd", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:65209 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 16:02:04,699", "levelname": "INFO", "message": "request", "request_id": "09d312da-5b91-47ac-a541-fd259373bce5", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 4}
INFO:     127.0.0.1:65232 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 16:02:11,079", "levelname": "INFO", "message": "request", "request_id": "4c08eff9-c14b-4533-9088-57f141f794c1", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:65260 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 16:02:11,134", "levelname": "INFO", "message": "request", "request_id": "b2a5f02d-a8e8-4c47-b0bd-89cd50de988e", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 42}
INFO:     127.0.0.1:65261 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6224,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758150130854.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5018,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758150136089.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 16:02:16 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758150147466.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 11157.24
  }
}

2025-09-17 16:02:27 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758150153159.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5526
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758150163054.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9777.71
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 148,
  "sample": {
    "symbol": "DHR",
    "score": 88.54,
    "entry": 106.7612,
    "stop": 102.3066,
    "targets": [
      112.9763,
      117.1197
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 136.2477,
          "x2": "2025-09-15",
          "y2": 106.23,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 125.8892,
          "x2": "2025-09-15",
          "y2": 103.34,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 104.785
        }
      ],
      "priceLevels": {
        "entry": 106.7612,
        "stop": 102.3066,
        "targets": [
          112.9763,
          117.1197
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.28",
        "slope gap 0.0487"
      ],
      "direction": "falling",
      "atr14": 5.3876,
      "sector": "Healthcare"
    },
    "avg_price": 100.27833760579428,
    "avg_volume": 17986646.166666668,
    "key_levels": {
      "entry": 106.7612,
      "stop": 102.3066,
      "targets": [
        112.9763,
        117.1197
      ]
    },
    "atr14": 5.3876,
    "sector": "Healthcare",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=DHR+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30359.2
  }
}
2025-09-17 16:04:28 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-17 23:04:32.150599', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 16:04:32 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 16:04:39 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 16:04:39 Sleeping 5m before next iteration
2025-09-17 16:09:39 === Iteration 14 ===
2025-09-17 16:09:39 venv exists
2025-09-17 16:09:39 Installing Python requirements
2025-09-17 16:09:40 shots: node_modules present
2025-09-17 16:09:40 frontend: node_modules present
2025-09-17 16:09:40 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 1 warning in 18.40s
2025-09-17 16:10:00 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 16:10:00 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 16:10:00 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 16:09:55,162", "levelname": "INFO", "message": "request", "request_id": "2ba667b7-ee9e-40ec-8203-2cf452e3d076", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 11}
INFO:     127.0.0.1:49642 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 16:09:55,171", "levelname": "INFO", "message": "request", "request_id": "5eab4eff-50b9-4c64-9ea1-4490038cc81e", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:49645 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 16:10:00,561", "levelname": "INFO", "message": "request", "request_id": "62e770e8-6308-42d8-9343-ad16d4f08522", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:49669 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 16:10:07,442", "levelname": "INFO", "message": "request", "request_id": "01285e65-f3d0-44ab-a67b-e858cec25385", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:49700 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 16:10:07,508", "levelname": "INFO", "message": "request", "request_id": "3662eba1-a8a9-4e73-8779-d09f789ce938", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 55}
INFO:     127.0.0.1:49701 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6704,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758150607189.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 6151,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758150613523.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 16:10:13 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758150625140.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 11208.4
  }
}

2025-09-17 16:10:25 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758150631711.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6213
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758150641545.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9734.92
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 166,
  "sample": {
    "symbol": "DHR",
    "score": 88.54,
    "entry": 106.7612,
    "stop": 102.3066,
    "targets": [
      112.9763,
      117.1197
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 136.2477,
          "x2": "2025-09-15",
          "y2": 106.23,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 125.8892,
          "x2": "2025-09-15",
          "y2": 103.34,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 104.785
        }
      ],
      "priceLevels": {
        "entry": 106.7612,
        "stop": 102.3066,
        "targets": [
          112.9763,
          117.1197
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.28",
        "slope gap 0.0487"
      ],
      "direction": "falling",
      "atr14": 5.3876,
      "sector": "Healthcare"
    },
    "avg_price": 100.27833760579428,
    "avg_volume": 17986646.166666668,
    "key_levels": {
      "entry": 106.7612,
      "stop": 102.3066,
      "targets": [
        112.9763,
        117.1197
      ]
    },
    "atr14": 5.3876,
    "sector": "Healthcare",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=DHR+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30313.12
  }
}
2025-09-17 16:12:30 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-17 23:12:34.236465', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 16:12:34 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 16:12:41 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 16:12:41 Sleeping 5m before next iteration
2025-09-17 16:17:41 === Iteration 15 ===
2025-09-17 16:17:41 venv exists
2025-09-17 16:17:41 Installing Python requirements
2025-09-17 16:17:42 shots: node_modules present
2025-09-17 16:17:42 frontend: node_modules present
2025-09-17 16:17:42 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 1 warning in 11.00s
2025-09-17 16:17:54 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 16:17:54 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 16:17:55 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 16:17:48,601", "levelname": "INFO", "message": "request", "request_id": "2cf6b3c8-9e62-4ebb-9a4b-9b31a784b0ea", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 24}
INFO:     127.0.0.1:50461 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 16:17:48,610", "levelname": "INFO", "message": "request", "request_id": "1cde72df-5e7d-4b07-90d3-36a0c5866abc", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:50464 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 16:17:55,014", "levelname": "INFO", "message": "request", "request_id": "62b20e81-c193-44dc-8ffa-8161b46f33a7", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:50487 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 16:18:01,601", "levelname": "INFO", "message": "request", "request_id": "7370f84d-a842-4777-8427-de08c25bce90", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:50519 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 16:18:01,637", "levelname": "INFO", "message": "request", "request_id": "4434c663-627f-446d-b072-e11745ce2451", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 24}
INFO:     127.0.0.1:50520 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6387,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758151081384.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5504,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758151087053.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 16:18:07 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758151097860.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10564.8
  }
}

2025-09-17 16:18:18 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758151103700.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5669
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758151112943.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9182.12
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 115,
  "sample": {
    "symbol": "VRSN",
    "score": 84.29,
    "entry": 75.9177,
    "stop": 71.7552,
    "targets": [
      80.894,
      84.2116
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 104.7729,
          "x2": "2025-09-15",
          "y2": 75.54,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 96.479,
          "x2": "2025-09-15",
          "y2": 72.48,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 74.01
        }
      ],
      "priceLevels": {
        "entry": 75.9177,
        "stop": 71.7552,
        "targets": [
          80.894,
          84.2116
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.37",
        "slope gap 0.0201"
      ],
      "direction": "falling",
      "atr14": 4.335
    },
    "avg_price": 68.79065272013347,
    "avg_volume": 15849026.566666666,
    "key_levels": {
      "entry": 75.9177,
      "stop": 71.7552,
      "targets": [
        80.894,
        84.2116
      ]
    },
    "atr14": 4.335,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=VRSN+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30498.61
  }
}
2025-09-17 16:20:17 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-17 23:20:20.737266', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 16:20:20 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 16:20:27 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 16:20:27 Sleeping 5m before next iteration
2025-09-17 16:25:27 === Iteration 16 ===
2025-09-17 16:25:27 venv exists
2025-09-17 16:25:27 Installing Python requirements
2025-09-17 16:25:28 shots: node_modules present
2025-09-17 16:25:28 frontend: node_modules present
2025-09-17 16:25:28 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 1 warning in 8.58s
2025-09-17 16:25:38 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 16:25:38 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 16:25:38 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 16:25:33,702", "levelname": "INFO", "message": "request", "request_id": "b576becb-66da-4946-937a-89c09c9c57fc", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 23}
INFO:     127.0.0.1:51270 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 16:25:33,710", "levelname": "INFO", "message": "request", "request_id": "e309a1d1-ea34-40fe-bfac-b695776f91b4", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 4}
INFO:     127.0.0.1:51273 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 16:25:38,705", "levelname": "INFO", "message": "request", "request_id": "8ced3d54-26b4-4b81-b65f-917986303165", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:51295 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 16:25:45,664", "levelname": "INFO", "message": "request", "request_id": "4a46a071-7299-4857-82e1-81568355a678", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:51327 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 16:25:45,752", "levelname": "INFO", "message": "request", "request_id": "0bb53517-69f6-44bc-a9bb-2b4b05752446", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 76}
INFO:     127.0.0.1:51328 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6751,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758151545428.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5263,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758151550920.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 16:25:51 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758151562160.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10933.13
  }
}

2025-09-17 16:26:02 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758151568191.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5811
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758151577458.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9129.67
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 168,
  "sample": {
    "symbol": "RVTY",
    "score": 80.6,
    "entry": 192.6686,
    "stop": 182.9025,
    "targets": [
      202.3226,
      208.7586
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 232.68,
          "x2": "2025-09-15",
          "y2": 191.71,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 216.59,
          "x2": "2025-09-15",
          "y2": 184.75,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 188.23
        }
      ],
      "priceLevels": {
        "entry": 192.6686,
        "stop": 182.9025,
        "targets": [
          202.3226,
          208.7586
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.43",
        "slope gap 0.0045"
      ],
      "direction": "falling",
      "atr14": 12.9686,
      "sector": "Healthcare"
    },
    "avg_price": 168.3730005900065,
    "avg_volume": 9545966.633333333,
    "key_levels": {
      "entry": 192.6686,
      "stop": 182.9025,
      "targets": [
        202.3226,
        208.7586
      ]
    },
    "atr14": 12.9686,
    "sector": "Healthcare",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=RVTY+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30342.05
  }
}
2025-09-17 16:28:02 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-17 23:28:06.819362', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 16:28:06 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 16:28:13 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 16:28:13 Sleeping 5m before next iteration
2025-09-17 16:33:13 === Iteration 17 ===
2025-09-17 16:33:13 venv exists
2025-09-17 16:33:13 Installing Python requirements
2025-09-17 16:33:14 shots: node_modules present
2025-09-17 16:33:14 frontend: node_modules present
2025-09-17 16:33:14 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 1 warning in 8.82s
2025-09-17 16:33:25 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 16:33:25 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 16:33:25 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 16:33:19,525", "levelname": "INFO", "message": "request", "request_id": "5ae6fa06-f760-4c2b-819d-4a79cb183751", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 13}
INFO:     127.0.0.1:52114 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 16:33:19,534", "levelname": "INFO", "message": "request", "request_id": "cb83eea3-2483-4292-ad1f-d849d210aada", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:52117 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 16:33:25,077", "levelname": "INFO", "message": "request", "request_id": "e35379fb-2ded-4622-ac6a-d04e0eef4249", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:52140 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 16:33:31,801", "levelname": "INFO", "message": "request", "request_id": "78117d33-3d44-4344-a94b-d1a37467e28e", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:52172 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 16:33:31,855", "levelname": "INFO", "message": "request", "request_id": "74865e6f-a554-43e0-bd40-436bd24fc312", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 43}
INFO:     127.0.0.1:52175 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6593,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758152011619.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5246,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758152017034.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 16:33:37 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758152028061.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10855.78
  }
}

2025-09-17 16:33:48 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758152033621.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5442
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758152043172.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9429.62
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 111,
  "sample": {
    "symbol": "PM",
    "score": 80.57,
    "entry": 144.2476,
    "stop": 138.5109,
    "targets": [
      148.5605,
      151.4357
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 164.837,
          "x2": "2025-09-15",
          "y2": 143.53,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 157.6489,
          "x2": "2025-09-15",
          "y2": 139.91,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 141.72
        }
      ],
      "priceLevels": {
        "entry": 144.2476,
        "stop": 138.5109,
        "targets": [
          148.5605,
          151.4357
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.50",
        "slope gap 0.0137"
      ],
      "direction": "falling",
      "atr14": 6.2749
    },
    "avg_price": 138.4904032389323,
    "avg_volume": 42075104.56666667,
    "key_levels": {
      "entry": 144.2476,
      "stop": 138.5109,
      "targets": [
        148.5605,
        151.4357
      ]
    },
    "atr14": 6.2749,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=PM+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758152133569.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 15801.81
  }
}
2025-09-17 16:35:33 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-17 23:35:37.442194', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 16:35:37 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 16:35:43 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 16:35:43 Sleeping 5m before next iteration
2025-09-17 16:40:43 === Iteration 18 ===
2025-09-17 16:40:43 venv exists
2025-09-17 16:40:43 Installing Python requirements
2025-09-17 16:40:45 shots: node_modules present
2025-09-17 16:40:45 frontend: node_modules present
2025-09-17 16:40:45 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 1 warning in 8.82s
2025-09-17 16:40:55 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 16:40:55 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 16:40:55 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 16:40:50,282", "levelname": "INFO", "message": "request", "request_id": "c56024be-bb26-4928-b594-eb4161dba429", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 64}
INFO:     127.0.0.1:52911 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 16:40:50,295", "levelname": "INFO", "message": "request", "request_id": "99c8cfc0-07cd-4ba2-9143-6002f58ed610", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 4}
INFO:     127.0.0.1:52914 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 16:40:55,499", "levelname": "INFO", "message": "request", "request_id": "34855542-254b-4b4b-9dbe-e955b5f9e533", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:52936 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 16:41:02,101", "levelname": "INFO", "message": "request", "request_id": "3a255da8-2881-4878-928a-51a0cbcf1f29", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:52966 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 16:41:02,192", "levelname": "INFO", "message": "request", "request_id": "36c88c5e-aff8-4b79-9e96-b5826ee4b774", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 60}
INFO:     127.0.0.1:52967 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6457,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758152461923.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5198,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758152467306.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 16:41:07 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758152477372.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9798.68
  }
}

2025-09-17 16:41:17 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758152482981.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5471
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758152492655.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9659.78
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 177,
  "sample": {
    "symbol": "APA",
    "score": 88.11,
    "entry": 85.0699,
    "stop": 80.3286,
    "targets": [
      92.4979,
      97.4499
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 91.66,
          "x2": "2025-09-15",
          "y2": 84.6467,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 79.28,
          "x2": "2025-09-15",
          "y2": 81.14,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 82.8933
        }
      ],
      "priceLevels": {
        "entry": 85.0699,
        "stop": 80.3286,
        "targets": [
          92.4979,
          97.4499
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.28",
        "slope gap 0.0170"
      ],
      "direction": "falling",
      "atr14": 4.5891
    },
    "avg_price": 67.01066678365072,
    "avg_volume": 13664891.066666666,
    "key_levels": {
      "entry": 85.0699,
      "stop": 80.3286,
      "targets": [
        92.4979,
        97.4499
      ]
    },
    "atr14": 4.5891,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=APA+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30367.87
  }
}
2025-09-17 16:43:18 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-17 23:43:23.766562', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 16:43:24 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 16:43:33 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 16:43:33 Sleeping 5m before next iteration
2025-09-17 16:48:33 === Iteration 19 ===
2025-09-17 16:48:33 venv exists
2025-09-17 16:48:33 Installing Python requirements
2025-09-17 16:48:34 shots: node_modules present
2025-09-17 16:48:34 frontend: node_modules present
2025-09-17 16:48:34 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 1 warning in 8.70s
2025-09-17 16:48:44 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 16:48:44 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 16:48:44 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 16:48:39,499", "levelname": "INFO", "message": "request", "request_id": "9b86fb92-c963-4ca1-9b11-9fd70beeb479", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 27}
INFO:     127.0.0.1:53834 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 16:48:39,512", "levelname": "INFO", "message": "request", "request_id": "cd9f5c34-bc02-4964-8cb0-230d1a2dfc9d", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 4}
INFO:     127.0.0.1:53837 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 16:48:44,431", "levelname": "INFO", "message": "request", "request_id": "287cd9c4-5976-4942-b86d-b86f8c425315", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 0}
INFO:     127.0.0.1:53860 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 16:48:51,610", "levelname": "INFO", "message": "request", "request_id": "defe9bd0-6e9c-45b2-a034-070a066cbbb1", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 7}
INFO:     127.0.0.1:53893 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 16:48:51,688", "levelname": "INFO", "message": "request", "request_id": "a74330ae-6e55-4e48-96fa-01875cc66c42", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 62}
INFO:     127.0.0.1:53894 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6964,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758152931373.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 6350,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758152937955.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 16:48:58 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758152948453.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10247.59
  }
}

2025-09-17 16:49:08 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758152955062.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6452
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758152964352.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9224.87
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 196,
  "sample": {
    "symbol": "ORCL",
    "score": 85.78,
    "entry": 73.7469,
    "stop": 70.8939,
    "targets": [
      77.198,
      79.4988
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 104.2589,
          "x2": "2025-09-15",
          "y2": 73.38,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 98.507,
          "x2": "2025-09-15",
          "y2": 71.61,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 72.495
        }
      ],
      "priceLevels": {
        "entry": 73.7469,
        "stop": 70.8939,
        "targets": [
          77.198,
          79.4988
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.31",
        "slope gap 0.0002"
      ],
      "direction": "falling",
      "atr14": 4.8596,
      "sector": "Technology"
    },
    "avg_price": 67.44640210469564,
    "avg_volume": 79877114.13333334,
    "key_levels": {
      "entry": 73.7469,
      "stop": 70.8939,
      "targets": [
        77.198,
        79.4988
      ]
    },
    "atr14": 4.8596,
    "sector": "Technology",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=ORCL+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30278.88
  }
}
2025-09-17 16:51:09 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-17 23:51:13.089313', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 16:51:13 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 16:51:19 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 16:51:19 Sleeping 5m before next iteration
2025-09-17 16:56:19 === Iteration 20 ===
2025-09-17 16:56:19 venv exists
2025-09-17 16:56:19 Installing Python requirements
2025-09-17 16:56:21 shots: node_modules present
2025-09-17 16:56:21 frontend: node_modules present
2025-09-17 16:56:21 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 1 warning in 8.67s
2025-09-17 16:56:31 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 16:56:31 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 16:56:31 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 16:56:26,180", "levelname": "INFO", "message": "request", "request_id": "8bd6ad6f-63e7-4d14-ac68-906b8d8f0409", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 24}
INFO:     127.0.0.1:54711 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 16:56:26,190", "levelname": "INFO", "message": "request", "request_id": "2ba944ea-72eb-4bdf-9f89-24b8d98acc7e", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:54714 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 16:56:31,330", "levelname": "INFO", "message": "request", "request_id": "6e8d6897-4e27-445b-879e-2217cc05a956", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:54738 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 16:56:38,128", "levelname": "INFO", "message": "request", "request_id": "a4031e83-c693-476a-b978-6ce68cc54f6c", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:54766 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 16:56:38,244", "levelname": "INFO", "message": "request", "request_id": "57e9580b-8ad2-48c1-b97d-40f697300637", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 97}
INFO:     127.0.0.1:54767 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6605,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758153397899.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5249,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758153403416.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 16:56:43 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758153415035.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 11311.12
  }
}

2025-09-17 16:56:55 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758153421647.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6446
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758153431152.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9476.48
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 176,
  "sample": {
    "symbol": "TRGP",
    "score": 84.29,
    "entry": 75.9177,
    "stop": 71.7552,
    "targets": [
      80.894,
      84.2116
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 104.7729,
          "x2": "2025-09-15",
          "y2": 75.54,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 96.479,
          "x2": "2025-09-15",
          "y2": 72.48,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 74.01
        }
      ],
      "priceLevels": {
        "entry": 75.9177,
        "stop": 71.7552,
        "targets": [
          80.894,
          84.2116
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.37",
        "slope gap 0.0201"
      ],
      "direction": "falling",
      "atr14": 4.335
    },
    "avg_price": 68.79065284729003,
    "avg_volume": 15849026.566666666,
    "key_levels": {
      "entry": 75.9177,
      "stop": 71.7552,
      "targets": [
        80.894,
        84.2116
      ]
    },
    "atr14": 4.335,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=TRGP+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30389.0
  }
}
2025-09-17 16:58:56 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-17 23:59:00.498310', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 16:59:00 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 16:59:07 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 16:59:07 Sleeping 5m before next iteration
2025-09-17 17:04:07 === Iteration 21 ===
2025-09-17 17:04:07 venv exists
2025-09-17 17:04:07 Installing Python requirements
2025-09-17 17:04:09 shots: node_modules present
2025-09-17 17:04:09 frontend: node_modules present
2025-09-17 17:04:09 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.11/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.11/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.11/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.11/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.11/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.11/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 1 warning in 9.00s
2025-09-17 17:04:19 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 17:04:19 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 17:04:20 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 17:04:14,630", "levelname": "INFO", "message": "request", "request_id": "7b152fe2-8ce4-4e7e-93a5-7461d61b1a6b", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 29}
INFO:     127.0.0.1:55567 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 17:04:14,639", "levelname": "INFO", "message": "request", "request_id": "5b850d2e-6e53-40b3-8fc5-cf5046bb002a", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:55570 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 17:04:20,009", "levelname": "INFO", "message": "request", "request_id": "04699e14-41b1-418f-ab5f-1e081bb879b7", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:55594 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 17:04:26,745", "levelname": "INFO", "message": "request", "request_id": "4c6d8eeb-d477-41fa-950c-cbf70e0fce79", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:55625 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 17:04:26,816", "levelname": "INFO", "message": "request", "request_id": "d730b8c6-f577-468e-8535-1985bb9fee0d", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 57}
INFO:     127.0.0.1:55626 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6490,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758153866511.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5452,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758153872178.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 17:04:32 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758153884465.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 11980.37
  }
}

2025-09-17 17:04:44 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758153890896.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6336
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758153900049.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9049.58
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 151,
  "sample": {
    "symbol": "NDAQ",
    "score": 88.78,
    "entry": 83.1637,
    "stop": 79.7346,
    "targets": [
      87.9836,
      91.1968
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 111.318,
          "x2": "2025-09-15",
          "y2": 82.75,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 103.285,
          "x2": "2025-09-15",
          "y2": 80.54,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 81.645
        }
      ],
      "priceLevels": {
        "entry": 83.1637,
        "stop": 79.7346,
        "targets": [
          87.9836,
          91.1968
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.28",
        "slope gap 0.0030"
      ],
      "direction": "falling",
      "atr14": 4.3001
    },
    "avg_price": 81.54688568115235,
    "avg_volume": 71392666.4,
    "key_levels": {
      "entry": 83.1637,
      "stop": 79.7346,
      "targets": [
        87.9836,
        91.1968
      ]
    },
    "atr14": 4.3001,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=NDAQ+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30402.52
  }
}
2025-09-17 17:06:44 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 00:06:48.679538', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 17:06:48 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 17:06:55 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 17:06:55 Sleeping 5m before next iteration
2025-09-17 17:11:55 === Iteration 22 ===
2025-09-17 17:11:55 venv exists
2025-09-17 17:11:55 Installing Python requirements
2025-09-17 17:12:29 shots: node_modules present
2025-09-17 17:12:29 frontend: node_modules present
2025-09-17 17:12:29 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 27.96s
2025-09-17 17:12:59 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 17:12:59 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 17:12:59 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 17:12:53,231", "levelname": "INFO", "message": "request", "request_id": "c85450dc-32f8-41e2-9614-2e34c2f6d7dc", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 27}
INFO:     127.0.0.1:56450 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 17:12:53,240", "levelname": "INFO", "message": "request", "request_id": "643b4e69-8da2-4b03-ba32-63d96dd0f633", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 4}
INFO:     127.0.0.1:56453 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 17:12:59,737", "levelname": "INFO", "message": "request", "request_id": "9eb11ce8-4207-4a5a-979c-40b70a1cb999", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:56480 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 17:13:06,591", "levelname": "INFO", "message": "request", "request_id": "bf002f71-9415-4d40-b59f-ad1d388ea6ae", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:56516 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 17:13:06,669", "levelname": "INFO", "message": "request", "request_id": "9189c6eb-4bab-47f3-9a79-e7495493011a", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 63}
INFO:     127.0.0.1:56517 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6626,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758154386383.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5580,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758154392138.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 17:13:12 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758154401880.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9430.82
  }
}

2025-09-17 17:13:22 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758154407955.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5896
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758154417344.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9318.13
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 111,
  "sample": {
    "symbol": "TTD",
    "score": 82.55,
    "entry": 91.2681,
    "stop": 87.5556,
    "targets": [
      94.9414,
      97.3903
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 135.8186,
          "x2": "2025-09-15",
          "y2": 90.814,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 129.6964,
          "x2": "2025-09-15",
          "y2": 88.44,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 89.627
        }
      ],
      "priceLevels": {
        "entry": 91.2681,
        "stop": 87.5556,
        "targets": [
          94.9414,
          97.3903
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.39",
        "slope gap 0.0283"
      ],
      "direction": "falling",
      "atr14": 5.9275
    },
    "avg_price": 98.35214207967122,
    "avg_volume": 36477690.1,
    "key_levels": {
      "entry": 91.2681,
      "stop": 87.5556,
      "targets": [
        94.9414,
        97.3903
      ]
    },
    "atr14": 5.9275,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=TTD+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30318.9
  }
}
2025-09-17 17:15:22 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 00:15:26.259163', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 17:15:26 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 17:15:33 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 17:15:33 Sleeping 5m before next iteration
2025-09-17 17:20:33 === Iteration 23 ===
2025-09-17 17:20:33 venv exists
2025-09-17 17:20:33 Installing Python requirements
2025-09-17 17:20:33 shots: node_modules present
2025-09-17 17:20:33 frontend: node_modules present
2025-09-17 17:20:33 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 10.48s
2025-09-17 17:20:45 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 17:20:45 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 17:20:45 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 17:20:38,553", "levelname": "INFO", "message": "request", "request_id": "f15ba3a1-0001-41a0-92b2-4d0df37f3558", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 32}
INFO:     127.0.0.1:57295 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 17:20:38,560", "levelname": "INFO", "message": "request", "request_id": "30307a20-f88e-4489-84db-5d577d6208ad", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:57298 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 17:20:45,643", "levelname": "INFO", "message": "request", "request_id": "af4deb40-6866-4ab5-956c-5c2ae3f88d7b", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:57321 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 17:20:52,753", "levelname": "INFO", "message": "request", "request_id": "cdf69228-7b17-458e-aee0-c00b65136c6d", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 5}
INFO:     127.0.0.1:57352 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 17:20:52,824", "levelname": "INFO", "message": "request", "request_id": "2bf0d111-582a-49bd-a9e4-20c951fbe5bb", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 56}
INFO:     127.0.0.1:57353 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6768,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758154852516.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5947,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758154858682.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 17:20:58 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758154869961.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10979.31
  }
}

2025-09-17 17:21:10 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758154876810.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6742
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758154886363.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9463.06
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 145,
  "sample": {
    "symbol": "HON",
    "score": 78.59,
    "entry": 50.4108,
    "stop": 47.9358,
    "targets": [
      52.2945,
      53.5503
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 63.2387,
          "x2": "2025-09-15",
          "y2": 50.16,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 60.0992,
          "x2": "2025-09-15",
          "y2": 48.42,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 49.29
        }
      ],
      "priceLevels": {
        "entry": 50.4108,
        "stop": 47.9358,
        "targets": [
          52.2945,
          53.5503
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.55",
        "slope gap 0.0034"
      ],
      "direction": "falling",
      "atr14": 2.1962
    },
    "avg_price": 53.468086624145506,
    "avg_volume": 27987371.1,
    "key_levels": {
      "entry": 50.4108,
      "stop": 47.9358,
      "targets": [
        52.2945,
        53.5503
      ]
    },
    "atr14": 2.1962,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=HON+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30267.61
  }
}
2025-09-17 17:23:10 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 00:23:14.940143', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 17:23:15 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 17:23:21 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 17:23:21 Sleeping 5m before next iteration
2025-09-17 17:28:21 === Iteration 24 ===
2025-09-17 17:28:21 venv exists
2025-09-17 17:28:21 Installing Python requirements
2025-09-17 17:28:22 shots: node_modules present
2025-09-17 17:28:22 frontend: node_modules present
2025-09-17 17:28:22 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 8.46s
2025-09-17 17:28:32 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 17:28:32 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 17:28:32 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 17:28:27,555", "levelname": "INFO", "message": "request", "request_id": "02324940-ea61-4e22-a84a-c006d5e621cc", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 48}
INFO:     127.0.0.1:58182 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 17:28:27,563", "levelname": "INFO", "message": "request", "request_id": "15467745-7bf9-4025-baed-fac282cd9880", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:58185 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 17:28:32,569", "levelname": "INFO", "message": "request", "request_id": "3c3e010d-e3df-4f7e-a1f8-9168841cea34", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:58210 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 17:28:39,339", "levelname": "INFO", "message": "request", "request_id": "ecac3a92-6975-4fa8-bba4-39ec64661444", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:58240 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 17:28:39,436", "levelname": "INFO", "message": "request", "request_id": "a27154f0-5b3a-478f-810d-28344a61c325", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 59}
INFO:     127.0.0.1:58241 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6552,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758155319144.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 4993,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758155324344.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 17:28:44 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758155335376.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10842.68
  }
}

2025-09-17 17:28:55 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758155341929.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6317
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758155351363.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9494.82
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 115,
  "sample": {
    "symbol": "DUK",
    "score": 83.42,
    "entry": 99.1935,
    "stop": 93.951,
    "targets": [
      105.0975,
      109.0335
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 145.09,
          "x2": "2025-09-15",
          "y2": 98.7,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 135.25,
          "x2": "2025-09-15",
          "y2": 94.9,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 96.8
        }
      ],
      "priceLevels": {
        "entry": 99.1935,
        "stop": 93.951,
        "targets": [
          105.0975,
          109.0335
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.39",
        "slope gap 0.0125"
      ],
      "direction": "falling",
      "atr14": 5.8471,
      "sector": "Utilities"
    },
    "avg_price": 92.20166702270508,
    "avg_volume": 21742586.633333333,
    "key_levels": {
      "entry": 99.1935,
      "stop": 93.951,
      "targets": [
        105.0975,
        109.0335
      ]
    },
    "atr14": 5.8471,
    "sector": "Utilities",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=DUK+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30334.35
  }
}
2025-09-17 17:30:56 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 00:31:00.563307', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 17:31:00 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 17:31:07 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 17:31:07 Sleeping 5m before next iteration
2025-09-17 17:36:07 === Iteration 25 ===
2025-09-17 17:36:07 venv exists
2025-09-17 17:36:07 Installing Python requirements
2025-09-17 17:36:08 shots: node_modules present
2025-09-17 17:36:08 frontend: node_modules present
2025-09-17 17:36:08 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 8.62s
2025-09-17 17:36:18 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 17:36:18 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 17:36:18 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 17:36:13,032", "levelname": "INFO", "message": "request", "request_id": "e48fb1fa-a264-4451-b83a-a429afc115d7", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 39}
INFO:     127.0.0.1:59044 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 17:36:13,039", "levelname": "INFO", "message": "request", "request_id": "819fb2ad-8531-49a5-8000-58100f25aea1", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:59047 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 17:36:18,188", "levelname": "INFO", "message": "request", "request_id": "73fe2f46-3e97-4cf3-9ba1-dfbea853f0ff", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:59070 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 17:36:25,088", "levelname": "INFO", "message": "request", "request_id": "8c7a18e0-7bee-4208-854b-e1c1b78459f0", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:59114 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 17:36:25,144", "levelname": "INFO", "message": "request", "request_id": "5b74b1e3-799c-4b9f-9bca-a4f9ab2198b9", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 41}
INFO:     127.0.0.1:59115 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6669,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758155784858.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 6375,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758155791464.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 17:36:31 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758155802756.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 11041.07
  }
}

2025-09-17 17:36:42 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758155808796.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5894
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758155818339.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9587.38
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 161,
  "sample": {
    "symbol": "ARE",
    "score": 88.11,
    "entry": 85.0699,
    "stop": 80.3286,
    "targets": [
      92.4979,
      97.4499
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 91.66,
          "x2": "2025-09-15",
          "y2": 84.6467,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 79.28,
          "x2": "2025-09-15",
          "y2": 81.14,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 82.8933
        }
      ],
      "priceLevels": {
        "entry": 85.0699,
        "stop": 80.3286,
        "targets": [
          92.4979,
          97.4499
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.28",
        "slope gap 0.0170"
      ],
      "direction": "falling",
      "atr14": 4.5891,
      "sector": "Real Estate"
    },
    "avg_price": 67.01066678365072,
    "avg_volume": 13664891.066666666,
    "key_levels": {
      "entry": 85.0699,
      "stop": 80.3286,
      "targets": [
        92.4979,
        97.4499
      ]
    },
    "atr14": 4.5891,
    "sector": "Real Estate",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=ARE+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30396.81
  }
}
2025-09-17 17:38:42 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 00:38:46.515954', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 17:38:46 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 17:38:53 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 17:38:53 Sleeping 5m before next iteration
2025-09-17 17:43:53 === Iteration 26 ===
2025-09-17 17:43:53 venv exists
2025-09-17 17:43:54 Installing Python requirements
2025-09-17 17:43:54 shots: node_modules present
2025-09-17 17:43:54 frontend: node_modules present
2025-09-17 17:43:54 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 8.49s
2025-09-17 17:44:04 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 17:44:04 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 17:44:04 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 17:43:59,300", "levelname": "INFO", "message": "request", "request_id": "6e857e8d-65cc-4dc6-a8a7-7aaa9cad15c9", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 28}
INFO:     127.0.0.1:59949 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 17:43:59,311", "levelname": "INFO", "message": "request", "request_id": "537ce5d0-ea37-4e6c-b134-fb1db86313a5", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 4}
INFO:     127.0.0.1:59952 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 17:44:04,357", "levelname": "INFO", "message": "request", "request_id": "cc1c6ece-2e5e-472a-a5c5-daa1e76c0d06", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:59974 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 17:44:11,153", "levelname": "INFO", "message": "request", "request_id": "4f8d1269-7943-48bc-8f94-7e14ff2ca29d", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:60003 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 17:44:11,208", "levelname": "INFO", "message": "request", "request_id": "aa35c95a-2d76-449a-b952-39c4753d5a55", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 40}
INFO:     127.0.0.1:60004 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6583,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758156250954.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 4818,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758156255951.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 17:44:16 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758156266538.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10402.53
  }
}

2025-09-17 17:44:26 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758156272502.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5716
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758156281871.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9444.32
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 148,
  "sample": {
    "symbol": "TDY",
    "score": 84.29,
    "entry": 75.9177,
    "stop": 71.7552,
    "targets": [
      80.894,
      84.2116
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 104.7729,
          "x2": "2025-09-15",
          "y2": 75.54,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 96.479,
          "x2": "2025-09-15",
          "y2": 72.48,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 74.01
        }
      ],
      "priceLevels": {
        "entry": 75.9177,
        "stop": 71.7552,
        "targets": [
          80.894,
          84.2116
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.37",
        "slope gap 0.0201"
      ],
      "direction": "falling",
      "atr14": 4.335
    },
    "avg_price": 68.79065272013347,
    "avg_volume": 15849026.566666666,
    "key_levels": {
      "entry": 75.9177,
      "stop": 71.7552,
      "targets": [
        80.894,
        84.2116
      ]
    },
    "atr14": 4.335,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=TDY+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30315.26
  }
}
2025-09-17 17:46:25 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 00:46:30.061779', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 17:46:30 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 17:46:37 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 17:46:37 Sleeping 5m before next iteration
2025-09-17 17:51:37 === Iteration 27 ===
2025-09-17 17:51:37 venv exists
2025-09-17 17:51:37 Installing Python requirements
2025-09-17 17:51:38 shots: node_modules present
2025-09-17 17:51:38 frontend: node_modules present
2025-09-17 17:51:38 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 9.12s
2025-09-17 17:51:48 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 17:51:48 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 17:51:48 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 17:51:42,992", "levelname": "INFO", "message": "request", "request_id": "d78b558a-8b4a-4c43-acd2-4482a608a6e2", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 44}
INFO:     127.0.0.1:60790 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 17:51:43,004", "levelname": "INFO", "message": "request", "request_id": "92eec1e6-2a55-4b7d-b063-d7ffea354c7d", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 7}
INFO:     127.0.0.1:60793 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 17:51:48,465", "levelname": "INFO", "message": "request", "request_id": "17d6656d-a1e9-4f86-82b1-5f7f22cfaa98", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:60817 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 17:51:56,028", "levelname": "INFO", "message": "request", "request_id": "7c6ef934-9b1d-4e7d-b4a1-350e87bbe4ed", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 11}
INFO:     127.0.0.1:60860 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 17:51:56,184", "levelname": "INFO", "message": "request", "request_id": "0a5b54e8-a5c7-49c4-8ed3-784195fa9456", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 104}
INFO:     127.0.0.1:60861 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 7307,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758156715790.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5668,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758156721759.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 17:52:01 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758156733153.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 11062.33
  }
}

2025-09-17 17:52:13 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758156740439.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6831
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758156749834.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9362.2
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 164,
  "sample": {
    "symbol": "MTD",
    "score": 88.91,
    "entry": 187.121,
    "stop": 178.0713,
    "targets": [
      201.4358,
      210.9791
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 284.7549,
          "x2": "2025-09-15",
          "y2": 186.19,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 260.8968,
          "x2": "2025-09-15",
          "y2": 179.87,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 183.03
        }
      ],
      "priceLevels": {
        "entry": 187.121,
        "stop": 178.0713,
        "targets": [
          201.4358,
          210.9791
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.26",
        "slope gap 0.0683"
      ],
      "direction": "falling",
      "atr14": 9.5991,
      "sector": "Healthcare"
    },
    "avg_price": 208.48872884114584,
    "avg_volume": 2926685.566666667,
    "key_levels": {
      "entry": 187.121,
      "stop": 178.0713,
      "targets": [
        201.4358,
        210.9791
      ]
    },
    "atr14": 9.5991,
    "sector": "Healthcare",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=MTD+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30290.8
  }
}
2025-09-17 17:54:15 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 00:54:18.953842', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 17:54:19 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 17:54:25 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 17:54:25 Sleeping 5m before next iteration
2025-09-17 17:59:25 === Iteration 28 ===
2025-09-17 17:59:25 venv exists
2025-09-17 17:59:25 Installing Python requirements
2025-09-17 17:59:26 shots: node_modules present
2025-09-17 17:59:26 frontend: node_modules present
2025-09-17 17:59:26 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 9.11s
2025-09-17 17:59:36 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 17:59:36 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 17:59:36 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 17:59:31,059", "levelname": "INFO", "message": "request", "request_id": "d3cbe4e7-c602-4c8b-a21f-aadaf583e478", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 29}
INFO:     127.0.0.1:61685 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 17:59:31,066", "levelname": "INFO", "message": "request", "request_id": "78e49b64-1def-4a5e-a8a5-d52a5ebf7b4a", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:61688 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 17:59:36,446", "levelname": "INFO", "message": "request", "request_id": "cc0a164c-3bd9-4b9a-96d6-3a053aed1a85", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:61713 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 17:59:43,433", "levelname": "INFO", "message": "request", "request_id": "34e9544a-a03b-490e-9333-1841775e37fd", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 12}
INFO:     127.0.0.1:61746 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 17:59:43,516", "levelname": "INFO", "message": "request", "request_id": "795524d1-fa1c-4780-9db5-03c1d0b35883", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 62}
INFO:     127.0.0.1:61747 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6743,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758157183216.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5606,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758157189035.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 17:59:49 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758157200272.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 11123.77
  }
}

2025-09-17 18:00:00 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758157206236.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5598
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758157215569.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9255.92
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 115,
  "sample": {
    "symbol": "NVDA",
    "score": 85.78,
    "entry": 73.7469,
    "stop": 70.8939,
    "targets": [
      77.198,
      79.4988
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 104.2589,
          "x2": "2025-09-15",
          "y2": 73.38,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 98.507,
          "x2": "2025-09-15",
          "y2": 71.61,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 72.495
        }
      ],
      "priceLevels": {
        "entry": 73.7469,
        "stop": 70.8939,
        "targets": [
          77.198,
          79.4988
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.31",
        "slope gap 0.0002"
      ],
      "direction": "falling",
      "atr14": 4.8596,
      "sector": "Technology"
    },
    "avg_price": 67.44640197753907,
    "avg_volume": 79877114.13333334,
    "key_levels": {
      "entry": 73.7469,
      "stop": 70.8939,
      "targets": [
        77.198,
        79.4988
      ]
    },
    "atr14": 4.8596,
    "sector": "Technology",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=NVDA+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30310.28
  }
}
2025-09-17 18:02:00 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 01:02:04.885187', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 18:02:04 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 18:02:11 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 18:02:12 Sleeping 5m before next iteration
2025-09-17 18:07:12 === Iteration 29 ===
2025-09-17 18:07:12 venv exists
2025-09-17 18:07:12 Installing Python requirements
2025-09-17 18:07:12 shots: node_modules present
2025-09-17 18:07:12 frontend: node_modules present
2025-09-17 18:07:12 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 9.06s
2025-09-17 18:07:22 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 18:07:22 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 18:07:22 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 18:07:17,753", "levelname": "INFO", "message": "request", "request_id": "f93aed39-439e-47cf-ae9c-c8fa4c6688c1", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 51}
INFO:     127.0.0.1:62576 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 18:07:17,762", "levelname": "INFO", "message": "request", "request_id": "317f1d63-c3c6-4c08-9886-dedb38c75f95", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 4}
INFO:     127.0.0.1:62579 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 18:07:22,952", "levelname": "INFO", "message": "request", "request_id": "b9441b6a-d27b-4bed-ba19-b449f201300f", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:62602 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 18:07:30,257", "levelname": "INFO", "message": "request", "request_id": "29f45204-30bf-412f-84af-f3ed45b67e82", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 5}
INFO:     127.0.0.1:62639 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 18:07:30,369", "levelname": "INFO", "message": "request", "request_id": "da27d03c-ecd4-44e6-8f37-b47860125ffb", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 75}
INFO:     127.0.0.1:62640 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 7062,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758157650019.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5729,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758157656033.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 18:07:36 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758157667664.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 11308.19
  }
}

2025-09-17 18:07:47 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758157674950.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6987
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758157684366.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9457.71
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 161,
  "sample": {
    "symbol": "DDOG",
    "score": 89.73,
    "entry": 69.6163,
    "stop": 67.7259,
    "targets": [
      71.8387,
      73.3203
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 66.8,
          "x2": "2025-09-15",
          "y2": 69.27,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 63.096,
          "x2": "2025-09-15",
          "y2": 68.41,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 68.84
        }
      ],
      "priceLevels": {
        "entry": 69.6163,
        "stop": 67.7259,
        "targets": [
          71.8387,
          73.3203
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.23",
        "slope gap 0.0095"
      ],
      "direction": "falling",
      "atr14": 4.025,
      "sector": "Technology"
    },
    "avg_price": 58.824666595458986,
    "avg_volume": 10344460.766666668,
    "key_levels": {
      "entry": 69.6163,
      "stop": 67.7259,
      "targets": [
        71.8387,
        73.3203
      ]
    },
    "atr14": 4.025,
    "sector": "Technology",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=DDOG+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758157800676.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 41987.73
  }
}
2025-09-17 18:10:00 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 01:10:04.539757', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 18:10:04 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 18:10:11 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 18:10:11 Sleeping 5m before next iteration
2025-09-17 18:15:11 === Iteration 30 ===
2025-09-17 18:15:11 venv exists
2025-09-17 18:15:11 Installing Python requirements
2025-09-17 18:15:11 shots: node_modules present
2025-09-17 18:15:11 frontend: node_modules present
2025-09-17 18:15:11 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 8.23s
2025-09-17 18:15:20 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 18:15:20 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 18:15:20 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 18:15:15,923", "levelname": "INFO", "message": "request", "request_id": "7e486465-f7ae-49f4-9795-010ead3a43e3", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 30}
INFO:     127.0.0.1:63471 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 18:15:15,930", "levelname": "INFO", "message": "request", "request_id": "f6e82282-64db-4ae1-b5fa-8b7a533e5b8f", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:63474 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 18:15:20,936", "levelname": "INFO", "message": "request", "request_id": "e1601ab1-6786-43d2-b13c-c6c976cb0bc4", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 0}
INFO:     127.0.0.1:63498 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 18:15:28,099", "levelname": "INFO", "message": "request", "request_id": "4687ec31-4436-49a3-a50b-ac4ae39ae020", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:63529 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 18:15:28,176", "levelname": "INFO", "message": "request", "request_id": "9114019f-779b-44d3-8592-34d7cd23bb72", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 54}
INFO:     127.0.0.1:63530 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6925,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758158127905.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5591,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758158133703.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 18:15:33 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758158143945.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9976.88
  }
}

2025-09-17 18:15:44 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758158149932.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5834
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758158159462.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9554.85
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 127,
  "sample": {
    "symbol": "DE",
    "score": 89.73,
    "entry": 69.6163,
    "stop": 67.7259,
    "targets": [
      71.8387,
      73.3203
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 66.8,
          "x2": "2025-09-15",
          "y2": 69.27,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 63.096,
          "x2": "2025-09-15",
          "y2": 68.41,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 68.84
        }
      ],
      "priceLevels": {
        "entry": 69.6163,
        "stop": 67.7259,
        "targets": [
          71.8387,
          73.3203
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.23",
        "slope gap 0.0095"
      ],
      "direction": "falling",
      "atr14": 4.025
    },
    "avg_price": 58.824666595458986,
    "avg_volume": 10344460.766666668,
    "key_levels": {
      "entry": 69.6163,
      "stop": 67.7259,
      "targets": [
        71.8387,
        73.3203
      ]
    },
    "atr14": 4.025,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=DE+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30218.02
  }
}
2025-09-17 18:17:44 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 01:17:47.800732', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 18:17:47 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 18:17:54 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 18:17:54 Sleeping 5m before next iteration
2025-09-17 18:22:54 === Iteration 31 ===
2025-09-17 18:22:54 venv exists
2025-09-17 18:22:54 Installing Python requirements
2025-09-17 18:22:55 shots: node_modules present
2025-09-17 18:22:55 frontend: node_modules present
2025-09-17 18:22:55 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 9.32s
2025-09-17 18:23:05 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 18:23:05 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 18:23:05 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 18:22:59,934", "levelname": "INFO", "message": "request", "request_id": "9efc3437-d51e-4bed-88be-09f7c68b7537", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 23}
INFO:     127.0.0.1:64348 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 18:22:59,944", "levelname": "INFO", "message": "request", "request_id": "5589a710-d164-4a4c-874c-ec1e9968fe62", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:64351 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 18:23:05,684", "levelname": "INFO", "message": "request", "request_id": "cc70eb6f-3315-4eeb-b890-0b6e4279be0b", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:64374 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 18:23:12,905", "levelname": "INFO", "message": "request", "request_id": "12f331de-94ae-4ed4-91ca-a447ca9fd111", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:64407 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 18:23:12,977", "levelname": "INFO", "message": "request", "request_id": "157ae38e-43a3-4b8e-846d-6fe6ece2d82b", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 56}
INFO:     127.0.0.1:64408 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 7020,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758158592669.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5262,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758158598151.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 18:23:18 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758158607878.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9562.92
  }
}

2025-09-17 18:23:28 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758158615231.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 7115
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758158624644.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9327.11
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 142,
  "sample": {
    "symbol": "TSCO",
    "score": 84.29,
    "entry": 75.9177,
    "stop": 71.7552,
    "targets": [
      80.894,
      84.2116
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 104.7729,
          "x2": "2025-09-15",
          "y2": 75.54,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 96.479,
          "x2": "2025-09-15",
          "y2": 72.48,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 74.01
        }
      ],
      "priceLevels": {
        "entry": 75.9177,
        "stop": 71.7552,
        "targets": [
          80.894,
          84.2116
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.37",
        "slope gap 0.0201"
      ],
      "direction": "falling",
      "atr14": 4.335,
      "sector": "Consumer Cyclical"
    },
    "avg_price": 68.79065284729003,
    "avg_volume": 15849026.566666666,
    "key_levels": {
      "entry": 75.9177,
      "stop": 71.7552,
      "targets": [
        80.894,
        84.2116
      ]
    },
    "atr14": 4.335,
    "sector": "Consumer Cyclical",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=TSCO+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30266.37
  }
}
2025-09-17 18:25:29 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 01:25:33.608836', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 18:25:33 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 18:25:40 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 18:25:40 Sleeping 5m before next iteration
2025-09-17 18:30:40 === Iteration 32 ===
2025-09-17 18:30:40 venv exists
2025-09-17 18:30:40 Installing Python requirements
2025-09-17 18:30:41 shots: node_modules present
2025-09-17 18:30:41 frontend: node_modules present
2025-09-17 18:30:41 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 8.51s
2025-09-17 18:30:50 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 18:30:50 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 18:30:50 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 18:30:45,549", "levelname": "INFO", "message": "request", "request_id": "73a5c4c2-3954-41dd-9521-237b2056db2b", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 30}
INFO:     127.0.0.1:65258 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 18:30:45,557", "levelname": "INFO", "message": "request", "request_id": "6d5dd278-af69-4232-aab2-d66a8d602d3d", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:65261 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 18:30:50,622", "levelname": "INFO", "message": "request", "request_id": "0e432d5f-bba1-4532-a0e4-4f2aaddcd1a8", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:65286 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 18:30:58,014", "levelname": "INFO", "message": "request", "request_id": "c2fd6b10-d9dd-4436-bb9b-b4b5787c00ef", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:65319 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 18:30:58,086", "levelname": "INFO", "message": "request", "request_id": "724e7b57-e8d0-435d-9744-8a59c7dcf65a", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 58}
INFO:     127.0.0.1:65320 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 7174,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758159057788.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 6503,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758159064506.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 18:31:04 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758159074510.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9791.33
  }
}

2025-09-17 18:31:14 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758159081206.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6489
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758159090774.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9513.68
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 116,
  "sample": {
    "symbol": "DTE",
    "score": 89.73,
    "entry": 69.6163,
    "stop": 67.7259,
    "targets": [
      71.8387,
      73.3203
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 66.8,
          "x2": "2025-09-15",
          "y2": 69.27,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 63.096,
          "x2": "2025-09-15",
          "y2": 68.41,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 68.84
        }
      ],
      "priceLevels": {
        "entry": 69.6163,
        "stop": 67.7259,
        "targets": [
          71.8387,
          73.3203
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.23",
        "slope gap 0.0095"
      ],
      "direction": "falling",
      "atr14": 4.025,
      "sector": "Utilities"
    },
    "avg_price": 58.824666595458986,
    "avg_volume": 10466750.766666668,
    "key_levels": {
      "entry": 69.6163,
      "stop": 67.7259,
      "targets": [
        71.8387,
        73.3203
      ]
    },
    "atr14": 4.025,
    "sector": "Utilities",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=DTE+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30430.04
  }
}
2025-09-17 18:33:15 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 01:33:18.961890', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 18:33:19 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 18:33:25 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 18:33:25 Sleeping 5m before next iteration
2025-09-17 18:38:25 === Iteration 33 ===
2025-09-17 18:38:25 venv exists
2025-09-17 18:38:25 Installing Python requirements
2025-09-17 18:38:26 shots: node_modules present
2025-09-17 18:38:26 frontend: node_modules present
2025-09-17 18:38:26 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 8.63s
2025-09-17 18:38:36 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 18:38:36 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 18:38:36 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 18:38:31,072", "levelname": "INFO", "message": "request", "request_id": "98ded5ce-74c0-469f-a1b2-b092f068b733", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 74}
INFO:     127.0.0.1:49756 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 18:38:31,081", "levelname": "INFO", "message": "request", "request_id": "b6b23a93-cd81-4c61-9899-325a046193fe", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 4}
INFO:     127.0.0.1:49759 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 18:38:36,321", "levelname": "INFO", "message": "request", "request_id": "8a174204-da5a-40cc-9078-35352ec000ce", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:49783 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 18:38:43,037", "levelname": "INFO", "message": "request", "request_id": "5ef5693d-0758-4738-82bf-25668601b69b", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:49813 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 18:38:43,118", "levelname": "INFO", "message": "request", "request_id": "70079bed-3644-498c-afe5-99130e3dcb73", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 68}
INFO:     127.0.0.1:49814 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6499,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758159522838.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5134,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758159528172.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 18:38:48 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758159538356.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9971.24
  }
}

2025-09-17 18:38:58 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758159544189.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5728
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758159553839.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9835.28
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 133,
  "sample": {
    "symbol": "ARE",
    "score": 88.1,
    "entry": 85.0733,
    "stop": 80.3286,
    "targets": [
      92.5013,
      97.4533
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 91.66,
          "x2": "2025-09-15",
          "y2": 84.65,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 79.28,
          "x2": "2025-09-15",
          "y2": 81.14,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 82.895
        }
      ],
      "priceLevels": {
        "entry": 85.0733,
        "stop": 80.3286,
        "targets": [
          92.5013,
          97.4533
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.28",
        "slope gap 0.0170"
      ],
      "direction": "falling",
      "atr14": 4.5893,
      "sector": "Real Estate"
    },
    "avg_price": 67.01066678365072,
    "avg_volume": 13724511.066666666,
    "key_levels": {
      "entry": 85.0733,
      "stop": 80.3286,
      "targets": [
        92.5013,
        97.4533
      ]
    },
    "atr14": 4.5893,
    "sector": "Real Estate",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=ARE+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30296.11
  }
}
2025-09-17 18:40:58 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 01:41:01.751584', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 18:41:01 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 18:41:08 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 18:41:08 Sleeping 5m before next iteration
2025-09-17 18:46:08 === Iteration 34 ===
2025-09-17 18:46:08 venv exists
2025-09-17 18:46:08 Installing Python requirements
2025-09-17 18:46:09 shots: node_modules present
2025-09-17 18:46:09 frontend: node_modules present
2025-09-17 18:46:09 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 9.34s
2025-09-17 18:46:20 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 18:46:20 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 18:46:20 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 18:46:15,046", "levelname": "INFO", "message": "request", "request_id": "f852142d-dc5c-46f5-ab5d-fed1aba5e4a5", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 29}
INFO:     127.0.0.1:50596 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 18:46:15,054", "levelname": "INFO", "message": "request", "request_id": "fb76427a-31e6-4ba9-a8ad-ce347783fbfb", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:50599 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 18:46:20,428", "levelname": "INFO", "message": "request", "request_id": "1f34a649-ceb5-446e-9120-f0f2970cb429", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 9}
INFO:     127.0.0.1:50621 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 18:46:31,658", "levelname": "INFO", "message": "request", "request_id": "313fb3be-2dbd-4753-84f0-380edb4146b3", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 5}
INFO:     127.0.0.1:50663 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 18:46:31,773", "levelname": "INFO", "message": "request", "request_id": "790714c9-17c1-4330-9ca7-36dfeb575ee4", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 81}
INFO:     127.0.0.1:50664 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 10886,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758159991400.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5919,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758159997652.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 18:46:37 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758160008371.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10251.34
  }
}

2025-09-17 18:46:48 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758160014397.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5868
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758160024020.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9607.43
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 94,
  "sample": {
    "symbol": "LEN",
    "score": 80.79,
    "entry": 62.0085,
    "stop": 58.4298,
    "targets": [
      65.8785,
      68.4585
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 77.63,
          "x2": "2025-09-15",
          "y2": 61.7,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 71.18,
          "x2": "2025-09-15",
          "y2": 59.02,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 60.36
        }
      ],
      "priceLevels": {
        "entry": 62.0085,
        "stop": 58.4298,
        "targets": [
          65.8785,
          68.4585
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.42",
        "slope gap 0.0041"
      ],
      "direction": "falling",
      "atr14": 4.4257
    },
    "avg_price": 65.70599975585938,
    "avg_volume": 15414877.5,
    "key_levels": {
      "entry": 62.0085,
      "stop": 58.4298,
      "targets": [
        65.8785,
        68.4585
      ]
    },
    "atr14": 4.4257,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=LEN+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30224.01
  }
}
2025-09-17 18:48:48 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 01:48:52.744782', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 18:48:52 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 18:49:00 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 18:49:00 Sleeping 5m before next iteration
2025-09-17 18:54:00 === Iteration 35 ===
2025-09-17 18:54:00 venv exists
2025-09-17 18:54:00 Installing Python requirements
2025-09-17 18:54:01 shots: node_modules present
2025-09-17 18:54:01 frontend: node_modules present
2025-09-17 18:54:01 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 8.81s
2025-09-17 18:54:10 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 18:54:10 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 18:54:11 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 18:54:05,796", "levelname": "INFO", "message": "request", "request_id": "3ec668a8-8fda-46cd-8cd8-e7c2033bf56c", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 30}
INFO:     127.0.0.1:51442 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 18:54:05,804", "levelname": "INFO", "message": "request", "request_id": "0c783bb7-89e1-480c-a135-3fdb0b5a7013", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:51445 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 18:54:11,006", "levelname": "INFO", "message": "request", "request_id": "f26944c2-6efd-445c-991c-e899f5ae4657", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:51467 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 18:54:18,066", "levelname": "INFO", "message": "request", "request_id": "45b698cd-cd13-4030-a41e-2e893463feda", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 4}
INFO:     127.0.0.1:51498 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 18:54:18,129", "levelname": "INFO", "message": "request", "request_id": "ed9cddc5-8efd-4903-b95a-4e216909e592", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 46}
INFO:     127.0.0.1:51499 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6816,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758160457825.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 4842,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758160462910.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 18:54:23 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758160472932.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9740.53
  }
}

2025-09-17 18:54:33 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758160479407.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6323
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758160489052.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9642.75
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 165,
  "sample": {
    "symbol": "BMY",
    "score": 83.77,
    "entry": 28.2506,
    "stop": 26.8389,
    "targets": [
      29.9898,
      31.1494
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 55.3463,
          "x2": "2025-09-15",
          "y2": 28.11,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 52.4474,
          "x2": "2025-09-15",
          "y2": 27.11,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 27.61
        }
      ],
      "priceLevels": {
        "entry": 28.2506,
        "stop": 26.8389,
        "targets": [
          29.9898,
          31.1494
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.34",
        "slope gap 0.0026"
      ],
      "direction": "falling",
      "atr14": 1.9824
    },
    "avg_price": 30.925524711608887,
    "avg_volume": 18955150.0,
    "key_levels": {
      "entry": 28.2506,
      "stop": 26.8389,
      "targets": [
        29.9898,
        31.1494
      ]
    },
    "atr14": 1.9824,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=BMY+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30393.45
  }
}
2025-09-17 18:56:33 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 01:56:36.820765', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 18:56:36 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 18:56:43 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 18:56:43 Sleeping 5m before next iteration
2025-09-17 19:01:43 === Iteration 36 ===
2025-09-17 19:01:43 venv exists
2025-09-17 19:01:43 Installing Python requirements
2025-09-17 19:01:44 shots: node_modules present
2025-09-17 19:01:44 frontend: node_modules present
2025-09-17 19:01:44 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 8.60s
2025-09-17 19:01:54 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 19:01:54 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 19:01:54 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 19:01:49,104", "levelname": "INFO", "message": "request", "request_id": "6add1644-8ca9-4f89-bfaa-0c45f3e16554", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 11}
INFO:     127.0.0.1:52288 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 19:01:49,111", "levelname": "INFO", "message": "request", "request_id": "862d67c6-0955-466e-a90d-9bbd3457b67d", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:52291 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 19:01:54,380", "levelname": "INFO", "message": "request", "request_id": "aae4bc62-2056-4df6-88ce-e9876a881239", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:52324 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 19:02:01,004", "levelname": "INFO", "message": "request", "request_id": "9f3294e6-cf77-40bd-b956-4c627a4d7d1e", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:52355 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 19:02:01,061", "levelname": "INFO", "message": "request", "request_id": "57d0fd4e-a121-4889-8d8d-68f4fe6745ff", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 41}
INFO:     127.0.0.1:52356 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6463,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758160920772.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5020,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758160926023.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 19:02:06 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758160936868.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10684.53
  }
}

2025-09-17 19:02:17 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758160942872.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5763
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758160952747.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9813.25
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 116,
  "sample": {
    "symbol": "HPE",
    "score": 78.56,
    "entry": 278.2946,
    "stop": 267.5871,
    "targets": [
      285.6572,
      290.5656
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 251.2054,
          "x2": "2025-09-15",
          "y2": 276.91,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 238.9343,
          "x2": "2025-09-15",
          "y2": 270.29,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 273.6
        }
      ],
      "priceLevels": {
        "entry": 278.2946,
        "stop": 267.5871,
        "targets": [
          285.6572,
          290.5656
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.54",
        "slope gap 0.0526"
      ],
      "direction": "falling",
      "atr14": 12.9797,
      "sector": "Technology"
    },
    "avg_price": 234.40657450358074,
    "avg_volume": 2861699.6,
    "key_levels": {
      "entry": 278.2946,
      "stop": 267.5871,
      "targets": [
        285.6572,
        290.5656
      ]
    },
    "atr14": 12.9797,
    "sector": "Technology",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=HPE+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30365.53
  }
}
2025-09-17 19:04:19 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 02:04:22.994289', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 19:04:23 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 19:04:30 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 19:04:30 Sleeping 5m before next iteration
2025-09-17 19:09:30 === Iteration 37 ===
2025-09-17 19:09:30 venv exists
2025-09-17 19:09:30 Installing Python requirements
2025-09-17 19:09:30 shots: node_modules present
2025-09-17 19:09:30 frontend: node_modules present
2025-09-17 19:09:30 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 8.01s
2025-09-17 19:09:39 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 19:09:39 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 19:09:39 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 19:09:34,960", "levelname": "INFO", "message": "request", "request_id": "7b725b7c-dbe4-4b09-a2ec-9ccc4f592afb", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 10}
INFO:     127.0.0.1:53114 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 19:09:34,967", "levelname": "INFO", "message": "request", "request_id": "317fe6e3-c81f-4f30-860b-ff1b2bb3f1e4", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:53117 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 19:09:39,887", "levelname": "INFO", "message": "request", "request_id": "7665a9b6-1320-4c43-9636-32831bcec598", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:53139 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 19:09:46,586", "levelname": "INFO", "message": "request", "request_id": "f53c84de-ccd9-4608-9178-fd76aa217a8f", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 4}
INFO:     127.0.0.1:53168 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 19:09:46,655", "levelname": "INFO", "message": "request", "request_id": "5d634e83-9a8f-4340-9ef7-edc3d6b43700", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 43}
INFO:     127.0.0.1:53169 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6555,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758161386371.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5155,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758161391744.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 19:09:51 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758161402867.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10829.83
  }
}

2025-09-17 19:10:02 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758161408487.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5502
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758161419067.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10543.71
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 159,
  "sample": {
    "symbol": "ROL",
    "score": 80.57,
    "entry": 144.2476,
    "stop": 138.5109,
    "targets": [
      148.5605,
      151.4357
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 164.837,
          "x2": "2025-09-15",
          "y2": 143.53,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 157.6489,
          "x2": "2025-09-15",
          "y2": 139.91,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 141.72
        }
      ],
      "priceLevels": {
        "entry": 144.2476,
        "stop": 138.5109,
        "targets": [
          148.5605,
          151.4357
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.50",
        "slope gap 0.0137"
      ],
      "direction": "falling",
      "atr14": 6.2749
    },
    "avg_price": 138.49040247599285,
    "avg_volume": 42278137.9,
    "key_levels": {
      "entry": 144.2476,
      "stop": 138.5109,
      "targets": [
        148.5605,
        151.4357
      ]
    },
    "atr14": 6.2749,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=ROL+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30340.1
  }
}
2025-09-17 19:12:03 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 02:12:08.170779', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 19:12:08 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 19:12:15 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 19:12:15 Sleeping 5m before next iteration
2025-09-17 19:17:15 === Iteration 38 ===
2025-09-17 19:17:15 venv exists
2025-09-17 19:17:15 Installing Python requirements
2025-09-17 19:17:15 shots: node_modules present
2025-09-17 19:17:15 frontend: node_modules present
2025-09-17 19:17:15 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 8.49s
2025-09-17 19:17:25 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 19:17:25 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 19:17:25 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 19:17:20,227", "levelname": "INFO", "message": "request", "request_id": "98a69afd-4615-47b9-bc24-c81bba1445ab", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 17}
INFO:     127.0.0.1:53934 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 19:17:20,234", "levelname": "INFO", "message": "request", "request_id": "73d5cf2d-6d12-4958-b298-feea56f307b2", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:53937 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 19:17:25,538", "levelname": "INFO", "message": "request", "request_id": "b1ded529-2345-4838-a428-f558e1d8dca6", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:53960 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 19:17:31,798", "levelname": "INFO", "message": "request", "request_id": "814f66c4-d70c-4d97-9882-ff935dde0e04", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:53991 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 19:17:31,844", "levelname": "INFO", "message": "request", "request_id": "7516867b-4ece-48b7-a3de-e641b7f8cb0c", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 36}
INFO:     127.0.0.1:53992 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6100,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758161851570.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 4812,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758161856583.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 19:17:36 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758161867847.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 11056.78
  }
}

2025-09-17 19:17:48 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758161873802.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5699
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758161883262.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9374.31
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 170,
  "sample": {
    "symbol": "AVGO",
    "score": 88.1,
    "entry": 85.0733,
    "stop": 80.3286,
    "targets": [
      92.5013,
      97.4533
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 91.66,
          "x2": "2025-09-15",
          "y2": 84.65,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 79.28,
          "x2": "2025-09-15",
          "y2": 81.14,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 82.895
        }
      ],
      "priceLevels": {
        "entry": 85.0733,
        "stop": 80.3286,
        "targets": [
          92.5013,
          97.4533
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.28",
        "slope gap 0.0170"
      ],
      "direction": "falling",
      "atr14": 4.5893,
      "sector": "Technology"
    },
    "avg_price": 67.01066678365072,
    "avg_volume": 13724511.066666666,
    "key_levels": {
      "entry": 85.0733,
      "stop": 80.3286,
      "targets": [
        92.5013,
        97.4533
      ]
    },
    "atr14": 4.5893,
    "sector": "Technology",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AVGO+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30484.11
  }
}
2025-09-17 19:19:48 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 02:19:52.292632', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 19:19:52 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 19:19:59 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 19:19:59 Sleeping 5m before next iteration
2025-09-17 19:24:59 === Iteration 39 ===
2025-09-17 19:24:59 venv exists
2025-09-17 19:24:59 Installing Python requirements
2025-09-17 19:25:00 shots: node_modules present
2025-09-17 19:25:00 frontend: node_modules present
2025-09-17 19:25:00 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 11.09s
2025-09-17 19:25:12 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 19:25:12 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 19:25:12 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 19:25:07,081", "levelname": "INFO", "message": "request", "request_id": "17812ed5-3526-4402-aad1-26b1eae4d8d4", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 26}
INFO:     127.0.0.1:54786 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 19:25:07,115", "levelname": "INFO", "message": "request", "request_id": "03e1655e-0480-4aa4-99cd-31b4d0be96b0", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 28}
INFO:     127.0.0.1:54789 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 19:25:12,322", "levelname": "INFO", "message": "request", "request_id": "bc880b6a-8990-4110-9bd3-4b1ec7ceb435", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:54811 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 19:25:19,674", "levelname": "INFO", "message": "request", "request_id": "c5e8ec44-e9e5-4b22-92cb-1e2b9cc28f81", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:54843 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 19:25:19,771", "levelname": "INFO", "message": "request", "request_id": "610c29a1-cf00-4234-b892-f43fd7aa7c93", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 77}
INFO:     127.0.0.1:54844 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 7089,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758162319389.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 6308,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758162326036.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 19:25:26 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758162336762.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10499.26
  }
}

2025-09-17 19:25:36 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758162342451.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5536
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758162351945.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9445.68
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 159,
  "sample": {
    "symbol": "NEE",
    "score": 88.78,
    "entry": 83.1637,
    "stop": 79.7346,
    "targets": [
      87.9836,
      91.1968
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 111.318,
          "x2": "2025-09-15",
          "y2": 82.75,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 103.285,
          "x2": "2025-09-15",
          "y2": 80.54,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 81.645
        }
      ],
      "priceLevels": {
        "entry": 83.1637,
        "stop": 79.7346,
        "targets": [
          87.9836,
          91.1968
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.28",
        "slope gap 0.0030"
      ],
      "direction": "falling",
      "atr14": 4.3001
    },
    "avg_price": 81.5468859354655,
    "avg_volume": 71813879.73333333,
    "key_levels": {
      "entry": 83.1637,
      "stop": 79.7346,
      "targets": [
        87.9836,
        91.1968
      ]
    },
    "atr14": 4.3001,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=NEE+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30204.09
  }
}
2025-09-17 19:27:41 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 02:27:44.780260', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 19:27:44 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 19:27:50 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 19:27:50 Sleeping 5m before next iteration
2025-09-17 19:32:50 === Iteration 40 ===
2025-09-17 19:32:50 venv exists
2025-09-17 19:32:50 Installing Python requirements
2025-09-17 19:32:51 shots: node_modules present
2025-09-17 19:32:51 frontend: node_modules present
2025-09-17 19:32:51 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 11.14s
2025-09-17 19:33:04 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 19:33:04 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 19:33:04 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 19:32:57,293", "levelname": "INFO", "message": "request", "request_id": "8a5ab26a-5b02-4aef-a5b5-d57ddc61051f", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 76}
INFO:     127.0.0.1:55628 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 19:32:57,348", "levelname": "INFO", "message": "request", "request_id": "63a8a8e3-efe8-45c8-a36e-e79eb176b67e", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 50}
INFO:     127.0.0.1:55631 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 19:33:04,672", "levelname": "INFO", "message": "request", "request_id": "a42f84ee-a440-4bd4-a101-dd2e89175f8b", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:55654 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 19:33:12,874", "levelname": "INFO", "message": "request", "request_id": "79da3a8a-8915-49f6-992b-142d8f3769b9", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:55685 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 19:33:12,999", "levelname": "INFO", "message": "request", "request_id": "7fcd67ab-bd14-4e90-8156-d2d938e6963c", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 109}
INFO:     127.0.0.1:55686 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 7894,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758162792559.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 6801,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758162799850.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 19:33:20 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758162812143.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 11312.5
  }
}

2025-09-17 19:33:32 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758162818962.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 6691
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758162828358.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9280.18
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 114,
  "sample": {
    "symbol": "NOW",
    "score": 88.78,
    "entry": 83.1637,
    "stop": 79.7346,
    "targets": [
      87.9836,
      91.1968
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 111.318,
          "x2": "2025-09-15",
          "y2": 82.75,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 103.285,
          "x2": "2025-09-15",
          "y2": 80.54,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 81.645
        }
      ],
      "priceLevels": {
        "entry": 83.1637,
        "stop": 79.7346,
        "targets": [
          87.9836,
          91.1968
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.28",
        "slope gap 0.0030"
      ],
      "direction": "falling",
      "atr14": 4.3001
    },
    "avg_price": 81.54688568115235,
    "avg_volume": 71813879.73333333,
    "key_levels": {
      "entry": 83.1637,
      "stop": 79.7346,
      "targets": [
        87.9836,
        91.1968
      ]
    },
    "atr14": 4.3001,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=NOW+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30380.66
  }
}
2025-09-17 19:35:33 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 02:35:37.019824', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 19:35:37 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 19:35:43 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 19:35:43 Sleeping 5m before next iteration
2025-09-17 19:40:43 === Iteration 41 ===
2025-09-17 19:40:43 venv exists
2025-09-17 19:40:43 Installing Python requirements
2025-09-17 19:40:43 shots: node_modules present
2025-09-17 19:40:43 frontend: node_modules present
2025-09-17 19:40:43 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 8.45s
2025-09-17 19:40:52 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 19:40:52 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 19:40:52 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 19:40:47,873", "levelname": "INFO", "message": "request", "request_id": "166af57b-981a-44d1-80f6-efdba07656c5", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 14}
INFO:     127.0.0.1:56428 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 19:40:47,880", "levelname": "INFO", "message": "request", "request_id": "f7364862-9a83-48e0-a361-b303bae769b4", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:56431 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 19:40:52,994", "levelname": "INFO", "message": "request", "request_id": "fede5198-02e8-4db9-b8eb-930f35ff23e5", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:56455 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 19:40:59,536", "levelname": "INFO", "message": "request", "request_id": "ef20f135-11af-4063-b437-7f88853301ff", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:56484 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 19:40:59,587", "levelname": "INFO", "message": "request", "request_id": "ae266d22-3407-4b68-93c8-0063115e508c", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 32}
INFO:     127.0.0.1:56485 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6401,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758163259330.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5445,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758163264942.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 19:41:05 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758163276841.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 11667.41
  }
}

2025-09-17 19:41:16 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758163282280.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5340
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758163291963.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9755.49
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 144,
  "sample": {
    "symbol": "SYF",
    "score": 84.29,
    "entry": 75.9177,
    "stop": 71.7552,
    "targets": [
      80.894,
      84.2116
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 104.7729,
          "x2": "2025-09-15",
          "y2": 75.54,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 96.479,
          "x2": "2025-09-15",
          "y2": 72.48,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 74.01
        }
      ],
      "priceLevels": {
        "entry": 75.9177,
        "stop": 71.7552,
        "targets": [
          80.894,
          84.2116
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.37",
        "slope gap 0.0201"
      ],
      "direction": "falling",
      "atr14": 4.335
    },
    "avg_price": 68.79065284729003,
    "avg_volume": 15929483.233333332,
    "key_levels": {
      "entry": 75.9177,
      "stop": 71.7552,
      "targets": [
        80.894,
        84.2116
      ]
    },
    "atr14": 4.335,
    "chart_url": "https://legend-shots.onrender.com/reports/SYF-1758163328571.png"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30286.99
  }
}
2025-09-17 19:43:16 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 02:43:19.788112', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 19:43:19 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 19:43:26 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 19:43:26 Sleeping 5m before next iteration
2025-09-17 19:48:26 === Iteration 42 ===
2025-09-17 19:48:26 venv exists
2025-09-17 19:48:26 Installing Python requirements
2025-09-17 19:48:27 shots: node_modules present
2025-09-17 19:48:27 frontend: node_modules present
2025-09-17 19:48:27 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 8.56s
2025-09-17 19:48:36 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 19:48:36 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 19:48:36 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 19:48:31,651", "levelname": "INFO", "message": "request", "request_id": "026445fe-9d8f-4bc2-b9aa-a0d8b6bc7c86", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 12}
INFO:     127.0.0.1:57246 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 19:48:31,661", "levelname": "INFO", "message": "request", "request_id": "f55f06bf-a933-489c-9c7d-326ee5cf0ce4", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:57249 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 19:48:36,955", "levelname": "INFO", "message": "request", "request_id": "1b237166-2ff1-442f-8046-0d4e125117d3", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:57271 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 19:48:43,921", "levelname": "INFO", "message": "request", "request_id": "88f7a391-3eb2-4b6e-9b8e-7e9ef21b82d4", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:57304 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 19:48:43,957", "levelname": "INFO", "message": "request", "request_id": "6d38630c-55ff-4a66-a11d-f46f91ee633f", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 22}
INFO:     127.0.0.1:57305 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6834,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758163723720.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5174,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758163729054.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 19:48:49 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758163739372.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10204.17
  }
}

2025-09-17 19:48:59 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758163745089.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5462
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758163754690.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9545.33
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 90,
  "sample": {
    "symbol": "ANET",
    "score": 88.1,
    "entry": 85.0733,
    "stop": 80.3286,
    "targets": [
      92.5013,
      97.4533
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 91.66,
          "x2": "2025-09-15",
          "y2": 84.65,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 79.28,
          "x2": "2025-09-15",
          "y2": 81.14,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 82.895
        }
      ],
      "priceLevels": {
        "entry": 85.0733,
        "stop": 80.3286,
        "targets": [
          92.5013,
          97.4533
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.28",
        "slope gap 0.0170"
      ],
      "direction": "falling",
      "atr14": 4.5893,
      "sector": "Technology"
    },
    "avg_price": 67.01066678365072,
    "avg_volume": 13724511.066666666,
    "key_levels": {
      "entry": 85.0733,
      "stop": 80.3286,
      "targets": [
        92.5013,
        97.4533
      ]
    },
    "atr14": 4.5893,
    "sector": "Technology",
    "chart_url": "https://legend-shots.onrender.com/reports/ANET-1758163791030.png"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30315.03
  }
}
2025-09-17 19:50:59 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 02:51:02.692964', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 19:51:02 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 19:51:08 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 19:51:08 Sleeping 5m before next iteration
2025-09-17 19:56:08 === Iteration 43 ===
2025-09-17 19:56:08 venv exists
2025-09-17 19:56:08 Installing Python requirements
2025-09-17 19:56:09 shots: node_modules present
2025-09-17 19:56:09 frontend: node_modules present
2025-09-17 19:56:09 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 8.25s
2025-09-17 19:56:18 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 19:56:18 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 19:56:18 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 19:56:13,414", "levelname": "INFO", "message": "request", "request_id": "66ed3712-0a9d-456c-8e64-201326bec1fc", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 11}
INFO:     127.0.0.1:58077 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 19:56:13,421", "levelname": "INFO", "message": "request", "request_id": "1b12d24a-5711-4732-88e3-76db463d18d4", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:58080 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 19:56:18,574", "levelname": "INFO", "message": "request", "request_id": "51a33141-b4fa-4893-998d-267802943d9d", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:58102 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 19:56:25,014", "levelname": "INFO", "message": "request", "request_id": "033fb981-ad3e-4a2f-ab7b-de2ad5a99faa", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:58135 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 19:56:25,062", "levelname": "INFO", "message": "request", "request_id": "1c239782-137f-4df1-b42c-029502b5a8d4", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 36}
INFO:     127.0.0.1:58136 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6305,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758164184808.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5341,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758164190343.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 19:56:30 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758164200855.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10285.77
  }
}

2025-09-17 19:56:40 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758164206295.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5273
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758164215654.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9411.51
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 141,
  "sample": {
    "symbol": "AVGO",
    "score": 88.1,
    "entry": 85.0733,
    "stop": 80.3286,
    "targets": [
      92.5013,
      97.4533
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 91.66,
          "x2": "2025-09-15",
          "y2": 84.65,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 79.28,
          "x2": "2025-09-15",
          "y2": 81.14,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 82.895
        }
      ],
      "priceLevels": {
        "entry": 85.0733,
        "stop": 80.3286,
        "targets": [
          92.5013,
          97.4533
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.28",
        "slope gap 0.0170"
      ],
      "direction": "falling",
      "atr14": 4.5893,
      "sector": "Technology"
    },
    "avg_price": 67.01066678365072,
    "avg_volume": 13724511.066666666,
    "key_levels": {
      "entry": 85.0733,
      "stop": 80.3286,
      "targets": [
        92.5013,
        97.4533
      ]
    },
    "atr14": 4.5893,
    "sector": "Technology",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AVGO+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30345.37
  }
}
2025-09-17 19:58:39 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 02:58:43.624342', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 19:58:43 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 19:58:50 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 19:58:50 Sleeping 5m before next iteration
2025-09-17 20:03:50 === Iteration 44 ===
2025-09-17 20:03:50 venv exists
2025-09-17 20:03:50 Installing Python requirements
2025-09-17 20:03:50 shots: node_modules present
2025-09-17 20:03:50 frontend: node_modules present
2025-09-17 20:03:50 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 8.91s
2025-09-17 20:04:00 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 20:04:00 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 20:04:01 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:03:55,918", "levelname": "INFO", "message": "request", "request_id": "83ad6749-9ac4-4aeb-829b-f656444f3229", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 27}
INFO:     127.0.0.1:58966 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 20:03:55,926", "levelname": "INFO", "message": "request", "request_id": "4af2e61a-1568-4329-ac3b-ee18cb4fa321", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:58969 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:04:01,021", "levelname": "INFO", "message": "request", "request_id": "1c8a39bd-279e-4875-9ece-1e86f494c4f2", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:58994 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:04:07,758", "levelname": "INFO", "message": "request", "request_id": "8fd1ef30-dcc2-4563-8278-703c8aa4ab43", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:59024 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:04:07,833", "levelname": "INFO", "message": "request", "request_id": "2ad2e791-c352-4d01-95e7-a12d0e685573", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 60}
INFO:     127.0.0.1:59025 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6527,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758164647549.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 6384,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758164654148.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 20:04:14 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758164665436.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 11009.57
  }
}

2025-09-17 20:04:25 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758164671466.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5929
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758164679050.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 7557.38
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 136,
  "sample": {
    "symbol": "ISRG",
    "score": 80.6,
    "entry": 192.6686,
    "stop": 182.9025,
    "targets": [
      202.3226,
      208.7586
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 232.68,
          "x2": "2025-09-15",
          "y2": 191.71,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 216.59,
          "x2": "2025-09-15",
          "y2": 184.75,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 188.23
        }
      ],
      "priceLevels": {
        "entry": 192.6686,
        "stop": 182.9025,
        "targets": [
          202.3226,
          208.7586
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.43",
        "slope gap 0.0045"
      ],
      "direction": "falling",
      "atr14": 12.9686
    },
    "avg_price": 168.3730005900065,
    "avg_volume": 9577806.633333333,
    "key_levels": {
      "entry": 192.6686,
      "stop": 182.9025,
      "targets": [
        202.3226,
        208.7586
      ]
    },
    "atr14": 12.9686,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=ISRG+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30306.44
  }
}
2025-09-17 20:06:23 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 03:06:27.748176', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 20:06:27 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 20:06:34 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 20:06:35 Sleeping 5m before next iteration
2025-09-17 20:11:35 === Iteration 45 ===
2025-09-17 20:11:35 venv exists
2025-09-17 20:11:35 Installing Python requirements
2025-09-17 20:11:35 shots: node_modules present
2025-09-17 20:11:35 frontend: node_modules present
2025-09-17 20:11:35 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 8.77s
2025-09-17 20:11:45 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 20:11:45 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 20:11:45 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:11:40,419", "levelname": "INFO", "message": "request", "request_id": "2d7abefc-90d4-484c-8665-1bda113323d3", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 51}
INFO:     127.0.0.1:59861 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 20:11:40,427", "levelname": "INFO", "message": "request", "request_id": "b6a53689-5627-4e9c-ba61-c68ff19f2e26", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:59864 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:11:45,605", "levelname": "INFO", "message": "request", "request_id": "15e8dc66-1fc0-4b0f-811d-2468f4f4bf5c", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:59887 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:11:52,814", "levelname": "INFO", "message": "request", "request_id": "d9f461a6-e1db-45eb-b350-bcbe3828739d", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:59927 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:11:52,881", "levelname": "INFO", "message": "request", "request_id": "5c97d2bf-5712-4f29-ad4c-1445be818880", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 54}
INFO:     127.0.0.1:59928 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 7001,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758165112597.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5202,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758165118012.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 20:11:58 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758165129651.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 11389.8
  }
}

2025-09-17 20:12:09 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758165135546.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5746
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758165145150.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9630.84
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 131,
  "sample": {
    "symbol": "SYF",
    "score": 84.29,
    "entry": 75.9177,
    "stop": 71.7552,
    "targets": [
      80.894,
      84.2116
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 104.7729,
          "x2": "2025-09-15",
          "y2": 75.54,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 96.479,
          "x2": "2025-09-15",
          "y2": 72.48,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 74.01
        }
      ],
      "priceLevels": {
        "entry": 75.9177,
        "stop": 71.7552,
        "targets": [
          80.894,
          84.2116
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.37",
        "slope gap 0.0201"
      ],
      "direction": "falling",
      "atr14": 4.335
    },
    "avg_price": 68.79065246582032,
    "avg_volume": 15929483.233333332,
    "key_levels": {
      "entry": 75.9177,
      "stop": 71.7552,
      "targets": [
        80.894,
        84.2116
      ]
    },
    "atr14": 4.335,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=SYF+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30247.5
  }
}
2025-09-17 20:14:09 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 03:14:15.628023', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 20:14:15 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 20:14:22 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 20:14:22 Sleeping 5m before next iteration
2025-09-17 20:19:22 === Iteration 46 ===
2025-09-17 20:19:22 venv exists
2025-09-17 20:19:22 Installing Python requirements
2025-09-17 20:19:22 shots: node_modules present
2025-09-17 20:19:22 frontend: node_modules present
2025-09-17 20:19:22 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 8.35s
2025-09-17 20:19:32 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 20:19:32 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 20:19:32 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:19:27,151", "levelname": "INFO", "message": "request", "request_id": "4d7eb349-f413-40b5-8290-3d6983e1d0a2", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 16}
INFO:     127.0.0.1:60715 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 20:19:27,155", "levelname": "INFO", "message": "request", "request_id": "b2f808fe-fc2f-4811-8a54-87308ea20435", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:60718 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:19:32,161", "levelname": "INFO", "message": "request", "request_id": "2aa64010-4446-4623-8861-e3905652ffcf", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:60742 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:19:39,033", "levelname": "INFO", "message": "request", "request_id": "648e060c-9bff-4eac-b8ff-6688f404852f", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 5}
INFO:     127.0.0.1:60773 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:19:39,092", "levelname": "INFO", "message": "request", "request_id": "1b98f988-9ad5-4b34-bb36-a2ac86a298e2", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 40}
INFO:     127.0.0.1:60774 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6721,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758165578816.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5273,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758165584287.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 20:19:44 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758165594849.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10318.73
  }
}

2025-09-17 20:19:54 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758165600585.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5565
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758165609965.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9386.14
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 136,
  "sample": {
    "symbol": "DE",
    "score": 89.73,
    "entry": 69.6163,
    "stop": 67.7259,
    "targets": [
      71.8387,
      73.3203
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 66.8,
          "x2": "2025-09-15",
          "y2": 69.27,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 63.096,
          "x2": "2025-09-15",
          "y2": 68.41,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 68.84
        }
      ],
      "priceLevels": {
        "entry": 69.6163,
        "stop": 67.7259,
        "targets": [
          71.8387,
          73.3203
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.23",
        "slope gap 0.0095"
      ],
      "direction": "falling",
      "atr14": 4.025
    },
    "avg_price": 58.824666595458986,
    "avg_volume": 10466750.766666668,
    "key_levels": {
      "entry": 69.6163,
      "stop": 67.7259,
      "targets": [
        71.8387,
        73.3203
      ]
    },
    "atr14": 4.025,
    "chart_url": "https://legend-shots.onrender.com/reports/DE-1758165673333.png"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/AAPL-1758165716059.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": false,
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 31909.46
  }
}
2025-09-17 20:21:56 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 03:22:01.716700', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 20:22:01 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 20:22:08 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 20:22:08 Sleeping 5m before next iteration
2025-09-17 20:27:08 === Iteration 47 ===
2025-09-17 20:27:08 venv exists
2025-09-17 20:27:08 Installing Python requirements
2025-09-17 20:27:09 shots: node_modules present
2025-09-17 20:27:09 frontend: node_modules present
2025-09-17 20:27:09 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 8.29s
2025-09-17 20:27:19 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 20:27:19 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 20:27:19 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:27:13,639", "levelname": "INFO", "message": "request", "request_id": "d31aaebf-e68e-47e1-8558-ebd7bc759752", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 13}
INFO:     127.0.0.1:61576 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 20:27:13,648", "levelname": "INFO", "message": "request", "request_id": "ba05dc64-293d-4cab-a6ec-1b05a6b326d3", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:61579 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:27:19,148", "levelname": "INFO", "message": "request", "request_id": "9aa86e72-ca91-461d-b6d9-fed34e52a0ed", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 5}
INFO:     127.0.0.1:61603 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:27:25,823", "levelname": "INFO", "message": "request", "request_id": "1424a007-e1e8-4889-ade6-39a7d9dd504e", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:61632 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:27:25,892", "levelname": "INFO", "message": "request", "request_id": "0ebadeb0-da65-4e5e-bbb0-1d147af8dc90", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 56}
INFO:     127.0.0.1:61633 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6485,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758166045612.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5085,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758166050889.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 20:27:31 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758166061331.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10214.92
  }
}

2025-09-17 20:27:41 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758166067301.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5770
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758166076563.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9198.75
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 174,
  "sample": {
    "symbol": "MRNA",
    "score": 88.91,
    "entry": 187.121,
    "stop": 178.0713,
    "targets": [
      201.4358,
      210.9791
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 284.755,
          "x2": "2025-09-15",
          "y2": 186.19,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 260.8969,
          "x2": "2025-09-15",
          "y2": 179.87,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 183.03
        }
      ],
      "priceLevels": {
        "entry": 187.121,
        "stop": 178.0713,
        "targets": [
          201.4358,
          210.9791
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.26",
        "slope gap 0.0683"
      ],
      "direction": "falling",
      "atr14": 9.5991
    },
    "avg_price": 208.48872884114584,
    "avg_volume": 2946465.566666667,
    "key_levels": {
      "entry": 187.121,
      "stop": 178.0713,
      "targets": [
        201.4358,
        210.9791
      ]
    },
    "atr14": 9.5991,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=MRNA+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30287.01
  }
}
2025-09-17 20:29:40 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 03:29:44.258790', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 20:29:44 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 20:29:51 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 20:29:51 Sleeping 5m before next iteration
2025-09-17 20:34:51 === Iteration 48 ===
2025-09-17 20:34:51 venv exists
2025-09-17 20:34:51 Installing Python requirements
2025-09-17 20:34:51 shots: node_modules present
2025-09-17 20:34:51 frontend: node_modules present
2025-09-17 20:34:51 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 8.42s
2025-09-17 20:35:01 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 20:35:01 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 20:35:01 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:34:56,170", "levelname": "INFO", "message": "request", "request_id": "65c543bd-720a-4aba-a5d9-889857853ee4", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 14}
INFO:     127.0.0.1:62462 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 20:34:56,179", "levelname": "INFO", "message": "request", "request_id": "17736519-c459-461d-af79-299a7d110aae", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:62465 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:35:01,578", "levelname": "INFO", "message": "request", "request_id": "17124d6c-6ea6-45c3-81ca-276fece6132a", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 4}
INFO:     127.0.0.1:62490 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:35:09,397", "levelname": "INFO", "message": "request", "request_id": "16fafb81-c0ee-42cb-8d6b-6b8d3037d68d", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:62523 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:35:09,478", "levelname": "INFO", "message": "request", "request_id": "aaac25da-0ab7-4d6e-961e-845ae0b34fb4", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 64}
INFO:     127.0.0.1:62524 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 7641,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758166509187.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 7630,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758166517068.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 20:35:17 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758166528143.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10941.92
  }
}

2025-09-17 20:35:28 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758166534253.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5734
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758166543944.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9595.28
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 130,
  "sample": {
    "symbol": "DIS",
    "score": 88.5,
    "entry": 106.7712,
    "stop": 102.3066,
    "targets": [
      112.9863,
      117.1297
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 136.2477,
          "x2": "2025-09-15",
          "y2": 106.24,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 125.8892,
          "x2": "2025-09-15",
          "y2": 103.34,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 104.79
        }
      ],
      "priceLevels": {
        "entry": 106.7712,
        "stop": 102.3066,
        "targets": [
          112.9863,
          117.1297
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.28",
        "slope gap 0.0487"
      ],
      "direction": "falling",
      "atr14": 5.3883,
      "sector": "Communication Services"
    },
    "avg_price": 100.27833760579428,
    "avg_volume": 18073049.5,
    "key_levels": {
      "entry": 106.7712,
      "stop": 102.3066,
      "targets": [
        112.9863,
        117.1297
      ]
    },
    "atr14": 5.3883,
    "sector": "Communication Services",
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=DIS+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30342.25
  }
}
2025-09-17 20:37:28 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 03:37:32.705225', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 20:37:32 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 20:37:38 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 20:37:38 Sleeping 5m before next iteration
2025-09-17 20:42:38 === Iteration 49 ===
2025-09-17 20:42:38 venv exists
2025-09-17 20:42:38 Installing Python requirements
2025-09-17 20:42:39 shots: node_modules present
2025-09-17 20:42:39 frontend: node_modules present
2025-09-17 20:42:39 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 8.14s
2025-09-17 20:42:48 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 20:42:48 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 20:42:48 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:42:43,641", "levelname": "INFO", "message": "request", "request_id": "52ab8f59-1d90-4ab5-b6e7-196ac9c2b0b1", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 23}
INFO:     127.0.0.1:63331 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 20:42:43,651", "levelname": "INFO", "message": "request", "request_id": "1ebab3c6-05b5-4486-a9ec-091a6ad9d30f", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:63334 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:42:48,527", "levelname": "INFO", "message": "request", "request_id": "aa6a6f41-d189-46e2-b94f-aa658878943e", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:63357 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:42:55,927", "levelname": "INFO", "message": "request", "request_id": "f45492b7-92b3-4ab7-8671-636a960c6cb1", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 1}
INFO:     127.0.0.1:63395 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:42:56,000", "levelname": "INFO", "message": "request", "request_id": "65d7412e-64b9-42f1-a02a-83438732208e", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 61}
INFO:     127.0.0.1:63396 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 7159,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758166975682.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5155,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758166981098.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 20:43:01 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758166992076.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 10609.86
  }
}

2025-09-17 20:43:12 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758166998067.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5790
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758167008058.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9927.54
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 130,
  "sample": {
    "symbol": "ORLY",
    "score": 85.78,
    "entry": 73.7469,
    "stop": 70.8939,
    "targets": [
      77.198,
      79.4988
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 104.2589,
          "x2": "2025-09-15",
          "y2": 73.38,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 98.507,
          "x2": "2025-09-15",
          "y2": 71.61,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 72.495
        }
      ],
      "priceLevels": {
        "entry": 73.7469,
        "stop": 70.8939,
        "targets": [
          77.198,
          79.4988
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.31",
        "slope gap 0.0002"
      ],
      "direction": "falling",
      "atr14": 4.8596,
      "sector": "Consumer Cyclical"
    },
    "avg_price": 67.44640210469564,
    "avg_volume": 80247007.46666667,
    "key_levels": {
      "entry": 73.7469,
      "stop": 70.8939,
      "targets": [
        77.198,
        79.4988
      ]
    },
    "atr14": 4.8596,
    "sector": "Consumer Cyclical",
    "chart_url": "https://legend-shots.onrender.com/reports/ORLY-1758167045534.png"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30336.19
  }
}
2025-09-17 20:44:47 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 03:44:51.494429', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 20:44:51 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 20:44:58 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 20:44:58 Sleeping 5m before next iteration
2025-09-17 20:49:58 === Iteration 50 ===
2025-09-17 20:49:58 venv exists
2025-09-17 20:49:58 Installing Python requirements
2025-09-17 20:49:58 shots: node_modules present
2025-09-17 20:49:58 frontend: node_modules present
2025-09-17 20:49:58 Running unit tests (pytest)
source .venv/bin/activate && pip install pytest && pytest -q
Requirement already satisfied: pytest in ./.venv/lib/python3.13/site-packages (8.4.2)
Requirement already satisfied: iniconfig>=1 in ./.venv/lib/python3.13/site-packages (from pytest) (2.1.0)
Requirement already satisfied: packaging>=20 in ./.venv/lib/python3.13/site-packages (from pytest) (25.0)
Requirement already satisfied: pluggy<2,>=1.5 in ./.venv/lib/python3.13/site-packages (from pytest) (1.6.0)
Requirement already satisfied: pygments>=2.7.2 in ./.venv/lib/python3.13/site-packages (from pytest) (2.19.2)
....................                                                     [100%]
=============================== warnings summary ===============================
.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

tests/test_backtest_smoke.py::test_walk_forward_smoke
  /Users/kyleholthaus/Projects/LegendAI/.venv/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
20 passed, 2 warnings in 8.95s
2025-09-17 20:50:09 Starting dev services (tmux: api, shots, fe)
‚ÑπÔ∏è  api already running
‚ÑπÔ∏è  shots already running
‚ÑπÔ∏è  fe already running
2025-09-17 20:50:09 Waiting for http://127.0.0.1:8000/healthz (timeout 60s)
2025-09-17 20:50:09 OK: http://127.0.0.1:8000/healthz
tmux sessions:
api: 1 windows (created Wed Sep 17 00:16:39 2025)
fe: 1 windows (created Wed Sep 17 00:16:39 2025)
legend-docs: 1 windows (created Wed Sep 17 14:26:51 2025)
legend-orch: 1 windows (created Wed Sep 17 17:11:53 2025)
shots: 1 windows (created Wed Sep 17 00:16:39 2025)

Ports:
python3.1 25033 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      25037 kyleholthaus   14u  IPv6 0xfb59ceae73d88c29      0t0  TCP *:3010 (LISTEN)
python3.1 50588 kyleholthaus    3u  IPv4 0xc65d299e6adc136a      0t0  TCP *:8000 (LISTEN)
node      58774 kyleholthaus   16u  IPv6 0x92092ec8b13ee272      0t0  TCP *:3001 (LISTEN)
python3.1 86663 kyleholthaus    8u  IPv4 0xf36556964144c05e      0t0  TCP 127.0.0.1:8000 (LISTEN)

Health checks:
{"ok":true,"version":"0.1.0"}
‚úÖ signals ok
‚úÖ shots ok
‚úÖ screenshot ok

Last 10 lines of logs:
---- logs/api.log ----
{"asctime": "2025-09-17 20:50:04,562", "levelname": "INFO", "message": "request", "request_id": "0820b2df-725f-405b-879b-276a8d23a12b", "path": "/api/v1/runs", "method": "POST", "status_code": 202, "duration_ms": 11}
INFO:     127.0.0.1:64227 - "POST /api/v1/runs?start=2024-01-01&end=2024-01-31&universe=simple&provider=yfinance HTTP/1.1" 202 Accepted
{"asctime": "2025-09-17 20:50:04,569", "levelname": "INFO", "message": "request", "request_id": "724b506f-90b2-41b1-bab9-7cee7cf0ed38", "path": "/scan/AAPL", "method": "GET", "status_code": 200, "duration_ms": 3}
INFO:     127.0.0.1:64230 - "GET /scan/AAPL HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:09,470", "levelname": "INFO", "message": "request", "request_id": "c0a75868-0e3e-4c96-b2f4-778a1547459a", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 2}
INFO:     127.0.0.1:64254 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:16,339", "levelname": "INFO", "message": "request", "request_id": "d2457979-5037-499b-b19b-943f27c5022e", "path": "/healthz", "method": "GET", "status_code": 200, "duration_ms": 7}
INFO:     127.0.0.1:64285 - "GET /healthz HTTP/1.1" 200 OK
{"asctime": "2025-09-17 20:50:16,388", "levelname": "INFO", "message": "request", "request_id": "d762e21d-56a8-42f0-91e4-21c8f8b750ea", "path": "/api/v1/signals", "method": "GET", "status_code": 200, "duration_ms": 27}
INFO:     127.0.0.1:64286 - "GET /api/v1/signals?symbol=NVDA HTTP/1.1" 200 OK
---- logs/shots.log ----
  duration_ms: 6681,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167416096.png'
}
shot_render_success {
  symbol: 'NVDA',
  duration_ms: 5225,
  overlay_counts: { lines: 0, boxes: 0, labels: 0, arrows: 0, zones: 0 },
  file: 'NVDA-1758167421546.png'
}
---- logs/fe.log ----

 ‚úì Starting...
 ‚úì Ready in 1113ms
 ‚ö† Found a change in next.config.mjs. Restarting the server to apply the changes...
  ‚ñ≤ Next.js 14.2.5
  - Local:        http://localhost:3001
  - Environments: .env

 ‚úì Starting...
 ‚úì Ready in 1691ms
2025-09-17 20:50:21 Running smoke checks from docs/DEV_RUN.md
{"ok":true,"version":"0.1.0"}
true
{
  "hit_rate": 0.62,
  "precision_at_10": 0.7,
  "precision_at_25": 0.66,
  "coverage": 125,
  "median_runup": 0.047
}
"Buy"

"NVDA"
false

53.0
"Neutral"
false

"neutral"
true

{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758167432957.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 11072.38
  }
}

2025-09-17 20:50:33 Running legend_check.sh against local services
API /healthz ‚Ä¶
{"ok":true,"version":"0.1.0"}
Signals (NVDA) ‚Ä¶
53.0
"Neutral"
Shots (NVDA) ‚Ä¶
{
  "chart_url": "http://127.0.0.1:3010/reports/NVDA-1758167438773.png",
  "overlay_counts": {
    "lines": 0,
    "boxes": 0,
    "labels": 0,
    "arrows": 0,
    "zones": 0
  },
  "duration_ms": 5762
}
API ‚Üí chart (NVDA) ‚Ä¶
{
  "chart_url": "https://legend-shots.onrender.com/reports/NVDA-1758167448756.png",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": false,
    "fallback": false,
    "overlay_counts": {
      "lines": 0,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 9843.59
  }
}
Weekly scan (WEDGE, timeframe=1wk) ‚Ä¶
{
  "count": 92,
  "sample": {
    "symbol": "CCL",
    "score": 83.77,
    "entry": 28.2506,
    "stop": 26.8389,
    "targets": [
      29.9898,
      31.1494
    ],
    "pattern": "wedge",
    "overlays": {
      "lines": [
        {
          "x1": "2024-01-01",
          "y1": 55.3463,
          "x2": "2025-09-15",
          "y2": 28.11,
          "color": "#ab47bc",
          "dash": true
        },
        {
          "x1": "2024-01-01",
          "y1": 52.4474,
          "x2": "2025-09-15",
          "y2": 27.11,
          "color": "#ab47bc",
          "dash": true
        }
      ],
      "boxes": [],
      "labels": [
        {
          "text": "Falling wedge",
          "x": "2025-07-14",
          "y": 27.61
        }
      ],
      "priceLevels": {
        "entry": 28.2506,
        "stop": 26.8389,
        "targets": [
          29.9898,
          31.1494
        ]
      }
    },
    "meta": {
      "evidence": [
        "spread compression 0.34",
        "slope gap 0.0026"
      ],
      "direction": "falling",
      "atr14": 1.9824
    },
    "avg_price": 30.925524266560874,
    "avg_volume": 18955150.0,
    "key_levels": {
      "entry": 28.2506,
      "stop": 26.8389,
      "targets": [
        29.9898,
        31.1494
      ]
    },
    "atr14": 1.9824,
    "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=CCL+Chart"
  }
}
Chart overlay POST (AAPL) ‚Ä¶
{
  "chart_url": "https://dummyimage.com/1200x628/0b1221/9be7ff.png&text=AAPL+Chart",
  "meta": {
    "source": "https://legend-shots.onrender.com",
    "overlay_applied": true,
    "fallback": true,
    "error": "shot-failed",
    "overlay_counts": {
      "lines": 1,
      "boxes": 0,
      "labels": 0,
      "arrows": 0,
      "zones": 0
    },
    "duration_ms": 30417.89
  }
}
2025-09-17 20:52:33 Running sample backtest
source .venv/bin/activate && python -m backtest.run_backtest --start 2024-01-01 --end 2024-03-31 --universe simple --provider yfinance
[warn] failed to persist run: (sqlite3.IntegrityError) UNIQUE constraint failed: backtest_runs.start, backtest_runs.end, backtest_runs.universe, backtest_runs.provider, backtest_runs.detector_version
[SQL: INSERT INTO backtest_runs (created_at, start, "end", universe, provider, status, duration_ms, error_message, detector_version, code_commit, artifacts_root, precision_at_10, precision_at_25, hit_rate, median_runup, num_candidates, num_triggers, num_success) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('2025-09-18 03:52:37.030899', '2024-01-01', '2024-03-31', 'simple', 'yfinance', 'pending', None, None, 'v1', None, '/Users/kyleholthaus/Projects/LegendAI/backtest/reports', 0.0, 0.0, 0.0, 0.0, 0, 0, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
backtest/reports/summary/summary_2024-01-01_2024-03-31.json
2025-09-17 20:52:37 Phase 4 optional: AI trading demo
‚úÖ pandas ok
‚úÖ numpy ok
‚úÖ yfinance ok
‚úÖ ta ok
‚úÖ transformers ok
‚úÖ torch ok
[
  {
    "symbol": "NVDA",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AAPL",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "MSFT",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  },
  {
    "symbol": "AMD",
    "error": "Data must be 1-dimensional, got ndarray of shape (250, 1) instead"
  }
]
2025-09-17 20:52:43 Deploy skipped (DO_DEPLOY!=1)
2025-09-17 20:52:44 Sleeping 5m before next iteration
